(function(c){var b=function(b,c){this.init("simplecolorpicker",b,c)};b.prototype={constructor:b,init:function(b,f,a){var g=this;g.type=b;g.$select=c(f);g.$select.hide();g.options=c.extend({},c.fn.simplecolorpicker.defaults,a);g.$colorList=null;!0===g.options.picker?(b=g.$select.find("> option:selected").text(),g.$icon=c('<span class="simplecolorpicker icon" title="'+b+'" style="background-color: '+g.$select.val()+';" role="button" tabindex="0"></span>').insertAfter(g.$select),g.$icon.on("click."+
g.type,c.proxy(g.showPicker,g)),g.$picker=c('<span class="simplecolorpicker picker '+g.options.theme+'"></span>').appendTo(document.body),g.$colorList=g.$picker,c(document).on("mousedown."+g.type,c.proxy(g.hidePicker,g)),g.$picker.on("mousedown."+g.type,c.proxy(g.mousedown,g))):(g.$inline=c('<span class="simplecolorpicker inline '+g.options.theme+'"></span>').insertAfter(g.$select),g.$colorList=g.$inline);g.$select.find("> option").each(function(){var a=c(this),b=a.val(),h=a.is(":selected"),m=a.is(":disabled"),
n="";!0===h&&(n=" data-selected");h="";!0===m&&(h=" data-disabled");var d="";!1===m&&(d=' title="'+a.text()+'"');var w="";!1===m&&(w=' role="button" tabindex="0"');b=c('<span class="color"'+d+' style="background-color: '+b+';" data-color="'+b+'"'+n+h+w+"></span>");g.$colorList.append(b);b.on("click."+g.type,c.proxy(g.colorSpanClicked,g));!0===a.next().is("optgroup")&&g.$colorList.append('<span class="vr"></span>')})},selectColor:function(b){var f=this.$colorList.find("> span.color").filter(function(){return c(this).data("color").toLowerCase()===
b.toLowerCase()});0<f.length?this.selectColorSpan(f):console.error("The given color '"+b+"' could not be found")},showPicker:function(){var b=this.$icon.offset();this.$picker.css({left:b.left-6,top:b.top+this.$icon.outerHeight()});this.$picker.show(this.options.pickerDelay)},hidePicker:function(){this.$picker.hide(this.options.pickerDelay)},selectColorSpan:function(b){var c=b.data("color"),a=b.prop("title");b.siblings().removeAttr("data-selected");b.attr("data-selected","");!0===this.options.picker&&
(this.$icon.css("background-color",c),this.$icon.prop("title",a),this.hidePicker());this.$select.val(c)},colorSpanClicked:function(b){!1===c(b.target).is("[data-disabled]")&&(this.selectColorSpan(c(b.target)),this.$select.trigger("change"))},mousedown:function(b){b.stopPropagation();b.preventDefault()},destroy:function(){!0===this.options.picker&&(this.$icon.off("."+this.type),this.$icon.remove(),c(document).off("."+this.type));this.$colorList.off("."+this.type);this.$colorList.remove();this.$select.removeData(this.type);
this.$select.show()}};c.fn.simplecolorpicker=function(d){var f=c.makeArray(arguments);f.shift();return this.each(function(){var a=c(this),g=a.data("simplecolorpicker"),e="object"===typeof d&&d;void 0===g&&a.data("simplecolorpicker",g=new b(this,e));"string"===typeof d&&g[d].apply(g,f)})};c.fn.simplecolorpicker.defaults={theme:"",picker:!1,pickerDelay:0}})(jQuery);/*

 pixi.js - v3.0.9
 Compiled 2015-12-22T18:28:46.266Z

 pixi.js is licensed under the MIT License.
 http://www.opensource.org/licenses/mit-license.php


 The MIT License

 Copyright (c) 2013-2015 Mathew Groves

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.


   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
*/
(function(c){"object"===typeof exports&&"undefined"!==typeof module?module.exports=c():"function"===typeof define&&define.amd?define([],c):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).PIXI=c()})(function(){return function b(c,f,a){function g(h,k){if(!f[h]){if(!c[h]){var n="function"==typeof require&&require;if(!k&&n)return n(h,!0);if(e)return e(h,!0);n=Error("Cannot find module '"+h+"'");throw n.code="MODULE_NOT_FOUND",n;}n=f[h]={exports:{}};
c[h][0].call(n.exports,function(a){var b=c[h][1][a];return g(b?b:a)},n,n.exports,b,c,f,a)}return f[h].exports}for(var e="function"==typeof require&&require,k=0;k<a.length;k++)g(a[k]);return g}({1:[function(b,c,f){(function(a,b){(function(){function e(){}function k(a){return a}function h(a){return!!a}function m(a){return!a}function n(a){return function(){if(null===a)throw Error("Callback was already called.");a.apply(this,arguments);a=null}}function q(a){return function(){null!==a&&(a.apply(this,arguments),
a=null)}}function w(a){return S(a)||"number"===typeof a.length&&0<=a.length&&0===a.length%1}function p(a,b){for(var e=-1,h=a.length;++e<h;)b(a[e],e,a)}function v(a,b){for(var e=-1,h=a.length,k=Array(h);++e<h;)k[e]=b(a[e],e,a);return k}function f(a){return v(Array(a),function(a,b){return b})}function u(a,b,e){p(a,function(a,h,k){e=b(e,a,h,k)});return e}function t(a,b){p(U(a),function(e){b(a[e],e)})}function D(a,b){for(var e=0;e<a.length;e++)if(a[e]===b)return e;return-1}function G(a){var b=-1,e,h;
if(w(a))return e=a.length,function(){b++;return b<e?b:null};h=U(a);e=h.length;return function(){b++;return b<e?h[b]:null}}function A(a,b){b=null==b?a.length-1:+b;return function(){for(var e=Math.max(arguments.length-b,0),h=Array(e),k=0;k<e;k++)h[k]=arguments[k+b];switch(b){case 0:return a.call(this,h);case 1:return a.call(this,arguments[0],h)}}}function z(a){return function(b,e,h){return a(b,h)}}function C(a){return function(b,h,k){k=q(k||e);b=b||[];var m=G(b);if(0>=a)return k(null);var c=!1,d=0,
g=!1;(function Y(){if(c&&0>=d)return k(null);for(;d<a&&!g;){var e=m();if(null===e){c=!0;0>=d&&k(null);break}d+=1;h(b[e],e,n(function(a){--d;a?(k(a),g=!0):Y()}))}})()}}function I(a){return function(b,e,h){return a(y.eachOf,b,e,h)}}function M(a){return function(b,e,h,k){return a(C(e),b,h,k)}}function N(a){return function(b,e,h){return a(y.eachOfSeries,b,e,h)}}function L(a,b,h,k){k=q(k||e);b=b||[];var m=w(b)?[]:{};a(b,function(a,b,e){h(a,function(a,h){m[b]=h;e(a)})},function(a){k(a,m)})}function J(a,
b,e,h){var k=[];a(b,function(a,b,h){e(a,function(e){e&&k.push({index:b,value:a});h()})},function(){h(v(k.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})}function B(a,b,e,h){J(a,b,function(a,b){e(a,function(a){b(!a)})},h)}function x(a,b,e){return function(h,k,m,c){function n(){c&&c(e(!1,void 0))}function d(a,h,k){if(!c)return k();m(a,function(h){c&&b(h)&&(c(e(!0,a)),c=m=!1);k()})}3<arguments.length?a(h,k,d,n):(c=m,m=k,a(h,d,n))}}function H(a,b){return b}function K(a,b,h){h=
h||e;var k=w(b)?[]:{};a(b,function(a,b,e){a(A(function(a,h){1>=h.length&&(h=h[0]);k[b]=h;e(a)}))},function(a){h(a,k)})}function O(a,b,e,h){var k=[];a(b,function(a,b,h){e(a,function(a,b){k=k.concat(b||[]);h(a)})},function(a){h(a,k)})}function F(a,b,h){function k(a,b,h,m){if(null!=m&&"function"!==typeof m)throw Error("task callback must be a function");a.started=!0;S(b)||(b=[b]);if(0===b.length&&a.idle())return y.setImmediate(function(){a.drain()});p(b,function(b){b={data:b,callback:m||e};h?a.tasks.unshift(b):
a.tasks.push(b);a.tasks.length===a.concurrency&&a.saturated()});y.setImmediate(a.process)}function m(a,b){return function(){--c;var e=!1,h=arguments;p(b,function(a){p(d,function(b,h){b!==a||e||(d.splice(h,1),e=!0)});a.callback.apply(a,h)});0===a.tasks.length+c&&a.drain();a.process()}}if(null==b)b=1;else if(0===b)throw Error("Concurrency must not be zero");var c=0,d=[],q={tasks:[],concurrency:b,payload:h,saturated:e,empty:e,drain:e,started:!1,paused:!1,push:function(a,b){k(q,a,!1,b)},kill:function(){q.drain=
e;q.tasks=[]},unshift:function(a,b){k(q,a,!0,b)},process:function(){if(!q.paused&&c<q.concurrency&&q.tasks.length)for(;c<q.concurrency&&q.tasks.length;){var b=q.payload?q.tasks.splice(0,q.payload):q.tasks.splice(0,q.tasks.length),e=v(b,function(a){return a.data});0===q.tasks.length&&q.empty();c+=1;d.push(b[0]);b=n(m(q,b));a(e,b)}},length:function(){return q.tasks.length},running:function(){return c},workersList:function(){return d},idle:function(){return 0===q.tasks.length+c},pause:function(){q.paused=
!0},resume:function(){if(!1!==q.paused){q.paused=!1;for(var a=Math.min(q.concurrency,q.tasks.length),b=1;b<=a;b++)y.setImmediate(q.process)}}};return q}function E(a){return A(function(b,e){b.apply(null,e.concat([A(function(b,e){"object"===typeof console&&(b?console.error&&console.error(b):console[a]&&p(e,function(b){console[a](b)}))})]))})}function P(a){return function(b,e,h){a(f(b),e,h)}}function Q(a){return A(function(b,e){var h=A(function(e){var h=this,k=e.pop();return a(b,function(a,b,k){a.apply(h,
e.concat([k]))},k)});return e.length?h.apply(this,e):h})}function R(a){return A(function(b){var e=b.pop();b.push(function(){var a=arguments;h?y.setImmediate(function(){e.apply(null,a)}):e.apply(null,a)});var h=!0;a.apply(this,b);h=!1})}var y={},W,T="object"===typeof self&&self.self===self&&self||"object"===typeof b&&b.global===b&&b||this;null!=T&&(W=T.async);y.noConflict=function(){T.async=W;return y};var Z=Object.prototype.toString,S=Array.isArray||function(a){return"[object Array]"===Z.call(a)},
aa=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},U=Object.keys||function(a){var b=[],e;for(e in a)a.hasOwnProperty(e)&&b.push(e);return b},V="function"===typeof setImmediate&&setImmediate,X=V?function(a){V(a)}:function(a){setTimeout(a,0)};y.nextTick="object"===typeof a&&"function"===typeof a.nextTick?a.nextTick:X;y.setImmediate=V?X:y.nextTick;y.forEach=y.each=function(a,b,e){return y.eachOf(a,z(b),e)};y.forEachSeries=y.eachSeries=function(a,b,e){return y.eachOfSeries(a,z(b),
e)};y.forEachLimit=y.eachLimit=function(a,b,e,h){return C(b)(a,z(e),h)};y.forEachOf=y.eachOf=function(a,b,h){function k(a){d--;a?h(a):null===c&&0>=d&&h(null)}h=q(h||e);a=a||[];for(var m=G(a),c,d=0;null!=(c=m());)d+=1,b(a[c],c,n(k));0===d&&h(null)};y.forEachOfSeries=y.eachOfSeries=function(a,b,h){function k(){var e=!0;if(null===c)return h(null);b(a[c],c,n(function(a){if(a)h(a);else{c=m();if(null===c)return h(null);e?y.setImmediate(k):k()}}));e=!1}h=q(h||e);a=a||[];var m=G(a),c=m();k()};y.forEachOfLimit=
y.eachOfLimit=function(a,b,e,h){C(b)(a,e,h)};y.map=I(L);y.mapSeries=N(L);y.mapLimit=M(L);y.inject=y.foldl=y.reduce=function(a,b,e,h){y.eachOfSeries(a,function(a,h,k){e(b,a,function(a,e){b=e;k(a)})},function(a){h(a,b)})};y.foldr=y.reduceRight=function(a,b,e,h){a=v(a,k).reverse();y.reduce(a,b,e,h)};y.transform=function(a,b,e,h){3===arguments.length&&(h=e,e=b,b=S(a)?[]:{});y.eachOf(a,function(a,h,k){e(b,a,h,k)},function(a){h(a,b)})};y.select=y.filter=I(J);y.selectLimit=y.filterLimit=M(J);y.selectSeries=
y.filterSeries=N(J);y.reject=I(B);y.rejectLimit=M(B);y.rejectSeries=N(B);y.any=y.some=x(y.eachOf,h,k);y.someLimit=x(y.eachOfLimit,h,k);y.all=y.every=x(y.eachOf,m,m);y.everyLimit=x(y.eachOfLimit,m,m);y.detect=x(y.eachOf,k,H);y.detectSeries=x(y.eachOfSeries,k,H);y.detectLimit=x(y.eachOfLimit,k,H);y.sortBy=function(a,b,e){function h(a,b){var e=a.criteria,k=b.criteria;return e<k?-1:e>k?1:0}y.map(a,function(a,e){b(a,function(b,h){b?e(b):e(null,{value:a,criteria:h})})},function(a,b){if(a)return e(a);e(null,
v(b.sort(h),function(a){return a.value}))})};y.auto=function(a,b,h){function k(){c--;p(g.slice(0),function(a){a()})}h||(h=b,b=null);h=q(h||e);var m=U(a),c=m.length;if(!c)return h(null);b||(b=c);var n={},d=0,g=[];g.unshift(function(){c||h(null,n)});p(m,function(e){function m(){return d<b&&u(w,function(a,b){return a&&n.hasOwnProperty(b)},!0)&&!n.hasOwnProperty(e)}function c(){if(m()){d++;var a=D(g,c);0<=a&&g.splice(a,1);q[q.length-1](p,n)}}for(var q=S(a[e])?a[e]:[a[e]],p=A(function(a,b){d--;1>=b.length&&
(b=b[0]);if(a){var m={};t(n,function(a,b){m[b]=a});m[e]=b;h(a,m)}else n[e]=b,y.setImmediate(k)}),w=q.slice(0,q.length-1),f=w.length,v;f--;){if(!(v=a[w[f]]))throw Error("Has inexistant dependency");if(S(v)&&0<=D(v,e))throw Error("Has cyclic dependencies");}m()?(d++,q[q.length-1](p,n)):g.unshift(c)})};y.retry=function(a,b,e){function h(a,b){if("number"===typeof b)a.times=parseInt(b,10)||5;else if("object"===typeof b)a.times=parseInt(b.times,10)||5,a.interval=parseInt(b.interval,10)||0;else throw Error("Unsupported argument type for 'times': "+
typeof b);}function k(a,b){function e(a,h){return function(e){a(function(a,b){e(!a||h,{err:a,result:b})},b)}}function h(a){return function(b){setTimeout(function(){b(null)},a)}}for(;c.times;){var n=!--c.times;m.push(e(c.task,n));!n&&0<c.interval&&m.push(h(c.interval))}y.series(m,function(b,e){e=e[e.length-1];(a||c.callback)(e.err,e.result)})}var m=[],c={times:5,interval:0},n=arguments.length;if(1>n||3<n)throw Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");
2>=n&&"function"===typeof a&&(e=b,b=a);"function"!==typeof a&&h(c,a);c.callback=e;c.task=b;return c.callback?k():k};y.waterfall=function(a,b){function h(a){return A(function(e,k){if(e)b.apply(null,[e].concat(k));else{var m=a.next();m?k.push(h(m)):k.push(b);R(a).apply(null,k)}})}b=q(b||e);if(!S(a))return b(Error("First argument to waterfall must be an array of functions"));if(!a.length)return b();h(y.iterator(a))()};y.parallel=function(a,b){K(y.eachOf,a,b)};y.parallelLimit=function(a,b,e){K(C(b),a,
e)};y.series=function(a,b){K(y.eachOfSeries,a,b)};y.iterator=function(a){function b(e){function h(){a.length&&a[e].apply(null,arguments);return h.next()}h.next=function(){return e<a.length-1?b(e+1):null};return h}return b(0)};y.apply=A(function(a,b){return A(function(e){return a.apply(null,b.concat(e))})});y.concat=I(O);y.concatSeries=N(O);y.whilst=function(a,b,h){h=h||e;if(a()){var k=A(function(e,m){e?h(e):a.apply(this,m)?b(k):h(null)});b(k)}else h(null)};y.doWhilst=function(a,b,e){var h=0;return y.whilst(function(){return 1>=
++h||b.apply(this,arguments)},a,e)};y.until=function(a,b,e){return y.whilst(function(){return!a.apply(this,arguments)},b,e)};y.doUntil=function(a,b,e){return y.doWhilst(a,function(){return!b.apply(this,arguments)},e)};y.during=function(a,b,h){h=h||e;var k=A(function(b,e){b?h(b):(e.push(m),a.apply(this,e))}),m=function(a,e){a?h(a):e?b(k):h(null)};a(m)};y.doDuring=function(a,b,e){var h=0;y.during(function(a){1>h++?a(null,!0):b.apply(this,arguments)},a,e)};y.queue=function(a,b){return F(function(b,e){a(b[0],
e)},b,1)};y.priorityQueue=function(a,b){function h(a,b){return a.priority-b.priority}function k(a,b,e){for(var h=-1,m=a.length-1;h<m;){var c=h+(m-h+1>>>1);0<=e(b,a[c])?h=c:m=c-1}return h}function m(a,b,c,n){if(null!=n&&"function"!==typeof n)throw Error("task callback must be a function");a.started=!0;S(b)||(b=[b]);if(0===b.length)return y.setImmediate(function(){a.drain()});p(b,function(b){b={data:b,priority:c,callback:"function"===typeof n?n:e};a.tasks.splice(k(a.tasks,b,h)+1,0,b);a.tasks.length===
a.concurrency&&a.saturated();y.setImmediate(a.process)})}var c=y.queue(a,b);c.push=function(a,b,e){m(c,a,b,e)};delete c.unshift;return c};y.cargo=function(a,b){return F(a,1,b)};y.log=E("log");y.dir=E("dir");y.memoize=function(a,b){var e={},h={};b=b||k;var m=A(function(k){var m=k.pop(),c=b.apply(null,k);c in e?y.setImmediate(function(){m.apply(null,e[c])}):c in h?h[c].push(m):(h[c]=[m],a.apply(null,k.concat([A(function(a){e[c]=a;var b=h[c];delete h[c];for(var k=0,m=b.length;k<m;k++)b[k].apply(null,
a)})])))});m.memo=e;m.unmemoized=a;return m};y.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}};y.times=P(y.map);y.timesSeries=P(y.mapSeries);y.timesLimit=function(a,b,e,h){return y.mapLimit(f(a),b,e,h)};y.seq=function(){var a=arguments;return A(function(b){var h=this,k=b[b.length-1];"function"==typeof k?b.pop():k=e;y.reduce(a,b,function(a,b,e){b.apply(h,a.concat([A(function(a,b){e(a,b)})]))},function(a,b){k.apply(h,[a].concat(b))})})};y.compose=function(){return y.seq.apply(null,
Array.prototype.reverse.call(arguments))};y.applyEach=Q(y.eachOf);y.applyEachSeries=Q(y.eachOfSeries);y.forever=function(a,b){function h(a){if(a)return k(a);m(h)}var k=n(b||e),m=R(a);h()};y.ensureAsync=R;y.constant=A(function(a){var b=[null].concat(a);return function(a){return a.apply(this,b)}});y.wrapSync=y.asyncify=function(a){return A(function(b){var e=b.pop(),h;try{h=a.apply(this,b)}catch(k){return e(k)}if(aa(h)&&"function"===typeof h.then)h.then(function(a){e(null,a)})["catch"](function(a){e(a.message?
a:Error(a))});else e(null,h)})};"object"===typeof c&&c.exports?c.exports=y:T.async=y})()}).call(this,b("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{_process:3}],2:[function(b,c,f){(function(a){function b(a,e){for(var h=0,k=a.length-1;0<=k;k--){var c=a[k];"."===c?a.splice(k,1):".."===c?(a.splice(k,1),h++):h&&(a.splice(k,1),h--)}if(e)for(;h--;h)a.unshift("..");return a}function e(a,b){if(a.filter)return a.filter(b);for(var e=
[],h=0;h<a.length;h++)b(a[h],h,a)&&e.push(a[h]);return e}var k=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;f.resolve=function(){for(var h="",k=!1,c=arguments.length-1;-1<=c&&!k;c--){var d=0<=c?arguments[c]:a.cwd();if("string"!==typeof d)throw new TypeError("Arguments to path.resolve must be strings");d&&(h=d+"/"+h,k="/"===d.charAt(0))}h=b(e(h.split("/"),function(a){return!!a}),!k).join("/");return(k?"/":"")+h||"."};f.normalize=function(a){var k=f.isAbsolute(a),c="/"===h(a,-1);
(a=b(e(a.split("/"),function(a){return!!a}),!k).join("/"))||k||(a=".");a&&c&&(a+="/");return(k?"/":"")+a};f.isAbsolute=function(a){return"/"===a.charAt(0)};f.join=function(){var a=Array.prototype.slice.call(arguments,0);return f.normalize(e(a,function(a,b){if("string"!==typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))};f.relative=function(a,b){function e(a){for(var b=0;b<a.length&&""===a[b];b++);for(var h=a.length-1;0<=h&&""===a[h];h--);return b>h?[]:a.slice(b,
h-b+1)}a=f.resolve(a).substr(1);b=f.resolve(b).substr(1);for(var h=e(a.split("/")),k=e(b.split("/")),c=Math.min(h.length,k.length),d=c,g=0;g<c;g++)if(h[g]!==k[g]){d=g;break}c=[];for(g=d;g<h.length;g++)c.push("..");c=c.concat(k.slice(d));return c.join("/")};f.sep="/";f.delimiter=":";f.dirname=function(a){var b=k.exec(a).slice(1);a=b[0];b=b[1];if(!a&&!b)return".";b&&(b=b.substr(0,b.length-1));return a+b};f.basename=function(a,b){var e=k.exec(a).slice(1)[2];b&&e.substr(-1*b.length)===b&&(e=e.substr(0,
e.length-b.length));return e};f.extname=function(a){return k.exec(a).slice(1)[3]};var h="b"==="ab".substr(-1)?function(a,b,e){return a.substr(b,e)}:function(a,b,e){0>b&&(b=a.length+b);return a.substr(b,e)}}).call(this,b("_process"))},{_process:3}],3:[function(b,c,f){function a(){m=!1;n.length?h=n.concat(h):q=-1;h.length&&g()}function g(){if(!m){var b=setTimeout(a);m=!0;for(var e=h.length;e;){n=h;for(h=[];++q<e;)n&&n[q].run();q=-1;e=h.length}n=null;m=!1;clearTimeout(b)}}function e(a,b){this.fun=a;
this.array=b}function k(){}b=c.exports={};var h=[],m=!1,n,q=-1;b.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var k=1;k<arguments.length;k++)b[k-1]=arguments[k];h.push(new e(a,b));1!==h.length||m||setTimeout(g,0)};e.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=k;b.addListener=k;b.once=k;b.off=k;b.removeListener=k;b.removeAllListeners=k;b.emit=k;b.binding=function(a){throw Error("process.binding is not supported");
};b.cwd=function(){return"/"};b.chdir=function(a){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},{}],4:[function(b,c,f){(function(a){(function(b){function e(a){throw RangeError(z[a]);}function k(a,b){for(var e=a.length,h=[];e--;)h[e]=b(a[e]);return h}function h(a,b){var e=a.split("@"),h="";1<e.length&&(h=e[0]+"@",a=e[1]);a=a.replace(A,".");e=a.split(".");e=k(e,b).join(".");return h+e}function m(a){for(var b=[],e=0,h=a.length,k,c;e<h;)k=a.charCodeAt(e++),55296<=k&&56319>=
k&&e<h?(c=a.charCodeAt(e++),56320==(c&64512)?b.push(((k&1023)<<10)+(c&1023)+65536):(b.push(k),e--)):b.push(k);return b}function n(a){return k(a,function(a){var b="";65535<a&&(a-=65536,b+=I(a>>>10&1023|55296),a=56320|a&1023);return b+=I(a)}).join("")}function q(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function w(a,b,e){var h=0;a=e?C(a/700):a>>1;for(a+=C(a/b);455<a;h+=36)a=C(a/35);return C(h+36*a/(a+38))}function p(a){var b=[],h=a.length,k,c=0,m=128,d=72,q,g,p,f,v;q=a.lastIndexOf("-");0>q&&(q=0);for(g=
0;g<q;++g)128<=a.charCodeAt(g)&&e("not-basic"),b.push(a.charCodeAt(g));for(q=0<q?q+1:0;q<h;){g=c;k=1;for(p=36;;p+=36){q>=h&&e("invalid-input");f=a.charCodeAt(q++);f=10>f-48?f-22:26>f-65?f-65:26>f-97?f-97:36;(36<=f||f>C((2147483647-c)/k))&&e("overflow");c+=f*k;v=p<=d?1:p>=d+26?26:p-d;if(f<v)break;f=36-v;k>C(2147483647/f)&&e("overflow");k*=f}k=b.length+1;d=w(c-g,k,0==g);C(c/k)>2147483647-m&&e("overflow");m+=C(c/k);c%=k;b.splice(c++,0,m)}return n(b)}function v(a){var b,h,k,c,n,d,g,p,f,v=[],r,u,G;a=m(a);
r=a.length;b=128;h=0;n=72;for(d=0;d<r;++d)f=a[d],128>f&&v.push(I(f));for((k=c=v.length)&&v.push("-");k<r;){g=2147483647;for(d=0;d<r;++d)f=a[d],f>=b&&f<g&&(g=f);u=k+1;g-b>C((2147483647-h)/u)&&e("overflow");h+=(g-b)*u;b=g;for(d=0;d<r;++d)if(f=a[d],f<b&&2147483647<++h&&e("overflow"),f==b){p=h;for(g=36;;g+=36){f=g<=n?1:g>=n+26?26:g-n;if(p<f)break;G=p-f;p=36-f;v.push(I(q(f+G%p,0)));p=C(G/p)}v.push(I(q(p,0)));n=w(h,u,k==c);h=0;++k}++h;++b}return v.join("")}var r="object"==typeof f&&f&&!f.nodeType&&f,u=
"object"==typeof c&&c&&!c.nodeType&&c,t="object"==typeof a&&a;if(t.global===t||t.window===t||t.self===t)b=t;var D=/^xn--/,G=/[^\x20-\x7E]/,A=/[\x2E\u3002\uFF0E\uFF61]/g,z={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},C=Math.floor,I=String.fromCharCode,M,t={version:"1.3.2",ucs2:{decode:m,encode:n},decode:p,encode:v,toASCII:function(a){return h(a,function(a){return G.test(a)?"xn--"+v(a):a})},
toUnicode:function(a){return h(a,function(a){return D.test(a)?p(a.slice(4).toLowerCase()):a})}};if(r&&u)if(c.exports==r)u.exports=t;else for(M in t)t.hasOwnProperty(M)&&(r[M]=t[M]);else b.punycode=t})(this)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],5:[function(b,c,f){c.exports=function(b,e,k,h){k=k||"=";var c={};if("string"!==typeof b||0===b.length)return c;var n=/\+/g;b=b.split(e||"&");e=1E3;h&&"number"===typeof h.maxKeys&&
(e=h.maxKeys);h=b.length;0<e&&h>e&&(h=e);for(e=0;e<h;++e){var d=b[e].replace(n,"%20"),w=d.indexOf(k),p;0<=w?(p=d.substr(0,w),d=d.substr(w+1)):(p=d,d="");p=decodeURIComponent(p);d=decodeURIComponent(d);Object.prototype.hasOwnProperty.call(c,p)?a(c[p])?c[p].push(d):c[p]=[c[p],d]:c[p]=d}return c};var a=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},{}],6:[function(b,c,f){function a(a,b){if(a.map)return a.map(b);for(var e=[],k=0;k<a.length;k++)e.push(b(a[k],k));
return e}var g=function(a){switch(typeof a){case "string":return a;case "boolean":return a?"true":"false";case "number":return isFinite(a)?a:"";default:return""}};c.exports=function(b,c,n,d){c=c||"&";n=n||"=";null===b&&(b=void 0);return"object"===typeof b?a(k(b),function(k){var d=encodeURIComponent(g(k))+n;return e(b[k])?a(b[k],function(a){return d+encodeURIComponent(g(a))}).join(c):d+encodeURIComponent(g(b[k]))}).join(c):d?encodeURIComponent(g(d))+n+encodeURIComponent(g(b)):""};var e=Array.isArray||
function(a){return"[object Array]"===Object.prototype.toString.call(a)},k=Object.keys||function(a){var b=[],e;for(e in a)Object.prototype.hasOwnProperty.call(a,e)&&b.push(e);return b}},{}],7:[function(b,c,f){f.decode=f.parse=b("./decode");f.encode=f.stringify=b("./encode")},{"./decode":5,"./encode":6}],8:[function(b,c,f){function a(){this.href=this.path=this.pathname=this.query=this.search=this.hash=this.hostname=this.port=this.host=this.auth=this.slashes=this.protocol=null}function g(b,h,k){if(b&&
e(b)&&b instanceof a)return b;var c=new a;c.parse(b,h,k);return c}function e(a){return"object"===typeof a&&null!==a}var k=b("punycode");f.parse=g;f.resolve=function(a,b){return g(a,!1,!0).resolve(b)};f.resolveObject=function(a,b){return a?g(a,!1,!0).resolveObject(b):b};f.format=function(b){"string"===typeof b&&(b=g(b));return b instanceof a?b.format():a.prototype.format.call(b)};f.Url=a;var h=/^([a-z0-9.+-]+:)/i,m=/:[0-9]*$/;c="{}|\\^`".split("").concat('<>"` \r\n\t'.split(""));var n=["'"].concat(c),
q=["%","/","?",";","#"].concat(n),w=["/","?","#"],p=/^[a-z0-9A-Z_-]{0,63}$/,v=/^([a-z0-9A-Z_-]{0,63})(.*)$/,r={javascript:!0,"javascript:":!0},u={javascript:!0,"javascript:":!0},t={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},D=b("querystring");a.prototype.parse=function(a,b,e){if("string"!==typeof a)throw new TypeError("Parameter 'url' must be a string, not "+typeof a);a=a.trim();var c=h.exec(a);if(c){var c=c[0],m=c.toLowerCase();this.protocol=
m;a=a.substr(c.length)}if(e||c||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var d="//"===a.substr(0,2);!d||c&&u[c]||(a=a.substr(2),this.slashes=!0)}if(!u[c]&&(d||c&&!t[c])){d=-1;for(e=0;e<w.length;e++)c=a.indexOf(w[e]),-1!==c&&(-1===d||c<d)&&(d=c);d=-1===d?a.lastIndexOf("@"):a.lastIndexOf("@",d);-1!==d&&(e=a.slice(0,d),a=a.slice(d+1),this.auth=decodeURIComponent(e));d=-1;for(e=0;e<q.length;e++)c=a.indexOf(q[e]),-1!==c&&(-1===d||c<d)&&(d=c);-1===d&&(d=a.length);this.host=a.slice(0,d);a=a.slice(d);this.parseHost();
this.hostname=this.hostname||"";d="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!d){var g=this.hostname.split(/\./);e=0;for(c=g.length;e<c;e++){var f=g[e];if(f&&!f.match(p)){for(var J="",B=0,x=f.length;B<x;B++)J=127<f.charCodeAt(B)?J+"x":J+f[B];if(!J.match(p)){c=g.slice(0,e);e=g.slice(e+1);if(f=f.match(v))c.push(f[1]),e.unshift(f[2]);e.length&&(a="/"+e.join(".")+a);this.hostname=c.join(".");break}}}}this.hostname=255<this.hostname.length?"":this.hostname.toLowerCase();if(!d){f=
this.hostname.split(".");g=[];for(e=0;e<f.length;++e)c=f[e],g.push(c.match(/[^A-Za-z0-9_-]/)?"xn--"+k.encode(c):c);this.hostname=g.join(".")}e=this.port?":"+this.port:"";this.host=(this.hostname||"")+e;this.href+=this.host;d&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!r[m])for(e=0,c=n.length;e<c;e++)d=n[e],f=encodeURIComponent(d),f===d&&(f=escape(d)),a=a.split(d).join(f);e=a.indexOf("#");-1!==e&&(this.hash=a.substr(e),a=a.slice(0,e));e=a.indexOf("?");
-1!==e?(this.search=a.substr(e),this.query=a.substr(e+1),b&&(this.query=D.parse(this.query)),a=a.slice(0,e)):b&&(this.search="",this.query={});a&&(this.pathname=a);t[m]&&this.hostname&&!this.pathname&&(this.pathname="/");if(this.pathname||this.search)e=this.pathname||"",c=this.search||"",this.path=e+c;this.href=this.format();return this};a.prototype.format=function(){var a=this.auth||"";a&&(a=encodeURIComponent(a),a=a.replace(/%3A/i,":"),a+="@");var b=this.protocol||"",h=this.pathname||"",k=this.hash||
"",c=!1,m="";this.host?c=a+this.host:this.hostname&&(c=a+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(c+=":"+this.port));this.query&&e(this.query)&&Object.keys(this.query).length&&(m=D.stringify(this.query));a=this.search||m&&"?"+m||"";b&&":"!==b.substr(-1)&&(b+=":");this.slashes||(!b||t[b])&&!1!==c?(c="//"+(c||""),h&&"/"!==h.charAt(0)&&(h="/"+h)):c||(c="");k&&"#"!==k.charAt(0)&&(k="#"+k);a&&"?"!==a.charAt(0)&&(a="?"+a);h=h.replace(/[?#]/g,function(a){return encodeURIComponent(a)});
a=a.replace("#","%23");return b+c+h+a+k};a.prototype.resolve=function(a){return this.resolveObject(g(a,!1,!0)).format()};a.prototype.resolveObject=function(b){if("string"===typeof b){var e=new a;e.parse(b,!1,!0);b=e}var h=new a;Object.keys(this).forEach(function(a){h[a]=this[a]},this);h.hash=b.hash;if(""===b.href)return h.href=h.format(),h;if(b.slashes&&!b.protocol)return Object.keys(b).forEach(function(a){"protocol"!==a&&(h[a]=b[a])}),t[h.protocol]&&h.hostname&&!h.pathname&&(h.path=h.pathname="/"),
h.href=h.format(),h;if(b.protocol&&b.protocol!==h.protocol){if(!t[b.protocol])return Object.keys(b).forEach(function(a){h[a]=b[a]}),h.href=h.format(),h;h.protocol=b.protocol;if(b.host||u[b.protocol])h.pathname=b.pathname;else{for(var k=(b.pathname||"").split("/");k.length&&!(b.host=k.shift()););b.host||(b.host="");b.hostname||(b.hostname="");""!==k[0]&&k.unshift("");2>k.length&&k.unshift("");h.pathname=k.join("/")}h.search=b.search;h.query=b.query;h.host=b.host||"";h.auth=b.auth;h.hostname=b.hostname||
b.host;h.port=b.port;if(h.pathname||h.search)h.path=(h.pathname||"")+(h.search||"");h.slashes=h.slashes||b.slashes;h.href=h.format();return h}var e=h.pathname&&"/"===h.pathname.charAt(0),c=b.host||b.pathname&&"/"===b.pathname.charAt(0),m=e=c||e||h.host&&b.pathname,d=h.pathname&&h.pathname.split("/")||[],k=b.pathname&&b.pathname.split("/")||[],n=h.protocol&&!t[h.protocol];n&&(h.hostname="",h.port=null,h.host&&(""===d[0]?d[0]=h.host:d.unshift(h.host)),h.host="",b.protocol&&(b.hostname=null,b.port=null,
b.host&&(""===k[0]?k[0]=b.host:k.unshift(b.host)),b.host=null),e=e&&(""===k[0]||""===d[0]));if(c)h.host=b.host||""===b.host?b.host:h.host,h.hostname=b.hostname||""===b.hostname?b.hostname:h.hostname,h.search=b.search,h.query=b.query,d=k;else if(k.length)d||(d=[]),d.pop(),d=d.concat(k),h.search=b.search,h.query=b.query;else if(null!=b.search){n&&(h.hostname=h.host=d.shift(),n=h.host&&0<h.host.indexOf("@")?h.host.split("@"):!1)&&(h.auth=n.shift(),h.host=h.hostname=n.shift());h.search=b.search;h.query=
b.query;if(null!==h.pathname||null!==h.search)h.path=(h.pathname?h.pathname:"")+(h.search?h.search:"");h.href=h.format();return h}if(!d.length)return h.pathname=null,h.path=h.search?"/"+h.search:null,h.href=h.format(),h;for(var c=d.slice(-1)[0],k=(h.host||b.host)&&("."===c||".."===c)||""===c,q=0,g=d.length;0<=g;g--)c=d[g],"."==c?d.splice(g,1):".."===c?(d.splice(g,1),q++):q&&(d.splice(g,1),q--);if(!e&&!m)for(;q--;q)d.unshift("..");!e||""===d[0]||d[0]&&"/"===d[0].charAt(0)||d.unshift("");k&&"/"!==d.join("/").substr(-1)&&
d.push("");m=""===d[0]||d[0]&&"/"===d[0].charAt(0);n&&(h.hostname=h.host=m?"":d.length?d.shift():"",n=h.host&&0<h.host.indexOf("@")?h.host.split("@"):!1)&&(h.auth=n.shift(),h.host=h.hostname=n.shift());(e=e||h.host&&d.length)&&!m&&d.unshift("");d.length?h.pathname=d.join("/"):(h.pathname=null,h.path=null);if(null!==h.pathname||null!==h.search)h.path=(h.pathname?h.pathname:"")+(h.search?h.search:"");h.auth=b.auth||h.auth;h.slashes=h.slashes||b.slashes;h.href=h.format();return h};a.prototype.parseHost=
function(){var a=this.host,b=m.exec(a);b&&(b=b[0],":"!==b&&(this.port=b.substr(1)),a=a.substr(0,a.length-b.length));a&&(this.hostname=a)}},{punycode:4,querystring:7}],9:[function(b,c,f){function a(a,b,e,h,k){var c=0,m,d,n;m=b;for(d=e-h;m<e;m+=h)c+=(a[d]-a[m])*(a[m+1]+a[d+1]),d=m;if(k===0<c)for(m=b;m<e;m+=h)n=r(m,a[m],a[m+1],n);else for(m=e-h;m>=b;m-=h)n=r(m,a[m],a[m+1],n);return n}function g(a,b){if(!a)return a;b||(b=a);var e=a,h;do{h=!1;var k;if(k=!e.steiner)k=e.next,k=e.x===k.x&&e.y===k.y||0===
q(e.prev,e,e.next);if(k){u(e);e=b=e.prev;if(e===e.next)return null;h=!0}else e=e.next}while(h||e!==b);return b}function e(a,b,k,c,m,d,f){if(a){if(!f&&d){var r=a,t=r;do null===t.z&&(t.z=h(t.x,t.y,c,m,d)),t.prevZ=t.prev,t=t.nextZ=t.next;while(t!==r);t.prevZ.nextZ=null;t.prevZ=null;var r=t,J,B,x,H,K,O,F=1;do{t=r;x=r=null;for(H=0;t;){H++;B=t;for(J=K=0;J<F&&(K++,B=B.nextZ,B);J++);for(O=F;0<K||0<O&&B;)0===K?(J=B,B=B.nextZ,O--):0!==O&&B?t.z<=B.z?(J=t,t=t.nextZ,K--):(J=B,B=B.nextZ,O--):(J=t,t=t.nextZ,K--),
x?x.nextZ=J:r=J,J.prevZ=x,x=J;t=B}x.nextZ=null;F*=2}while(1<H)}for(r=a;a.prev!==a.next;){t=a.prev;B=a.next;if(d)a:{x=a;O=c;var E=m,P=d;H=x.prev;K=x;F=x.next;if(0<=q(H,K,F))x=!1;else{var Q=H.x>K.x?H.x>F.x?H.x:F.x:K.x>F.x?K.x:F.x,R=H.y>K.y?H.y>F.y?H.y:F.y:K.y>F.y?K.y:F.y;J=h(H.x<K.x?H.x<F.x?H.x:F.x:K.x<F.x?K.x:F.x,H.y<K.y?H.y<F.y?H.y:F.y:K.y<F.y?K.y:F.y,O,E,P);O=h(Q,R,O,E,P);for(E=x.nextZ;E&&E.z<=O;){if(E!==x.prev&&E!==x.next&&n(H.x,H.y,K.x,K.y,F.x,F.y,E.x,E.y)&&0<=q(E.prev,E,E.next)){x=!1;break a}E=
E.nextZ}for(E=x.prevZ;E&&E.z>=J;){if(E!==x.prev&&E!==x.next&&n(H.x,H.y,K.x,K.y,F.x,F.y,E.x,E.y)&&0<=q(E.prev,E,E.next)){x=!1;break a}E=E.prevZ}x=!0}}else a:if(x=a,H=x.prev,K=x,F=x.next,0<=q(H,K,F))x=!1;else{for(J=x.next.next;J!==x.prev;){if(n(H.x,H.y,K.x,K.y,F.x,F.y,J.x,J.y)&&0<=q(J.prev,J,J.next)){x=!1;break a}J=J.next}x=!0}if(x)b.push(t.i/k),b.push(a.i/k),b.push(B.i/k),u(a),r=a=B.next;else if(a=B,a===r){if(!f)e(g(a),b,k,c,m,d,1);else if(1===f){f=b;r=k;t=a;do B=t.prev,x=t.next.next,w(B,t,t.next,
x)&&p(B,x)&&p(x,B)&&(f.push(B.i/r),f.push(t.i/r),f.push(x.i/r),u(t),u(t.next),t=a=x),t=t.next;while(t!==a);a=t;e(a,b,k,c,m,d,2)}else if(2===f)a:{f=a;do{for(r=f.next.next;r!==f.prev;){if(t=f.i!==r.i){t=f;B=r;if(!(x=t.x===B.x&&t.y===B.y)){if(x=t.next.i!==B.i&&t.prev.i!==B.i){b:{x=t;do{if(x.i!==t.i&&x.next.i!==t.i&&x.i!==B.i&&x.next.i!==B.i&&w(x,x.next,t,B)){x=!0;break b}x=x.next}while(x!==t);x=!1}x=!x}if(x=x&&p(t,B)&&p(B,t)){x=t;H=!1;K=(t.x+B.x)/2;B=(t.y+B.y)/2;do x.y>B!==x.next.y>B&&K<(x.next.x-x.x)*
(B-x.y)/(x.next.y-x.y)+x.x&&(H=!H),x=x.next;while(x!==t);x=H}}t=x}if(t){a=v(f,r);f=g(f,f.next);a=g(a,a.next);e(f,b,k,c,m,d);e(a,b,k,c,m,d);break a}r=r.next}f=f.next}while(f!==a)}break}}}}function k(a,b){return a.x-b.x}function h(a,b,e,h,k){a=32767*(a-e)/k;b=32767*(b-h)/k;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function m(a){var b=a,e=a;do b.x<e.x&&(e=b),b=b.next;while(b!==
a);return e}function n(a,b,e,h,k,c,m,d){return 0<=(k-m)*(b-d)-(a-m)*(c-d)&&0<=(a-m)*(h-d)-(e-m)*(b-d)&&0<=(e-m)*(c-d)-(k-m)*(h-d)}function q(a,b,e){return(b.y-a.y)*(e.x-b.x)-(b.x-a.x)*(e.y-b.y)}function w(a,b,e,h){return 0<q(a,b,e)!==0<q(a,b,h)&&0<q(e,h,a)!==0<q(e,h,b)}function p(a,b){return 0>q(a.prev,a,a.next)?0<=q(a,b,a.next)&&0<=q(a,a.prev,b):0>q(a,b,a.prev)||0>q(a,a.next,b)}function v(a,b){var e=new t(a.i,a.x,a.y),h=new t(b.i,b.x,b.y),k=a.next,c=b.prev;a.next=b;b.prev=a;e.next=k;k.prev=e;h.next=
e;e.prev=h;c.next=h;h.prev=c;return h}function r(a,b,e,h){a=new t(a,b,e);h?(a.next=h.next,a.prev=h,h.next.prev=a,h.next=a):(a.prev=a,a.next=a);return a}function u(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function t(a,b,e){this.i=a;this.x=b;this.y=e;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}c.exports=function(b,h,c){c=c||2;var d=h&&h.length,q=d?h[0]*c:b.length,f=a(b,0,q,c,!0),w=[];if(!f)return w;var r,u,t,
B;if(d){var x=c,d=[],H,K,O;B=0;for(H=h.length;B<H;B++)K=h[B]*x,O=B<H-1?h[B+1]*x:b.length,K=a(b,K,O,x,!1),K===K.next&&(K.steiner=!0),d.push(m(K));d.sort(k);for(B=0;B<d.length;B++){h=d[B];var F=f;x=F;H=h.x;K=h.y;O=-Infinity;var E=void 0;do{if(K<=x.y&&K>=x.next.y){var P=x.x+(K-x.y)*(x.next.x-x.x)/(x.next.y-x.y);P<=H&&P>O&&(O=P,E=x.x<x.next.x?x:x.next)}x=x.next}while(x!==F);if(E){for(var F=E,P=Infinity,Q,x=E.next;x!==F;)H>=x.x&&x.x>=E.x&&n(K<E.y?H:O,K,E.x,E.y,K<E.y?O:H,K,x.x,x.y)&&(Q=Math.abs(K-x.y)/
(H-x.x),(Q<P||Q===P&&x.x>E.x)&&p(x,h)&&(E=x,P=Q)),x=x.next;F=E}else F=null;F&&(h=v(F,h),g(h,h.next));f=g(f,f.next)}}if(b.length>80*c){r=t=b[0];u=d=b[1];for(x=c;x<q;x+=c)B=b[x],h=b[x+1],B<r&&(r=B),h<u&&(u=h),B>t&&(t=B),h>d&&(d=h);t=Math.max(t-r,d-u)}e(f,w,c,r,u,t);return w}},{}],10:[function(b,c,f){function a(a,b,e){this.fn=a;this.context=b;this.once=e||!1}function g(){}var e="function"!==typeof Object.create?"~":!1;g.prototype._events=void 0;g.prototype.listeners=function(a,b){var c=e?e+a:a,c=this._events&&
this._events[c];if(b)return!!c;if(!c)return[];if(c.fn)return[c.fn];for(var d=0,q=c.length,g=Array(q);d<q;d++)g[d]=c[d].fn;return g};g.prototype.emit=function(a,b,c,d,q,g){var p=e?e+a:a;if(!this._events||!this._events[p])return!1;var p=this._events[p],f=arguments.length,r,u;if("function"===typeof p.fn){p.once&&this.removeListener(a,p.fn,void 0,!0);switch(f){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,b),!0;case 3:return p.fn.call(p.context,b,c),!0;case 4:return p.fn.call(p.context,
b,c,d),!0;case 5:return p.fn.call(p.context,b,c,d,q),!0;case 6:return p.fn.call(p.context,b,c,d,q,g),!0}u=1;for(r=Array(f-1);u<f;u++)r[u-1]=arguments[u];p.fn.apply(p.context,r)}else{var t=p.length,D;for(u=0;u<t;u++)switch(p[u].once&&this.removeListener(a,p[u].fn,void 0,!0),f){case 1:p[u].fn.call(p[u].context);break;case 2:p[u].fn.call(p[u].context,b);break;case 3:p[u].fn.call(p[u].context,b,c);break;default:if(!r)for(D=1,r=Array(f-1);D<f;D++)r[D-1]=arguments[D];p[u].fn.apply(p[u].context,r)}}return!0};
g.prototype.on=function(b,h,c){h=new a(h,c||this);b=e?e+b:b;this._events||(this._events=e?{}:Object.create(null));this._events[b]?this._events[b].fn?this._events[b]=[this._events[b],h]:this._events[b].push(h):this._events[b]=h;return this};g.prototype.once=function(b,h,c){h=new a(h,c||this,!0);b=e?e+b:b;this._events||(this._events=e?{}:Object.create(null));this._events[b]?this._events[b].fn?this._events[b]=[this._events[b],h]:this._events[b].push(h):this._events[b]=h;return this};g.prototype.removeListener=
function(a,b,c,d){a=e?e+a:a;if(!this._events||!this._events[a])return this;var q=this._events[a],g=[];if(b)if(q.fn)(q.fn!==b||d&&!q.once||c&&q.context!==c)&&g.push(q);else for(var p=0,f=q.length;p<f;p++)(q[p].fn!==b||d&&!q[p].once||c&&q[p].context!==c)&&g.push(q[p]);g.length?this._events[a]=1===g.length?g[0]:g:delete this._events[a];return this};g.prototype.removeAllListeners=function(a){if(!this._events)return this;a?delete this._events[e?e+a:a]:this._events=e?{}:Object.create(null);return this};
g.prototype.off=g.prototype.removeListener;g.prototype.addListener=g.prototype.on;g.prototype.setMaxListeners=function(){return this};g.prefixed=e;"undefined"!==typeof c&&(c.exports=g)},{}],11:[function(b,c,f){var a=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable;c.exports=Object.assign||function(b,c){var h,m;if(null===b||void 0===b)throw new TypeError("Object.assign cannot be called with null or undefined");m=Object(b);for(var d,q=1;q<arguments.length;q++){h=Object(arguments[q]);
for(var f in h)a.call(h,f)&&(m[f]=h[f]);if(Object.getOwnPropertySymbols){d=Object.getOwnPropertySymbols(h);for(var p=0;p<d.length;p++)g.call(h,d[p])&&(m[d[p]]=h[d[p]])}}return m}},{}],12:[function(b,c,f){c.exports={name:"pixi.js",version:"3.0.9",description:"Pixi.js is a fast lightweight 2D library that works across all devices.",author:"Mat Groves",contributors:["Chad Engler <chad@pantherdev.com>","Richard Davey <rdavey@gmail.com>"],main:"./src/index.js",homepage:"http://goodboydigital.com/",bugs:"https://github.com/pixijs/pixi.js/issues",
license:"MIT",repository:{type:"git",url:"https://github.com/pixijs/pixi.js.git"},scripts:{start:"gulp && gulp watch",test:"gulp && testem ci",build:"gulp",docs:"jsdoc -c ./gulp/util/jsdoc.conf.json -R README.md"},files:"bin/ src/ CONTRIBUTING.md LICENSE package.json README.md".split(" "),dependencies:{async:"^1.5.0",brfs:"^1.4.1",earcut:"^2.0.7",eventemitter3:"^1.1.1","object-assign":"^4.0.1","resource-loader":"^1.6.4"},devDependencies:{browserify:"^11.1.0",chai:"^3.2.0",del:"^2.0.2",gulp:"^3.9.0",
"gulp-cached":"^1.1.0","gulp-concat":"^2.6.0","gulp-debug":"^2.1.0","gulp-header":"^1.7.1","gulp-jshint":"^1.11.2","gulp-mirror":"^0.4.0","gulp-plumber":"^1.0.1","gulp-rename":"^1.2.2","gulp-sourcemaps":"^1.5.2","gulp-uglify":"^1.4.1","gulp-util":"^3.0.6","jaguarjs-jsdoc":"git+https://github.com/davidshimjs/jaguarjs-jsdoc.git",jsdoc:"^3.3.2","jshint-summary":"^0.4.0",minimist:"^1.2.0",mocha:"^2.3.2","require-dir":"^0.3.0","run-sequence":"^1.1.2",testem:"^0.9.4","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",
watchify:"^3.4.0"},browserify:{transform:["brfs"]}}},{}],13:[function(b,c,f){function a(a){var b=document.createElement("div");b.style.width="100px";b.style.height="100px";b.style.position="absolute";b.style.top=0;b.style.left=0;b.style.zIndex=2;this.div=b;this.pool=[];this.renderId=0;this.debug=!1;this.renderer=a;this.children=[];this._onKeyDown=this._onKeyDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this.isActive=!1;window.addEventListener("keydown",this._onKeyDown,!1)}var g=b("../core");
Object.assign(g.DisplayObject.prototype,b("./accessibleTarget"));a.prototype.constructor=a;c.exports=a;a.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode.appendChild(this.div))};a.prototype.deactivate=function(){this.isActive&&(this.isActive=!1,window.document.removeEventListener("mousemove",
this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode.removeChild(this.div))};a.prototype.updateAccessibleObjects=function(a){if(a.visible){a.accessible&&a.interactive&&(a._accessibleActive||this.addChild(a),a.renderId=this.renderId);a=a.children;for(var b=a.length-1;0<=b;b--)this.updateAccessibleObjects(a[b])}};a.prototype.update=function(){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var a=this.renderer.view.getBoundingClientRect(),
b=a.width/this.renderer.width,h=a.height/this.renderer.height,c=this.div;c.style.left=a.left+"px";c.style.top=a.top+"px";c.style.width=this.renderer.width+"px";c.style.height=this.renderer.height+"px";for(a=0;a<this.children.length;a++){var d=this.children[a];if(d.renderId!==this.renderId)d._accessibleActive=!1,g.utils.removeItems(this.children,a,1),this.div.removeChild(d._accessibleDiv),this.pool.push(d._accessibleDiv),d._accessibleDiv=null,a--,0===this.children.length&&this.deactivate();else{var c=
d._accessibleDiv,q=d.hitArea,f=d.worldTransform;d.hitArea?(c.style.left=(f.tx+q.x*f.a)*b+"px",c.style.top=(f.ty+q.y*f.d)*h+"px",c.style.width=q.width*f.a*b+"px",c.style.height=q.height*f.d*h+"px"):(q=d.getBounds(),this.capHitArea(q),c.style.left=q.x*b+"px",c.style.top=q.y*h+"px",c.style.width=q.width*b+"px",c.style.height=q.height*h+"px")}}this.renderId++};a.prototype.capHitArea=function(a){0>a.x&&(a.width+=a.x,a.x=0);0>a.y&&(a.height+=a.y,a.y=0);a.x+a.width>this.renderer.width&&(a.width=this.renderer.width-
a.x);a.y+a.height>this.renderer.height&&(a.height=this.renderer.height-a.y)};a.prototype.addChild=function(a){var b=this.pool.pop();b||(b=document.createElement("button"),b.style.width="100px",b.style.height="100px",b.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",b.style.position="absolute",b.style.zIndex=2,b.style.borderStyle="none",b.addEventListener("click",this._onClick.bind(this)),b.addEventListener("focus",this._onFocus.bind(this)),b.addEventListener("focusout",this._onFocusOut.bind(this)));
b.title=a.accessibleTitle||"displayObject "+this.tabIndex;a._accessibleActive=!0;a._accessibleDiv=b;b.displayObject=a;this.children.push(a);this.div.appendChild(a._accessibleDiv);a._accessibleDiv.tabIndex=a.tabIndex};a.prototype._onClick=function(a){var b=this.renderer.plugins.interaction;b.dispatchEvent(a.target.displayObject,"click",b.eventData)};a.prototype._onFocus=function(a){var b=this.renderer.plugins.interaction;b.dispatchEvent(a.target.displayObject,"mouseover",b.eventData)};a.prototype._onFocusOut=
function(a){var b=this.renderer.plugins.interaction;b.dispatchEvent(a.target.displayObject,"mouseout",b.eventData)};a.prototype._onKeyDown=function(a){9===a.keyCode&&this.activate()};a.prototype._onMouseMove=function(){this.deactivate()};a.prototype.destroy=function(){this.div=null;for(var a=0;a<this.children.length;a++)this.children[a].div=null;window.document.removeEventListener("mousemove",this._onMouseMove);window.removeEventListener("keydown",this._onKeyDown);this.renderer=this.children=this.pool=
null};g.WebGLRenderer.registerPlugin("accessibility",a);g.CanvasRenderer.registerPlugin("accessibility",a)},{"../core":23,"./accessibleTarget":14}],14:[function(b,c,f){c.exports={accessible:!1,accessibleTitle:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1}},{}],15:[function(b,c,f){c.exports={accessibleTarget:b("./accessibleTarget"),AccessibilityManager:b("./AccessibilityManager")}},{"./AccessibilityManager":13,"./accessibleTarget":14}],16:[function(b,c,f){b={VERSION:b("../../package.json").version,
PI_2:2*Math.PI,RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180,TARGET_FPMS:.06,RENDERER_TYPE:{UNKNOWN:0,WEBGL:1,CANVAS:2},BLEND_MODES:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},DRAW_MODES:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},SCALE_MODES:{DEFAULT:0,LINEAR:0,NEAREST:1},RETINA_PREFIX:/@(.+)x/,RESOLUTION:1,
FILTER_RESOLUTION:1,DEFAULT_RENDER_OPTIONS:{view:null,resolution:1,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1},SHAPES:{POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},SPRITE_BATCH_SIZE:2E3};c.exports=b},{"../../package.json":12}],17:[function(b,c,f){function a(){k.call(this);this.children=[]}var g=b("../math"),e=b("../utils"),k=b("./DisplayObject"),h=b("../textures/RenderTexture"),m=new g.Matrix;a.prototype=Object.create(k.prototype);
a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{width:{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(a){var b=this.getLocalBounds().width;this.scale.x=0!==b?a/b:1;this._width=a}},height:{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(a){var b=this.getLocalBounds().height;this.scale.y=0!==b?a/b:1;this._height=a}}});a.prototype.onChildrenChange=function(){};a.prototype.addChild=function(a){var b=arguments.length;
if(1<b)for(var h=0;h<b;h++)this.addChild(arguments[h]);else a.parent&&a.parent.removeChild(a),a.parent=this,this.children.push(a),this.onChildrenChange(this.children.length-1),a.emit("added",this);return a};a.prototype.addChildAt=function(a,b){if(0<=b&&b<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),this.onChildrenChange(b),a.emit("added",this),a;throw Error(a+"addChildAt: The index "+b+" supplied is out of bounds "+this.children.length);
};a.prototype.swapChildren=function(a,b){if(a!==b){var h=this.getChildIndex(a),e=this.getChildIndex(b);if(0>h||0>e)throw Error("swapChildren: Both the supplied DisplayObjects must be children of the caller.");this.children[h]=b;this.children[e]=a;this.onChildrenChange(h<e?h:e)}};a.prototype.getChildIndex=function(a){a=this.children.indexOf(a);if(-1===a)throw Error("The supplied DisplayObject must be a child of the caller");return a};a.prototype.setChildIndex=function(a,b){if(0>b||b>=this.children.length)throw Error("The supplied index is out of bounds");
var h=this.getChildIndex(a);e.removeItems(this.children,h,1);this.children.splice(b,0,a);this.onChildrenChange(b)};a.prototype.getChildAt=function(a){if(0>a||a>=this.children.length)throw Error("getChildAt: Supplied index "+a+" does not exist in the child list, or the supplied DisplayObject is not a child of the caller");return this.children[a]};a.prototype.removeChild=function(a){var b=arguments.length;if(1<b)for(var h=0;h<b;h++)this.removeChild(arguments[h]);else{b=this.children.indexOf(a);if(-1===
b)return;a.parent=null;e.removeItems(this.children,b,1);this.onChildrenChange(b);a.emit("removed",this)}return a};a.prototype.removeChildAt=function(a){var b=this.getChildAt(a);b.parent=null;e.removeItems(this.children,a,1);this.onChildrenChange(a);b.emit("removed",this);return b};a.prototype.removeChildren=function(a,b){var h=a||0,e="number"===typeof b?b:this.children.length,c=e-h;if(0<c&&c<=e){h=this.children.splice(h,c);for(e=0;e<h.length;++e)h[e].parent=null;this.onChildrenChange(a);for(e=0;e<
h.length;++e)h[e].emit("removed",this);return h}if(0===c&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.");};a.prototype.generateTexture=function(a,b,e){var c=this.getLocalBounds();a=new h(a,c.width|0,c.height|0,e,b);m.tx=-c.x;m.ty=-c.y;a.render(this,m);return a};a.prototype.updateTransform=function(){if(this.visible){this.displayObjectUpdateTransform();for(var a=0,b=this.children.length;a<b;++a)this.children[a].updateTransform()}};
a.prototype.containerUpdateTransform=a.prototype.updateTransform;a.prototype.getBounds=function(){if(!this._currentBounds){if(0===this.children.length)return g.Rectangle.EMPTY;for(var a=Infinity,b=Infinity,h=-Infinity,e=-Infinity,c,k,d=!1,m=0,f=this.children.length;m<f;++m)this.children[m].visible&&(d=!0,c=this.children[m].getBounds(),a=a<c.x?a:c.x,b=b<c.y?b:c.y,k=c.width+c.x,c=c.height+c.y,h=h>k?h:k,e=e>c?e:c);if(!d)return g.Rectangle.EMPTY;k=this._bounds;k.x=a;k.y=b;k.width=h-a;k.height=e-b;this._currentBounds=
k}return this._currentBounds};a.prototype.containerGetBounds=a.prototype.getBounds;a.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=g.Matrix.IDENTITY;for(var b=0,h=this.children.length;b<h;++b)this.children[b].updateTransform();this.worldTransform=a;this._currentBounds=null;return this.getBounds(g.Matrix.IDENTITY)};a.prototype.renderWebGL=function(a){if(this.visible&&!(0>=this.worldAlpha)&&this.renderable){var b,h;if(this._mask||this._filters){a.currentRenderer.flush();
this._filters&&this._filters.length&&a.filterManager.pushFilter(this,this._filters);this._mask&&a.maskManager.pushMask(this,this._mask);a.currentRenderer.start();this._renderWebGL(a);b=0;for(h=this.children.length;b<h;b++)this.children[b].renderWebGL(a);a.currentRenderer.flush();this._mask&&a.maskManager.popMask(this,this._mask);this._filters&&a.filterManager.popFilter();a.currentRenderer.start()}else for(this._renderWebGL(a),b=0,h=this.children.length;b<h;++b)this.children[b].renderWebGL(a)}};a.prototype._renderWebGL=
function(a){};a.prototype._renderCanvas=function(a){};a.prototype.renderCanvas=function(a){if(this.visible&&!(0>=this.alpha)&&this.renderable){this._mask&&a.maskManager.pushMask(this._mask,a);this._renderCanvas(a);for(var b=0,h=this.children.length;b<h;++b)this.children[b].renderCanvas(a);this._mask&&a.maskManager.popMask(a)}};a.prototype.destroy=function(a){k.prototype.destroy.call(this);if(a)for(var b=0,h=this.children.length;b<h;++b)this.children[b].destroy(a);this.removeChildren();this.children=
null}},{"../math":26,"../textures/RenderTexture":64,"../utils":70,"./DisplayObject":18}],18:[function(b,c,f){function a(){k.call(this);this.position=new g.Point;this.scale=new g.Point(1,1);this.pivot=new g.Point(0,0);this.skew=new g.Point(0,0);this.rotation=0;this.alpha=1;this.renderable=this.visible=!0;this.parent=null;this.worldAlpha=1;this.worldTransform=new g.Matrix;this.filterArea=null;this._sr=0;this._cr=1;this._bounds=new g.Rectangle(0,0,1,1);this._mask=this._currentBounds=null}var g=b("../math"),
e=b("../textures/RenderTexture"),k=b("eventemitter3"),h=b("../const"),m=new g.Matrix,n={worldTransform:new g.Matrix,worldAlpha:1,children:[]};a.prototype=Object.create(k.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{x:{get:function(){return this.position.x},set:function(a){this.position.x=a}},y:{get:function(){return this.position.y},set:function(a){this.position.y=a}},worldVisible:{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}},
mask:{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.renderable=!0);if(this._mask=a)this._mask.renderable=!1}},filters:{get:function(){return this._filters&&this._filters.slice()},set:function(a){this._filters=a&&a.slice()}}});a.prototype.updateTransform=function(){var a=this.parent.worldTransform,b=this.worldTransform,e,c,k,d,n,g;if(this.skew.x||this.skew.y)m.setTransform(this.position.x,this.position.y,this.pivot.x,this.pivot.y,this.scale.x,this.scale.y,this.rotation,
this.skew.x,this.skew.y),b.a=m.a*a.a+m.b*a.c,b.b=m.a*a.b+m.b*a.d,b.c=m.c*a.a+m.d*a.c,b.d=m.c*a.b+m.d*a.d,b.tx=m.tx*a.a+m.ty*a.c+a.tx,b.ty=m.tx*a.b+m.ty*a.d+a.ty;else{if(this.rotation%h.PI_2){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));e=this._cr*this.scale.x;c=this._sr*this.scale.x;k=-this._sr*this.scale.y;d=this._cr*this.scale.y;n=this.position.x;g=this.position.y;if(this.pivot.x||this.pivot.y)n-=this.pivot.x*
e+this.pivot.y*k,g-=this.pivot.x*c+this.pivot.y*d;b.a=e*a.a+c*a.c;b.b=e*a.b+c*a.d;b.c=k*a.a+d*a.c;b.d=k*a.b+d*a.d}else e=this.scale.x,d=this.scale.y,n=this.position.x-this.pivot.x*e,g=this.position.y-this.pivot.y*d,b.a=e*a.a,b.b=e*a.b,b.c=d*a.c,b.d=d*a.d;b.tx=n*a.a+g*a.c+a.tx;b.ty=n*a.b+g*a.d+a.ty}this.worldAlpha=this.alpha*this.parent.worldAlpha;this._currentBounds=null};a.prototype.displayObjectUpdateTransform=a.prototype.updateTransform;a.prototype.getBounds=function(a){return g.Rectangle.EMPTY};
a.prototype.getLocalBounds=function(){return this.getBounds(g.Matrix.IDENTITY)};a.prototype.toGlobal=function(a){this.parent?this.displayObjectUpdateTransform():(this.parent=n,this.displayObjectUpdateTransform(),this.parent=null);return this.worldTransform.apply(a)};a.prototype.toLocal=function(a,b,h){b&&(a=b.toGlobal(a));this.parent?this.displayObjectUpdateTransform():(this.parent=n,this.displayObjectUpdateTransform(),this.parent=null);return this.worldTransform.applyInverse(a,h)};a.prototype.renderWebGL=
function(a){};a.prototype.renderCanvas=function(a){};a.prototype.generateTexture=function(a,b,h){var c=this.getLocalBounds();a=new e(a,c.width|0,c.height|0,b,h);m.tx=-c.x;m.ty=-c.y;a.render(this,m);return a};a.prototype.setParent=function(a){if(!a||!a.addChild)throw Error("setParent: Argument must be a Container");a.addChild(this);return a};a.prototype.setTransform=function(a,b,h,e,c,k,d,m,n){this.position.x=a||0;this.position.y=b||0;this.scale.x=h?h:1;this.scale.y=e?e:1;this.rotation=c||0;this.skew.x=
k||0;this.skew.y=d||0;this.pivot.x=m||0;this.pivot.y=n||0;return this};a.prototype.destroy=function(){this.filterArea=this.worldTransform=this._mask=this._currentBounds=this._bounds=this.parent=this.skew=this.pivot=this.scale=this.position=null}},{"../const":16,"../math":26,"../textures/RenderTexture":64,eventemitter3:10}],19:[function(b,c,f){function a(){g.call(this);this.fillAlpha=1;this.lineColor=this.lineWidth=0;this.graphicsData=[];this._prevTint=this.tint=16777215;this.blendMode=q.BLEND_MODES.NORMAL;
this.currentPath=null;this._webGL={};this.isMask=!1;this.boundsPadding=0;this._localBounds=new n.Rectangle(0,0,1,1);this.dirty=!0;this.glDirty=!1;this.boundsDirty=!0;this.cachedSpriteDirty=!1}var g=b("../display/Container"),e=b("../textures/Texture"),k=b("../renderers/canvas/utils/CanvasBuffer"),h=b("../renderers/canvas/utils/CanvasGraphics"),m=b("./GraphicsData"),n=b("../math"),q=b("../const"),w=new n.Point;a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.clone=
function(){var b=new a;b.renderable=this.renderable;b.fillAlpha=this.fillAlpha;b.lineWidth=this.lineWidth;b.lineColor=this.lineColor;b.tint=this.tint;b.blendMode=this.blendMode;b.isMask=this.isMask;b.boundsPadding=this.boundsPadding;b.dirty=!0;b.glDirty=!0;b.cachedSpriteDirty=this.cachedSpriteDirty;for(var h=0;h<this.graphicsData.length;++h)b.graphicsData.push(this.graphicsData[h].clone());b.currentPath=b.graphicsData[b.graphicsData.length-1];b.updateLocalBounds();return b};a.prototype.lineStyle=
function(a,b,h){this.lineWidth=a||0;this.lineColor=b||0;this.lineAlpha=void 0===h?1:h;this.currentPath&&(this.currentPath.shape.points.length?(a=new n.Polygon(this.currentPath.shape.points.slice(-2)),a.closed=!1,this.drawShape(a)):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha));return this};a.prototype.moveTo=function(a,b){var h=new n.Polygon([a,b]);h.closed=!1;this.drawShape(h);return this};a.prototype.lineTo=function(a,
b){this.currentPath.shape.points.push(a,b);this.dirty=!0;return this};a.prototype.quadraticCurveTo=function(a,b,h,e){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var c,k,d=this.currentPath.shape.points;0===d.length&&this.moveTo(0,0);for(var m=d[d.length-2],n=d[d.length-1],g,q=1;20>=q;++q)g=q/20,c=m+(a-m)*g,k=n+(b-n)*g,d.push(c+(a+(h-a)*g-c)*g,k+(b+(e-b)*g-k)*g);this.dirty=this.boundsDirty=!0;return this};a.prototype.bezierCurveTo=
function(a,b,h,e,c,k){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var d,m,n,g,q,f=this.currentPath.shape.points,w=f[f.length-2],L=f[f.length-1],J,B=1;20>=B;++B)J=B/20,d=1-J,m=d*d,n=m*d,g=J*J,q=g*J,f.push(n*w+3*m*J*a+3*d*g*h+q*c,n*L+3*m*J*b+3*d*g*e+q*k);this.dirty=this.boundsDirty=!0;return this};a.prototype.arcTo=function(a,b,h,e,c){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(a,
b):this.moveTo(a,b);var k=this.currentPath.shape.points,d=k[k.length-1]-b,m=k[k.length-2]-a;e-=b;h-=a;var n=Math.abs(d*h-m*e);if(1E-8>n||0===c)k[k.length-2]===a&&k[k.length-1]===b||k.push(a,b);else{var g=d*d+m*m,q=e*e+h*h,f=d*e+m*h,k=c*Math.sqrt(g)/n,n=c*Math.sqrt(q)/n,g=k*f/g,q=n*f/q,f=k*h+n*m,w=k*e+n*d;this.arc(f+a,w+b,c,Math.atan2(d*(n+g)-w,m*(n+g)-f),Math.atan2(e*(k+q)-w,h*(k+q)-f),m*e>h*d)}this.dirty=this.boundsDirty=!0;return this};a.prototype.arc=function(a,b,h,e,c,k){k=k||!1;if(e===c)return this;
!k&&c<=e?c+=2*Math.PI:k&&e<=c&&(e+=2*Math.PI);k=k?-1*(e-c):c-e;var d=40*Math.ceil(Math.abs(k)/(2*Math.PI));if(0===k)return this;c=a+Math.cos(e)*h;var m=b+Math.sin(e)*h;this.currentPath?this.currentPath.shape.points.push(c,m):this.moveTo(c,m);c=this.currentPath.shape.points;k/=2*d;for(var m=2*k,n=Math.cos(k),g=Math.sin(k),d=d-1,q=d%1/d,f=0;f<=d;f++){var w=k+e+m*(f+q*f),L=Math.cos(w),w=-Math.sin(w);c.push((n*L+g*w)*h+a,(n*-w+g*L)*h+b)}this.dirty=this.boundsDirty=!0;return this};a.prototype.beginFill=
function(a,b){this.filling=!0;this.fillColor=a||0;this.fillAlpha=void 0===b?1:b;this.currentPath&&2>=this.currentPath.shape.points.length&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha);return this};a.prototype.endFill=function(){this.filling=!1;this.fillColor=null;this.fillAlpha=1;return this};a.prototype.drawRect=function(a,b,h,e){this.drawShape(new n.Rectangle(a,b,h,e));return this};a.prototype.drawRoundedRect=function(a,
b,h,e,c){this.drawShape(new n.RoundedRectangle(a,b,h,e,c));return this};a.prototype.drawCircle=function(a,b,h){this.drawShape(new n.Circle(a,b,h));return this};a.prototype.drawEllipse=function(a,b,h,e){this.drawShape(new n.Ellipse(a,b,h,e));return this};a.prototype.drawPolygon=function(a){var b=a,h=!0;b instanceof n.Polygon&&(h=b.closed,b=b.points);if(!Array.isArray(b))for(var b=Array(arguments.length),e=0;e<b.length;++e)b[e]=arguments[e];b=new n.Polygon(b);b.closed=h;this.drawShape(b);return this};
a.prototype.clear=function(){this.lineWidth=0;this.filling=!1;this.clearDirty=this.dirty=!0;this.graphicsData=[];return this};a.prototype.generateTexture=function(a,b,c){b=b||1;a=this.getLocalBounds();var d=new k(a.width*b,a.height*b);c=e.fromCanvas(d.canvas,c);c.baseTexture.resolution=b;d.context.scale(b,b);d.context.translate(-a.x,-a.y);h.renderGraphics(this,d.context);return c};a.prototype._renderWebGL=function(a){this.glDirty&&(this.dirty=!0,this.glDirty=!1);a.setObjectRenderer(a.plugins.graphics);
a.plugins.graphics.render(this)};a.prototype._renderCanvas=function(a){if(!0!==this.isMask){this._prevTint!==this.tint&&(this.dirty=!0);var b=a.context,e=this.worldTransform,c=a.blendModes[this.blendMode];c!==b.globalCompositeOperation&&(b.globalCompositeOperation=c);a=a.resolution;b.setTransform(e.a*a,e.b*a,e.c*a,e.d*a,e.tx*a,e.ty*a);h.renderGraphics(this,b)}};a.prototype.getBounds=function(a){if(!this._currentBounds){if(!this.renderable)return n.Rectangle.EMPTY;this.boundsDirty&&(this.updateLocalBounds(),
this.cachedSpriteDirty=this.glDirty=!0,this.boundsDirty=!1);var b=this._localBounds,h=b.x,e=b.width+b.x,c=b.y,k=b.height+b.y;a=a||this.worldTransform;var d=a.a,m=a.b,g=a.c,q=a.d,f=a.tx,w=a.ty,N=d*e+g*k+f,b=q*k+m*e+w;a=d*h+g*k+f;var k=q*k+m*h+w,L=d*h+g*c+f,h=q*c+m*h+w,d=d*e+g*c+f,e=q*c+m*e+w,c=N,m=b,N=a<N?a:N,N=L<N?L:N,N=d<N?d:N,b=k<b?k:b,b=h<b?h:b,b=e<b?e:b,c=a>c?a:c,c=L>c?L:c,m=k>m?k:m,m=h>m?h:m;this._bounds.x=N;this._bounds.width=(d>c?d:c)-N;this._bounds.y=b;this._bounds.height=(e>m?e:m)-b;this._currentBounds=
this._bounds}return this._currentBounds};a.prototype.containsPoint=function(a){this.worldTransform.applyInverse(a,w);a=this.graphicsData;for(var b=0;b<a.length;b++){var h=a[b];if(h.fill&&h.shape&&h.shape.contains(w.x,w.y))return!0}return!1};a.prototype.updateLocalBounds=function(){var a=Infinity,b=-Infinity,h=Infinity,e=-Infinity;if(this.graphicsData.length)for(var c,k,d,m,n,g=0;g<this.graphicsData.length;g++)if(d=this.graphicsData[g],k=d.type,n=d.lineWidth,c=d.shape,k===q.SHAPES.RECT||k===q.SHAPES.RREC)k=
c.x-n/2,d=c.y-n/2,m=c.width+n,n=c.height+n,a=k<a?k:a,b=k+m>b?k+m:b,h=d<h?d:h,e=d+n>e?d+n:e;else if(k===q.SHAPES.CIRC)k=c.x,d=c.y,m=c.radius+n/2,n=c.radius+n/2,a=k-m<a?k-m:a,b=k+m>b?k+m:b,h=d-n<h?d-n:h,e=d+n>e?d+n:e;else if(k===q.SHAPES.ELIP)k=c.x,d=c.y,m=c.width+n/2,n=c.height+n/2,a=k-m<a?k-m:a,b=k+m>b?k+m:b,h=d-n<h?d-n:h,e=d+n>e?d+n:e;else for(c=c.points,m=0;m<c.length;m+=2)k=c[m],d=c[m+1],a=k-n<a?k-n:a,b=k+n>b?k+n:b,h=d-n<h?d-n:h,e=d+n>e?d+n:e;else e=h=b=a=0;g=this.boundsPadding;this._localBounds.x=
a-g;this._localBounds.width=b-a+2*g;this._localBounds.y=h-g;this._localBounds.height=e-h+2*g};a.prototype.drawShape=function(a){this.currentPath&&2>=this.currentPath.shape.points.length&&this.graphicsData.pop();this.currentPath=null;a=new m(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,a);this.graphicsData.push(a);a.type===q.SHAPES.POLY&&(a.shape.closed=a.shape.closed||this.filling,this.currentPath=a);this.dirty=this.boundsDirty=!0;return a};a.prototype.destroy=
function(){g.prototype.destroy.apply(this,arguments);for(var a=0;a<this.graphicsData.length;++a)this.graphicsData[a].destroy();for(var b in this._webgl)for(a=0;a<this._webgl[b].data.length;++a)this._webgl[b].data[a].destroy();this._localBounds=this._webgl=this.currentPath=this.graphicsData=null}},{"../const":16,"../display/Container":17,"../math":26,"../renderers/canvas/utils/CanvasBuffer":38,"../renderers/canvas/utils/CanvasGraphics":39,"../textures/Texture":65,"./GraphicsData":20}],20:[function(b,
c,f){function a(a,b,c,h,d,n,q){this.lineWidth=a;this.lineColor=b;this.lineAlpha=c;this._lineTint=b;this.fillColor=h;this.fillAlpha=d;this._fillTint=h;this.fill=n;this.shape=q;this.type=q.type}a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){return new a(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};a.prototype.destroy=function(){this.shape=null}},{}],21:[function(b,c,f){function a(a){h.call(this,a);this.graphicsDataPool=[];this.complexPrimitiveShader=
this.primitiveShader=null;this.maximumSimplePolySize=200}var g=b("../../utils"),e=b("../../math"),k=b("../../const"),h=b("../../renderers/webgl/utils/ObjectRenderer");f=b("../../renderers/webgl/WebGLRenderer");var m=b("./WebGLGraphicsData"),n=b("earcut");a.prototype=Object.create(h.prototype);a.prototype.constructor=a;c.exports=a;f.registerPlugin("graphics",a);a.prototype.onContextChange=function(){};a.prototype.destroy=function(){h.prototype.destroy.call(this);for(var a=0;a<this.graphicsDataPool.length;++a)this.graphicsDataPool[a].destroy();
this.graphicsDataPool=null};a.prototype.render=function(a){var b=this.renderer,h=b.gl,e,c;!a.dirty&&a._webGL[h.id]||this.updateGraphics(a);var k=a._webGL[h.id];b.blendModeManager.setBlendMode(a.blendMode);for(var d=0,m=k.data.length;d<m;d++)c=k.data[d],1===k.data[d].mode?(b.stencilManager.pushStencil(a,c),h.uniform1f(b.shaderManager.complexPrimitiveShader.uniforms.alpha._location,a.worldAlpha*c.alpha),h.drawElements(h.TRIANGLE_FAN,4,h.UNSIGNED_SHORT,2*(c.indices.length-4)),b.stencilManager.popStencil(a,
c)):(e=b.shaderManager.primitiveShader,b.shaderManager.setShader(e),h.uniformMatrix3fv(e.uniforms.translationMatrix._location,!1,a.worldTransform.toArray(!0)),h.uniformMatrix3fv(e.uniforms.projectionMatrix._location,!1,b.currentRenderTarget.projectionMatrix.toArray(!0)),h.uniform3fv(e.uniforms.tint._location,g.hex2rgb(a.tint)),h.uniform1f(e.uniforms.alpha._location,a.worldAlpha),h.bindBuffer(h.ARRAY_BUFFER,c.buffer),h.vertexAttribPointer(e.attributes.aVertexPosition,2,h.FLOAT,!1,24,0),h.vertexAttribPointer(e.attributes.aColor,
4,h.FLOAT,!1,24,8),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,c.indexBuffer),h.drawElements(h.TRIANGLE_STRIP,c.indices.length,h.UNSIGNED_SHORT,0)),b.drawCount++};a.prototype.updateGraphics=function(a){var b=this.renderer.gl,h=a._webGL[b.id];h||(h=a._webGL[b.id]={lastIndex:0,data:[],gl:b});a.dirty=!1;if(a.clearDirty){a.clearDirty=!1;for(b=0;b<h.data.length;b++){var e=h.data[b];e.reset();this.graphicsDataPool.push(e)}h.data=[];h.lastIndex=0}for(b=h.lastIndex;b<a.graphicsData.length;b++){var c=a.graphicsData[b];
c.type===k.SHAPES.POLY?(c.points=c.shape.points.slice(),c.shape.closed&&(c.points[0]===c.points[c.points.length-2]&&c.points[1]===c.points[c.points.length-1]||c.points.push(c.points[0],c.points[1])),c.fill&&6<=c.points.length&&(c.points.length<2*this.maximumSimplePolySize?(e=this.switchMode(h,0),this.buildPoly(c,e)||(e=this.switchMode(h,1),this.buildComplexPoly(c,e))):(e=this.switchMode(h,1),this.buildComplexPoly(c,e))),0<c.lineWidth&&(e=this.switchMode(h,0),this.buildLine(c,e))):(e=this.switchMode(h,
0),c.type===k.SHAPES.RECT?this.buildRectangle(c,e):c.type===k.SHAPES.CIRC||c.type===k.SHAPES.ELIP?this.buildCircle(c,e):c.type===k.SHAPES.RREC&&this.buildRoundedRectangle(c,e));h.lastIndex++}for(b=0;b<h.data.length;b++)e=h.data[b],e.dirty&&e.upload()};a.prototype.switchMode=function(a,b){var h;if(a.data.length){if(h=a.data[a.data.length-1],32E4<h.points.length||h.mode!==b||1===b)h=this.graphicsDataPool.pop()||new m(a.gl),h.mode=b,a.data.push(h)}else h=this.graphicsDataPool.pop()||new m(a.gl),h.mode=
b,a.data.push(h);h.dirty=!0;return h};a.prototype.buildRectangle=function(a,b){var h=a.shape,e=h.x,c=h.y,k=h.width,h=h.height;if(a.fill){var d=g.hex2rgb(a.fillColor),m=a.fillAlpha,n=d[0]*m,f=d[1]*m,d=d[2]*m,z=b.points,C=b.indices,I=z.length/6;z.push(e,c);z.push(n,f,d,m);z.push(e+k,c);z.push(n,f,d,m);z.push(e,c+h);z.push(n,f,d,m);z.push(e+k,c+h);z.push(n,f,d,m);C.push(I,I,I+1,I+2,I+3,I+3)}a.lineWidth&&(m=a.points,a.points=[e,c,e+k,c,e+k,c+h,e,c+h,e,c],this.buildLine(a,b),a.points=m)};a.prototype.buildRoundedRectangle=
function(a,b){var h=a.shape,e=h.x,c=h.y,k=h.width,d=h.height,m=h.radius,h=[];h.push(e,c+m);this.quadraticBezierCurve(e,c+d-m,e,c+d,e+m,c+d,h);this.quadraticBezierCurve(e+k-m,c+d,e+k,c+d,e+k,c+d-m,h);this.quadraticBezierCurve(e+k,c+m,e+k,c,e+k-m,c,h);this.quadraticBezierCurve(e+m,c,e,c,e,c+m+1E-10,h);if(a.fill){var d=g.hex2rgb(a.fillColor),e=a.fillAlpha,c=d[0]*e,k=d[1]*e,d=d[2]*e,m=b.points,f=b.indices,A=m.length/6,z=n(h,null,2),C;for(C=0;C<z.length;C+=3)f.push(z[C]+A),f.push(z[C]+A),f.push(z[C+1]+
A),f.push(z[C+2]+A),f.push(z[C+2]+A);for(C=0;C<h.length;C++)m.push(h[C],h[++C],c,k,d,e)}a.lineWidth&&(e=a.points,a.points=h,this.buildLine(a,b),a.points=e)};a.prototype.quadraticBezierCurve=function(a,b,h,e,c,k,d){var m,n,g,f;d=d||[];for(var C,I=0;20>=I;I++)C=I/20,m=a+(h-a)*C,n=b+(e-b)*C,g=h+(c-h)*C,f=e+(k-e)*C,m+=(g-m)*C,n+=(f-n)*C,d.push(m,n);return d};a.prototype.buildCircle=function(a,b){var h=a.shape,e=h.x,c=h.y,d,m;a.type===k.SHAPES.CIRC?m=d=h.radius:(d=h.width,m=h.height);var h=Math.floor(30*
Math.sqrt(h.radius))||Math.floor(15*Math.sqrt(h.width+h.height)),n=2*Math.PI/h,f;if(a.fill){f=g.hex2rgb(a.fillColor);var A=a.fillAlpha,z=f[0]*A,C=f[1]*A,I=f[2]*A,M=b.points,N=b.indices,L=M.length/6;N.push(L);for(f=0;f<h+1;f++)M.push(e,c,z,C,I,A),M.push(e+Math.sin(n*f)*d,c+Math.cos(n*f)*m,z,C,I,A),N.push(L++,L++);N.push(L-1)}if(a.lineWidth){A=a.points;a.points=[];for(f=0;f<h+1;f++)a.points.push(e+Math.sin(n*f)*d,c+Math.cos(n*f)*m);this.buildLine(a,b);a.points=A}};a.prototype.buildLine=function(a,b){var h,
c=a.points;if(0!==c.length){var k=new e.Point(c[0],c[1]),d=new e.Point(c[c.length-2],c[c.length-1]);if(k.x===d.x&&k.y===d.y){c=c.slice();c.pop();c.pop();var d=new e.Point(c[c.length-2],c[c.length-1]),m=d.x+.5*(k.x-d.x),k=d.y+.5*(k.y-d.y);c.unshift(m,k);c.push(m,k)}var m=b.points,k=b.indices,d=c.length/2,n=c.length,f=m.length/6,A=a.lineWidth/2;h=g.hex2rgb(a.lineColor);var z=a.lineAlpha,C=h[0]*z,I=h[1]*z,M=h[2]*z,N,L,J,B,x,H,K,O,F,E,P,Q,R;J=c[0];B=c[1];x=c[2];H=c[3];F=-(B-H);E=J-x;L=Math.sqrt(F*F+E*
E);F=F/L*A;E=E/L*A;m.push(J-F,B-E,C,I,M,z);m.push(J+F,B+E,C,I,M,z);for(h=1;h<d-1;h++)J=c[2*(h-1)],B=c[2*(h-1)+1],x=c[2*h],H=c[2*h+1],K=c[2*(h+1)],O=c[2*(h+1)+1],F=-(B-H),E=J-x,L=Math.sqrt(F*F+E*E),F/=L,E/=L,F*=A,E*=A,P=-(H-O),Q=x-K,L=Math.sqrt(P*P+Q*Q),P/=L,Q/=L,P*=A,Q*=A,L=-E+B-(-E+H),N=-F+x-(-F+J),J=(-F+J)*(-E+H)-(-F+x)*(-E+B),B=-Q+O-(-Q+H),R=-P+x-(-P+K),K=(-P+K)*(-Q+H)-(-P+x)*(-Q+O),O=L*R-B*N,.1>Math.abs(O)?(m.push(x-F,H-E,C,I,M,z),m.push(x+F,H+E,C,I,M,z)):(N=(N*K-R*J)/O,L=(B*J-L*K)/O,K=(N-x)*
(N-x)+(L-H)*(L-H),19600<K?(F-=P,E-=Q,L=Math.sqrt(F*F+E*E),F/=L,E/=L,F*=A,E*=A,m.push(x-F,H-E),m.push(C,I,M,z),m.push(x+F,H+E),m.push(C,I,M,z),m.push(x-F,H-E),m.push(C,I,M,z),n++):(m.push(N,L),m.push(C,I,M,z),m.push(x-(N-x),H-(L-H)),m.push(C,I,M,z)));J=c[2*(d-2)];B=c[2*(d-2)+1];x=c[2*(d-1)];H=c[2*(d-1)+1];F=-(B-H);E=J-x;L=Math.sqrt(F*F+E*E);F=F/L*A;E=E/L*A;m.push(x-F,H-E);m.push(C,I,M,z);m.push(x+F,H+E);m.push(C,I,M,z);k.push(f);for(h=0;h<n;h++)k.push(f++);k.push(f-1)}};a.prototype.buildComplexPoly=
function(a,b){var h=a.points.slice();if(!(6>h.length)){var e=b.indices;b.points=h;b.alpha=a.fillAlpha;b.color=g.hex2rgb(a.fillColor);for(var c=Infinity,k=-Infinity,d=Infinity,m=-Infinity,n,f,z=0;z<h.length;z+=2)n=h[z],f=h[z+1],c=n<c?n:c,k=n>k?n:k,d=f<d?f:d,m=f>m?f:m;h.push(c,d,k,d,k,m,c,m);h=h.length/2;for(z=0;z<h;z++)e.push(z)}};a.prototype.buildPoly=function(a,b){var h=a.points;if(!(6>h.length)){var e=b.points,c=b.indices,k=h.length/2,d=g.hex2rgb(a.fillColor),m=a.fillAlpha,f=d[0]*m,A=d[1]*m,d=d[2]*
m,z=n(h,null,2);if(!z)return!1;var C=e.length/6,I;for(I=0;I<z.length;I+=3)c.push(z[I]+C),c.push(z[I]+C),c.push(z[I+1]+C),c.push(z[I+2]+C),c.push(z[I+2]+C);for(I=0;I<k;I++)e.push(h[2*I],h[2*I+1],f,A,d,m);return!0}}},{"../../const":16,"../../math":26,"../../renderers/webgl/WebGLRenderer":42,"../../renderers/webgl/utils/ObjectRenderer":56,"../../utils":70,"./WebGLGraphicsData":22,earcut:9}],22:[function(b,c,f){function a(a){this.gl=a;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=a.createBuffer();
this.indexBuffer=a.createBuffer();this.alpha=this.mode=1;this.dirty=!0;this.glIndices=this.glPoints=null}a.prototype.constructor=a;c.exports=a;a.prototype.reset=function(){this.points.length=0;this.indices.length=0};a.prototype.upload=function(){var a=this.gl;this.glPoints=new Float32Array(this.points);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.bufferData(a.ARRAY_BUFFER,this.glPoints,a.STATIC_DRAW);this.glIndices=new Uint16Array(this.indices);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);
a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndices,a.STATIC_DRAW);this.dirty=!1};a.prototype.destroy=function(){this.indices=this.points=this.color=null;this.gl.deleteBuffer(this.buffer);this.gl.deleteBuffer(this.indexBuffer);this.glIndices=this.glPoints=this.indexBuffer=this.buffer=this.gl=null}},{}],23:[function(b,c,f){var a=c.exports=Object.assign(b("./const"),b("./math"),{utils:b("./utils"),ticker:b("./ticker"),DisplayObject:b("./display/DisplayObject"),Container:b("./display/Container"),Sprite:b("./sprites/Sprite"),
ParticleContainer:b("./particles/ParticleContainer"),SpriteRenderer:b("./sprites/webgl/SpriteRenderer"),ParticleRenderer:b("./particles/webgl/ParticleRenderer"),Text:b("./text/Text"),Graphics:b("./graphics/Graphics"),GraphicsData:b("./graphics/GraphicsData"),GraphicsRenderer:b("./graphics/webgl/GraphicsRenderer"),Texture:b("./textures/Texture"),BaseTexture:b("./textures/BaseTexture"),RenderTexture:b("./textures/RenderTexture"),VideoBaseTexture:b("./textures/VideoBaseTexture"),TextureUvs:b("./textures/TextureUvs"),
CanvasRenderer:b("./renderers/canvas/CanvasRenderer"),CanvasGraphics:b("./renderers/canvas/utils/CanvasGraphics"),CanvasBuffer:b("./renderers/canvas/utils/CanvasBuffer"),WebGLRenderer:b("./renderers/webgl/WebGLRenderer"),WebGLManager:b("./renderers/webgl/managers/WebGLManager"),ShaderManager:b("./renderers/webgl/managers/ShaderManager"),Shader:b("./renderers/webgl/shaders/Shader"),ObjectRenderer:b("./renderers/webgl/utils/ObjectRenderer"),RenderTarget:b("./renderers/webgl/utils/RenderTarget"),AbstractFilter:b("./renderers/webgl/filters/AbstractFilter"),
FXAAFilter:b("./renderers/webgl/filters/FXAAFilter"),SpriteMaskFilter:b("./renderers/webgl/filters/SpriteMaskFilter"),autoDetectRenderer:function(b,e,c,h){b=b||800;e=e||600;return!h&&a.utils.isWebGLSupported()?new a.WebGLRenderer(b,e,c):new a.CanvasRenderer(b,e,c)}})},{"./const":16,"./display/Container":17,"./display/DisplayObject":18,"./graphics/Graphics":19,"./graphics/GraphicsData":20,"./graphics/webgl/GraphicsRenderer":21,"./math":26,"./particles/ParticleContainer":32,"./particles/webgl/ParticleRenderer":34,
"./renderers/canvas/CanvasRenderer":37,"./renderers/canvas/utils/CanvasBuffer":38,"./renderers/canvas/utils/CanvasGraphics":39,"./renderers/webgl/WebGLRenderer":42,"./renderers/webgl/filters/AbstractFilter":43,"./renderers/webgl/filters/FXAAFilter":44,"./renderers/webgl/filters/SpriteMaskFilter":45,"./renderers/webgl/managers/ShaderManager":49,"./renderers/webgl/managers/WebGLManager":51,"./renderers/webgl/shaders/Shader":54,"./renderers/webgl/utils/ObjectRenderer":56,"./renderers/webgl/utils/RenderTarget":58,
"./sprites/Sprite":60,"./sprites/webgl/SpriteRenderer":61,"./text/Text":62,"./textures/BaseTexture":63,"./textures/RenderTexture":64,"./textures/Texture":65,"./textures/TextureUvs":66,"./textures/VideoBaseTexture":67,"./ticker":69,"./utils":70}],24:[function(b,c,f){function a(){this.a=1;this.c=this.b=0;this.d=1;this.ty=this.tx=0}var g=b("./Point");a.prototype.constructor=a;c.exports=a;a.prototype.fromArray=function(a){this.a=a[0];this.b=a[1];this.c=a[3];this.d=a[4];this.tx=a[2];this.ty=a[5]};a.prototype.set=
function(a,b,h,c,d,g){this.a=a;this.b=b;this.c=h;this.d=c;this.tx=d;this.ty=g;return this};a.prototype.toArray=function(a,b){this.array||(this.array=new Float32Array(9));var h=b||this.array;a?(h[0]=this.a,h[1]=this.b,h[2]=0,h[3]=this.c,h[4]=this.d,h[5]=0,h[6]=this.tx,h[7]=this.ty):(h[0]=this.a,h[1]=this.c,h[2]=this.tx,h[3]=this.b,h[4]=this.d,h[5]=this.ty,h[6]=0,h[7]=0);h[8]=1;return h};a.prototype.apply=function(a,b){b=b||new g;var h=a.x,c=a.y;b.x=this.a*h+this.c*c+this.tx;b.y=this.b*h+this.d*c+this.ty;
return b};a.prototype.applyInverse=function(a,b){b=b||new g;var h=1/(this.a*this.d+this.c*-this.b),c=a.x,d=a.y;b.x=this.d*h*c+-this.c*h*d+(this.ty*this.c-this.tx*this.d)*h;b.y=this.a*h*d+-this.b*h*c+(-this.ty*this.a+this.tx*this.b)*h;return b};a.prototype.translate=function(a,b){this.tx+=a;this.ty+=b;return this};a.prototype.scale=function(a,b){this.a*=a;this.d*=b;this.c*=a;this.b*=b;this.tx*=a;this.ty*=b;return this};a.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);var h=this.a,c=this.c,
d=this.tx;this.a=h*b-this.b*a;this.b=h*a+this.b*b;this.c=c*b-this.d*a;this.d=c*a+this.d*b;this.tx=d*b-this.ty*a;this.ty=d*a+this.ty*b;return this};a.prototype.append=function(a){var b=this.a,h=this.b,c=this.c,d=this.d;this.a=a.a*b+a.b*c;this.b=a.a*h+a.b*d;this.c=a.c*b+a.d*c;this.d=a.c*h+a.d*d;this.tx=a.tx*b+a.ty*c+this.tx;this.ty=a.tx*h+a.ty*d+this.ty;return this};a.prototype.setTransform=function(a,b,h,c,d,g,f,p,v){var r,u,t,D;r=Math.sin(f);u=Math.cos(f);f=Math.cos(v);v=Math.sin(v);t=-Math.sin(p);
D=Math.cos(p);p=u*d;d*=r;r=-r*g;g*=u;this.a=f*p+v*r;this.b=f*d+v*g;this.c=t*p+D*r;this.d=t*d+D*g;this.tx=a+(h*p+c*r);this.ty=b+(h*d+c*g);return this};a.prototype.prepend=function(a){var b=this.tx;if(1!==a.a||0!==a.b||0!==a.c||1!==a.d){var h=this.a,c=this.c;this.a=h*a.a+this.b*a.c;this.b=h*a.b+this.b*a.d;this.c=c*a.a+this.d*a.c;this.d=c*a.b+this.d*a.d}this.tx=b*a.a+this.ty*a.c+a.tx;this.ty=b*a.b+this.ty*a.d+a.ty;return this};a.prototype.invert=function(){var a=this.a,b=this.b,h=this.c,c=this.d,d=this.tx,
g=a*c-b*h;this.a=c/g;this.b=-b/g;this.c=-h/g;this.d=a/g;this.tx=(h*this.ty-c*d)/g;this.ty=-(a*this.ty-b*d)/g;return this};a.prototype.identity=function(){this.a=1;this.c=this.b=0;this.d=1;this.ty=this.tx=0;return this};a.prototype.clone=function(){var b=new a;b.a=this.a;b.b=this.b;b.c=this.c;b.d=this.d;b.tx=this.tx;b.ty=this.ty;return b};a.prototype.copy=function(a){a.a=this.a;a.b=this.b;a.c=this.c;a.d=this.d;a.tx=this.tx;a.ty=this.ty;return a};a.IDENTITY=new a;a.TEMP_MATRIX=new a},{"./Point":25}],
25:[function(b,c,f){function a(a,b){this.x=a||0;this.y=b||0}a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.copy=function(a){this.set(a.x,a.y)};a.prototype.equals=function(a){return a.x===this.x&&a.y===this.y};a.prototype.set=function(a,b){this.x=a||0;this.y=b||(0!==b?this.x:0)}},{}],26:[function(b,c,f){c.exports={Point:b("./Point"),Matrix:b("./Matrix"),Circle:b("./shapes/Circle"),Ellipse:b("./shapes/Ellipse"),Polygon:b("./shapes/Polygon"),
Rectangle:b("./shapes/Rectangle"),RoundedRectangle:b("./shapes/RoundedRectangle")}},{"./Matrix":24,"./Point":25,"./shapes/Circle":27,"./shapes/Ellipse":28,"./shapes/Polygon":29,"./shapes/Rectangle":30,"./shapes/RoundedRectangle":31}],27:[function(b,c,f){function a(a,b,c){this.x=a||0;this.y=b||0;this.radius=c||0;this.type=e.SHAPES.CIRC}var g=b("./Rectangle"),e=b("../../const");a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){return new a(this.x,this.y,this.radius)};a.prototype.contains=
function(a,b){if(0>=this.radius)return!1;var c=this.x-a,e=this.y-b;return c*c+e*e<=this.radius*this.radius};a.prototype.getBounds=function(){return new g(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}},{"../../const":16,"./Rectangle":30}],28:[function(b,c,f){function a(a,b,c,d){this.x=a||0;this.y=b||0;this.width=c||0;this.height=d||0;this.type=e.SHAPES.ELIP}var g=b("./Rectangle"),e=b("../../const");a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){return new a(this.x,
this.y,this.width,this.height)};a.prototype.contains=function(a,b){if(0>=this.width||0>=this.height)return!1;var c=(a-this.x)/this.width,e=(b-this.y)/this.height;return 1>=c*c+e*e};a.prototype.getBounds=function(){return new g(this.x-this.width,this.y-this.height,this.width,this.height)}},{"../../const":16,"./Rectangle":30}],29:[function(b,c,f){function a(a){var b=a;if(!Array.isArray(b))for(var b=Array(arguments.length),c=0;c<b.length;++c)b[c]=arguments[c];if(b[0]instanceof g){for(var c=[],d=0,q=
b.length;d<q;d++)c.push(b[d].x,b[d].y);b=c}this.closed=!0;this.points=b;this.type=e.SHAPES.POLY}var g=b("../Point"),e=b("../../const");a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){return new a(this.points.slice())};a.prototype.contains=function(a,b){for(var c=!1,e=this.points.length/2,d=0,g=e-1;d<e;g=d++){var f=this.points[2*d],v=this.points[2*d+1],r=this.points[2*g],g=this.points[2*g+1];v>b!==g>b&&a<(r-f)*(b-v)/(g-v)+f&&(c=!c)}return c}},{"../../const":16,"../Point":25}],30:[function(b,
c,f){function a(a,b,h,c){this.x=a||0;this.y=b||0;this.width=h||0;this.height=c||0;this.type=g.SHAPES.RECT}var g=b("../../const");a.prototype.constructor=a;c.exports=a;a.EMPTY=new a(0,0,0,0);a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)};a.prototype.contains=function(a,b){return 0>=this.width||0>=this.height?!1:a>=this.x&&a<this.x+this.width&&b>=this.y&&b<this.y+this.height?!0:!1}},{"../../const":16}],31:[function(b,c,f){function a(a,b,h,c,d){this.x=a||0;this.y=b||
0;this.width=h||0;this.height=c||0;this.radius=d||20;this.type=g.SHAPES.RREC}var g=b("../../const");a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height,this.radius)};a.prototype.contains=function(a,b){return 0>=this.width||0>=this.height?!1:a>=this.x&&a<=this.x+this.width&&b>=this.y&&b<=this.y+this.height?!0:!1}},{"../../const":16}],32:[function(b,c,f){function a(a,b,c){g.call(this);c=c||15E3;a=a||15E3;16384<c&&(c=16384);c>a&&(c=a);
this._properties=[!1,!0,!1,!1,!1];this._maxSize=a;this._batchSize=c;this._buffers=null;this._bufferToUpdate=0;this.interactiveChildren=!1;this.blendMode=e.BLEND_MODES.NORMAL;this.roundPixels=!0;this.setProperties(b)}var g=b("../display/Container"),e=b("../const");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.setProperties=function(a){a&&(this._properties[0]="scale"in a?!!a.scale:this._properties[0],this._properties[1]="position"in a?!!a.position:this._properties[1],
this._properties[2]="rotation"in a?!!a.rotation:this._properties[2],this._properties[3]="uvs"in a?!!a.uvs:this._properties[3],this._properties[4]="alpha"in a?!!a.alpha:this._properties[4])};a.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};a.prototype.renderWebGL=function(a){this.visible&&!(0>=this.worldAlpha)&&this.children.length&&this.renderable&&(a.setObjectRenderer(a.plugins.particle),a.plugins.particle.render(this))};a.prototype.onChildrenChange=function(a){a=Math.floor(a/
this._batchSize);a<this._bufferToUpdate&&(this._bufferToUpdate=a)};a.prototype.renderCanvas=function(a){if(this.visible&&!(0>=this.worldAlpha)&&this.children.length&&this.renderable){var b=a.context,c=this.worldTransform,e=!0,d,g,f,v,r=a.blendModes[this.blendMode];r!==b.globalCompositeOperation&&(b.globalCompositeOperation=r);b.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();for(r=0;r<this.children.length;++r){var u=this.children[r];if(u.visible){var t=u.texture.frame;b.globalAlpha=
this.worldAlpha*u.alpha;0===u.rotation%(2*Math.PI)?(e&&(b.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty),e=!1),d=u.anchor.x*-t.width*u.scale.x+u.position.x+.5,g=u.anchor.y*-t.height*u.scale.y+u.position.y+.5,f=t.width*u.scale.x,v=t.height*u.scale.y):(e||(e=!0),u.displayObjectUpdateTransform(),d=u.worldTransform,a.roundPixels?b.setTransform(d.a,d.b,d.c,d.d,d.tx|0,d.ty|0):b.setTransform(d.a,d.b,d.c,d.d,d.tx,d.ty),d=u.anchor.x*-t.width+.5,g=u.anchor.y*-t.height+.5,f=t.width,v=t.height);b.drawImage(u.texture.baseTexture.source,
t.x,t.y,t.width,t.height,d,g,f,v)}}}};a.prototype.destroy=function(){g.prototype.destroy.apply(this,arguments);if(this._buffers)for(var a=0;a<this._buffers.length;++a)this._buffers[a].destroy();this._buffers=this._properties=null}},{"../const":16,"../display/Container":17}],33:[function(b,c,f){function a(a,b,c,h){this.gl=a;this.vertSize=2;this.vertByteSize=4*this.vertSize;this.size=h;this.dynamicProperties=[];this.staticProperties=[];for(a=0;a<b.length;a++)h=b[a],c[a]?this.dynamicProperties.push(h):
this.staticProperties.push(h);this.staticStride=0;this.staticData=this.staticBuffer=null;this.dynamicStride=0;this.dynamicData=this.dynamicBuffer=null;this.initBuffers()}a.prototype.constructor=a;c.exports=a;a.prototype.initBuffers=function(){var a=this.gl,b,c,h=0;for(b=this.dynamicStride=0;b<this.dynamicProperties.length;b++)c=this.dynamicProperties[b],c.offset=h,h+=c.size,this.dynamicStride+=c.size;this.dynamicData=new Float32Array(this.size*this.dynamicStride*4);this.dynamicBuffer=a.createBuffer();
a.bindBuffer(a.ARRAY_BUFFER,this.dynamicBuffer);a.bufferData(a.ARRAY_BUFFER,this.dynamicData,a.DYNAMIC_DRAW);for(b=this.staticStride=h=0;b<this.staticProperties.length;b++)c=this.staticProperties[b],c.offset=h,h+=c.size,this.staticStride+=c.size;this.staticData=new Float32Array(this.size*this.staticStride*4);this.staticBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.staticBuffer);a.bufferData(a.ARRAY_BUFFER,this.staticData,a.DYNAMIC_DRAW)};a.prototype.uploadDynamic=function(a,b,c){for(var h=
this.gl,d=0;d<this.dynamicProperties.length;d++){var n=this.dynamicProperties[d];n.uploadFunction(a,b,c,this.dynamicData,this.dynamicStride,n.offset)}h.bindBuffer(h.ARRAY_BUFFER,this.dynamicBuffer);h.bufferSubData(h.ARRAY_BUFFER,0,this.dynamicData)};a.prototype.uploadStatic=function(a,b,c){for(var h=this.gl,d=0;d<this.staticProperties.length;d++){var n=this.staticProperties[d];n.uploadFunction(a,b,c,this.staticData,this.staticStride,n.offset)}h.bindBuffer(h.ARRAY_BUFFER,this.staticBuffer);h.bufferSubData(h.ARRAY_BUFFER,
0,this.staticData)};a.prototype.bind=function(){var a=this.gl,b,c;a.bindBuffer(a.ARRAY_BUFFER,this.dynamicBuffer);for(b=0;b<this.dynamicProperties.length;b++)c=this.dynamicProperties[b],a.vertexAttribPointer(c.attribute,c.size,a.FLOAT,!1,4*this.dynamicStride,4*c.offset);a.bindBuffer(a.ARRAY_BUFFER,this.staticBuffer);for(b=0;b<this.staticProperties.length;b++)c=this.staticProperties[b],a.vertexAttribPointer(c.attribute,c.size,a.FLOAT,!1,4*this.staticStride,4*c.offset)};a.prototype.destroy=function(){this.dynamicData=
this.dynamicProperties=null;this.gl.deleteBuffer(this.dynamicBuffer);this.staticData=this.staticProperties=null;this.gl.deleteBuffer(this.staticBuffer)}},{}],34:[function(b,c,f){function a(a){g.call(this,a);this.indices=new Uint16Array(98304);for(var b=a=0;98304>a;a+=6,b+=4)this.indices[a+0]=b+0,this.indices[a+1]=b+1,this.indices[a+2]=b+2,this.indices[a+3]=b+0,this.indices[a+4]=b+2,this.indices[a+5]=b+3;this.properties=this.indexBuffer=this.shader=null;this.tempMatrix=new h.Matrix}var g=b("../../renderers/webgl/utils/ObjectRenderer");
f=b("../../renderers/webgl/WebGLRenderer");var e=b("./ParticleShader"),k=b("./ParticleBuffer"),h=b("../../math");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;f.registerPlugin("particle",a);a.prototype.onContextChange=function(){var a=this.renderer.gl;this.shader=new e(this.renderer.shaderManager);this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);this.properties=[{attribute:this.shader.attributes.aVertexPosition,
size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,uploadFunction:this.uploadAlpha,offset:0}]};a.prototype.start=function(){var a=this.renderer.gl;a.activeTexture(a.TEXTURE0);
a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);this.renderer.shaderManager.setShader(this.shader)};a.prototype.render=function(a){var b=a.children,h=b.length,c=a._maxSize,e=a._batchSize;if(0!==h){h>c&&(h=c);a._buffers||(a._buffers=this.generateBuffers(a));this.renderer.blendModeManager.setBlendMode(a.blendMode);var c=this.renderer.gl,d=a.worldTransform.copy(this.tempMatrix);d.prepend(this.renderer.currentRenderTarget.projectionMatrix);c.uniformMatrix3fv(this.shader.uniforms.projectionMatrix._location,
!1,d.toArray(!0));c.uniform1f(this.shader.uniforms.uAlpha._location,a.worldAlpha);d=b[0]._texture.baseTexture;if(d._glTextures[c.id])c.bindTexture(c.TEXTURE_2D,d._glTextures[c.id]);else{if(!this.renderer.updateTexture(d))return;a._properties[0]&&a._properties[3]||(a._bufferToUpdate=0)}for(var k=d=0;d<h;d+=e,k+=1){var g=h-d;g>e&&(g=e);var f=a._buffers[k];f.uploadDynamic(b,d,g);a._bufferToUpdate===k&&(f.uploadStatic(b,d,g),a._bufferToUpdate=k+1);f.bind(this.shader);c.drawElements(c.TRIANGLES,6*g,c.UNSIGNED_SHORT,
0);this.renderer.drawCount++}}};a.prototype.generateBuffers=function(a){var b=this.renderer.gl,h=[],c=a._maxSize,e=a._batchSize;a=a._properties;var d;for(d=0;d<c;d+=e)h.push(new k(b,this.properties,a,e));return h};a.prototype.uploadVertices=function(a,b,h,c,e,d){for(var k,g,f,D,G,A,z,C=0;C<h;C++)k=a[b+C],g=k._texture,D=k.scale.x,G=k.scale.y,g.trim?(f=g.trim,z=f.x-k.anchor.x*f.width,A=z+g.crop.width,k=f.y-k.anchor.y*f.height,f=k+g.crop.height):(A=g._frame.width*(1-k.anchor.x),z=g._frame.width*-k.anchor.x,
f=g._frame.height*(1-k.anchor.y),k=g._frame.height*-k.anchor.y),c[d]=z*D,c[d+1]=k*G,c[d+e]=A*D,c[d+e+1]=k*G,c[d+2*e]=A*D,c[d+2*e+1]=f*G,c[d+3*e]=z*D,c[d+3*e+1]=f*G,d+=4*e};a.prototype.uploadPosition=function(a,b,h,c,e,d){for(var k=0;k<h;k++){var g=a[b+k].position;c[d]=g.x;c[d+1]=g.y;c[d+e]=g.x;c[d+e+1]=g.y;c[d+2*e]=g.x;c[d+2*e+1]=g.y;c[d+3*e]=g.x;c[d+3*e+1]=g.y;d+=4*e}};a.prototype.uploadRotation=function(a,b,h,c,e,d){for(var k=0;k<h;k++){var g=a[b+k].rotation;c[d]=g;c[d+e]=g;c[d+2*e]=g;c[d+3*e]=
g;d+=4*e}};a.prototype.uploadUvs=function(a,b,h,c,e,d){for(var k=0;k<h;k++){var g=a[b+k]._texture._uvs;g?(c[d]=g.x0,c[d+1]=g.y0,c[d+e]=g.x1,c[d+e+1]=g.y1,c[d+2*e]=g.x2,c[d+2*e+1]=g.y2,c[d+3*e]=g.x3,c[d+3*e+1]=g.y3):(c[d]=0,c[d+1]=0,c[d+e]=0,c[d+e+1]=0,c[d+2*e]=0,c[d+2*e+1]=0,c[d+3*e]=0,c[d+3*e+1]=0);d+=4*e}};a.prototype.uploadAlpha=function(a,b,c,h,e,d){for(var k=0;k<c;k++){var g=a[b+k].alpha;h[d]=g;h[d+e]=g;h[d+2*e]=g;h[d+3*e]=g;d+=4*e}};a.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer);
g.prototype.destroy.apply(this,arguments);this.shader.destroy();this.tempMatrix=this.indices=null}},{"../../math":26,"../../renderers/webgl/WebGLRenderer":42,"../../renderers/webgl/utils/ObjectRenderer":56,"./ParticleBuffer":33,"./ParticleShader":35}],35:[function(b,c,f){function a(a){g.call(this,a,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aColor;\nattribute vec2 aPositionCoord;\nattribute vec2 aScale;\nattribute float aRotation;\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\nvarying float vColor;\nvoid main(void){\n   vec2 v = aVertexPosition;\n   v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n   v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n   v = v + aPositionCoord;\n   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = aColor;\n}",
"precision lowp float;\nvarying vec2 vTextureCoord;\nvarying float vColor;\nuniform sampler2D uSampler;\nuniform float uAlpha;\nvoid main(void){\n  vec4 color = texture2D(uSampler, vTextureCoord) * vColor * uAlpha;\n  if (color.a == 0.0) discard;\n  gl_FragColor = color;\n}",{uAlpha:{type:"1f",value:1}},{aPositionCoord:0,aRotation:0})}var g=b("../../renderers/webgl/shaders/TextureShader");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a},{"../../renderers/webgl/shaders/TextureShader":55}],
36:[function(b,c,f){function a(a,b,c,d){h.call(this);g.sayHello(a);if(d)for(var f in k.DEFAULT_RENDER_OPTIONS)"undefined"===typeof d[f]&&(d[f]=k.DEFAULT_RENDER_OPTIONS[f]);else d=k.DEFAULT_RENDER_OPTIONS;this.type=k.RENDERER_TYPE.UNKNOWN;this.width=b||800;this.height=c||600;this.view=d.view||document.createElement("canvas");this.resolution=d.resolution;this.transparent=d.transparent;this.autoResize=d.autoResize||!1;this.blendModes=null;this.preserveDrawingBuffer=d.preserveDrawingBuffer;this.clearBeforeRender=
d.clearBeforeRender;this.roundPixels=d.roundPixels;this._backgroundColor=0;this._backgroundColorRgb=[0,0,0];this._backgroundColorString="#000000";this.backgroundColor=d.backgroundColor||this._backgroundColor;this._lastObjectRendered=this._tempDisplayObjectParent={worldTransform:new e.Matrix,worldAlpha:1,children:[]}}var g=b("../utils"),e=b("../math"),k=b("../const"),h=b("eventemitter3");a.prototype=Object.create(h.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,
{backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=a;this._backgroundColorString=g.hex2string(a);g.hex2rgb(a,this._backgroundColorRgb)}}});a.prototype.resize=function(a,b){this.width=a*this.resolution;this.height=b*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")};a.prototype.destroy=function(a){a&&
this.view.parentNode&&this.view.parentNode.removeChild(this.view);this.type=k.RENDERER_TYPE.UNKNOWN;this.height=this.width=0;this.view=null;this.resolution=0;this.autoResize=this.transparent=!1;this.blendModes=null;this.roundPixels=this.clearBeforeRender=this.preserveDrawingBuffer=!1;this._backgroundColor=0;this._backgroundColorString=this._backgroundColorRgb=null}},{"../const":16,"../math":26,"../utils":70,eventemitter3:10}],37:[function(b,c,f){function a(a,b,c){c=c||{};g.call(this,"Canvas",a,b,
c);this.type=m.RENDERER_TYPE.CANVAS;this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=!0;this.maskManager=new e;this.smoothProperty="imageSmoothingEnabled";this.context.imageSmoothingEnabled||(this.context.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":this.context.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":this.context.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":this.context.msImageSmoothingEnabled&&
(this.smoothProperty="msImageSmoothingEnabled"));this.initPlugins();this._mapBlendModes();this._tempDisplayObjectParent={worldTransform:new h.Matrix,worldAlpha:1};this.resize(a,b)}var g=b("../SystemRenderer"),e=b("./utils/CanvasMaskManager"),k=b("../../utils"),h=b("../../math"),m=b("../../const");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;k.pluginTarget.mixin(a);a.prototype.render=function(a){this.emit("prerender");var b=a.parent;this._lastObjectRendered=a;a.parent=
this._tempDisplayObjectParent;a.updateTransform();a.parent=b;this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.context.globalCompositeOperation=this.blendModes[m.BLEND_MODES.NORMAL];navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=this._backgroundColorString,this.context.fillRect(0,0,this.width,this.height)));this.renderDisplayObject(a,
this.context);this.emit("postrender")};a.prototype.destroy=function(a){this.destroyPlugins();g.prototype.destroy.call(this,a);this.context=null;this.refresh=!0;this.maskManager.destroy();this.smoothProperty=this.maskManager=null};a.prototype.renderDisplayObject=function(a,b){var c=this.context;this.context=b;a.renderCanvas(this);this.context=c};a.prototype.resize=function(a,b){g.prototype.resize.call(this,a,b);this.smoothProperty&&(this.context[this.smoothProperty]=m.SCALE_MODES.DEFAULT===m.SCALE_MODES.LINEAR)};
a.prototype._mapBlendModes=function(){this.blendModes||(this.blendModes={},k.canUseNewCanvasBlendModes()?(this.blendModes[m.BLEND_MODES.NORMAL]="source-over",this.blendModes[m.BLEND_MODES.ADD]="lighter",this.blendModes[m.BLEND_MODES.MULTIPLY]="multiply",this.blendModes[m.BLEND_MODES.SCREEN]="screen",this.blendModes[m.BLEND_MODES.OVERLAY]="overlay",this.blendModes[m.BLEND_MODES.DARKEN]="darken",this.blendModes[m.BLEND_MODES.LIGHTEN]="lighten",this.blendModes[m.BLEND_MODES.COLOR_DODGE]="color-dodge",
this.blendModes[m.BLEND_MODES.COLOR_BURN]="color-burn",this.blendModes[m.BLEND_MODES.HARD_LIGHT]="hard-light",this.blendModes[m.BLEND_MODES.SOFT_LIGHT]="soft-light",this.blendModes[m.BLEND_MODES.DIFFERENCE]="difference",this.blendModes[m.BLEND_MODES.EXCLUSION]="exclusion",this.blendModes[m.BLEND_MODES.HUE]="hue",this.blendModes[m.BLEND_MODES.SATURATION]="saturate",this.blendModes[m.BLEND_MODES.COLOR]="color",this.blendModes[m.BLEND_MODES.LUMINOSITY]="luminosity"):(this.blendModes[m.BLEND_MODES.NORMAL]=
"source-over",this.blendModes[m.BLEND_MODES.ADD]="lighter",this.blendModes[m.BLEND_MODES.MULTIPLY]="source-over",this.blendModes[m.BLEND_MODES.SCREEN]="source-over",this.blendModes[m.BLEND_MODES.OVERLAY]="source-over",this.blendModes[m.BLEND_MODES.DARKEN]="source-over",this.blendModes[m.BLEND_MODES.LIGHTEN]="source-over",this.blendModes[m.BLEND_MODES.COLOR_DODGE]="source-over",this.blendModes[m.BLEND_MODES.COLOR_BURN]="source-over",this.blendModes[m.BLEND_MODES.HARD_LIGHT]="source-over",this.blendModes[m.BLEND_MODES.SOFT_LIGHT]=
"source-over",this.blendModes[m.BLEND_MODES.DIFFERENCE]="source-over",this.blendModes[m.BLEND_MODES.EXCLUSION]="source-over",this.blendModes[m.BLEND_MODES.HUE]="source-over",this.blendModes[m.BLEND_MODES.SATURATION]="source-over",this.blendModes[m.BLEND_MODES.COLOR]="source-over",this.blendModes[m.BLEND_MODES.LUMINOSITY]="source-over"))}},{"../../const":16,"../../math":26,"../../utils":70,"../SystemRenderer":36,"./utils/CanvasMaskManager":40}],38:[function(b,c,f){function a(a,b){this.canvas=document.createElement("canvas");
this.context=this.canvas.getContext("2d");this.canvas.width=a;this.canvas.height=b}a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{width:{get:function(){return this.canvas.width},set:function(a){this.canvas.width=a}},height:{get:function(){return this.canvas.height},set:function(a){this.canvas.height=a}}});a.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};a.prototype.resize=function(a,b){this.canvas.width=
a;this.canvas.height=b};a.prototype.destroy=function(){this.canvas=this.context=null}},{}],39:[function(b,c,f){var a=b("../../../const");b={};c.exports=b;b.renderGraphics=function(b,c){var d=b.worldAlpha;b.dirty&&(this.updateGraphicsTint(b),b.dirty=!1);for(var h=0;h<b.graphicsData.length;h++){var m=b.graphicsData[h],n=m.shape,f=m._fillTint,w=m._lineTint;c.lineWidth=m.lineWidth;if(m.type===a.SHAPES.POLY){c.beginPath();var p=n.points;c.moveTo(p[0],p[1]);for(var v=1;v<p.length/2;v++)c.lineTo(p[2*v],
p[2*v+1]);n.closed&&c.lineTo(p[0],p[1]);p[0]===p[p.length-2]&&p[1]===p[p.length-1]&&c.closePath();m.fill&&(c.globalAlpha=m.fillAlpha*d,c.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.fill());m.lineWidth&&(c.globalAlpha=m.lineAlpha*d,c.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),c.stroke())}else if(m.type===a.SHAPES.RECT){if(m.fillColor||0===m.fillColor)c.globalAlpha=m.fillAlpha*d,c.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.fillRect(n.x,n.y,n.width,n.height);m.lineWidth&&
(c.globalAlpha=m.lineAlpha*d,c.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),c.strokeRect(n.x,n.y,n.width,n.height))}else if(m.type===a.SHAPES.CIRC)c.beginPath(),c.arc(n.x,n.y,n.radius,0,2*Math.PI),c.closePath(),m.fill&&(c.globalAlpha=m.fillAlpha*d,c.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.fill()),m.lineWidth&&(c.globalAlpha=m.lineAlpha*d,c.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),c.stroke());else if(m.type===a.SHAPES.ELIP){var r=2*n.width,v=2*n.height,p=n.x-
r/2,n=n.y-v/2;c.beginPath();var u=r/2*.5522848,t=v/2*.5522848,D=p+r,G=n+v,r=p+r/2,v=n+v/2;c.moveTo(p,v);c.bezierCurveTo(p,v-t,r-u,n,r,n);c.bezierCurveTo(r+u,n,D,v-t,D,v);c.bezierCurveTo(D,v+t,r+u,G,r,G);c.bezierCurveTo(r-u,G,p,v+t,p,v);c.closePath();m.fill&&(c.globalAlpha=m.fillAlpha*d,c.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.fill());m.lineWidth&&(c.globalAlpha=m.lineAlpha*d,c.strokeStyle="#"+("00000"+(w|0).toString(16)).substr(-6),c.stroke())}else if(m.type===a.SHAPES.RREC){p=n.x;
v=n.y;u=n.width;t=n.height;n=n.radius;D=Math.min(u,t)/2|0;n=n>D?D:n;c.beginPath();c.moveTo(p,v+n);c.lineTo(p,v+t-n);c.quadraticCurveTo(p,v+t,p+n,v+t);c.lineTo(p+u-n,v+t);c.quadraticCurveTo(p+u,v+t,p+u,v+t-n);c.lineTo(p+u,v+n);c.quadraticCurveTo(p+u,v,p+u-n,v);c.lineTo(p+n,v);c.quadraticCurveTo(p,v,p,v+n);c.closePath();if(m.fillColor||0===m.fillColor)c.globalAlpha=m.fillAlpha*d,c.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.fill();m.lineWidth&&(c.globalAlpha=m.lineAlpha*d,c.strokeStyle=
"#"+("00000"+(w|0).toString(16)).substr(-6),c.stroke())}}};b.renderGraphicsMask=function(b,c){var d=b.graphicsData.length;if(0!==d){c.beginPath();for(var h=0;h<d;h++){var m=b.graphicsData[h],n=m.shape;if(m.type===a.SHAPES.POLY){m=n.points;c.moveTo(m[0],m[1]);for(var f=1;f<m.length/2;f++)c.lineTo(m[2*f],m[2*f+1]);m[0]===m[m.length-2]&&m[1]===m[m.length-1]&&c.closePath()}else if(m.type===a.SHAPES.RECT)c.rect(n.x,n.y,n.width,n.height),c.closePath();else if(m.type===a.SHAPES.CIRC)c.arc(n.x,n.y,n.radius,
0,2*Math.PI),c.closePath();else if(m.type===a.SHAPES.ELIP){var w=2*n.width,f=2*n.height,m=n.x-w/2,n=n.y-f/2,p=w/2*.5522848,v=f/2*.5522848,r=m+w,u=n+f,w=m+w/2,f=n+f/2;c.moveTo(m,f);c.bezierCurveTo(m,f-v,w-p,n,w,n);c.bezierCurveTo(w+p,n,r,f-v,r,f);c.bezierCurveTo(r,f+v,w+p,u,w,u);c.bezierCurveTo(w-p,u,m,f+v,m,f);c.closePath()}else m.type===a.SHAPES.RREC&&(m=n.x,f=n.y,p=n.width,v=n.height,n=n.radius,r=Math.min(p,v)/2|0,n=n>r?r:n,c.moveTo(m,f+n),c.lineTo(m,f+v-n),c.quadraticCurveTo(m,f+v,m+n,f+v),c.lineTo(m+
p-n,f+v),c.quadraticCurveTo(m+p,f+v,m+p,f+v-n),c.lineTo(m+p,f+n),c.quadraticCurveTo(m+p,f,m+p-n,f),c.lineTo(m+n,f),c.quadraticCurveTo(m,f,m,f+n),c.closePath())}}};b.updateGraphicsTint=function(a){if(16777215!==a.tint||a._prevTint!==a.tint){a._prevTint=a.tint;for(var b=(a.tint>>16&255)/255,c=(a.tint>>8&255)/255,h=(a.tint&255)/255,d=0;d<a.graphicsData.length;d++){var n=a.graphicsData[d],f=n.fillColor|0,w=n.lineColor|0;n._fillTint=((f>>16&255)/255*b*255<<16)+((f>>8&255)/255*c*255<<8)+(f&255)/255*h*255;
n._lineTint=((w>>16&255)/255*b*255<<16)+((w>>8&255)/255*c*255<<8)+(w&255)/255*h*255}}}},{"../../../const":16}],40:[function(b,c,f){function a(){}var g=b("./CanvasGraphics");a.prototype.constructor=a;c.exports=a;a.prototype.pushMask=function(a,b){b.context.save();var c=a.alpha,d=a.worldTransform,n=b.resolution;b.context.setTransform(d.a*n,d.b*n,d.c*n,d.d*n,d.tx*n,d.ty*n);a.texture||(g.renderGraphicsMask(a,b.context),b.context.clip());a.worldAlpha=c};a.prototype.popMask=function(a){a.context.restore()};
a.prototype.destroy=function(){}},{"./CanvasGraphics":39}],41:[function(b,c,f){var a=b("../../../utils"),g={};c.exports=g;g.getTintedTexture=function(a,b){var c=a.texture;b=g.roundColor(b);var d="#"+("00000"+(b|0).toString(16)).substr(-6);c.tintCache=c.tintCache||{};if(c.tintCache[d])return c.tintCache[d];var n=g.canvas||document.createElement("canvas");g.tintMethod(c,b,n);if(g.convertTintToImage){var f=new Image;f.src=n.toDataURL();c.tintCache[d]=f}else c.tintCache[d]=n,g.canvas=null;return n};g.tintWithMultiply=
function(a,b,c){var d=c.getContext("2d"),n=a.baseTexture.resolution,g=a.crop.clone();g.x*=n;g.y*=n;g.width*=n;g.height*=n;c.width=g.width;c.height=g.height;d.fillStyle="#"+("00000"+(b|0).toString(16)).substr(-6);d.fillRect(0,0,g.width,g.height);d.globalCompositeOperation="multiply";d.drawImage(a.baseTexture.source,g.x,g.y,g.width,g.height,0,0,g.width,g.height);d.globalCompositeOperation="destination-atop";d.drawImage(a.baseTexture.source,g.x,g.y,g.width,g.height,0,0,g.width,g.height)};g.tintWithOverlay=
function(a,b,c){var d=c.getContext("2d"),g=a.baseTexture.resolution,f=a.crop.clone();f.x*=g;f.y*=g;f.width*=g;f.height*=g;c.width=f.width;c.height=f.height;d.globalCompositeOperation="copy";d.fillStyle="#"+("00000"+(b|0).toString(16)).substr(-6);d.fillRect(0,0,f.width,f.height);d.globalCompositeOperation="destination-atop";d.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height)};g.tintWithPerPixel=function(b,c,h){var d=h.getContext("2d"),g=b.baseTexture.resolution,f=b.crop.clone();
f.x*=g;f.y*=g;f.width*=g;f.height*=g;h.width=f.width;h.height=f.height;d.globalCompositeOperation="copy";d.drawImage(b.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);h=a.hex2rgb(c);b=h[0];c=h[1];h=h[2];for(var f=d.getImageData(0,0,f.width,f.height),g=f.data,w=0;w<g.length;w+=4)g[w+0]*=b,g[w+1]*=c,g[w+2]*=h;d.putImageData(f,0,0)};g.roundColor=function(b){var c=g.cacheStepsPerColorChannel;b=a.hex2rgb(b);b[0]=Math.min(255,b[0]/c*c);b[1]=Math.min(255,b[1]/c*c);b[2]=Math.min(255,b[2]/
c*c);return a.rgb2hex(b)};g.cacheStepsPerColorChannel=8;g.convertTintToImage=!1;g.canUseMultiply=a.canUseNewCanvasBlendModes();g.tintMethod=g.canUseMultiply?g.tintWithMultiply:g.tintWithPerPixel},{"../../../utils":70}],42:[function(b,c,f){function a(a,b,c){c=c||{};g.call(this,"WebGL",a,b,c);this.type=r.RENDERER_TYPE.WEBGL;this.handleContextLost=this.handleContextLost.bind(this);this.handleContextRestored=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.handleContextLost,
!1);this.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1);this._useFXAA=!!c.forceFXAA&&c.antialias;this._FXAAFilter=null;this._contextOptions={alpha:this.transparent,antialias:c.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:c.preserveDrawingBuffer};this.drawCount=0;this.shaderManager=new e(this);this.maskManager=new k(this);this.stencilManager=new h(this);this.filterManager=new m(this);this.blendModeManager=
new n(this);this.currentRenderTarget=null;this.currentRenderer=new w(this);this.initPlugins();this._createContext();this._initContext();this._mapGlModes();this._managedTextures=[];this._renderTargetStack=[]}var g=b("../SystemRenderer"),e=b("./managers/ShaderManager"),k=b("./managers/MaskManager"),h=b("./managers/StencilManager"),m=b("./managers/FilterManager"),n=b("./managers/BlendModeManager"),q=b("./utils/RenderTarget"),w=b("./utils/ObjectRenderer"),p=b("./filters/FXAAFilter"),v=b("../../utils"),
r=b("../../const");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;v.pluginTarget.mixin(a);a.glContextId=0;a.prototype._createContext=function(){var b=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=b;if(!b)throw Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=a.glContextId++;b.id=this.glContextId;b.renderer=this};a.prototype._initContext=function(){var a=
this.gl;a.disable(a.DEPTH_TEST);a.disable(a.CULL_FACE);a.enable(a.BLEND);this.renderTarget=new q(a,this.width,this.height,null,this.resolution,!0);this.setRenderTarget(this.renderTarget);this.emit("context",a);this.resize(this.width,this.height);this._useFXAA||(this._useFXAA=this._contextOptions.antialias&&!a.getContextAttributes().antialias);this._useFXAA&&(window.console.warn("FXAA antialiasing being used instead of native antialiasing"),this._FXAAFilter=[new p])};a.prototype.render=function(a){this.emit("prerender");
if(!this.gl.isContextLost()){this.drawCount=0;this._lastObjectRendered=a;this._useFXAA&&(this._FXAAFilter[0].uniforms.resolution.value.x=this.width,this._FXAAFilter[0].uniforms.resolution.value.y=this.height,a.filterArea=this.renderTarget.size,a.filters=this._FXAAFilter);var b=a.parent;a.parent=this._tempDisplayObjectParent;a.updateTransform();a.parent=b;b=this.gl;this.setRenderTarget(this.renderTarget);this.clearBeforeRender&&(this.transparent?b.clearColor(0,0,0,0):b.clearColor(this._backgroundColorRgb[0],
this._backgroundColorRgb[1],this._backgroundColorRgb[2],1),b.clear(b.COLOR_BUFFER_BIT));this.renderDisplayObject(a,this.renderTarget);this.emit("postrender")}};a.prototype.renderDisplayObject=function(a,b,c){this.setRenderTarget(b);c&&b.clear();this.filterManager.setFilterStack(b.filterStack);a.renderWebGL(this);this.currentRenderer.flush()};a.prototype.setObjectRenderer=function(a){this.currentRenderer!==a&&(this.currentRenderer.stop(),this.currentRenderer=a,this.currentRenderer.start())};a.prototype.setRenderTarget=
function(a){this.currentRenderTarget!==a&&(this.currentRenderTarget=a,this.currentRenderTarget.activate(),this.stencilManager.setMaskStack(a.stencilMaskStack))};a.prototype.resize=function(a,b){g.prototype.resize.call(this,a,b);this.filterManager.resize(a,b);this.renderTarget.resize(a,b);this.currentRenderTarget===this.renderTarget&&(this.renderTarget.activate(),this.gl.viewport(0,0,this.width,this.height))};a.prototype.updateTexture=function(a){a=a.baseTexture||a;if(a.hasLoaded){var b=this.gl;a._glTextures[b.id]||
(a._glTextures[b.id]=b.createTexture(),a.on("update",this.updateTexture,this),a.on("dispose",this.destroyTexture,this),this._managedTextures.push(a));b.bindTexture(b.TEXTURE_2D,a._glTextures[b.id]);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a.source);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a.scaleMode===r.SCALE_MODES.LINEAR?b.LINEAR:b.NEAREST);a.mipmap&&a.isPowerOfTwo?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,
a.scaleMode===r.SCALE_MODES.LINEAR?b.LINEAR_MIPMAP_LINEAR:b.NEAREST_MIPMAP_NEAREST),b.generateMipmap(b.TEXTURE_2D)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===r.SCALE_MODES.LINEAR?b.LINEAR:b.NEAREST);a.isPowerOfTwo?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE));return a._glTextures[b.id]}};
a.prototype.destroyTexture=function(a,b){a=a.baseTexture||a;if(a.hasLoaded&&a._glTextures[this.gl.id]&&(this.gl.deleteTexture(a._glTextures[this.gl.id]),delete a._glTextures[this.gl.id],!b)){var c=this._managedTextures.indexOf(a);-1!==c&&v.removeItems(this._managedTextures,c,1)}};a.prototype.handleContextLost=function(a){a.preventDefault()};a.prototype.handleContextRestored=function(){this._initContext();for(var a=0;a<this._managedTextures.length;++a){var b=this._managedTextures[a];b._glTextures[this.gl.id]&&
delete b._glTextures[this.gl.id]}};a.prototype.destroy=function(a){this.destroyPlugins();this.view.removeEventListener("webglcontextlost",this.handleContextLost);this.view.removeEventListener("webglcontextrestored",this.handleContextRestored);for(var b=0;b<this._managedTextures.length;++b){var c=this._managedTextures[b];this.destroyTexture(c,!0);c.off("update",this.updateTexture,this);c.off("dispose",this.destroyTexture,this)}g.prototype.destroy.call(this,a);this.uid=0;this.shaderManager.destroy();
this.maskManager.destroy();this.stencilManager.destroy();this.filterManager.destroy();this.blendModeManager.destroy();this._managedTextures=this._contextOptions=this.handleContextRestored=this.handleContextLost=this.currentRenderer=this.blendModeManager=this.filterManager=this.maskManager=this.shaderManager=null;this.drawCount=0;this.gl.useProgram(null);this.gl=null};a.prototype._mapGlModes=function(){var a=this.gl;this.blendModes||(this.blendModes={},this.blendModes[r.BLEND_MODES.NORMAL]=[a.ONE,
a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.ADD]=[a.SRC_ALPHA,a.DST_ALPHA],this.blendModes[r.BLEND_MODES.MULTIPLY]=[a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.SCREEN]=[a.SRC_ALPHA,a.ONE],this.blendModes[r.BLEND_MODES.OVERLAY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.DARKEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.LIGHTEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.COLOR_DODGE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.COLOR_BURN]=
[a.ONE,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.HARD_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.SOFT_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.DIFFERENCE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.EXCLUSION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.HUE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.SATURATION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],this.blendModes[r.BLEND_MODES.COLOR]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],
this.blendModes[r.BLEND_MODES.LUMINOSITY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA]);this.drawModes||(this.drawModes={},this.drawModes[r.DRAW_MODES.POINTS]=a.POINTS,this.drawModes[r.DRAW_MODES.LINES]=a.LINES,this.drawModes[r.DRAW_MODES.LINE_LOOP]=a.LINE_LOOP,this.drawModes[r.DRAW_MODES.LINE_STRIP]=a.LINE_STRIP,this.drawModes[r.DRAW_MODES.TRIANGLES]=a.TRIANGLES,this.drawModes[r.DRAW_MODES.TRIANGLE_STRIP]=a.TRIANGLE_STRIP,this.drawModes[r.DRAW_MODES.TRIANGLE_FAN]=a.TRIANGLE_FAN)}},{"../../const":16,"../../utils":70,
"../SystemRenderer":36,"./filters/FXAAFilter":44,"./managers/BlendModeManager":46,"./managers/FilterManager":47,"./managers/MaskManager":48,"./managers/ShaderManager":49,"./managers/StencilManager":50,"./utils/ObjectRenderer":56,"./utils/RenderTarget":58}],43:[function(b,c,f){function a(a,b,c){this.shaders=[];this.padding=0;this.uniforms=c||{};this.vertexSrc=a||g.defaultVertexSrc;this.fragmentSrc=b||g.defaultFragmentSrc}var g=b("../shaders/TextureShader");a.prototype.constructor=a;c.exports=a;a.prototype.getShader=
function(a){var b=a.gl,c=this.shaders[b.id];c||(c=new g(a.shaderManager,this.vertexSrc,this.fragmentSrc,this.uniforms,this.attributes),this.shaders[b.id]=c);return c};a.prototype.applyFilter=function(a,b,c,d){var g=this.getShader(a);a.filterManager.applyFilter(g,b,c,d)};a.prototype.syncUniform=function(a){for(var b=0,c=this.shaders.length;b<c;++b)this.shaders[b].syncUniform(a)}},{"../shaders/TextureShader":55}],44:[function(b,c,f){function a(){g.call(this,"\nprecision mediump float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform vec2 resolution;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\n            out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n   vResolution = resolution;\n\n   //compute the texture coords and send them to varyings\n   texcoords(aTextureCoord * resolution, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",
'precision lowp float;\n\n\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it\'s\nunsupported by WebGL.\n\n--\n\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\n\nCopyright (c) 2011 by Armin Ronacher.\n\nSome rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE,\n            vec2 v_rgbSW, vec2 v_rgbSE,\n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform sampler2D uSampler;\n\n\nvoid main(void){\n\n    gl_FragColor = fxaa(uSampler, vTextureCoord * vResolution, vResolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n}\n',
{resolution:{type:"v2",value:{x:1,y:1}}})}var g=b("./AbstractFilter");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.applyFilter=function(a,b,c){var d=a.filterManager;a=this.getShader(a);d.applyFilter(a,b,c)}},{"./AbstractFilter":43}],45:[function(b,c,f){function a(a){var b=new e.Matrix;g.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n",
"precision lowp float;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform sampler2D mask;\n\nvoid main(void)\n{\n    // check clip! this will stop the mask bleeding out from the edges\n    vec2 text = abs( vMaskCoord - 0.5 );\n    text = step(0.5, text);\n    float clip = 1.0 - max(text.y, text.x);\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    original *= (masky.r * masky.a * alpha * clip);\n    gl_FragColor = original;\n}\n",
{mask:{type:"sampler2D",value:a._texture},alpha:{type:"f",value:1},otherMatrix:{type:"mat3",value:b.toArray(!0)}});this.maskSprite=a;this.maskMatrix=b}var g=b("./AbstractFilter"),e=b("../../../math");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.applyFilter=function(a,b,c){var e=a.filterManager;this.uniforms.mask.value=this.maskSprite._texture;e.calculateMappedMatrix(b.frame,this.maskSprite,this.maskMatrix);this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0);
this.uniforms.alpha.value=this.maskSprite.worldAlpha;a=this.getShader(a);e.applyFilter(a,b,c)};Object.defineProperties(a.prototype,{map:{get:function(){return this.uniforms.mask.value},set:function(a){this.uniforms.mask.value=a}},offset:{get:function(){return this.uniforms.offset.value},set:function(a){this.uniforms.offset.value=a}}})},{"../../../math":26,"./AbstractFilter":43}],46:[function(b,c,f){function a(a){g.call(this,a);this.currentBlendMode=99999}var g=b("./WebGLManager");a.prototype=Object.create(g.prototype);
a.prototype.constructor=a;c.exports=a;a.prototype.setBlendMode=function(a){if(this.currentBlendMode===a)return!1;this.currentBlendMode=a;a=this.renderer.blendModes[this.currentBlendMode];this.renderer.gl.blendFunc(a[0],a[1]);return!0}},{"./WebGLManager":51}],47:[function(b,c,f){function a(a){g.call(this,a);this.filterStack=[];this.filterStack.push({renderTarget:a.currentRenderTarget,filter:[],bounds:null});this.texturePool=[];this.textureSize=new m.Rectangle(0,0,a.width,a.height);this.currentFrame=
null}var g=b("./WebGLManager"),e=b("../utils/RenderTarget"),k=b("../../../const"),h=b("../utils/Quad"),m=b("../../../math");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.onContextChange=function(){this.texturePool.length=0;this.quad=new h(this.renderer.gl)};a.prototype.setFilterStack=function(a){this.filterStack=a};a.prototype.pushFilter=function(a,b){var c=a.filterArea?a.filterArea.clone():a.getBounds();c.x|=0;c.y|=0;c.width|=0;c.height|=0;var h=b[0].padding|
0;c.x-=h;c.y-=h;c.width+=2*h;c.height+=2*h;this.renderer.currentRenderTarget.transform?(h=this.renderer.currentRenderTarget.transform,c.x+=h.tx,c.y+=h.ty,this.capFilterArea(c),c.x-=h.tx,c.y-=h.ty):this.capFilterArea(c);0<c.width&&0<c.height?(this.currentFrame=c,c=this.getRenderTarget(),this.renderer.setRenderTarget(c),c.clear(),this.filterStack.push({renderTarget:c,filter:b})):this.filterStack.push({renderTarget:null,filter:b})};a.prototype.popFilter=function(){var a=this.filterStack.pop(),b=this.filterStack[this.filterStack.length-
1],c=a.renderTarget;if(a.renderTarget){var b=b.renderTarget,h=this.renderer.gl;this.currentFrame=c.frame;this.quad.map(this.textureSize,c.frame);h.bindBuffer(h.ARRAY_BUFFER,this.quad.vertexBuffer);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.quad.indexBuffer);var e=a.filter;h.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aVertexPosition,2,h.FLOAT,!1,0,0);h.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aTextureCoord,2,h.FLOAT,!1,0,32);h.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aColor,
4,h.FLOAT,!1,0,64);this.renderer.blendModeManager.setBlendMode(k.BLEND_MODES.NORMAL);if(1===e.length)e[0].uniforms.dimensions&&(e[0].uniforms.dimensions.value[0]=this.renderer.width,e[0].uniforms.dimensions.value[1]=this.renderer.height,e[0].uniforms.dimensions.value[2]=this.quad.vertices[0],e[0].uniforms.dimensions.value[3]=this.quad.vertices[5]),e[0].applyFilter(this.renderer,c,b),this.returnRenderTarget(c);else{for(var h=this.getRenderTarget(!0),d=0;d<e.length-1;d++){var m=e[d];m.uniforms.dimensions&&
(m.uniforms.dimensions.value[0]=this.renderer.width,m.uniforms.dimensions.value[1]=this.renderer.height,m.uniforms.dimensions.value[2]=this.quad.vertices[0],m.uniforms.dimensions.value[3]=this.quad.vertices[5]);m.applyFilter(this.renderer,c,h);m=c;c=h;h=m}e[e.length-1].applyFilter(this.renderer,c,b);this.returnRenderTarget(c);this.returnRenderTarget(h)}return a.filter}};a.prototype.getRenderTarget=function(a){var b=this.texturePool.pop()||new e(this.renderer.gl,this.textureSize.width,this.textureSize.height,
k.SCALE_MODES.LINEAR,this.renderer.resolution*k.FILTER_RESOLUTION);b.frame=this.currentFrame;a&&b.clear(!0);return b};a.prototype.returnRenderTarget=function(a){this.texturePool.push(a)};a.prototype.applyFilter=function(a,b,c,h){var e=this.renderer.gl;this.renderer.setRenderTarget(c);h&&c.clear();this.renderer.shaderManager.setShader(a);a.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0);a.syncUniforms();e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,
b.texture);e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0);this.renderer.drawCount++};a.prototype.calculateMappedMatrix=function(a,b,c){var h=b.worldTransform.copy(m.Matrix.TEMP_MATRIX),e=b._texture.baseTexture;c=c.identity();var d=this.textureSize.height/this.textureSize.width;c.translate(a.x/this.textureSize.width,a.y/this.textureSize.height);c.scale(1,d);a=this.textureSize.width/e.width;var k=this.textureSize.height/e.height;h.tx/=e.width*a;h.ty/=e.width*a;h.invert();c.prepend(h);c.scale(1,1/
d);c.scale(a,k);c.translate(b.anchor.x,b.anchor.y);return c};a.prototype.capFilterArea=function(a){0>a.x&&(a.width+=a.x,a.x=0);0>a.y&&(a.height+=a.y,a.y=0);a.x+a.width>this.textureSize.width&&(a.width=this.textureSize.width-a.x);a.y+a.height>this.textureSize.height&&(a.height=this.textureSize.height-a.y)};a.prototype.resize=function(a,b){this.textureSize.width=a;this.textureSize.height=b;for(var c=0;c<this.texturePool.length;c++)this.texturePool[c].resize(a,b)};a.prototype.destroy=function(){this.quad.destroy();
g.prototype.destroy.call(this);this.filterStack=null;for(var a=this.offsetY=0;a<this.texturePool.length;a++)this.texturePool[a].destroy();this.texturePool=null}},{"../../../const":16,"../../../math":26,"../utils/Quad":57,"../utils/RenderTarget":58,"./WebGLManager":51}],48:[function(b,c,f){function a(a){g.call(this,a);this.stencilStack=[];this.reverse=!0;this.count=0;this.alphaMaskPool=[]}var g=b("./WebGLManager"),e=b("../filters/SpriteMaskFilter");a.prototype=Object.create(g.prototype);a.prototype.constructor=
a;c.exports=a;a.prototype.pushMask=function(a,b){b.texture?this.pushSpriteMask(a,b):this.pushStencilMask(a,b)};a.prototype.popMask=function(a,b){b.texture?this.popSpriteMask(a,b):this.popStencilMask(a,b)};a.prototype.pushSpriteMask=function(a,b){var c=this.alphaMaskPool.pop();c||(c=[new e(b)]);c[0].maskSprite=b;this.renderer.filterManager.pushFilter(a,c)};a.prototype.popSpriteMask=function(){var a=this.renderer.filterManager.popFilter();this.alphaMaskPool.push(a)};a.prototype.pushStencilMask=function(a,
b){this.renderer.stencilManager.pushMask(b)};a.prototype.popStencilMask=function(a,b){this.renderer.stencilManager.popMask(b)}},{"../filters/SpriteMaskFilter":45,"./WebGLManager":51}],49:[function(b,c,f){function a(a){g.call(this,a);this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(a=0;a<this.maxAttibs;a++)this.attribState[a]=!1;this.stack=[];this._currentId=-1;this.currentShader=null}var g=b("./WebGLManager"),e=b("../shaders/TextureShader"),k=b("../shaders/ComplexPrimitiveShader"),
h=b("../shaders/PrimitiveShader");b=b("../../../utils");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;b.pluginTarget.mixin(a);c.exports=a;a.prototype.onContextChange=function(){this.initPlugins();var a=this.renderer.gl;this.maxAttibs=a.getParameter(a.MAX_VERTEX_ATTRIBS);this.attribState=[];for(a=0;a<this.maxAttibs;a++)this.attribState[a]=!1;this.defaultShader=new e(this);this.primitiveShader=new h(this);this.complexPrimitiveShader=new k(this)};a.prototype.setAttribs=function(a){var b;
for(b=0;b<this.tempAttribState.length;b++)this.tempAttribState[b]=!1;for(var c in a)this.tempAttribState[a[c]]=!0;a=this.renderer.gl;for(b=0;b<this.attribState.length;b++)this.attribState[b]!==this.tempAttribState[b]&&(this.attribState[b]=this.tempAttribState[b],this.attribState[b]?a.enableVertexAttribArray(b):a.disableVertexAttribArray(b))};a.prototype.setShader=function(a){if(this._currentId===a.uid)return!1;this._currentId=a.uid;this.currentShader=a;this.renderer.gl.useProgram(a.program);this.setAttribs(a.attributes);
return!0};a.prototype.destroy=function(){this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();g.prototype.destroy.call(this);this.destroyPlugins();this.tempAttribState=this.attribState=null}},{"../../../utils":70,"../shaders/ComplexPrimitiveShader":52,"../shaders/PrimitiveShader":53,"../shaders/TextureShader":55,"./WebGLManager":51}],50:[function(b,c,f){function a(a){g.call(this,a);this.stencilMaskStack=null}var g=b("./WebGLManager"),e=b("../../../utils");a.prototype=Object.create(g.prototype);
a.prototype.constructor=a;c.exports=a;a.prototype.setMaskStack=function(a){this.stencilMaskStack=a;var b=this.renderer.gl;0===a.stencilStack.length?b.disable(b.STENCIL_TEST):b.enable(b.STENCIL_TEST)};a.prototype.pushStencil=function(a,b){this.renderer.currentRenderTarget.attachStencilBuffer();var c=this.renderer.gl,e=this.stencilMaskStack;this.bindGraphics(a,b);0===e.stencilStack.length&&(c.enable(c.STENCIL_TEST),c.clear(c.STENCIL_BUFFER_BIT),e.reverse=!0,e.count=0);e.stencilStack.push(b);var d=e.count;
c.colorMask(!1,!1,!1,!1);c.stencilFunc(c.ALWAYS,0,255);c.stencilOp(c.KEEP,c.KEEP,c.INVERT);1===b.mode?(c.drawElements(c.TRIANGLE_FAN,b.indices.length-4,c.UNSIGNED_SHORT,0),e.reverse?(c.stencilFunc(c.EQUAL,255-d,255),c.stencilOp(c.KEEP,c.KEEP,c.DECR)):(c.stencilFunc(c.EQUAL,d,255),c.stencilOp(c.KEEP,c.KEEP,c.INCR)),c.drawElements(c.TRIANGLE_FAN,4,c.UNSIGNED_SHORT,2*(b.indices.length-4)),e.reverse?c.stencilFunc(c.EQUAL,255-(d+1),255):c.stencilFunc(c.EQUAL,d+1,255),e.reverse=!e.reverse):(e.reverse?(c.stencilFunc(c.EQUAL,
d,255),c.stencilOp(c.KEEP,c.KEEP,c.INCR)):(c.stencilFunc(c.EQUAL,255-d,255),c.stencilOp(c.KEEP,c.KEEP,c.DECR)),c.drawElements(c.TRIANGLE_STRIP,b.indices.length,c.UNSIGNED_SHORT,0),e.reverse?c.stencilFunc(c.EQUAL,d+1,255):c.stencilFunc(c.EQUAL,255-(d+1),255));c.colorMask(!0,!0,!0,!0);c.stencilOp(c.KEEP,c.KEEP,c.KEEP);e.count++};a.prototype.bindGraphics=function(a,b){var c=this.renderer.gl,d;1===b.mode?(d=this.renderer.shaderManager.complexPrimitiveShader,this.renderer.shaderManager.setShader(d),c.uniformMatrix3fv(d.uniforms.translationMatrix._location,
!1,a.worldTransform.toArray(!0)),c.uniformMatrix3fv(d.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),c.uniform3fv(d.uniforms.tint._location,e.hex2rgb(a.tint)),c.uniform3fv(d.uniforms.color._location,b.color),c.uniform1f(d.uniforms.alpha._location,a.worldAlpha),c.bindBuffer(c.ARRAY_BUFFER,b.buffer),c.vertexAttribPointer(d.attributes.aVertexPosition,2,c.FLOAT,!1,8,0)):(d=this.renderer.shaderManager.primitiveShader,this.renderer.shaderManager.setShader(d),
c.uniformMatrix3fv(d.uniforms.translationMatrix._location,!1,a.worldTransform.toArray(!0)),c.uniformMatrix3fv(d.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),c.uniform3fv(d.uniforms.tint._location,e.hex2rgb(a.tint)),c.uniform1f(d.uniforms.alpha._location,a.worldAlpha),c.bindBuffer(c.ARRAY_BUFFER,b.buffer),c.vertexAttribPointer(d.attributes.aVertexPosition,2,c.FLOAT,!1,24,0),c.vertexAttribPointer(d.attributes.aColor,4,c.FLOAT,!1,24,8));c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
b.indexBuffer)};a.prototype.popStencil=function(a,b){var c=this.renderer.gl,e=this.stencilMaskStack;e.stencilStack.pop();e.count--;if(0===e.stencilStack.length)c.disable(c.STENCIL_TEST);else{var d=e.count;this.bindGraphics(a,b);c.colorMask(!1,!1,!1,!1);1===b.mode?(e.reverse=!e.reverse,e.reverse?(c.stencilFunc(c.EQUAL,255-(d+1),255),c.stencilOp(c.KEEP,c.KEEP,c.INCR)):(c.stencilFunc(c.EQUAL,d+1,255),c.stencilOp(c.KEEP,c.KEEP,c.DECR)),c.drawElements(c.TRIANGLE_FAN,4,c.UNSIGNED_SHORT,2*(b.indices.length-
4)),c.stencilFunc(c.ALWAYS,0,255),c.stencilOp(c.KEEP,c.KEEP,c.INVERT),c.drawElements(c.TRIANGLE_FAN,b.indices.length-4,c.UNSIGNED_SHORT,0),this.renderer.drawCount+=2):(e.reverse?(c.stencilFunc(c.EQUAL,d+1,255),c.stencilOp(c.KEEP,c.KEEP,c.DECR)):(c.stencilFunc(c.EQUAL,255-(d+1),255),c.stencilOp(c.KEEP,c.KEEP,c.INCR)),c.drawElements(c.TRIANGLE_STRIP,b.indices.length,c.UNSIGNED_SHORT,0),this.renderer.drawCount++);e.reverse?c.stencilFunc(c.EQUAL,d,255):c.stencilFunc(c.EQUAL,255-d,255);c.colorMask(!0,
!0,!0,!0);c.stencilOp(c.KEEP,c.KEEP,c.KEEP)}};a.prototype.destroy=function(){g.prototype.destroy.call(this);this.stencilMaskStack.stencilStack=null};a.prototype.pushMask=function(a){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);a.dirty&&this.renderer.plugins.graphics.updateGraphics(a,this.renderer.gl);a._webGL[this.renderer.gl.id].data.length&&this.pushStencil(a,a._webGL[this.renderer.gl.id].data[0])};a.prototype.popMask=function(a){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);
this.popStencil(a,a._webGL[this.renderer.gl.id].data[0])}},{"../../../utils":70,"./WebGLManager":51}],51:[function(b,c,f){function a(a){this.renderer=a;this.renderer.on("context",this.onContextChange,this)}a.prototype.constructor=a;c.exports=a;a.prototype.onContextChange=function(){};a.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this);this.renderer=null}},{}],52:[function(b,c,f){function a(a){g.call(this,a,"attribute vec2 aVertexPosition;\nuniform mat3 translationMatrix;\nuniform mat3 projectionMatrix;\nuniform vec3 tint;\nuniform float alpha;\nuniform vec3 color;\nvarying vec4 vColor;\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vColor = vec4(color * alpha * tint, alpha);\n}",
"precision mediump float;\nvarying vec4 vColor;\nvoid main(void){\n   gl_FragColor = vColor;\n}",{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},color:{type:"3f",value:[0,0,0]},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0})}var g=b("./Shader");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a},{"./Shader":54}],53:[function(b,c,f){function a(a){g.call(this,a,"attribute vec2 aVertexPosition;\nattribute vec4 aColor;\nuniform mat3 translationMatrix;\nuniform mat3 projectionMatrix;\nuniform float alpha;\nuniform float flipY;\nuniform vec3 tint;\nvarying vec4 vColor;\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vColor = aColor * vec4(tint * alpha, alpha);\n}",
"precision mediump float;\nvarying vec4 vColor;\nvoid main(void){\n   gl_FragColor = vColor;\n}",{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aColor:0})}var g=b("./Shader");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a},{"./Shader":54}],54:[function(b,c,f){function a(a,b,c,d,f){if(!b||!c)throw Error("Pixi.js Error. Shader requires vertexSrc and fragmentSrc");
this.uid=g.uid();this.gl=a.renderer.gl;this.shaderManager=a;this.program=null;this.uniforms=d||{};this.attributes=f||{};this.textureCount=1;this.vertexSrc=b;this.fragmentSrc=c;this.init()}var g=b("../../../utils");a.prototype.constructor=a;c.exports=a;a.prototype.init=function(){this.compile();this.gl.useProgram(this.program);this.cacheUniformLocations(Object.keys(this.uniforms));this.cacheAttributeLocations(Object.keys(this.attributes))};a.prototype.cacheUniformLocations=function(a){for(var b=0;b<
a.length;++b)this.uniforms[a[b]]._location=this.gl.getUniformLocation(this.program,a[b])};a.prototype.cacheAttributeLocations=function(a){for(var b=0;b<a.length;++b)this.attributes[a[b]]=this.gl.getAttribLocation(this.program,a[b])};a.prototype.compile=function(){var a=this.gl,b=this._glCompile(a.VERTEX_SHADER,this.vertexSrc),c=this._glCompile(a.FRAGMENT_SHADER,this.fragmentSrc),d=a.createProgram();a.attachShader(d,b);a.attachShader(d,c);a.linkProgram(d);a.getProgramParameter(d,a.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),
console.error("gl.VALIDATE_STATUS",a.getProgramParameter(d,a.VALIDATE_STATUS)),console.error("gl.getError()",a.getError()),""!==a.getProgramInfoLog(d)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",a.getProgramInfoLog(d)),a.deleteProgram(d),d=null);a.deleteShader(b);a.deleteShader(c);return this.program=d};a.prototype.syncUniform=function(a){var b=a._location,c=a.value,d=this.gl,f,q;switch(a.type){case "b":case "bool":case "boolean":d.uniform1i(b,c?1:0);break;case "i":case "1i":d.uniform1i(b,
c);break;case "f":case "1f":d.uniform1f(b,c);break;case "2f":d.uniform2f(b,c[0],c[1]);break;case "3f":d.uniform3f(b,c[0],c[1],c[2]);break;case "4f":d.uniform4f(b,c[0],c[1],c[2],c[3]);break;case "v2":d.uniform2f(b,c.x,c.y);break;case "v3":d.uniform3f(b,c.x,c.y,c.z);break;case "v4":d.uniform4f(b,c.x,c.y,c.z,c.w);break;case "1iv":d.uniform1iv(b,c);break;case "2iv":d.uniform2iv(b,c);break;case "3iv":d.uniform3iv(b,c);break;case "4iv":d.uniform4iv(b,c);break;case "1fv":d.uniform1fv(b,c);break;case "2fv":d.uniform2fv(b,
c);break;case "3fv":d.uniform3fv(b,c);break;case "4fv":d.uniform4fv(b,c);break;case "m2":case "mat2":case "Matrix2fv":d.uniformMatrix2fv(b,a.transpose,c);break;case "m3":case "mat3":case "Matrix3fv":d.uniformMatrix3fv(b,a.transpose,c);break;case "m4":case "mat4":case "Matrix4fv":d.uniformMatrix4fv(b,a.transpose,c);break;case "c":"number"===typeof c&&(c=g.hex2rgb(c));d.uniform3f(b,c[0],c[1],c[2]);break;case "iv1":d.uniform1iv(b,c);break;case "iv":d.uniform3iv(b,c);break;case "fv1":d.uniform1fv(b,c);
break;case "fv":d.uniform3fv(b,c);break;case "v2v":a._array||(a._array=new Float32Array(2*c.length));f=0;for(q=c.length;f<q;++f)a._array[2*f]=c[f].x,a._array[2*f+1]=c[f].y;d.uniform2fv(b,a._array);break;case "v3v":a._array||(a._array=new Float32Array(3*c.length));f=0;for(q=c.length;f<q;++f)a._array[3*f]=c[f].x,a._array[3*f+1]=c[f].y,a._array[3*f+2]=c[f].z;d.uniform3fv(b,a._array);break;case "v4v":a._array||(a._array=new Float32Array(4*c.length));f=0;for(q=c.length;f<q;++f)a._array[4*f]=c[f].x,a._array[4*
f+1]=c[f].y,a._array[4*f+2]=c[f].z,a._array[4*f+3]=c[f].w;d.uniform4fv(b,a._array);break;case "t":case "sampler2D":if(!a.value||!a.value.baseTexture.hasLoaded)break;d.activeTexture(d["TEXTURE"+this.textureCount]);b=a.value.baseTexture._glTextures[d.id];b||(this.initSampler2D(a),b=a.value.baseTexture._glTextures[d.id]);d.bindTexture(d.TEXTURE_2D,b);d.uniform1i(a._location,this.textureCount);this.textureCount++;break;default:console.warn("Pixi.js Shader Warning: Unknown uniform type: "+a.type)}};a.prototype.syncUniforms=
function(){this.textureCount=1;for(var a in this.uniforms)this.syncUniform(this.uniforms[a])};a.prototype.initSampler2D=function(a){var b=this.gl,c=a.value.baseTexture;c.hasLoaded&&(a.textureData?(a=a.textureData,c._glTextures[b.id]=b.createTexture(),b.bindTexture(b.TEXTURE_2D,c._glTextures[b.id]),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.premultipliedAlpha),b.texImage2D(b.TEXTURE_2D,0,a.luminance?b.LUMINANCE:b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c.source),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,
a.magFilter?a.magFilter:b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.wrapS?a.wrapS:b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,a.wrapS?a.wrapS:b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,a.wrapT?a.wrapT:b.CLAMP_TO_EDGE)):this.shaderManager.renderer.updateTexture(c))};a.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.fragmentSrc=this.vertexSrc=this.attributes=this.uniforms=this.gl=null};a.prototype._glCompile=function(a,b){var c=
this.gl.createShader(a);this.gl.shaderSource(c,b);this.gl.compileShader(c);return this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)?c:(console.log(this.gl.getShaderInfoLog(c)),null)}},{"../../../utils":70}],55:[function(b,c,f){function a(b,c,h,d,f){var q={uSampler:{type:"sampler2D",value:0},projectionMatrix:{type:"mat3",value:new Float32Array([1,0,0,0,1,0,0,0,1])}};if(d)for(var w in d)q[w]=d[w];d={aVertexPosition:0,aTextureCoord:0,aColor:0};if(f)for(var p in f)d[p]=f[p];c=c||a.defaultVertexSrc;
h=h||a.defaultFragmentSrc;g.call(this,b,c,h,q,d)}var g=b("./Shader");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.defaultVertexSrc="precision lowp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}";
a.defaultFragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;\n}"},{"./Shader":54}],56:[function(b,c,f){function a(a){g.call(this,a)}var g=b("../managers/WebGLManager");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.start=function(){};a.prototype.stop=function(){this.flush()};a.prototype.flush=function(){};a.prototype.render=
function(a){}},{"../managers/WebGLManager":51}],57:[function(b,c,f){function a(a){this.gl=a;this.vertices=new Float32Array([0,0,200,0,200,200,0,200]);this.uvs=new Float32Array([0,0,1,0,1,1,0,1]);this.colors=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);this.indices=new Uint16Array([0,1,2,0,3,2]);this.vertexBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,128,a.DYNAMIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,
this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);this.upload()}a.prototype.constructor=a;a.prototype.map=function(a,b){var c=0,h=0;this.uvs[0]=c;this.uvs[1]=h;this.uvs[2]=c+b.width/a.width;this.uvs[3]=h;this.uvs[4]=c+b.width/a.width;this.uvs[5]=h+b.height/a.height;this.uvs[6]=c;this.uvs[7]=h+b.height/a.height;c=b.x;h=b.y;this.vertices[0]=c;this.vertices[1]=h;this.vertices[2]=c+b.width;this.vertices[3]=h;this.vertices[4]=c+b.width;this.vertices[5]=h+b.height;this.vertices[6]=
c;this.vertices[7]=h+b.height;this.upload()};a.prototype.upload=function(){var a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);a.bufferSubData(a.ARRAY_BUFFER,32,this.uvs);a.bufferSubData(a.ARRAY_BUFFER,64,this.colors)};a.prototype.destroy=function(){var a=this.gl;a.deleteBuffer(this.vertexBuffer);a.deleteBuffer(this.indexBuffer)};c.exports=a},{}],58:[function(b,c,f){var a=b("../../../math"),g=b("../../../utils"),e=b("../../../const"),k=b("./StencilMaskStack");
b=function(b,c,d,f,w,p){this.gl=b;this.texture=this.frameBuffer=null;this.size=new a.Rectangle(0,0,1,1);this.resolution=w||e.RESOLUTION;this.projectionMatrix=new a.Matrix;this.stencilBuffer=this.frame=this.transform=null;this.stencilMaskStack=new k;this.filterStack=[{renderTarget:this,filter:[],bounds:this.size}];this.scaleMode=f||e.SCALE_MODES.DEFAULT;this.root=p;this.root||(this.frameBuffer=b.createFramebuffer(),this.texture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,this.texture),b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_MAG_FILTER,f===e.SCALE_MODES.LINEAR?b.LINEAR:b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f===e.SCALE_MODES.LINEAR?b.LINEAR:b.NEAREST),g.isPowerOfTwo(c,d)?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)),b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer),b.framebufferTexture2D(b.FRAMEBUFFER,
b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.texture,0));this.resize(c,d)};b.prototype.constructor=b;c.exports=b;b.prototype.clear=function(a){var b=this.gl;a&&b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT)};b.prototype.attachStencilBuffer=function(){if(!this.stencilBuffer&&!this.root){var a=this.gl;this.stencilBuffer=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this.stencilBuffer);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,
a.RENDERBUFFER,this.stencilBuffer);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,this.size.width*this.resolution,this.size.height*this.resolution)}};b.prototype.activate=function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer);var b=this.frame||this.size;this.calculateProjection(b);this.transform&&this.projectionMatrix.append(this.transform);a.viewport(0,0,b.width*this.resolution,b.height*this.resolution)};b.prototype.calculateProjection=function(a){var b=this.projectionMatrix;
b.identity();this.root?(b.a=1/a.width*2,b.d=-1/a.height*2,b.tx=-1-a.x*b.a,b.ty=1-a.y*b.d):(b.a=1/a.width*2,b.d=1/a.height*2,b.tx=-1-a.x*b.a,b.ty=-1-a.y*b.d)};b.prototype.resize=function(a,b){a|=0;b|=0;if(this.size.width!==a||this.size.height!==b){this.size.width=a;this.size.height=b;if(!this.root){var c=this.gl;c.bindTexture(c.TEXTURE_2D,this.texture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a*this.resolution,b*this.resolution,0,c.RGBA,c.UNSIGNED_BYTE,null);this.stencilBuffer&&(c.bindRenderbuffer(c.RENDERBUFFER,
this.stencilBuffer),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,a*this.resolution,b*this.resolution))}this.calculateProjection(this.frame||this.size)}};b.prototype.destroy=function(){var a=this.gl;a.deleteRenderbuffer(this.stencilBuffer);a.deleteFramebuffer(this.frameBuffer);a.deleteTexture(this.texture);this.texture=this.frameBuffer=null}},{"../../../const":16,"../../../math":26,"../../../utils":70,"./StencilMaskStack":59}],59:[function(b,c,f){function a(){this.stencilStack=[];this.reverse=
!0;this.count=0}a.prototype.constructor=a;c.exports=a},{}],60:[function(b,c,f){function a(a){k.call(this);this.anchor=new g.Point;this._texture=null;this._height=this._width=0;this.tint=16777215;this.blendMode=n.BLEND_MODES.NORMAL;this.shader=null;this.cachedTint=16777215;this.texture=a||e.EMPTY}var g=b("../math"),e=b("../textures/Texture"),k=b("../display/Container"),h=b("../renderers/canvas/utils/CanvasTinter"),m=b("../utils"),n=b("../const"),q=new g.Point;a.prototype=Object.create(k.prototype);
a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{width:{get:function(){return Math.abs(this.scale.x)*this.texture._frame.width},set:function(a){var b=m.sign(this.scale.x)||1;this.scale.x=b*a/this.texture._frame.width;this._width=a}},height:{get:function(){return Math.abs(this.scale.y)*this.texture._frame.height},set:function(a){var b=m.sign(this.scale.y)||1;this.scale.y=b*a/this.texture._frame.height;this._height=a}},texture:{get:function(){return this._texture},set:function(a){if(this._texture!==
a&&(this._texture=a,this.cachedTint=16777215,a))if(a.baseTexture.hasLoaded)this._onTextureUpdate();else a.once("update",this._onTextureUpdate,this)}}});a.prototype._onTextureUpdate=function(){this._width&&(this.scale.x=m.sign(this.scale.x)*this._width/this.texture.frame.width);this._height&&(this.scale.y=m.sign(this.scale.y)*this._height/this.texture.frame.height)};a.prototype._renderWebGL=function(a){a.setObjectRenderer(a.plugins.sprite);a.plugins.sprite.render(this)};a.prototype.getBounds=function(a){if(!this._currentBounds){var b=
this._texture._frame.width,c=this._texture._frame.height,h=b*(1-this.anchor.x),b=b*-this.anchor.x,d=c*(1-this.anchor.y),e=c*-this.anchor.y;a=a||this.worldTransform;var k=a.a,g=a.b,f=a.c,m=a.d,n=a.tx,q=a.ty,M;M=k*b+f*e+n;a=m*e+g*b+q;var c=k*h+f*e+n,e=m*e+g*h+q,N=k*h+f*d+n,h=m*d+g*h+q,k=k*b+f*d+n,b=m*d+g*b+q,g=M,g=c<g?c:g,g=N<g?N:g,g=k<g?k:g,m=a,m=e<m?e:m,m=h<m?h:m,m=b<m?b:m;M=c>M?c:M;M=N>M?N:M;M=k>M?k:M;a=e>a?e:a;a=h>a?h:a;a=b>a?b:a;this.children.length&&(c=this.containerGetBounds(),h=c.x,b=c.x+c.width,
d=c.y,e=c.y+c.height,g=g<h?g:h,m=m<d?m:d,M=M>b?M:b,a=a>e?a:e);b=this._bounds;b.x=g;b.width=M-g;b.y=m;b.height=a-m;this._currentBounds=b}return this._currentBounds};a.prototype.getLocalBounds=function(){this._bounds.x=-this._texture._frame.width*this.anchor.x;this._bounds.y=-this._texture._frame.height*this.anchor.y;this._bounds.width=this._texture._frame.width;this._bounds.height=this._texture._frame.height;return this._bounds};a.prototype.containsPoint=function(a){this.worldTransform.applyInverse(a,
q);var b=this._texture._frame.width;a=this._texture._frame.height;var c=-b*this.anchor.x;return q.x>c&&q.x<c+b&&(b=-a*this.anchor.y,q.y>b&&q.y<b+a)?!0:!1};a.prototype._renderCanvas=function(a){if(!(0>=this.texture.crop.width||0>=this.texture.crop.height)){var b=a.blendModes[this.blendMode];b!==a.context.globalCompositeOperation&&(a.context.globalCompositeOperation=b);if(this.texture.valid){var b=this._texture,c=this.worldTransform,d,e,k,g;a.context.globalAlpha=this.worldAlpha;k=b.baseTexture.scaleMode===
n.SCALE_MODES.LINEAR;a.smoothProperty&&a.context[a.smoothProperty]!==k&&(a.context[a.smoothProperty]=k);b.rotate?(k=b.crop.height,g=b.crop.width,d=b.trim?b.trim.y-this.anchor.y*b.trim.height:this.anchor.y*-b._frame.height,e=b.trim?b.trim.x-this.anchor.x*b.trim.width:this.anchor.x*-b._frame.width,d+=k,c.tx=e*c.a+d*c.c+c.tx,c.ty=e*c.b+d*c.d+c.ty,d=c.a,c.a=-c.c,c.c=d,d=c.b,c.b=-c.d,c.d=d,e=d=0):(k=b.crop.width,g=b.crop.height,d=b.trim?b.trim.x-this.anchor.x*b.trim.width:this.anchor.x*-b._frame.width,
e=b.trim?b.trim.y-this.anchor.y*b.trim.height:this.anchor.y*-b._frame.height);a.roundPixels?(a.context.setTransform(c.a,c.b,c.c,c.d,c.tx*a.resolution|0,c.ty*a.resolution|0),d|=0,e|=0):a.context.setTransform(c.a,c.b,c.c,c.d,c.tx*a.resolution,c.ty*a.resolution);c=b.baseTexture.resolution;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=h.getTintedTexture(this,this.tint)),a.context.drawImage(this.tintedTexture,0,0,k*c,g*c,d*a.resolution,e*a.resolution,
k*a.resolution,g*a.resolution)):a.context.drawImage(b.baseTexture.source,b.crop.x*c,b.crop.y*c,k*c,g*c,d*a.resolution,e*a.resolution,k*a.resolution,g*a.resolution)}}};a.prototype.destroy=function(a,b){k.prototype.destroy.call(this);this.anchor=null;a&&this._texture.destroy(b);this.shader=this._texture=null};a.fromFrame=function(b){var c=m.TextureCache[b];if(!c)throw Error('The frameId "'+b+'" does not exist in the texture cache');return new a(c)};a.fromImage=function(b,c,h){return new a(e.fromImage(b,
c,h))}},{"../const":16,"../display/Container":17,"../math":26,"../renderers/canvas/utils/CanvasTinter":41,"../textures/Texture":65,"../utils":70}],61:[function(b,c,f){function a(a){g.call(this,a);this.vertSize=5;this.vertByteSize=4*this.vertSize;this.size=e.SPRITE_BATCH_SIZE;a=6*this.size;this.vertices=new ArrayBuffer(4*this.size*this.vertByteSize);this.positions=new Float32Array(this.vertices);this.colors=new Uint32Array(this.vertices);this.indices=new Uint16Array(a);for(var b=0,c=0;b<a;b+=6,c+=
4)this.indices[b+0]=c+0,this.indices[b+1]=c+1,this.indices[b+2]=c+2,this.indices[b+3]=c+0,this.indices[b+4]=c+2,this.indices[b+5]=c+3;this.currentBatchSize=0;this.sprites=[];this.shader=null}var g=b("../../renderers/webgl/utils/ObjectRenderer");f=b("../../renderers/webgl/WebGLRenderer");var e=b("../../const");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;f.registerPlugin("sprite",a);a.prototype.onContextChange=function(){var a=this.renderer.gl;this.shader=this.renderer.shaderManager.defaultShader;
this.vertexBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW);this.currentBlendMode=99999};a.prototype.render=function(a){var b=a._texture;this.currentBatchSize>=this.size&&this.flush();var c=b._uvs;if(c){var d=a.anchor.x,e=a.anchor.y,g,f;b.trim&&void 0===a.tileScale?(f=
b.trim,d=f.x-d*f.width,g=d+b.crop.width,e=f.y-e*f.height,f=e+b.crop.height):(g=b._frame.width*(1-d),d=b._frame.width*-d,f=b._frame.height*(1-e),e=b._frame.height*-e);var b=this.currentBatchSize*this.vertByteSize,v=a.worldTransform,r=v.a,u=v.b,t=v.c,D=v.d,G=v.tx,A=v.ty,v=this.colors,z=this.positions;if(this.renderer.roundPixels){var C=this.renderer.resolution;z[b]=((r*d+t*e+G)*C|0)/C;z[b+1]=((D*e+u*d+A)*C|0)/C;z[b+5]=((r*g+t*e+G)*C|0)/C;z[b+6]=((D*e+u*g+A)*C|0)/C;z[b+10]=((r*g+t*f+G)*C|0)/C;z[b+11]=
((D*f+u*g+A)*C|0)/C;z[b+15]=((r*d+t*f+G)*C|0)/C;z[b+16]=((D*f+u*d+A)*C|0)/C}else z[b]=r*d+t*e+G,z[b+1]=D*e+u*d+A,z[b+5]=r*g+t*e+G,z[b+6]=D*e+u*g+A,z[b+10]=r*g+t*f+G,z[b+11]=D*f+u*g+A,z[b+15]=r*d+t*f+G,z[b+16]=D*f+u*d+A;z[b+2]=c.x0;z[b+3]=c.y0;z[b+7]=c.x1;z[b+8]=c.y1;z[b+12]=c.x2;z[b+13]=c.y2;z[b+17]=c.x3;z[b+18]=c.y3;c=a.tint;v[b+4]=v[b+9]=v[b+14]=v[b+19]=(c>>16)+(c&65280)+((c&255)<<16)+(255*a.worldAlpha<<24);this.sprites[this.currentBatchSize++]=a}};a.prototype.flush=function(){if(0!==this.currentBatchSize){var a=
this.renderer.gl,b;if(this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var c=this.positions.subarray(0,this.currentBatchSize*this.vertByteSize);a.bufferSubData(a.ARRAY_BUFFER,0,c)}for(var d,e,g=c=0,f=null,v=this.renderer.blendModeManager.currentBlendMode,r=null,u,t,D=0,G=this.currentBatchSize;D<G;D++){e=this.sprites[D];b=e._texture.baseTexture;d=e.blendMode;e=e.shader||this.shader;u=v!==d;t=r!==e;if(f!==b||u||t)this.renderBatch(f,c,g),g=D,c=0,f=b,u&&(v=d,this.renderer.blendModeManager.setBlendMode(v)),
t&&(r=e,(b=r.shaders?r.shaders[a.id]:r)||(b=r.getShader(this.renderer)),this.renderer.shaderManager.setShader(b),b.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0),b.syncUniforms(),a.activeTexture(a.TEXTURE0));c++}this.renderBatch(f,c,g);this.currentBatchSize=0}};a.prototype.renderBatch=function(a,b,c){if(0!==b){var d=this.renderer.gl;a._glTextures[d.id]?d.bindTexture(d.TEXTURE_2D,a._glTextures[d.id]):this.renderer.updateTexture(a);d.drawElements(d.TRIANGLES,
6*b,d.UNSIGNED_SHORT,12*c);this.renderer.drawCount++}};a.prototype.start=function(){var a=this.renderer.gl;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.vertByteSize;a.vertexAttribPointer(this.shader.attributes.aVertexPosition,2,a.FLOAT,!1,b,0);a.vertexAttribPointer(this.shader.attributes.aTextureCoord,2,a.FLOAT,!1,b,8);a.vertexAttribPointer(this.shader.attributes.aColor,4,a.UNSIGNED_BYTE,!0,b,16)};a.prototype.destroy=function(){this.renderer.gl.deleteBuffer(this.vertexBuffer);
this.renderer.gl.deleteBuffer(this.indexBuffer);g.prototype.destroy.call(this);this.shader.destroy();this.shader=this.sprites=this.indexBuffer=this.vertexBuffer=this.indices=this.colors=this.positions=this.vertices=this.renderer=null}},{"../../const":16,"../../renderers/webgl/WebGLRenderer":42,"../../renderers/webgl/utils/ObjectRenderer":56}],62:[function(b,c,f){function a(a,b,c){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=c||m.RESOLUTION;
this._style=this._text=null;c=e.fromCanvas(this.canvas);c.trim=new k.Rectangle;g.call(this,c);this.text=a;this.style=b}var g=b("../sprites/Sprite"),e=b("../textures/Texture"),k=b("../math"),h=b("../utils"),m=b("../const");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.fontPropertiesCache={};a.fontPropertiesCanvas=document.createElement("canvas");a.fontPropertiesContext=a.fontPropertiesCanvas.getContext("2d");Object.defineProperties(a.prototype,{width:{get:function(){this.dirty&&
this.updateText();return this.scale.x*this._texture._frame.width},set:function(a){this.scale.x=a/this._texture._frame.width;this._width=a}},height:{get:function(){this.dirty&&this.updateText();return this.scale.y*this._texture._frame.height},set:function(a){this.scale.y=a/this._texture._frame.height;this._height=a}},style:{get:function(){return this._style},set:function(a){a=a||{};"number"===typeof a.fill&&(a.fill=h.hex2string(a.fill));"number"===typeof a.stroke&&(a.stroke=h.hex2string(a.stroke));
"number"===typeof a.dropShadowColor&&(a.dropShadowColor=h.hex2string(a.dropShadowColor));a.font=a.font||"bold 20pt Arial";a.fill=a.fill||"black";a.align=a.align||"left";a.stroke=a.stroke||"black";a.strokeThickness=a.strokeThickness||0;a.wordWrap=a.wordWrap||!1;a.wordWrapWidth=a.wordWrapWidth||100;a.dropShadow=a.dropShadow||!1;a.dropShadowColor=a.dropShadowColor||"#000000";a.dropShadowAngle=void 0!==a.dropShadowAngle?a.dropShadowAngle:Math.PI/6;a.dropShadowDistance=void 0!==a.dropShadowDistance?a.dropShadowDistance:
5;a.dropShadowBlur=void 0!==a.dropShadowBlur?a.dropShadowBlur:0;a.padding=a.padding||0;a.textBaseline=a.textBaseline||"alphabetic";a.lineJoin=a.lineJoin||"miter";a.miterLimit=a.miterLimit||10;this._style=a;this.dirty=!0}},text:{get:function(){return this._text},set:function(a){a=a.toString()||" ";this._text!==a&&(this._text=a,this.dirty=!0)}}});a.prototype.updateText=function(){var a=this._style;this.context.font=a.font;for(var b=(a.wordWrap?this.wordWrap(this._text):this._text).split(/(?:\r\n|\r|\n)/),
c=Array(b.length),h=0,d=this.determineFontProperties(a.font),e=0;e<b.length;e++){var k=this.context.measureText(b[e]).width;c[e]=k;h=Math.max(h,k)}e=h+a.strokeThickness;a.dropShadow&&(e+=a.dropShadowDistance);this.canvas.width=(e+this.context.lineWidth)*this.resolution;k=this.style.lineHeight||d.fontSize+a.strokeThickness;e=k*b.length;a.dropShadow&&(e+=a.dropShadowDistance);this.canvas.height=(e+2*this._style.padding)*this.resolution;this.context.scale(this.resolution,this.resolution);navigator.isCocoonJS&&
this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.font=a.font;this.context.strokeStyle=a.stroke;this.context.lineWidth=a.strokeThickness;this.context.textBaseline=a.textBaseline;this.context.lineJoin=a.lineJoin;this.context.miterLimit=a.miterLimit;var g,f;if(a.dropShadow){0<a.dropShadowBlur?(this.context.shadowColor=a.dropShadowColor,this.context.shadowBlur=a.dropShadowBlur):this.context.fillStyle=a.dropShadowColor;for(var m=Math.cos(a.dropShadowAngle)*a.dropShadowDistance,
A=Math.sin(a.dropShadowAngle)*a.dropShadowDistance,e=0;e<b.length;e++)g=a.strokeThickness/2,f=a.strokeThickness/2+e*k+d.ascent,"right"===a.align?g+=h-c[e]:"center"===a.align&&(g+=(h-c[e])/2),a.fill&&this.context.fillText(b[e],g+m,f+A+this._style.padding)}this.context.fillStyle=a.fill;for(e=0;e<b.length;e++)g=a.strokeThickness/2,f=a.strokeThickness/2+e*k+d.ascent,"right"===a.align?g+=h-c[e]:"center"===a.align&&(g+=(h-c[e])/2),a.stroke&&a.strokeThickness&&this.context.strokeText(b[e],g,f+this._style.padding),
a.fill&&this.context.fillText(b[e],g,f+this._style.padding);this.updateTexture()};a.prototype.updateTexture=function(){var a=this._texture;a.baseTexture.hasLoaded=!0;a.baseTexture.resolution=this.resolution;a.baseTexture.width=this.canvas.width/this.resolution;a.baseTexture.height=this.canvas.height/this.resolution;a.crop.width=a._frame.width=this.canvas.width/this.resolution;a.crop.height=a._frame.height=this.canvas.height/this.resolution;a.trim.x=0;a.trim.y=-this._style.padding;a.trim.width=a._frame.width;
a.trim.height=a._frame.height-2*this._style.padding;this._width=this.canvas.width/this.resolution;this._height=this.canvas.height/this.resolution;a.baseTexture.emit("update",a.baseTexture);this.dirty=!1};a.prototype.renderWebGL=function(a){this.dirty&&this.updateText();g.prototype.renderWebGL.call(this,a)};a.prototype._renderCanvas=function(a){this.dirty&&this.updateText();g.prototype._renderCanvas.call(this,a)};a.prototype.determineFontProperties=function(b){var c=a.fontPropertiesCache[b];if(!c){var c=
{},h=a.fontPropertiesCanvas,d=a.fontPropertiesContext;d.font=b;var e=Math.ceil(d.measureText("|M\u00c9q").width),k=Math.ceil(d.measureText("M").width),g=2*k,k=1.4*k|0;h.width=e;h.height=g;d.fillStyle="#f00";d.fillRect(0,0,e,g);d.font=b;d.textBaseline="alphabetic";d.fillStyle="#000";d.fillText("|M\u00c9q",0,k);var h=d.getImageData(0,0,e,g).data,d=h.length,e=4*e,f,m,G=0,A=!1;for(f=0;f<k;f++){for(m=0;m<e;m+=4)if(255!==h[G+m]){A=!0;break}if(A)break;else G+=e}c.ascent=k-f;G=d-e;A=!1;for(f=g;f>k;f--){for(m=
0;m<e;m+=4)if(255!==h[G+m]){A=!0;break}if(A)break;else G-=e}c.descent=f-k;c.fontSize=c.ascent+c.descent;a.fontPropertiesCache[b]=c}return c};a.prototype.wordWrap=function(a){var b="";a=a.split("\n");for(var c=this._style.wordWrapWidth,h=0;h<a.length;h++){for(var d=c,e=a[h].split(" "),k=0;k<e.length;k++){var g=this.context.measureText(e[k]).width,f=g+this.context.measureText(" ").width;0===k||f>d?(0<k&&(b+="\n"),b+=e[k],d=c-g):(d-=f,b+=" "+e[k])}h<a.length-1&&(b+="\n")}return b};a.prototype.getBounds=
function(a){this.dirty&&this.updateText();return g.prototype.getBounds.call(this,a)};a.prototype.destroy=function(a){this._style=this.canvas=this.context=null;this._texture.destroy(void 0===a?!0:a)}},{"../const":16,"../math":26,"../sprites/Sprite":60,"../textures/Texture":65,"../utils":70}],63:[function(b,c,f){function a(a,b,c){k.call(this);this.uid=g.uid();this.resolution=c||1;this.realHeight=this.realWidth=this.height=this.width=100;this.scaleMode=b||e.SCALE_MODES.DEFAULT;this.isLoading=this.hasLoaded=
!1;this.source=null;this.premultipliedAlpha=!0;this.imageUrl=null;this.mipmap=this.isPowerOfTwo=!1;this._glTextures={};a&&this.loadSource(a)}var g=b("../utils"),e=b("../const"),k=b("eventemitter3");a.prototype=Object.create(k.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.update=function(){this.realWidth=this.source.naturalWidth||this.source.width;this.realHeight=this.source.naturalHeight||this.source.height;this.width=this.realWidth/this.resolution;this.height=this.realHeight/this.resolution;
this.isPowerOfTwo=g.isPowerOfTwo(this.realWidth,this.realHeight);this.emit("update",this)};a.prototype.loadSource=function(a){var b=this.isLoading;this.isLoading=this.hasLoaded=!1;b&&this.source&&(this.source.onload=null,this.source.onerror=null);this.source=a;if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this._sourceLoaded();else if(!a.getContext){this.isLoading=!0;var c=this;a.onload=function(){a.onload=null;a.onerror=null;c.isLoading&&(c.isLoading=!1,
c._sourceLoaded(),c.emit("loaded",c))};a.onerror=function(){a.onload=null;a.onerror=null;c.isLoading&&(c.isLoading=!1,c.emit("error",c))};a.complete&&a.src&&(this.isLoading=!1,a.onload=null,a.onerror=null,a.width&&a.height?(this._sourceLoaded(),b&&this.emit("loaded",this)):b&&this.emit("error",this))}};a.prototype._sourceLoaded=function(){this.hasLoaded=!0;this.update()};a.prototype.destroy=function(){this.imageUrl?(delete g.BaseTextureCache[this.imageUrl],delete g.TextureCache[this.imageUrl],this.imageUrl=
null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete g.BaseTextureCache[this.source._pixiId];this.source=null;this.dispose()};a.prototype.dispose=function(){this.emit("dispose",this)};a.prototype.updateSourceImage=function(a){this.source.src=a;this.loadSource(this.source)};a.fromImage=function(b,c,d){var e=g.BaseTextureCache[b];void 0===c&&0!==b.indexOf("data:")&&(c=!0);if(!e){var k=new Image;c&&(k.crossOrigin="");e=new a(k,d);e.imageUrl=b;k.src=b;g.BaseTextureCache[b]=
e;e.resolution=g.getResolutionOfUrl(b)}return e};a.fromCanvas=function(b,c){b._pixiId||(b._pixiId="canvas_"+g.uid());var d=g.BaseTextureCache[b._pixiId];d||(d=new a(b,c),g.BaseTextureCache[b._pixiId]=d);return d}},{"../const":16,"../utils":70,eventemitter3:10}],64:[function(b,c,f){function a(a,b,c,d,f){if(!a)throw Error("Unable to create RenderTexture, you must pass a renderer into the constructor.");b=b||100;c=c||100;f=f||q.RESOLUTION;var w=new g;w.width=b;w.height=c;w.resolution=f;w.scaleMode=d||
q.SCALE_MODES.DEFAULT;w.hasLoaded=!0;e.call(this,w,new n.Rectangle(0,0,b,c));this.width=b;this.height=c;this.resolution=f;this.render=null;this.renderer=a;this.renderer.type===q.RENDERER_TYPE.WEBGL?(a=this.renderer.gl,this.textureBuffer=new k(a,this.width,this.height,w.scaleMode,this.resolution),this.baseTexture._glTextures[a.id]=this.textureBuffer.texture,this.filterManager=new h(this.renderer),this.filterManager.onContextChange(),this.filterManager.resize(b,c),this.render=this.renderWebGL,this.renderer.currentRenderer.start(),
this.renderer.currentRenderTarget.activate()):(this.render=this.renderCanvas,this.textureBuffer=new m(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas);this.valid=!0;this._updateUvs()}var g=b("./BaseTexture"),e=b("./Texture"),k=b("../renderers/webgl/utils/RenderTarget"),h=b("../renderers/webgl/managers/FilterManager"),m=b("../renderers/canvas/utils/CanvasBuffer"),n=b("../math"),q=b("../const"),w=new n.Matrix;a.prototype=Object.create(e.prototype);
a.prototype.constructor=a;c.exports=a;a.prototype.resize=function(a,b,c){if(a!==this.width||b!==this.height)this.valid=0<a&&0<b,this.width=this._frame.width=this.crop.width=a,this.height=this._frame.height=this.crop.height=b,c&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.valid&&(this.textureBuffer.resize(this.width,this.height),this.filterManager&&this.filterManager.resize(this.width,this.height))};a.prototype.clear=function(){this.valid&&(this.renderer.type===q.RENDERER_TYPE.WEBGL&&
this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())};a.prototype.renderWebGL=function(a,b,c,d){if(this.valid){d=void 0!==d?d:!0;this.textureBuffer.transform=b;this.textureBuffer.activate();a.worldAlpha=1;if(d){a.worldTransform.identity();a.currentBounds=null;b=a.children;var h;d=0;for(h=b.length;d<h;++d)b[d].updateTransform()}b=this.renderer.filterManager;this.renderer.filterManager=this.filterManager;this.renderer.renderDisplayObject(a,
this.textureBuffer,c);this.renderer.filterManager=b}};a.prototype.renderCanvas=function(a,b,c,d){if(this.valid){w.identity();b&&w.append(b);b=a.worldTransform;a.worldTransform=w;a.worldAlpha=1;d=a.children;var h,e;h=0;for(e=d.length;h<e;++h)d[h].updateTransform();c&&this.textureBuffer.clear();c=this.textureBuffer.context;d=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(a,c);this.renderer.resolution=d;a.worldTransform===w&&(a.worldTransform=b)}};
a.prototype.destroy=function(){e.prototype.destroy.call(this,!0);this.textureBuffer.destroy();this.filterManager&&this.filterManager.destroy();this.renderer=null};a.prototype.getImage=function(){var a=new Image;a.src=this.getBase64();return a};a.prototype.getBase64=function(){return this.getCanvas().toDataURL()};a.prototype.getCanvas=function(){if(this.renderer.type===q.RENDERER_TYPE.WEBGL){var a=this.renderer.gl,b=this.textureBuffer.size.width,c=this.textureBuffer.size.height,d=new Uint8Array(4*
b*c);a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer);a.readPixels(0,0,b,c,a.RGBA,a.UNSIGNED_BYTE,d);a.bindFramebuffer(a.FRAMEBUFFER,null);a=new m(b,c);b=a.context.getImageData(0,0,b,c);b.data.set(d);a.context.putImageData(b,0,0);return a.canvas}return this.textureBuffer.canvas};a.prototype.getPixels=function(){var a,b;if(this.renderer.type===q.RENDERER_TYPE.WEBGL){var c=this.renderer.gl;a=this.textureBuffer.size.width;b=this.textureBuffer.size.height;var d=new Uint8Array(4*a*b);c.bindFramebuffer(c.FRAMEBUFFER,
this.textureBuffer.frameBuffer);c.readPixels(0,0,a,b,c.RGBA,c.UNSIGNED_BYTE,d);c.bindFramebuffer(c.FRAMEBUFFER,null);return d}a=this.textureBuffer.canvas.width;b=this.textureBuffer.canvas.height;return this.textureBuffer.canvas.getContext("2d").getImageData(0,0,a,b).data};a.prototype.getPixel=function(a,b){if(this.renderer.type===q.RENDERER_TYPE.WEBGL){var c=this.renderer.gl,d=new Uint8Array(4);c.bindFramebuffer(c.FRAMEBUFFER,this.textureBuffer.frameBuffer);c.readPixels(a,b,1,1,c.RGBA,c.UNSIGNED_BYTE,
d);c.bindFramebuffer(c.FRAMEBUFFER,null);return d}return this.textureBuffer.canvas.getContext("2d").getImageData(a,b,1,1).data}},{"../const":16,"../math":26,"../renderers/canvas/utils/CanvasBuffer":38,"../renderers/webgl/managers/FilterManager":47,"../renderers/webgl/utils/RenderTarget":58,"./BaseTexture":63,"./Texture":65}],65:[function(b,c,f){function a(b,c,d,e,k){h.call(this);this.noFrame=!1;c||(this.noFrame=!0,c=new m.Rectangle(0,0,1,1));b instanceof a&&(b=b.baseTexture);this.baseTexture=b;this._frame=
c;this.trim=e;this.requiresUpdate=this.valid=!1;this._uvs=null;this.height=this.width=0;this.crop=d||c;this.rotate=!!k;if(b.hasLoaded)this.noFrame&&(c=new m.Rectangle(0,0,b.width,b.height),b.on("update",this.onBaseTextureUpdated,this)),this.frame=c;else b.once("loaded",this.onBaseTextureLoaded,this)}var g=b("./BaseTexture"),e=b("./VideoBaseTexture"),k=b("./TextureUvs"),h=b("eventemitter3"),m=b("../math"),n=b("../utils");a.prototype=Object.create(h.prototype);a.prototype.constructor=a;c.exports=a;
Object.defineProperties(a.prototype,{frame:{get:function(){return this._frame},set:function(a){this._frame=a;this.noFrame=!1;this.width=a.width;this.height=a.height;if(!this.trim&&!this.rotate&&(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height))throw Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=a&&a.width&&a.height&&this.baseTexture.hasLoaded;this.trim?(this.width=this.trim.width,this.height=this.trim.height,this._frame.width=
this.trim.width,this._frame.height=this.trim.height):this.crop=a;this.valid&&this._updateUvs()}}});a.prototype.update=function(){this.baseTexture.update()};a.prototype.onBaseTextureLoaded=function(a){this.frame=this.noFrame?new m.Rectangle(0,0,a.width,a.height):this._frame;this.emit("update",this)};a.prototype.onBaseTextureUpdated=function(a){this._frame.width=a.width;this._frame.height=a.height;this.emit("update",this)};a.prototype.destroy=function(a){this.baseTexture&&(a&&this.baseTexture.destroy(),
this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null);this.crop=this.trim=this._uvs=this._frame=null;this.valid=!1;this.off("dispose",this.dispose,this);this.off("update",this.update,this)};a.prototype.clone=function(){return new a(this.baseTexture,this.frame,this.crop,this.trim,this.rotate)};a.prototype._updateUvs=function(){this._uvs||(this._uvs=new k);this._uvs.set(this.crop,this.baseTexture,this.rotate)};
a.fromImage=function(b,c,d){var h=n.TextureCache[b];h||(h=new a(g.fromImage(b,c,d)),n.TextureCache[b]=h);return h};a.fromFrame=function(a){var b=n.TextureCache[a];if(!b)throw Error('The frameId "'+a+'" does not exist in the texture cache');return b};a.fromCanvas=function(b,c){return new a(g.fromCanvas(b,c))};a.fromVideo=function(b,c){return"string"===typeof b?a.fromVideoUrl(b,c):new a(e.fromVideo(b,c))};a.fromVideoUrl=function(b,c){return new a(e.fromUrl(b,c))};a.addTextureToCache=function(a,b){n.TextureCache[b]=
a};a.removeTextureFromCache=function(a){var b=n.TextureCache[a];delete n.TextureCache[a];delete n.BaseTextureCache[a];return b};a.EMPTY=new a(new g)},{"../math":26,"../utils":70,"./BaseTexture":63,"./TextureUvs":66,"./VideoBaseTexture":67,eventemitter3:10}],66:[function(b,c,f){function a(){this.y0=this.x0=0;this.x1=1;this.y1=0;this.y2=this.x2=1;this.x3=0;this.y3=1}c.exports=a;a.prototype.set=function(a,b,c){var d=b.width;b=b.height;c?(this.x0=(a.x+a.height)/d,this.y0=a.y/b,this.x1=(a.x+a.height)/
d,this.y1=(a.y+a.width)/b,this.x2=a.x/d,this.y2=(a.y+a.width)/b,this.x3=a.x/d,this.y3=a.y/b):(this.x0=a.x/d,this.y0=a.y/b,this.x1=(a.x+a.width)/d,this.y1=a.y/b,this.x2=(a.x+a.width)/d,this.y2=(a.y+a.height)/b,this.x3=a.x/d,this.y3=(a.y+a.height)/b)}},{}],67:[function(b,c,f){function a(a,b){if(!a)throw Error("No video source element specified.");(a.readyState===a.HAVE_ENOUGH_DATA||a.readyState===a.HAVE_FUTURE_DATA)&&a.width&&a.height&&(a.complete=!0);e.call(this,a,b);this.autoUpdate=!1;this._onUpdate=
this._onUpdate.bind(this);this._onCanPlay=this._onCanPlay.bind(this);a.complete||(a.addEventListener("canplay",this._onCanPlay),a.addEventListener("canplaythrough",this._onCanPlay),a.addEventListener("play",this._onPlayStart.bind(this)),a.addEventListener("pause",this._onPlayStop.bind(this)));this.__loaded=!1}function g(a,b){b||(b="video/"+a.substr(a.lastIndexOf(".")+1));var c=document.createElement("source");c.src=a;c.type=b;return c}var e=b("./BaseTexture"),k=b("../utils");a.prototype=Object.create(e.prototype);
a.prototype.constructor=a;c.exports=a;a.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this._onUpdate),this.update())};a.prototype._onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this._onUpdate),this.autoUpdate=!0)};a.prototype._onPlayStop=function(){this.autoUpdate=!1};a.prototype._onCanPlay=function(){this.hasLoaded=!0;this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),
this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.source.play(),this.__loaded||(this.__loaded=!0,this.emit("loaded",this)))};a.prototype.destroy=function(){this.source&&this.source._pixiId&&(delete k.BaseTextureCache[this.source._pixiId],delete this.source._pixiId);e.prototype.destroy.call(this)};a.fromVideo=function(b,c){b._pixiId||(b._pixiId="video_"+k.uid());var d=k.BaseTextureCache[b._pixiId];d||(d=new a(b,c),k.BaseTextureCache[b._pixiId]=d);return d};a.fromUrl=function(b,
c){var d=document.createElement("video");if(Array.isArray(b))for(var e=0;e<b.length;++e)d.appendChild(g(b[e].src||b[e],b[e].mime));else d.appendChild(g(b.src||b,b.mime));d.load();d.play();return a.fromVideo(d,c)};a.fromUrls=a.fromUrl},{"../utils":70,"./BaseTexture":63}],68:[function(b,c,f){function a(){var a=this;this._tick=function(b){a._requestId=null;a.started&&(a.update(b),a.started&&null===a._requestId&&a._emitter.listeners("tick",!0)&&(a._requestId=requestAnimationFrame(a._tick)))};this._emitter=
new e;this._requestId=null;this._maxElapsedMS=100;this.autoStart=!1;this.deltaTime=1;this.elapsedMS=1/g.TARGET_FPMS;this.lastTime=0;this.speed=1;this.started=!1}var g=b("../const"),e=b("eventemitter3");Object.defineProperties(a.prototype,{FPS:{get:function(){return 1E3/this.elapsedMS}},minFPS:{get:function(){return 1E3/this._maxElapsedMS},set:function(a){this._maxElapsedMS=1/Math.min(Math.max(0,a)/1E3,g.TARGET_FPMS)}}});a.prototype._requestIfNeeded=function(){null===this._requestId&&this._emitter.listeners("tick",
!0)&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))};a.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)};a.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()};a.prototype.add=function(a,b){this._emitter.on("tick",a,b);this._startIfPossible();return this};a.prototype.addOnce=function(a,b){this._emitter.once("tick",a,b);this._startIfPossible();
return this};a.prototype.remove=function(a,b){this._emitter.off("tick",a,b);this._emitter.listeners("tick",!0)||this._cancelIfNeeded();return this};a.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())};a.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())};a.prototype.update=function(a){var b;a=a||performance.now();b=this.elapsedMS=a-this.lastTime;b>this._maxElapsedMS&&(b=this._maxElapsedMS);this.deltaTime=b*g.TARGET_FPMS*this.speed;this._emitter.emit("tick",
this.deltaTime);this.lastTime=a};c.exports=a},{"../const":16,eventemitter3:10}],69:[function(b,c,f){b=b("./Ticker");f=new b;f.autoStart=!0;c.exports={shared:f,Ticker:b}},{"./Ticker":68}],70:[function(b,c,f){var a=b("../const"),g=c.exports={_uid:0,_saidHello:!1,EventEmitter:b("eventemitter3"),pluginTarget:b("./pluginTarget"),async:b("async"),uid:function(){return++g._uid},hex2rgb:function(a,b){b=b||[];b[0]=(a>>16&255)/255;b[1]=(a>>8&255)/255;b[2]=(a&255)/255;return b},hex2string:function(a){a=a.toString(16);
a="000000".substr(0,6-a.length)+a;return"#"+a},rgb2hex:function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]},canUseNewCanvasBlendModes:function(){if("undefined"===typeof document)return!1;var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/AP804Oa6AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var b=new Image;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX//wCKxvRFAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";
var c=document.createElement("canvas");c.width=6;c.height=1;c=c.getContext("2d");c.globalCompositeOperation="multiply";c.drawImage(a,0,0);c.drawImage(b,2,0);a=c.getImageData(2,0,1,1).data;return 255===a[0]&&0===a[1]&&0===a[2]},getNextPowerOfTwo:function(a){if(0<a&&0===(a&a-1))return a;for(var b=1;b<a;)b<<=1;return b},isPowerOfTwo:function(a,b){return 0<a&&0===(a&a-1)&&0<b&&0===(b&b-1)},getResolutionOfUrl:function(b){return(b=a.RETINA_PREFIX.exec(b))?parseFloat(b[1]):1},sayHello:function(b){g._saidHello||
(-1<navigator.userAgent.toLowerCase().indexOf("chrome")?window.console.log.apply(console,["\n %c %c %c Pixi.js "+a.VERSION+" - \u2730 "+b+" \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;",
"color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"]):window.console&&window.console.log("Pixi.js "+a.VERSION+" - "+b+" - http://www.pixijs.com/"),g._saidHello=!0)},isWebGLSupported:function(){var a={stencil:!0};try{if(!window.WebGLRenderingContext)return!1;var b=document.createElement("canvas"),c=b.getContext("webgl",a)||b.getContext("experimental-webgl",a);return!(!c||!c.getContextAttributes().stencil)}catch(d){return!1}},sign:function(a){return a?
0>a?-1:1:0},removeItems:function(a,b,c){var d=a.length;if(!(b>=d||0===c)){c=b+c>d?d-b:c;for(d-=c;b<d;++b)a[b]=a[b+c];a.length=d}},TextureCache:{},BaseTextureCache:{}}},{"../const":16,"./pluginTarget":71,async:1,eventemitter3:10}],71:[function(b,c,f){function a(a){a.__plugins={};a.registerPlugin=function(b,c){a.__plugins[b]=c};a.prototype.initPlugins=function(){this.plugins=this.plugins||{};for(var b in a.__plugins)this.plugins[b]=new a.__plugins[b](this)};a.prototype.destroyPlugins=function(){for(var a in this.plugins)this.plugins[a].destroy(),
this.plugins[a]=null;this.plugins=null}}c.exports={mixin:function(b){a(b)}}},{}],72:[function(b,c,f){var a=b("./core"),g=b("./mesh"),e=b("./extras");b=b("./filters");a.SpriteBatch=function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.");};a.AssetLoader=function(){throw new ReferenceError("The loader system was overhauled in pixi v3, please see the new PIXI.loaders.Loader class.");};Object.defineProperties(a,{Stage:{get:function(){console.warn("You do not need to use a PIXI Stage any more, you can simply render any container.");
return a.Container}},DisplayObjectContainer:{get:function(){console.warn("DisplayObjectContainer has been shortened to Container, please use Container from now on.");return a.Container}},Strip:{get:function(){console.warn("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on.");return g.Mesh}},Rope:{get:function(){console.warn("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on.");return g.Rope}},MovieClip:{get:function(){console.warn("The MovieClip class has been moved to extras.MovieClip, please use extras.MovieClip from now on.");
return e.MovieClip}},TilingSprite:{get:function(){console.warn("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on.");return e.TilingSprite}},BitmapText:{get:function(){console.warn("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on.");return e.BitmapText}},blendModes:{get:function(){console.warn("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on.");return a.BLEND_MODES}},
scaleModes:{get:function(){console.warn("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on.");return a.SCALE_MODES}},BaseTextureCache:{get:function(){console.warn("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on.");return a.utils.BaseTextureCache}},TextureCache:{get:function(){console.warn("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on.");return a.utils.TextureCache}},
math:{get:function(){console.warn("The math namespace is deprecated, please access members already accessible on PIXI.");return a}}});a.Sprite.prototype.setTexture=function(a){this.texture=a;console.warn("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")};e.BitmapText.prototype.setText=function(a){this.text=a;console.warn("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")};a.Text.prototype.setText=function(a){this.text=
a;console.warn("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")};a.Text.prototype.setStyle=function(a){this.style=a;console.warn("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")};a.Texture.prototype.setFrame=function(a){this.frame=a;console.warn("setFrame is now deprecated, please use the frame property, e.g : myTexture.frame = frame;")};Object.defineProperties(b,{AbstractFilter:{get:function(){console.warn("filters.AbstractFilter is an undocumented alias, please use AbstractFilter from now on.");
return a.AbstractFilter}},FXAAFilter:{get:function(){console.warn("filters.FXAAFilter is an undocumented alias, please use FXAAFilter from now on.");return a.FXAAFilter}},SpriteMaskFilter:{get:function(){console.warn("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on.");return a.SpriteMaskFilter}}});a.utils.uuid=function(){console.warn("utils.uuid() is deprecated, please use utils.uid() from now on.");return a.utils.uid()}},{"./core":23,"./extras":79,"./filters":96,
"./mesh":121}],73:[function(b,c,f){function a(a,b){g.Container.call(this);b=b||{};this.textHeight=this.textWidth=0;this._glyphs=[];this._font={tint:void 0!==b.tint?b.tint:16777215,align:b.align||"left",name:null,size:0};this.font=b.font;this._text=a;this.maxLineHeight=this.maxWidth=0;this.dirty=!1;this.updateText()}var g=b("../core");a.prototype=Object.create(g.Container.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{tint:{get:function(){return this._font.tint},
set:function(a){this._font.tint="number"===typeof a&&0<=a?a:16777215;this.dirty=!0}},align:{get:function(){return this._font.align},set:function(a){this._font.align=a||"left";this.dirty=!0}},font:{get:function(){return this._font},set:function(b){b&&("string"===typeof b?(b=b.split(" "),this._font.name=1===b.length?b[0]:b.slice(1).join(" "),this._font.size=2<=b.length?parseInt(b[0],10):a.fonts[this._font.name].size):(this._font.name=b.name,this._font.size="number"===typeof b.size?b.size:parseInt(b.size,
10)),this.dirty=!0)}},text:{get:function(){return this._text},set:function(a){a=a.toString()||" ";this._text!==a&&(this._text=a,this.dirty=!0)}}});a.prototype.updateText=function(){for(var b=a.fonts[this._font.name],c=new g.Point,d=null,f=[],n=0,q=0,w=[],p=0,v=this._font.size/b.size,r=-1,u=0,t=0;t<this.text.length;t++){var D=this.text.charCodeAt(t),r=/(\s)/.test(this.text.charAt(t))?t:r;if(/(?:\r\n|\r|\n)/.test(this.text.charAt(t)))w.push(n),q=Math.max(q,n),p++,c.x=0,c.y+=b.lineHeight,d=null;else if(-1!==
r&&0<this.maxWidth&&c.x*v>this.maxWidth)g.utils.removeItems(f,r,t-r),t=r,r=-1,w.push(n),q=Math.max(q,n),p++,c.x=0,c.y+=b.lineHeight,d=null;else{var G=b.chars[D];G&&(d&&G.kerning[d]&&(c.x+=G.kerning[d]),f.push({texture:G.texture,line:p,charCode:D,position:new g.Point(c.x+G.xOffset,c.y+G.yOffset)}),n=c.x+(G.texture.width+G.xOffset),c.x+=G.xAdvance,u=Math.max(u,G.yOffset+G.texture.height),d=D)}}w.push(n);q=Math.max(q,n);d=[];for(t=0;t<=p;t++)n=0,"right"===this._font.align?n=q-w[t]:"center"===this._font.align&&
(n=(q-w[t])/2),d.push(n);w=f.length;p=this.tint;for(t=0;t<w;t++)(n=this._glyphs[t])?n.texture=f[t].texture:(n=new g.Sprite(f[t].texture),this._glyphs.push(n)),n.position.x=(f[t].position.x+d[f[t].line])*v,n.position.y=f[t].position.y*v,n.scale.x=n.scale.y=v,n.tint=p,n.parent||this.addChild(n);for(t=w;t<this._glyphs.length;++t)this.removeChild(this._glyphs[t]);this.textWidth=q*v;this.textHeight=(c.y+b.lineHeight)*v;this.maxLineHeight=u*v};a.prototype.updateTransform=function(){this.validate();this.containerUpdateTransform()};
a.prototype.getLocalBounds=function(){this.validate();return g.Container.prototype.getLocalBounds.call(this)};a.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)};a.fonts={}},{"../core":23}],74:[function(b,c,f){function a(a){g.Sprite.call(this,a[0]instanceof g.Texture?a[0]:a[0].texture);this._durations=this._textures=null;this.textures=a;this.animationSpeed=1;this.loop=!0;this.onComplete=null;this._currentTime=0;this.playing=!1}var g=b("../core");a.prototype=Object.create(g.Sprite.prototype);
a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{totalFrames:{get:function(){return this._textures.length}},textures:{get:function(){return this._textures},set:function(a){if(a[0]instanceof g.Texture)this._textures=a,this._durations=null;else{this._textures=[];this._durations=[];for(var b=0;b<a.length;b++)this._textures.push(a[b].texture),this._durations.push(a[b].time)}}},currentFrame:{get:function(){var a=Math.floor(this._currentTime)%this._textures.length;0>a&&(a+=this._textures.length);
return a}}});a.prototype.stop=function(){this.playing&&(this.playing=!1,g.ticker.shared.remove(this.update,this))};a.prototype.play=function(){this.playing||(this.playing=!0,g.ticker.shared.add(this.update,this))};a.prototype.gotoAndStop=function(a){this.stop();this._currentTime=a;this._texture=this._textures[this.currentFrame]};a.prototype.gotoAndPlay=function(a){this._currentTime=a;this.play()};a.prototype.update=function(a){var b=this.animationSpeed*a;if(null!==this._durations){for(var c=this._currentTime%
1*this._durations[this.currentFrame],c=c+b/60*1E3;0>c;)this._currentTime--,c+=this._durations[this.currentFrame];a=Math.sign(this.animationSpeed*a);for(this._currentTime=Math.floor(this._currentTime);c>=this._durations[this.currentFrame];)c-=this._durations[this.currentFrame]*a,this._currentTime+=a;this._currentTime+=c/this._durations[this.currentFrame]}else this._currentTime+=b;if(0>this._currentTime&&!this.loop){if(this.gotoAndStop(0),this.onComplete)this.onComplete()}else if(this._currentTime>=
this._textures.length&&!this.loop){if(this.gotoAndStop(this._textures.length-1),this.onComplete)this.onComplete()}else this._texture=this._textures[this.currentFrame]};a.prototype.destroy=function(){this.stop();g.Sprite.prototype.destroy.call(this)};a.fromFrames=function(b){for(var c=[],d=0;d<b.length;++d)c.push(new g.Texture.fromFrame(b[d]));return new a(c)};a.fromImages=function(b){for(var c=[],d=0;d<b.length;++d)c.push(new g.Texture.fromImage(b[d]));return new a(c)}},{"../core":23}],75:[function(b,
c,f){function a(a,b,c){g.Sprite.call(this,a);this.tileScale=new g.Point(1,1);this.tilePosition=new g.Point(0,0);this._width=b||100;this._height=c||100;this._uvs=new g.TextureUvs;this._canvasPattern=null;this.shader=new g.AbstractFilter("precision lowp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nuniform mat3 projectionMatrix;\nuniform vec4 uFrame;\nuniform vec4 uTransform;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vec2 coord = aTextureCoord;\n   coord -= uTransform.xy;\n   coord /= uTransform.zw;\n   vTextureCoord = coord;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}",
"precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nuniform vec4 uFrame;\nuniform vec2 uPixelSize;\nvoid main(void){\n   vec2 coord = mod(vTextureCoord, uFrame.zw);\n   coord = clamp(coord, uPixelSize, uFrame.zw - uPixelSize);\n   coord += uFrame.xy;\n   gl_FragColor =  texture2D(uSampler, coord) * vColor ;\n}",{uFrame:{type:"4fv",value:[0,0,1,1]},uTransform:{type:"4fv",value:[0,0,1,1]},uPixelSize:{type:"2fv",value:[1,1]}})}var g=b("../core"),e=
new g.Point,k=b("../core/renderers/canvas/utils/CanvasTinter");a.prototype=Object.create(g.Sprite.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{width:{get:function(){return this._width},set:function(a){this._width=a}},height:{get:function(){return this._height},set:function(a){this._height=a}}});a.prototype._onTextureUpdate=function(){};a.prototype._renderWebGL=function(a){var b=this._texture;if(b&&b._uvs){var c=b._uvs,d=b._frame.width,e=b._frame.height,k=b.baseTexture.width,
g=b.baseTexture.height;b._uvs=this._uvs;b._frame.width=this.width;b._frame.height=this.height;this.shader.uniforms.uPixelSize.value[0]=1/k;this.shader.uniforms.uPixelSize.value[1]=1/g;this.shader.uniforms.uFrame.value[0]=c.x0;this.shader.uniforms.uFrame.value[1]=c.y0;this.shader.uniforms.uFrame.value[2]=c.x1-c.x0;this.shader.uniforms.uFrame.value[3]=c.y2-c.y0;this.shader.uniforms.uTransform.value[0]=this.tilePosition.x%(d*this.tileScale.x)/this._width;this.shader.uniforms.uTransform.value[1]=this.tilePosition.y%
(e*this.tileScale.y)/this._height;this.shader.uniforms.uTransform.value[2]=k/this._width*this.tileScale.x;this.shader.uniforms.uTransform.value[3]=g/this._height*this.tileScale.y;a.setObjectRenderer(a.plugins.sprite);a.plugins.sprite.render(this);b._uvs=c;b._frame.width=d;b._frame.height=e}};a.prototype._renderCanvas=function(a){var b=this._texture;if(b.baseTexture.hasLoaded){var c=a.context,d=this.worldTransform,e=a.resolution,f=b.baseTexture,v=this.tilePosition.x/this.tileScale.x%b._frame.width,
r=this.tilePosition.y/this.tileScale.y%b._frame.height;if(!this._canvasPattern){var u=new g.CanvasBuffer(b._frame.width,b._frame.height);16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=k.getTintedTexture(this,this.tint)),u.context.drawImage(this.tintedTexture,0,0)):u.context.drawImage(f.source,-b._frame.x,-b._frame.y);this._canvasPattern=u.context.createPattern(u.canvas,"repeat")}c.globalAlpha=this.worldAlpha;c.setTransform(d.a*e,d.b*e,d.c*e,d.d*e,
d.tx*e,d.ty*e);c.scale(this.tileScale.x,this.tileScale.y);c.translate(v+this.anchor.x*-this._width,r+this.anchor.y*-this._height);b=a.blendModes[this.blendMode];b!==a.context.globalCompositeOperation&&(c.globalCompositeOperation=b);c.fillStyle=this._canvasPattern;c.fillRect(-v,-r,this._width/this.tileScale.x,this._height/this.tileScale.y)}};a.prototype.getBounds=function(){var a=this._width,b=this._height,c=a*(1-this.anchor.x),d=a*-this.anchor.x,e=b*(1-this.anchor.y),k=b*-this.anchor.y,b=this.worldTransform,
g=b.a,f=b.b,u=b.c,t=b.d,D=b.tx,G=b.ty,A=g*d+u*k+D,b=t*k+f*d+G,a=g*c+u*k+D,k=t*k+f*c+G,z=g*c+u*e+D,c=t*e+f*c+G,g=g*d+u*e+D,d=t*e+f*d+G,e=A,e=a<e?a:e,e=z<e?z:e,e=g<e?g:e,f=b,f=k<f?k:f,f=c<f?c:f,f=d<f?d:f,A=a>A?a:A,A=z>A?z:A,b=k>b?k:b,b=c>b?c:b,a=this._bounds;a.x=e;a.width=(g>A?g:A)-e;a.y=f;a.height=(d>b?d:b)-f;return this._currentBounds=a};a.prototype.containsPoint=function(a){this.worldTransform.applyInverse(a,e);var b=this._width;a=this._height;var c=-b*this.anchor.x;return e.x>c&&e.x<c+b&&(b=-a*
this.anchor.y,e.y>b&&e.y<b+a)?!0:!1};a.prototype.destroy=function(){g.Sprite.prototype.destroy.call(this);this._uvs=this.tilePosition=this._tileScaleOffset=this.tileScale=null};a.fromFrame=function(b,c,d){var e=g.utils.TextureCache[b];if(!e)throw Error('The frameId "'+b+'" does not exist in the texture cache '+this);return new a(e,c,d)};a.fromImage=function(b,c,d,e,k){return new a(g.Texture.fromImage(b,e,k),c,d)}},{"../core":23,"../core/renderers/canvas/utils/CanvasTinter":41}],76:[function(b,c,f){var a=
b("../core");b=a.DisplayObject;var g=new a.Matrix;b.prototype._cacheAsBitmap=!1;b.prototype._originalRenderWebGL=null;b.prototype._originalRenderCanvas=null;b.prototype._originalUpdateTransform=null;b.prototype._originalHitTest=null;b.prototype._originalDestroy=null;b.prototype._cachedSprite=null;Object.defineProperties(b.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap!==a&&((this._cacheAsBitmap=a)?(this._originalRenderWebGL=this.renderWebGL,
this._originalRenderCanvas=this.renderCanvas,this._originalUpdateTransform=this.updateTransform,this._originalGetBounds=this.getBounds,this._originalDestroy=this.destroy,this._originalContainsPoint=this.containsPoint,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(this._cachedSprite&&this._destroyCachedDisplayObject(),this.renderWebGL=this._originalRenderWebGL,this.renderCanvas=this._originalRenderCanvas,this.getBounds=
this._originalGetBounds,this.destroy=this._originalDestroy,this.updateTransform=this._originalUpdateTransform,this.containsPoint=this._originalContainsPoint))}}});b.prototype._renderCachedWebGL=function(a){!this.visible||0>=this.worldAlpha||!this.renderable||(this._initCachedDisplayObject(a),this._cachedSprite.worldAlpha=this.worldAlpha,a.setObjectRenderer(a.plugins.sprite),a.plugins.sprite.render(this._cachedSprite))};b.prototype._initCachedDisplayObject=function(b){if(!this._cachedSprite){b.currentRenderer.flush();
var c=this.getLocalBounds().clone();if(this._filters){var d=this._filters[0].padding;c.x-=d;c.y-=d;c.width+=2*d;c.height+=2*d}var d=b.currentRenderTarget,f=b.filterManager.filterStack,n=new a.RenderTexture(b,c.width|0,c.height|0);g.tx=-c.x;g.ty=-c.y;this.renderWebGL=this._originalRenderWebGL;n.render(this,g,!0,!0);b.setRenderTarget(d);b.filterManager.filterStack=f;this.renderWebGL=this._renderCachedWebGL;this.updateTransform=this.displayObjectUpdateTransform;this.getBounds=this._getCachedBounds;this._cachedSprite=
new a.Sprite(n);this._cachedSprite.worldTransform=this.worldTransform;this._cachedSprite.anchor.x=-(c.x/c.width);this._cachedSprite.anchor.y=-(c.y/c.height);this.updateTransform();this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}};b.prototype._renderCachedCanvas=function(a){!this.visible||0>=this.worldAlpha||!this.renderable||(this._initCachedDisplayObjectCanvas(a),this._cachedSprite.worldAlpha=this.worldAlpha,this._cachedSprite.renderCanvas(a))};b.prototype._initCachedDisplayObjectCanvas=
function(b){if(!this._cachedSprite){var c=this.getLocalBounds(),d=b.context,f=new a.RenderTexture(b,c.width|0,c.height|0);g.tx=-c.x;g.ty=-c.y;this.renderCanvas=this._originalRenderCanvas;f.render(this,g,!0);b.context=d;this.renderCanvas=this._renderCachedCanvas;this.updateTransform=this.displayObjectUpdateTransform;this.getBounds=this._getCachedBounds;this._cachedSprite=new a.Sprite(f);this._cachedSprite.worldTransform=this.worldTransform;this._cachedSprite.anchor.x=-(c.x/c.width);this._cachedSprite.anchor.y=
-(c.y/c.height);this.updateTransform();this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}};b.prototype._getCachedBounds=function(){this._cachedSprite._currentBounds=null;return this._cachedSprite.getBounds()};b.prototype._destroyCachedDisplayObject=function(){this._cachedSprite._texture.destroy();this._cachedSprite=null};b.prototype._cacheAsBitmapDestroy=function(){this.cacheAsBitmap=!1;this._originalDestroy()}},{"../core":23}],77:[function(b,c,f){b=b("../core");b.DisplayObject.prototype.name=
null;b.Container.prototype.getChildByName=function(a){for(var b=0;b<this.children.length;b++)if(this.children[b].name===a)return this.children[b];return null}},{"../core":23}],78:[function(b,c,f){var a=b("../core");a.DisplayObject.prototype.getGlobalPosition=function(b){b=b||new a.Point;this.parent?(this.displayObjectUpdateTransform(),b.x=this.worldTransform.tx,b.y=this.worldTransform.ty):(b.x=this.position.x,b.y=this.position.y);return b}},{"../core":23}],79:[function(b,c,f){b("./cacheAsBitmap");
b("./getChildByName");b("./getGlobalPosition");c.exports={MovieClip:b("./MovieClip"),TilingSprite:b("./TilingSprite"),BitmapText:b("./BitmapText")}},{"./BitmapText":73,"./MovieClip":74,"./TilingSprite":75,"./cacheAsBitmap":76,"./getChildByName":77,"./getGlobalPosition":78}],80:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nuniform vec4 dimensions;\nuniform float pixelSize;\nuniform sampler2D uSampler;\n\nfloat character(float n, vec2 p)\n{\n    p = floor(p*vec2(4.0, -4.0) + 2.5);\n    if (clamp(p.x, 0.0, 4.0) == p.x && clamp(p.y, 0.0, 4.0) == p.y)\n    {\n        if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;\n    }\n    return 0.0;\n}\n\nvoid main()\n{\n    vec2 uv = gl_FragCoord.xy;\n\n    vec3 col = texture2D(uSampler, floor( uv / pixelSize ) * pixelSize / dimensions.xy).rgb;\n\n    float gray = (col.r + col.g + col.b) / 3.0;\n\n    float n =  65536.0;             // .\n    if (gray > 0.2) n = 65600.0;    // :\n    if (gray > 0.3) n = 332772.0;   // *\n    if (gray > 0.4) n = 15255086.0; // o\n    if (gray > 0.5) n = 23385164.0; // &\n    if (gray > 0.6) n = 15252014.0; // 8\n    if (gray > 0.7) n = 13199452.0; // @\n    if (gray > 0.8) n = 11512810.0; // #\n\n    vec2 p = mod( uv / ( pixelSize * 0.5 ), 2.0) - vec2(1.0);\n    col = col * character(n, p);\n\n    gl_FragColor = vec4(col, 1.0);\n}\n",
{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"1f",value:8}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(a){this.uniforms.pixelSize.value=a}}})},{"../../core":23}],81:[function(b,c,f){function a(){g.AbstractFilter.call(this);this.blurXFilter=new e;this.blurYFilter=new k;this.defaultFilter=new g.AbstractFilter}
var g=b("../../core"),e=b("../blur/BlurXFilter"),k=b("../blur/BlurYFilter");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.applyFilter=function(a,b,c){var d=a.filterManager.getRenderTarget(!0);this.defaultFilter.applyFilter(a,b,c);this.blurXFilter.applyFilter(a,b,d);a.blendModeManager.setBlendMode(g.BLEND_MODES.SCREEN);this.blurYFilter.applyFilter(a,d,c);a.blendModeManager.setBlendMode(g.BLEND_MODES.NORMAL);a.filterManager.returnRenderTarget(d)};
Object.defineProperties(a.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=this.blurYFilter.blur=a}},blurX:{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=a}},blurY:{get:function(){return this.blurYFilter.blur},set:function(a){this.blurYFilter.blur=a}}})},{"../../core":23,"../blur/BlurXFilter":84,"../blur/BlurYFilter":85}],82:[function(b,c,f){function a(a,b){g.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform float dirX;\nuniform float dirY;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[3];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[0] = aTextureCoord + vec2( (0.004 * strength) * dirX, (0.004 * strength) * dirY );\n    vBlurTexCoords[1] = aTextureCoord + vec2( (0.008 * strength) * dirX, (0.008 * strength) * dirY );\n    vBlurTexCoords[2] = aTextureCoord + vec2( (0.012 * strength) * dirX, (0.012 * strength) * dirY );\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n",
"precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[3];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vTextureCoord     ) * 0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0]) * 0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1]) * 0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2]) * 0.004431848411938341;\n}\n",
{strength:{type:"1f",value:1},dirX:{type:"1f",value:a||0},dirY:{type:"1f",value:b||0}});this.defaultFilter=new g.AbstractFilter;this.passes=1;this.dirX=a||0;this.dirY=b||0;this.strength=4}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.applyFilter=function(a,b,c,d){var f=this.getShader(a);this.uniforms.strength.value=this.strength/4/this.passes*(b.frame.width/b.size.width);if(1===this.passes)a.filterManager.applyFilter(f,
b,c,d);else{var g=a.filterManager.getRenderTarget(!0);a.filterManager.applyFilter(f,b,g,d);for(b=0;b<this.passes-2;b++)a.filterManager.applyFilter(f,g,g,d);a.filterManager.applyFilter(f,g,c,d);a.filterManager.returnRenderTarget(g)}};Object.defineProperties(a.prototype,{blur:{get:function(){return this.strength},set:function(a){this.padding=.5*a;this.strength=a}},dirX:{get:function(){return this.dirX},set:function(a){this.uniforms.dirX.value=a}},dirY:{get:function(){return this.dirY},set:function(a){this.uniforms.dirY.value=
a}}})},{"../../core":23}],83:[function(b,c,f){function a(){g.AbstractFilter.call(this);this.blurXFilter=new e;this.blurYFilter=new k}var g=b("../../core"),e=b("./BlurXFilter"),k=b("./BlurYFilter");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.applyFilter=function(a,b,c){var d=a.filterManager.getRenderTarget(!0);this.blurXFilter.applyFilter(a,b,d);this.blurYFilter.applyFilter(a,d,c);a.filterManager.returnRenderTarget(d)};Object.defineProperties(a.prototype,
{blur:{get:function(){return this.blurXFilter.blur},set:function(a){this.padding=.5*Math.abs(a);this.blurXFilter.blur=this.blurYFilter.blur=a}},passes:{get:function(){return this.blurXFilter.passes},set:function(a){this.blurXFilter.passes=this.blurYFilter.passes=a}},blurX:{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=a}},blurY:{get:function(){return this.blurYFilter.blur},set:function(a){this.blurYFilter.blur=a}}})},{"../../core":23,"./BlurXFilter":84,"./BlurYFilter":85}],
84:[function(b,c,f){function a(){g.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(-0.012 * strength, 0.0);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(-0.008 * strength, 0.0);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(-0.004 * strength, 0.0);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2( 0.004 * strength, 0.0);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2( 0.008 * strength, 0.0);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2( 0.012 * strength, 0.0);\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n",
"precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",
{strength:{type:"1f",value:1}});this.passes=1;this.strength=4}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.applyFilter=function(a,b,c,d){var f=this.getShader(a);this.uniforms.strength.value=this.strength/4/this.passes*(b.frame.width/b.size.width);if(1===this.passes)a.filterManager.applyFilter(f,b,c,d);else{for(var g=a.filterManager.getRenderTarget(!0),w=g,p=0;p<this.passes-1;p++){a.filterManager.applyFilter(f,b,w,!0);
var v=w,w=b;b=v}a.filterManager.applyFilter(f,b,c,d);a.filterManager.returnRenderTarget(g)}};Object.defineProperties(a.prototype,{blur:{get:function(){return this.strength},set:function(a){this.padding=.5*Math.abs(a);this.strength=a}}})},{"../../core":23}],85:[function(b,c,f){function a(){g.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n",
"precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",
{strength:{type:"1f",value:1}});this.passes=1;this.strength=4}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.applyFilter=function(a,b,c,d){var f=this.getShader(a);this.uniforms.strength.value=Math.abs(this.strength)/4/this.passes*(b.frame.height/b.size.height);if(1===this.passes)a.filterManager.applyFilter(f,b,c,d);else{for(var g=a.filterManager.getRenderTarget(!0),w=g,p=0;p<this.passes-1;p++){a.filterManager.applyFilter(f,
b,w,!0);var v=w,w=b;b=v}a.filterManager.applyFilter(f,b,c,d);a.filterManager.returnRenderTarget(g)}};Object.defineProperties(a.prototype,{blur:{get:function(){return this.strength},set:function(a){this.padding=.5*Math.abs(a);this.strength=a}}})},{"../../core":23}],86:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 delta;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta * percent);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",
{delta:{type:"v2",value:{x:.1,y:0}}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a},{"../../core":23}],87:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[25];\n\nvoid main(void)\n{\n\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.r = (m[0] * c.r);\n        gl_FragColor.r += (m[1] * c.g);\n        gl_FragColor.r += (m[2] * c.b);\n        gl_FragColor.r += (m[3] * c.a);\n        gl_FragColor.r += m[4];\n\n    gl_FragColor.g = (m[5] * c.r);\n        gl_FragColor.g += (m[6] * c.g);\n        gl_FragColor.g += (m[7] * c.b);\n        gl_FragColor.g += (m[8] * c.a);\n        gl_FragColor.g += m[9];\n\n     gl_FragColor.b = (m[10] * c.r);\n        gl_FragColor.b += (m[11] * c.g);\n        gl_FragColor.b += (m[12] * c.b);\n        gl_FragColor.b += (m[13] * c.a);\n        gl_FragColor.b += m[14];\n\n     gl_FragColor.a = (m[15] * c.r);\n        gl_FragColor.a += (m[16] * c.g);\n        gl_FragColor.a += (m[17] * c.b);\n        gl_FragColor.a += (m[18] * c.a);\n        gl_FragColor.a += m[19];\n\n}\n",
{m:{type:"1fv",value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype._loadMatrix=function(a,b){var c=a;b&&(this._multiply(c,this.uniforms.m.value,a),c=this._colorMatrix(c));this.uniforms.m.value=c};a.prototype._multiply=function(a,b,c){a[0]=b[0]*c[0]+b[1]*c[5]+b[2]*c[10]+b[3]*c[15];a[1]=b[0]*c[1]+b[1]*c[6]+b[2]*c[11]+b[3]*c[16];a[2]=b[0]*c[2]+b[1]*c[7]+b[2]*c[12]+b[3]*c[17];a[3]=
b[0]*c[3]+b[1]*c[8]+b[2]*c[13]+b[3]*c[18];a[4]=b[0]*c[4]+b[1]*c[9]+b[2]*c[14]+b[3]*c[19];a[5]=b[5]*c[0]+b[6]*c[5]+b[7]*c[10]+b[8]*c[15];a[6]=b[5]*c[1]+b[6]*c[6]+b[7]*c[11]+b[8]*c[16];a[7]=b[5]*c[2]+b[6]*c[7]+b[7]*c[12]+b[8]*c[17];a[8]=b[5]*c[3]+b[6]*c[8]+b[7]*c[13]+b[8]*c[18];a[9]=b[5]*c[4]+b[6]*c[9]+b[7]*c[14]+b[8]*c[19];a[10]=b[10]*c[0]+b[11]*c[5]+b[12]*c[10]+b[13]*c[15];a[11]=b[10]*c[1]+b[11]*c[6]+b[12]*c[11]+b[13]*c[16];a[12]=b[10]*c[2]+b[11]*c[7]+b[12]*c[12]+b[13]*c[17];a[13]=b[10]*c[3]+b[11]*
c[8]+b[12]*c[13]+b[13]*c[18];a[14]=b[10]*c[4]+b[11]*c[9]+b[12]*c[14]+b[13]*c[19];a[15]=b[15]*c[0]+b[16]*c[5]+b[17]*c[10]+b[18]*c[15];a[16]=b[15]*c[1]+b[16]*c[6]+b[17]*c[11]+b[18]*c[16];a[17]=b[15]*c[2]+b[16]*c[7]+b[17]*c[12]+b[18]*c[17];a[18]=b[15]*c[3]+b[16]*c[8]+b[17]*c[13]+b[18]*c[18];a[19]=b[15]*c[4]+b[16]*c[9]+b[17]*c[14]+b[18]*c[19];return a};a.prototype._colorMatrix=function(a){a=new Float32Array(a);a[4]/=255;a[9]/=255;a[14]/=255;a[19]/=255;return a};a.prototype.brightness=function(a,b){this._loadMatrix([a,
0,0,0,0,0,a,0,0,0,0,0,a,0,0,0,0,0,1,0],b)};a.prototype.greyscale=function(a,b){this._loadMatrix([a,a,a,0,0,a,a,a,0,0,a,a,a,0,0,0,0,0,1,0],b)};a.prototype.grayscale=a.prototype.greyscale;a.prototype.blackAndWhite=function(a){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],a)};a.prototype.hue=function(a,b){a=(a||0)/180*Math.PI;var c=Math.cos(a),d=Math.sin(a);this._loadMatrix([.213+.787*c+-.213*d,.715+-.715*c+-.715*d,.072+-.072*c+.928*d,0,0,.213+-.213*c+.143*d,.715+c*(1-.715)+.14*
d,.072+-.072*c+-.283*d,0,0,.213+-.213*c+-.787*d,.715+-.715*c+.715*d,.072+.928*c+.072*d,0,0,0,0,0,1,0],b)};a.prototype.contrast=function(a,b){var c=(a||0)+1,d=-128*(c-1);this._loadMatrix([c,0,0,0,d,0,c,0,0,d,0,0,c,0,d,0,0,0,1,0],b)};a.prototype.saturate=function(a,b){var c=2*(a||0)/3+1,d=-.5*(c-1);this._loadMatrix([c,d,d,0,0,d,c,d,0,0,d,d,c,0,0,0,0,0,1,0],b)};a.prototype.desaturate=function(a){this.saturate(-1)};a.prototype.negative=function(a){this._loadMatrix([0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,
1,0],a)};a.prototype.sepia=function(a){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],a)};a.prototype.technicolor=function(a){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],a)};a.prototype.polaroid=function(a){this._loadMatrix([1.438,
-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],a)};a.prototype.toBGR=function(a){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],a)};a.prototype.kodachrome=function(a){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],a)};a.prototype.browni=function(a){this._loadMatrix([.5997023498159715,
.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],a)};a.prototype.vintage=function(a){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,
0,0,0,1,0],a)};a.prototype.colorTone=function(a,b,c,d,f){c=c||16770432;d=d||3375104;var g=(c>>16&255)/255,w=(c>>8&255)/255;c=(c&255)/255;var p=(d>>16&255)/255,v=(d>>8&255)/255;d=(d&255)/255;this._loadMatrix([.3,.59,.11,0,0,g,w,c,a||.2,0,p,v,d,b||.15,0,g-p,w-v,c-d,0,0],f)};a.prototype.night=function(a,b){a=a||.1;this._loadMatrix([-2*a,-a,0,0,0,-a,0,a,0,0,0,a,2*a,0,0,0,0,0,1,0],b)};a.prototype.predator=function(a,b){this._loadMatrix([11.224130630493164*a,-4.794486999511719*a,-2.8746118545532227*a,0*
a,.40342438220977783*a,-3.6330697536468506*a,9.193157196044922*a,-2.951810836791992*a,0*a,-1.316135048866272*a,-3.2184197902679443*a,-4.2375030517578125*a,7.476448059082031*a,0*a,.8044459223747253*a,0,0,0,1,0],b)};a.prototype.lsd=function(a){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],a)};a.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)};Object.defineProperties(a.prototype,{matrix:{get:function(){return this.uniforms.m.value},set:function(a){this.uniforms.m.value=
a}}})},{"../../core":23}],88:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float step;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    color = floor(color * step) / step;\n\n    gl_FragColor = color;\n}\n",{step:{type:"1f",value:5}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,
{step:{get:function(){return this.uniforms.step.value},set:function(a){this.uniforms.step.value=a}}})},{"../../core":23}],89:[function(b,c,f){function a(a,b,c){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying mediump vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 texelSize;\nuniform float matrix[9];\n\nvoid main(void)\n{\n   vec4 c11 = texture2D(uSampler, vTextureCoord - texelSize); // top left\n   vec4 c12 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - texelSize.y)); // top center\n   vec4 c13 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y - texelSize.y)); // top right\n\n   vec4 c21 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y)); // mid left\n   vec4 c22 = texture2D(uSampler, vTextureCoord); // mid center\n   vec4 c23 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y)); // mid right\n\n   vec4 c31 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y + texelSize.y)); // bottom left\n   vec4 c32 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + texelSize.y)); // bottom center\n   vec4 c33 = texture2D(uSampler, vTextureCoord + texelSize); // bottom right\n\n   gl_FragColor =\n       c11 * matrix[0] + c12 * matrix[1] + c13 * matrix[2] +\n       c21 * matrix[3] + c22 * matrix[4] + c23 * matrix[5] +\n       c31 * matrix[6] + c32 * matrix[7] + c33 * matrix[8];\n\n   gl_FragColor.a = c22.a;\n}\n",
{matrix:{type:"1fv",value:new Float32Array(a)},texelSize:{type:"v2",value:{x:1/b,y:1/c}}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{matrix:{get:function(){return this.uniforms.matrix.value},set:function(a){this.uniforms.matrix.value=new Float32Array(a)}},width:{get:function(){return 1/this.uniforms.texelSize.value.x},set:function(a){this.uniforms.texelSize.value.x=1/a}},height:{get:function(){return 1/
this.uniforms.texelSize.value.y},set:function(a){this.uniforms.texelSize.value.y=1/a}}})},{"../../core":23}],90:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\n    if (lum < 1.00)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.75)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.50)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.3)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n}\n")}
var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a},{"../../core":23}],91:[function(b,c,f){function a(a,b){var c=new g.Matrix;a.renderable=!1;g.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vMapCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n",
"precision mediump float;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nvoid main(void)\n{\n   vec4 map =  texture2D(mapSampler, vMapCoord);\n\n   map -= 0.5;\n   map.xy *= scale;\n\n   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y));\n}\n",{mapSampler:{type:"sampler2D",value:a.texture},otherMatrix:{type:"mat3",value:c.toArray(!0)},scale:{type:"v2",
value:{x:1,y:1}}});this.maskSprite=a;this.maskMatrix=c;if(null===b||void 0===b)b=20;this.scale=new g.Point(b,b)}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.applyFilter=function(a,b,c){var d=a.filterManager;d.calculateMappedMatrix(b.frame,this.maskSprite,this.maskMatrix);this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0);this.uniforms.scale.value.x=1/b.frame.width*this.scale.x;this.uniforms.scale.value.y=1/b.frame.height*
this.scale.y;a=this.getShader(a);d.applyFilter(a,b,c)};Object.defineProperties(a.prototype,{map:{get:function(){return this.uniforms.mapSampler.value},set:function(a){this.uniforms.mapSampler.value=a}}})},{"../../core":23}],92:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec4 dimensions;\nuniform sampler2D uSampler;\n\nuniform float angle;\nuniform float scale;\n\nfloat pattern()\n{\n   float s = sin(angle), c = cos(angle);\n   vec2 tex = vTextureCoord * dimensions.xy;\n   vec2 point = vec2(\n       c * tex.x - s * tex.y,\n       s * tex.x + c * tex.y\n   ) * scale;\n   return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\nvoid main()\n{\n   vec4 color = texture2D(uSampler, vTextureCoord);\n   float average = (color.r + color.g + color.b) / 3.0;\n   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\n}\n",
{scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{scale:{get:function(){return this.uniforms.scale.value},set:function(a){this.uniforms.scale.value=a}},angle:{get:function(){return this.uniforms.angle.value},set:function(a){this.uniforms.angle.value=a}}})},{"../../core":23}],93:[function(b,c,f){function a(){g.AbstractFilter.call(this,
"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform vec2 offset;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition+offset), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n",
"precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform vec3 color;\nuniform float alpha;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 sum = vec4(0.0);\n\n    sum += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    sum += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    sum += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    sum += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    sum += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n\n    gl_FragColor = vec4( color.rgb * sum.a * alpha, sum.a * alpha );\n}\n",
{blur:{type:"1f",value:1/512},color:{type:"c",value:[0,0,0]},alpha:{type:"1f",value:.7},offset:{type:"2f",value:[5,5]},strength:{type:"1f",value:1}});this.passes=1;this.strength=4}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.applyFilter=function(a,b,c,d){var f=this.getShader(a);this.uniforms.strength.value=this.strength/4/this.passes*(b.frame.height/b.size.height);if(1===this.passes)a.filterManager.applyFilter(f,b,c,
d);else{for(var g=a.filterManager.getRenderTarget(!0),w=g,p=0;p<this.passes-1;p++){a.filterManager.applyFilter(f,b,w,d);var v=w,w=b;b=v}a.filterManager.applyFilter(f,b,c,d);a.filterManager.returnRenderTarget(g)}};Object.defineProperties(a.prototype,{blur:{get:function(){return this.strength},set:function(a){this.padding=.5*a;this.strength=a}}})},{"../../core":23}],94:[function(b,c,f){function a(){g.AbstractFilter.call(this);this.blurXFilter=new e;this.blurYTintFilter=new k;this.defaultFilter=new g.AbstractFilter;
this.padding=30;this._dirtyPosition=!0;this._angle=45*Math.PI/180;this._distance=10;this.alpha=.75;this.hideObject=!1;this.blendMode=g.BLEND_MODES.MULTIPLY}var g=b("../../core"),e=b("../blur/BlurXFilter"),k=b("./BlurYTintFilter");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.applyFilter=function(a,b,c){var d=a.filterManager.getRenderTarget(!0);this._dirtyPosition&&(this._dirtyPosition=!1,this.blurYTintFilter.uniforms.offset.value[0]=Math.sin(this._angle)*
this._distance,this.blurYTintFilter.uniforms.offset.value[1]=Math.cos(this._angle)*this._distance);this.blurXFilter.applyFilter(a,b,d);a.blendModeManager.setBlendMode(this.blendMode);this.blurYTintFilter.applyFilter(a,d,c);a.blendModeManager.setBlendMode(g.BLEND_MODES.NORMAL);this.hideObject||this.defaultFilter.applyFilter(a,b,c);a.filterManager.returnRenderTarget(d)};Object.defineProperties(a.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=this.blurYTintFilter.blur=
a}},blurX:{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=a}},blurY:{get:function(){return this.blurYTintFilter.blur},set:function(a){this.blurYTintFilter.blur=a}},color:{get:function(){return g.utils.rgb2hex(this.blurYTintFilter.uniforms.color.value)},set:function(a){this.blurYTintFilter.uniforms.color.value=g.utils.hex2rgb(a)}},alpha:{get:function(){return this.blurYTintFilter.uniforms.alpha.value},set:function(a){this.blurYTintFilter.uniforms.alpha.value=a}},
distance:{get:function(){return this._distance},set:function(a){this._dirtyPosition=!0;this._distance=a}},angle:{get:function(){return this._angle},set:function(a){this._dirtyPosition=!0;this._angle=a}}})},{"../../core":23,"../blur/BlurXFilter":84,"./BlurYTintFilter":93}],95:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float gray;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);\n}\n",
{gray:{type:"1f",value:1}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{gray:{get:function(){return this.uniforms.gray.value},set:function(a){this.uniforms.gray.value=a}}})},{"../../core":23}],96:[function(b,c,f){c.exports={AsciiFilter:b("./ascii/AsciiFilter"),BloomFilter:b("./bloom/BloomFilter"),BlurFilter:b("./blur/BlurFilter"),BlurXFilter:b("./blur/BlurXFilter"),BlurYFilter:b("./blur/BlurYFilter"),
BlurDirFilter:b("./blur/BlurDirFilter"),ColorMatrixFilter:b("./color/ColorMatrixFilter"),ColorStepFilter:b("./color/ColorStepFilter"),ConvolutionFilter:b("./convolution/ConvolutionFilter"),CrossHatchFilter:b("./crosshatch/CrossHatchFilter"),DisplacementFilter:b("./displacement/DisplacementFilter"),DotScreenFilter:b("./dot/DotScreenFilter"),GrayFilter:b("./gray/GrayFilter"),DropShadowFilter:b("./dropshadow/DropShadowFilter"),InvertFilter:b("./invert/InvertFilter"),NoiseFilter:b("./noise/NoiseFilter"),
PixelateFilter:b("./pixelate/PixelateFilter"),RGBSplitFilter:b("./rgb/RGBSplitFilter"),ShockwaveFilter:b("./shockwave/ShockwaveFilter"),SepiaFilter:b("./sepia/SepiaFilter"),SmartBlurFilter:b("./blur/SmartBlurFilter"),TiltShiftFilter:b("./tiltshift/TiltShiftFilter"),TiltShiftXFilter:b("./tiltshift/TiltShiftXFilter"),TiltShiftYFilter:b("./tiltshift/TiltShiftYFilter"),TwistFilter:b("./twist/TwistFilter")}},{"./ascii/AsciiFilter":80,"./bloom/BloomFilter":81,"./blur/BlurDirFilter":82,"./blur/BlurFilter":83,
"./blur/BlurXFilter":84,"./blur/BlurYFilter":85,"./blur/SmartBlurFilter":86,"./color/ColorMatrixFilter":87,"./color/ColorStepFilter":88,"./convolution/ConvolutionFilter":89,"./crosshatch/CrossHatchFilter":90,"./displacement/DisplacementFilter":91,"./dot/DotScreenFilter":92,"./dropshadow/DropShadowFilter":94,"./gray/GrayFilter":95,"./invert/InvertFilter":97,"./noise/NoiseFilter":98,"./pixelate/PixelateFilter":99,"./rgb/RGBSplitFilter":100,"./sepia/SepiaFilter":101,"./shockwave/ShockwaveFilter":102,
"./tiltshift/TiltShiftFilter":104,"./tiltshift/TiltShiftXFilter":105,"./tiltshift/TiltShiftYFilter":106,"./twist/TwistFilter":107}],97:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform float invert;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);\n}\n",
{invert:{type:"1f",value:1}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{invert:{get:function(){return this.uniforms.invert.value},set:function(a){this.uniforms.invert.value=a}}})},{"../../core":23}],98:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float noise;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    float diff = (rand(vTextureCoord) - 0.5) * noise;\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    gl_FragColor = color;\n}\n",
{noise:{type:"1f",value:.5}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{noise:{get:function(){return this.uniforms.noise.value},set:function(a){this.uniforms.noise.value=a}}})},{"../../core":23}],99:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 dimensions;\nuniform vec2 pixelSize;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord;\n\n    vec2 size = dimensions.xy / pixelSize;\n\n    vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;\n\n    gl_FragColor = texture2D(uSampler, color);\n}\n",
{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"v2",value:{x:10,y:10}}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(a){this.uniforms.pixelSize.value=a}}})},{"../../core":23}],100:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 dimensions;\nuniform vec2 red;\nuniform vec2 green;\nuniform vec2 blue;\n\nvoid main(void)\n{\n   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;\n   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;\n   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;\n   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;\n}\n",
{red:{type:"v2",value:{x:20,y:20}},green:{type:"v2",value:{x:-20,y:20}},blue:{type:"v2",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{red:{get:function(){return this.uniforms.red.value},set:function(a){this.uniforms.red.value=a}},green:{get:function(){return this.uniforms.green.value},set:function(a){this.uniforms.green.value=a}},blue:{get:function(){return this.uniforms.blue.value},
set:function(a){this.uniforms.blue.value=a}}})},{"../../core":23}],101:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float sepia;\n\nconst mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);\n}\n",
{sepia:{type:"1f",value:1}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{sepia:{get:function(){return this.uniforms.sepia.value},set:function(a){this.uniforms.sepia.value=a}}})},{"../../core":23}],102:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform vec2 center;\nuniform vec3 params; // 10.0, 0.8, 0.1\nuniform float time;\n\nvoid main()\n{\n    vec2 uv = vTextureCoord;\n    vec2 texCoord = uv;\n\n    float dist = distance(uv, center);\n\n    if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )\n    {\n        float diff = (dist - time);\n        float powDiff = 1.0 - pow(abs(diff*params.x), params.y);\n\n        float diffTime = diff  * powDiff;\n        vec2 diffUV = normalize(uv - center);\n        texCoord = uv + (diffUV * diffTime);\n    }\n\n    gl_FragColor = texture2D(uSampler, texCoord);\n}\n",
{center:{type:"v2",value:{x:.5,y:.5}},params:{type:"v3",value:{x:10,y:.8,z:.1}},time:{type:"1f",value:0}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{center:{get:function(){return this.uniforms.center.value},set:function(a){this.uniforms.center.value=a}},params:{get:function(){return this.uniforms.params.value},set:function(a){this.uniforms.params.value=a}},time:{get:function(){return this.uniforms.time.value},
set:function(a){this.uniforms.time.value=a}}})},{"../../core":23}],103:[function(b,c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float blur;\nuniform float gradientBlur;\nuniform vec2 start;\nuniform vec2 end;\nuniform vec2 delta;\nuniform vec2 texSize;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",
{blur:{type:"1f",value:100},gradientBlur:{type:"1f",value:600},start:{type:"v2",value:{x:0,y:window.innerHeight/2}},end:{type:"v2",value:{x:600,y:window.innerHeight/2}},delta:{type:"v2",value:{x:30,y:30}},texSize:{type:"v2",value:{x:window.innerWidth,y:window.innerHeight}}});this.updateDelta()}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.updateDelta=function(){this.uniforms.delta.value.x=0;this.uniforms.delta.value.y=
0};Object.defineProperties(a.prototype,{blur:{get:function(){return this.uniforms.blur.value},set:function(a){this.uniforms.blur.value=a}},gradientBlur:{get:function(){return this.uniforms.gradientBlur.value},set:function(a){this.uniforms.gradientBlur.value=a}},start:{get:function(){return this.uniforms.start.value},set:function(a){this.uniforms.start.value=a;this.updateDelta()}},end:{get:function(){return this.uniforms.end.value},set:function(a){this.uniforms.end.value=a;this.updateDelta()}}})},
{"../../core":23}],104:[function(b,c,f){function a(){g.AbstractFilter.call(this);this.tiltShiftXFilter=new e;this.tiltShiftYFilter=new k}var g=b("../../core"),e=b("./TiltShiftXFilter"),k=b("./TiltShiftYFilter");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.applyFilter=function(a,b,c){var d=a.filterManager.getRenderTarget(!0);this.tiltShiftXFilter.applyFilter(a,b,d);this.tiltShiftYFilter.applyFilter(a,d,c);a.filterManager.returnRenderTarget(d)};
Object.defineProperties(a.prototype,{blur:{get:function(){return this.tiltShiftXFilter.blur},set:function(a){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=a}},gradientBlur:{get:function(){return this.tiltShiftXFilter.gradientBlur},set:function(a){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=a}},start:{get:function(){return this.tiltShiftXFilter.start},set:function(a){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=a}},end:{get:function(){return this.tiltShiftXFilter.end},
set:function(a){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=a}}})},{"../../core":23,"./TiltShiftXFilter":105,"./TiltShiftYFilter":106}],105:[function(b,c,f){function a(){g.call(this)}var g=b("./TiltShiftAxisFilter");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.updateDelta=function(){var a=this.uniforms.end.value.x-this.uniforms.start.value.x,b=this.uniforms.end.value.y-this.uniforms.start.value.y,c=Math.sqrt(a*a+b*b);this.uniforms.delta.value.x=
a/c;this.uniforms.delta.value.y=b/c}},{"./TiltShiftAxisFilter":103}],106:[function(b,c,f){function a(){g.call(this)}var g=b("./TiltShiftAxisFilter");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.updateDelta=function(){var a=this.uniforms.end.value.x-this.uniforms.start.value.x,b=this.uniforms.end.value.y-this.uniforms.start.value.y,c=Math.sqrt(a*a+b*b);this.uniforms.delta.value.x=-b/c;this.uniforms.delta.value.y=a/c}},{"./TiltShiftAxisFilter":103}],107:[function(b,
c,f){function a(){g.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\n\nvoid main(void)\n{\n   vec2 coord = vTextureCoord - offset;\n   float dist = length(coord);\n\n   if (dist < radius)\n   {\n       float ratio = (radius - dist) / radius;\n       float angleMod = ratio * ratio * angle;\n       float s = sin(angleMod);\n       float c = cos(angleMod);\n       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n   }\n\n   gl_FragColor = texture2D(uSampler, coord+offset);\n}\n",
{radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"v2",value:{x:.5,y:.5}}})}var g=b("../../core");a.prototype=Object.create(g.AbstractFilter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{offset:{get:function(){return this.uniforms.offset.value},set:function(a){this.uniforms.offset.value=a}},radius:{get:function(){return this.uniforms.radius.value},set:function(a){this.uniforms.radius.value=a}},angle:{get:function(){return this.uniforms.angle.value},
set:function(a){this.uniforms.angle.value=a}}})},{"../../core":23}],108:[function(b,c,f){f="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{};b("./polyfill");c=c.exports=b("./core");c.extras=b("./extras");c.filters=b("./filters");c.interaction=b("./interaction");c.loaders=b("./loaders");c.mesh=b("./mesh");c.accessibility=b("./accessibility");c.loader=new c.loaders.Loader;Object.assign(c,b("./deprecation"));f.PIXI=c},{"./accessibility":15,"./core":23,
"./deprecation":72,"./extras":79,"./filters":96,"./interaction":111,"./loaders":114,"./mesh":121,"./polyfill":126}],109:[function(b,c,f){function a(){this.global=new g.Point;this.originalEvent=this.target=null}var g=b("../core");a.prototype.constructor=a;c.exports=a;a.prototype.getLocalPosition=function(a,b,c){return a.worldTransform.applyInverse(c||this.global,b)}},{"../core":23}],110:[function(b,c,f){function a(a,b){b=b||{};this.renderer=a;this.autoPreventDefault=void 0!==b.autoPreventDefault?b.autoPreventDefault:
!0;this.interactionFrequency=b.interactionFrequency||10;this.mouse=new e;this.eventData={stopped:!1,target:null,type:null,data:this.mouse,stopPropagation:function(){this.stopped=!0}};this.interactiveDataPool=[];this.interactionDOMElement=null;this.eventsAdded=!1;this.onMouseUp=this.onMouseUp.bind(this);this.processMouseUp=this.processMouseUp.bind(this);this.onMouseDown=this.onMouseDown.bind(this);this.processMouseDown=this.processMouseDown.bind(this);this.onMouseMove=this.onMouseMove.bind(this);this.processMouseMove=
this.processMouseMove.bind(this);this.onMouseOut=this.onMouseOut.bind(this);this.processMouseOverOut=this.processMouseOverOut.bind(this);this.onTouchStart=this.onTouchStart.bind(this);this.processTouchStart=this.processTouchStart.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.processTouchEnd=this.processTouchEnd.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.processTouchMove=this.processTouchMove.bind(this);this.last=0;this.currentCursorStyle="inherit";this._tempPoint=new g.Point;
this.resolution=1;this.setTargetElement(this.renderer.view,this.renderer.resolution)}var g=b("../core"),e=b("./InteractionData");Object.assign(g.DisplayObject.prototype,b("./interactiveTarget"));a.prototype.constructor=a;c.exports=a;a.prototype.setTargetElement=function(a,b){this.removeEvents();this.interactionDOMElement=a;this.resolution=b||1;this.addEvents()};a.prototype.addEvents=function(){this.interactionDOMElement&&(g.ticker.shared.add(this.update,this),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]=
"none",this.interactionDOMElement.style["-ms-touch-action"]="none"),window.document.addEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.addEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.addEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.addEventListener("touchmove",this.onTouchMove,
!0),window.addEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!0)};a.prototype.removeEvents=function(){this.interactionDOMElement&&(g.ticker.shared.remove(this.update),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""),window.document.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",
this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!1)};a.prototype.update=function(a){this._deltaTime+=a;this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.interactionDOMElement&&
(this.didMove?this.didMove=!1:(this.cursor="inherit",this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor))))};a.prototype.dispatchEvent=function(a,b,c){if(!c.stopped&&(c.target=a,c.type=b,a.emit(b,c),a[b]))a[b](c)};a.prototype.mapPositionToPoint=function(a,b,c){var d;try{d=this.interactionDOMElement.getBoundingClientRect()}catch(e){d=
{left:0,top:0}}a.x=this.interactionDOMElement.width/d.width*(b-d.left)/this.resolution;a.y=this.interactionDOMElement.height/d.height*(c-d.top)/this.resolution};a.prototype.processInteractive=function(a,b,c,d,e){if(!b||!b.visible)return!1;var f=!1,g=e=b.interactive||e;b.hitArea&&(g=!1);if(b.interactiveChildren)for(var v=b.children,r=v.length-1;0<=r;r--){var u=v[r];this.processInteractive(a,u,c,d,g)&&u.parent&&(f=!0,d=g=!1)}e&&(d&&!f&&(b.hitArea?(b.worldTransform.applyInverse(a,this._tempPoint),f=
b.hitArea.contains(this._tempPoint.x,this._tempPoint.y)):b.containsPoint&&(f=b.containsPoint(a))),b.interactive&&c(b,f));return f};a.prototype.onMouseDown=function(a){this.mouse.originalEvent=a;this.eventData.data=this.mouse;this.eventData.stopped=!1;this.mapPositionToPoint(this.mouse.global,a.clientX,a.clientY);this.autoPreventDefault&&this.mouse.originalEvent.preventDefault();this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseDown,!0)};a.prototype.processMouseDown=
function(a,b){var c=this.mouse.originalEvent,c=2===c.button||3===c.which;b&&(a[c?"_isRightDown":"_isLeftDown"]=!0,this.dispatchEvent(a,c?"rightdown":"mousedown",this.eventData))};a.prototype.onMouseUp=function(a){this.mouse.originalEvent=a;this.eventData.data=this.mouse;this.eventData.stopped=!1;this.mapPositionToPoint(this.mouse.global,a.clientX,a.clientY);this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseUp,!0)};a.prototype.processMouseUp=function(a,b){var c=
this.mouse.originalEvent,d=(c=2===c.button||3===c.which)?"_isRightDown":"_isLeftDown";b?(this.dispatchEvent(a,c?"rightup":"mouseup",this.eventData),a[d]&&(a[d]=!1,this.dispatchEvent(a,c?"rightclick":"click",this.eventData))):a[d]&&(a[d]=!1,this.dispatchEvent(a,c?"rightupoutside":"mouseupoutside",this.eventData))};a.prototype.onMouseMove=function(a){this.mouse.originalEvent=a;this.eventData.data=this.mouse;this.eventData.stopped=!1;this.mapPositionToPoint(this.mouse.global,a.clientX,a.clientY);this.didMove=
!0;this.cursor="inherit";this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseMove,!0);this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)};a.prototype.processMouseMove=function(a,b){this.dispatchEvent(a,"mousemove",this.eventData);this.processMouseOverOut(a,b)};a.prototype.onMouseOut=function(a){this.mouse.originalEvent=a;this.eventData.stopped=!1;this.mapPositionToPoint(this.mouse.global,
a.clientX,a.clientY);this.interactionDOMElement.style.cursor="inherit";this.mapPositionToPoint(this.mouse.global,a.clientX,a.clientY);this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!1)};a.prototype.processMouseOverOut=function(a,b){b?(a._over||(a._over=!0,this.dispatchEvent(a,"mouseover",this.eventData)),a.buttonMode&&(this.cursor=a.defaultCursor)):a._over&&(a._over=!1,this.dispatchEvent(a,"mouseout",this.eventData))};a.prototype.onTouchStart=
function(a){this.autoPreventDefault&&a.preventDefault();for(var b=a.changedTouches,c=b.length,d=0;d<c;d++){var e=this.getTouchData(b[d]);e.originalEvent=a;this.eventData.data=e;this.eventData.stopped=!1;this.processInteractive(e.global,this.renderer._lastObjectRendered,this.processTouchStart,!0);this.returnTouchData(e)}};a.prototype.processTouchStart=function(a,b){b&&(a._touchDown=!0,this.dispatchEvent(a,"touchstart",this.eventData))};a.prototype.onTouchEnd=function(a){this.autoPreventDefault&&a.preventDefault();
for(var b=a.changedTouches,c=b.length,d=0;d<c;d++){var e=this.getTouchData(b[d]);e.originalEvent=a;this.eventData.data=e;this.eventData.stopped=!1;this.processInteractive(e.global,this.renderer._lastObjectRendered,this.processTouchEnd,!0);this.returnTouchData(e)}};a.prototype.processTouchEnd=function(a,b){b?(this.dispatchEvent(a,"touchend",this.eventData),a._touchDown&&(a._touchDown=!1,this.dispatchEvent(a,"tap",this.eventData))):a._touchDown&&(a._touchDown=!1,this.dispatchEvent(a,"touchendoutside",
this.eventData))};a.prototype.onTouchMove=function(a){this.autoPreventDefault&&a.preventDefault();for(var b=a.changedTouches,c=b.length,d=0;d<c;d++){var e=this.getTouchData(b[d]);e.originalEvent=a;this.eventData.data=e;this.eventData.stopped=!1;this.processInteractive(e.global,this.renderer._lastObjectRendered,this.processTouchMove,!0);this.returnTouchData(e)}};a.prototype.processTouchMove=function(a,b){this.dispatchEvent(a,"touchmove",this.eventData)};a.prototype.getTouchData=function(a){var b=this.interactiveDataPool.pop();
b||(b=new e);b.identifier=a.identifier;this.mapPositionToPoint(b.global,a.clientX,a.clientY);navigator.isCocoonJS&&(b.global.x/=this.resolution,b.global.y/=this.resolution);a.globalX=b.global.x;a.globalY=b.global.y;return b};a.prototype.returnTouchData=function(a){this.interactiveDataPool.push(a)};a.prototype.destroy=function(){this.removeEvents();this._tempPoint=this.processTouchMove=this.onTouchMove=this.processTouchEnd=this.onTouchEnd=this.processTouchStart=this.onTouchStart=this.processMouseOverOut=
this.onMouseOut=this.processMouseMove=this.onMouseMove=this.processMouseDown=this.onMouseDown=this.processMouseUp=this.onMouseUp=this.interactionDOMElement=this.interactiveDataPool=this.eventData=this.mouse=this.renderer=null};g.WebGLRenderer.registerPlugin("interaction",a);g.CanvasRenderer.registerPlugin("interaction",a)},{"../core":23,"./InteractionData":109,"./interactiveTarget":112}],111:[function(b,c,f){c.exports={InteractionData:b("./InteractionData"),InteractionManager:b("./InteractionManager"),
interactiveTarget:b("./interactiveTarget")}},{"./InteractionData":109,"./InteractionManager":110,"./interactiveTarget":112}],112:[function(b,c,f){c.exports={interactive:!1,buttonMode:!1,interactiveChildren:!0,defaultCursor:"pointer",_over:!1,_touchDown:!1}},{}],113:[function(b,c,f){function a(a,b){var c={},d=a.data.getElementsByTagName("info")[0],h=a.data.getElementsByTagName("common")[0];c.font=d.getAttribute("face");c.size=parseInt(d.getAttribute("size"),10);c.lineHeight=parseInt(h.getAttribute("lineHeight"),
10);c.chars={};h=a.data.getElementsByTagName("char");for(d=0;d<h.length;d++){var f=parseInt(h[d].getAttribute("id"),10),g=new e.Rectangle(parseInt(h[d].getAttribute("x"),10)+b.frame.x,parseInt(h[d].getAttribute("y"),10)+b.frame.y,parseInt(h[d].getAttribute("width"),10),parseInt(h[d].getAttribute("height"),10));c.chars[f]={xOffset:parseInt(h[d].getAttribute("xoffset"),10),yOffset:parseInt(h[d].getAttribute("yoffset"),10),xAdvance:parseInt(h[d].getAttribute("xadvance"),10),kerning:{},texture:new e.Texture(b.baseTexture,
g)}}h=a.data.getElementsByTagName("kerning");for(d=0;d<h.length;d++){var f=parseInt(h[d].getAttribute("first"),10),g=parseInt(h[d].getAttribute("second"),10),u=parseInt(h[d].getAttribute("amount"),10);c.chars[g].kerning[f]=u}a.bitmapFont=c;k.BitmapText.fonts[c.font]=c}var g=b("resource-loader").Resource,e=b("../core"),k=b("../extras"),h=b("path");c.exports=function(){return function(b,c){if(!b.data||!b.isXml||0===b.data.getElementsByTagName("page").length||0===b.data.getElementsByTagName("info").length||
null===b.data.getElementsByTagName("info")[0].getAttribute("face"))return c();var d=h.dirname(b.url);"."===d&&(d="");this.baseUrl&&d&&("/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(d+="/"),d=d.replace(this.baseUrl,""));d&&"/"!==d.charAt(d.length-1)&&(d+="/");d+=b.data.getElementsByTagName("page")[0].getAttribute("file");e.utils.TextureCache[d]?(a(b,e.utils.TextureCache[d]),c()):this.add(b.name+"_image",d,{crossOrigin:b.crossOrigin,loadType:g.LOAD_TYPE.IMAGE,metadata:b.metadata.imageMetadata},
function(d){a(b,d.texture);c()})}}},{"../core":23,"../extras":79,path:2,"resource-loader":133}],114:[function(b,c,f){c.exports={Loader:b("./loader"),bitmapFontParser:b("./bitmapFontParser"),spritesheetParser:b("./spritesheetParser"),textureParser:b("./textureParser"),Resource:b("resource-loader").Resource}},{"./bitmapFontParser":113,"./loader":115,"./spritesheetParser":116,"./textureParser":117,"resource-loader":133}],115:[function(b,c,f){function a(b,c){g.call(this,b,c);for(var d=0;d<a._pixiMiddleware.length;++d)this.use(a._pixiMiddleware[d]())}
var g=b("resource-loader");f=b("./textureParser");var e=b("./spritesheetParser");b=b("./bitmapFontParser");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a._pixiMiddleware=[g.middleware.parsing.blob,f,e,b];a.addPixiMiddleware=function(b){a._pixiMiddleware.push(b)};c=g.Resource;c.setExtensionXhrType("fnt",c.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":113,"./spritesheetParser":116,"./textureParser":117,"resource-loader":133}],116:[function(b,c,f){var a=b("resource-loader").Resource,
g=b("path"),e=b("../core");c.exports=function(){return function(b,c){if(!b.data||!b.isJson||!b.data.frames)return c();var d={crossOrigin:b.crossOrigin,loadType:a.LOAD_TYPE.IMAGE,metadata:b.metadata.imageMetadata},f=g.dirname(b.url.replace(this.baseUrl,"")),q=e.utils.getResolutionOfUrl(b.url);this.add(b.name+"_image",f+"/"+b.data.meta.image,d,function(a){b.textures={};var d=b.data.frames,f;for(f in d){var g=d[f].frame;if(g){var m=null,g=d[f].rotated?new e.Rectangle(g.x,g.y,g.h,g.w):new e.Rectangle(g.x,
g.y,g.w,g.h);d[f].trimmed&&(m=new e.Rectangle(d[f].spriteSourceSize.x/q,d[f].spriteSourceSize.y/q,d[f].sourceSize.w/q,d[f].sourceSize.h/q));if(d[f].rotated){var n=g.width;g.width=g.height;g.height=n}g.x/=q;g.y/=q;g.width/=q;g.height/=q;b.textures[f]=new e.Texture(a.texture.baseTexture,g,g.clone(),m,d[f].rotated);e.utils.TextureCache[f]=b.textures[f]}}c()})}}},{"../core":23,path:2,"resource-loader":133}],117:[function(b,c,f){var a=b("../core");c.exports=function(){return function(b,c){if(b.data&&b.isImage){var d=
new a.BaseTexture(b.data,null,a.utils.getResolutionOfUrl(b.url));d.imageUrl=b.url;b.texture=new a.Texture(d);a.utils.BaseTextureCache[b.url]=d;a.utils.TextureCache[b.url]=b.texture}c()}}},{"../core":23}],118:[function(b,c,f){function a(b,c,d,e,f){g.Container.call(this);this._texture=null;this.uvs=d||new Float32Array([0,0,1,0,1,1,0,1]);this.vertices=c||new Float32Array([0,0,100,0,100,100,0,100]);this.indices=e||new Uint16Array([0,1,3,2]);this.dirty=!0;this.blendMode=g.BLEND_MODES.NORMAL;this.canvasPadding=
0;this.drawMode=f||a.DRAW_MODES.TRIANGLE_MESH;this.texture=b;this.shader=null}var g=b("../core"),e=new g.Point,k=new g.Polygon;a.prototype=Object.create(g.Container.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{texture:{get:function(){return this._texture},set:function(a){if(this._texture!==a&&(this._texture=a))if(a.baseTexture.hasLoaded)this._onTextureUpdate();else a.once("update",this._onTextureUpdate,this)}}});a.prototype._renderWebGL=function(a){a.setObjectRenderer(a.plugins.mesh);
a.plugins.mesh.render(this)};a.prototype._renderCanvas=function(b){var c=b.context,d=this.worldTransform;b.roundPixels?c.setTransform(d.a,d.b,d.c,d.d,d.tx|0,d.ty|0):c.setTransform(d.a,d.b,d.c,d.d,d.tx,d.ty);this.drawMode===a.DRAW_MODES.TRIANGLE_MESH?this._renderCanvasTriangleMesh(c):this._renderCanvasTriangles(c)};a.prototype._renderCanvasTriangleMesh=function(a){for(var b=this.vertices,c=this.uvs,d=b.length/2,e=0;e<d-2;e++){var f=2*e;this._renderCanvasDrawTriangle(a,b,c,f,f+2,f+4)}};a.prototype._renderCanvasTriangles=
function(a){for(var b=this.vertices,c=this.uvs,d=this.indices,e=d.length,f=0;f<e;f+=3)this._renderCanvasDrawTriangle(a,b,c,2*d[f],2*d[f+1],2*d[f+2])};a.prototype._renderCanvasDrawTriangle=function(a,b,c,d,e,f){var g=this._texture.baseTexture.source,k=this._texture.baseTexture.width,u=this._texture.baseTexture.height,t=b[d],D=b[e],G=b[f],A=b[d+1],z=b[e+1];b=b[f+1];var C=c[d]*k,I=c[e]*k,k=c[f]*k;d=c[d+1]*u;e=c[e+1]*u;c=c[f+1]*u;if(0<this.canvasPadding){f=this.canvasPadding/this.worldTransform.a;var u=
this.canvasPadding/this.worldTransform.d,M=(t+D+G)/3,N=(A+z+b)/3,L=t-M,J=A-N,B=Math.sqrt(L*L+J*J),t=M+L/B*(B+f),A=N+J/B*(B+u),L=D-M,J=z-N,B=Math.sqrt(L*L+J*J),D=M+L/B*(B+f),z=N+J/B*(B+u),L=G-M,J=b-N,B=Math.sqrt(L*L+J*J),G=M+L/B*(B+f);b=N+J/B*(B+u)}a.save();a.beginPath();a.moveTo(t,A);a.lineTo(D,z);a.lineTo(G,b);a.closePath();a.clip();f=C*e+d*k+I*c-e*k-d*I-C*c;a.transform((t*e+d*G+D*c-e*G-d*D-t*c)/f,(A*e+d*b+z*c-e*b-d*z-A*c)/f,(C*D+t*k+I*G-D*k-t*I-C*G)/f,(C*z+A*k+I*b-z*k-A*I-C*b)/f,(C*e*G+d*D*k+t*
I*c-t*e*k-d*I*G-C*D*c)/f,(C*e*b+d*z*k+A*I*c-A*e*k-d*I*b-C*z*c)/f);a.drawImage(g,0,0);a.restore()};a.prototype.renderMeshFlat=function(a){var b=this.context;a=a.vertices;var c=a.length/2;b.beginPath();for(var d=1;d<c-2;d++){var e=2*d,f=a[e+2],g=a[e+4],k=a[e+3],u=a[e+5];b.moveTo(a[e],a[e+1]);b.lineTo(f,k);b.lineTo(g,u)}b.fillStyle="#FF0000";b.fill();b.closePath()};a.prototype._onTextureUpdate=function(){this.updateFrame=!0};a.prototype.getBounds=function(a){if(!this._currentBounds){var b=a||this.worldTransform;
a=b.a;for(var c=b.b,d=b.c,e=b.d,f=b.tx,k=b.ty,r=b=-Infinity,u=Infinity,t=Infinity,D=this.vertices,G=0,A=D.length;G<A;G+=2)var z=D[G],C=D[G+1],I=a*z+d*C+f,z=e*C+c*z+k,u=I<u?I:u,t=z<t?z:t,b=I>b?I:b,r=z>r?z:r;if(-Infinity===u||Infinity===r)return g.Rectangle.EMPTY;a=this._bounds;a.x=u;a.width=b-u;a.y=t;a.height=r-t;this._currentBounds=a}return this._currentBounds};a.prototype.containsPoint=function(b){if(!this.getBounds().contains(b.x,b.y))return!1;this.worldTransform.applyInverse(b,e);b=this.vertices;
var c=k.points,d,f;if(this.drawMode===a.DRAW_MODES.TRIANGLES){var g=this.indices;f=this.indices.length;for(d=0;d<f;d+=3){var p=2*g[d],v=2*g[d+1],r=2*g[d+2];c[0]=b[p];c[1]=b[p+1];c[2]=b[v];c[3]=b[v+1];c[4]=b[r];c[5]=b[r+1];if(k.contains(e.x,e.y))return!0}}else for(f=b.length,d=0;d<f;d+=6)if(c[0]=b[d],c[1]=b[d+1],c[2]=b[d+2],c[3]=b[d+3],c[4]=b[d+4],c[5]=b[d+5],k.contains(e.x,e.y))return!0;return!1};a.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":23}],119:[function(b,c,f){function a(a,b,c){g.call(this,
a);this._ready=!0;this.segmentsX=b||10;this.segmentsY=c||10;this.drawMode=g.DRAW_MODES.TRIANGLES;this.refresh()}var g=b("./Mesh");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.refresh=function(){for(var a=this.segmentsX*this.segmentsY,b=[],c=[],d=[],f=this.texture,g=this.segmentsX-1,w=this.segmentsY-1,p=f.width/g,v=f.height/w,f=0;f<a;f++){var r=f%this.segmentsX,u=f/this.segmentsX|0;b.push(r*p,u*v);c.push(r/(this.segmentsX-1),u/(this.segmentsY-1))}a=g*w;for(f=
0;f<a;f++)w=f%g,p=f/g|0,v=p*this.segmentsX+w+1,r=(p+1)*this.segmentsX+w,u=(p+1)*this.segmentsX+w+1,d.push(p*this.segmentsX+w,v,r),d.push(v,u,r);this.vertices=new Float32Array(b);this.uvs=new Float32Array(c);this.colors=new Float32Array([]);this.indices=new Uint16Array(d)};a.prototype._onTextureUpdate=function(){g.prototype._onTextureUpdate.call(this);this._ready&&this.refresh()}},{"./Mesh":118}],120:[function(b,c,f){function a(a,b){g.call(this,a);this.points=b;this.vertices=new Float32Array(4*b.length);
this.uvs=new Float32Array(4*b.length);this.colors=new Float32Array(2*b.length);this.indices=new Uint16Array(2*b.length);this._ready=!0;this.refresh()}var g=b("./Mesh"),e=b("../core");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.refresh=function(){var a=this.points;if(!(1>a.length)&&this._texture._uvs){var b=this.uvs,c=this.indices,d=this.colors,f=this._texture._uvs,g=new e.Point(f.x0,f.y0),f=new e.Point(f.x2-f.x0,f.y2-f.y0);b[0]=0+g.x;b[1]=0+g.y;b[2]=0+
g.x;b[3]=1*f.y+g.y;d[0]=1;d[1]=1;c[0]=0;c[1]=1;for(var a=a.length,p,v,r=1;r<a;r++)p=4*r,v=r/(a-1),b[p]=v*f.x+g.x,b[p+1]=0+g.y,b[p+2]=v*f.x+g.x,b[p+3]=1*f.y+g.y,p=2*r,d[p]=1,d[p+1]=1,p=2*r,c[p]=p,c[p+1]=p+1;this.dirty=!0}};a.prototype._onTextureUpdate=function(){g.prototype._onTextureUpdate.call(this);this._ready&&this.refresh()};a.prototype.updateTransform=function(){var a=this.points;if(!(1>a.length)){for(var b=a[0],c,d,e=this.vertices,f=a.length,g,v,r,u=0;u<f;u++)g=a[u],v=4*u,c=u<a.length-1?a[u+
1]:g,d=-(c.x-b.x),b=c.y-b.y,c=Math.sqrt(b*b+d*d),r=this._texture.height/2,b/=c,d/=c,b*=r,d*=r,e[v]=g.x+b,e[v+1]=g.y+d,e[v+2]=g.x-b,e[v+3]=g.y-d,b=g;this.containerUpdateTransform()}}},{"../core":23,"./Mesh":118}],121:[function(b,c,f){c.exports={Mesh:b("./Mesh"),Plane:b("./Plane"),Rope:b("./Rope"),MeshRenderer:b("./webgl/MeshRenderer"),MeshShader:b("./webgl/MeshShader")}},{"./Mesh":118,"./Plane":119,"./Rope":120,"./webgl/MeshRenderer":122,"./webgl/MeshShader":123}],122:[function(b,c,f){function a(a){g.ObjectRenderer.call(this,
a);this.indices=new Uint16Array(15E3);for(var b=a=0;15E3>a;a+=6,b+=4)this.indices[a+0]=b+0,this.indices[a+1]=b+1,this.indices[a+2]=b+2,this.indices[a+3]=b+0,this.indices[a+4]=b+2,this.indices[a+5]=b+3;this.currentShader=null}var g=b("../../core"),e=b("../Mesh");a.prototype=Object.create(g.ObjectRenderer.prototype);a.prototype.constructor=a;c.exports=a;g.WebGLRenderer.registerPlugin("mesh",a);a.prototype.onContextChange=function(){};a.prototype.render=function(a){a._vertexBuffer||this._initWebGL(a);
var b=this.renderer,c=b.gl,d=a._texture.baseTexture,f=a.shader,g=a.drawMode===e.DRAW_MODES.TRIANGLE_MESH?c.TRIANGLE_STRIP:c.TRIANGLES;b.blendModeManager.setBlendMode(a.blendMode);f=f?f.shaders[c.id]||f.getShader(b):b.shaderManager.plugins.meshShader;this.renderer.shaderManager.setShader(f);f.uniforms.translationMatrix.value=a.worldTransform.toArray(!0);f.uniforms.projectionMatrix.value=b.currentRenderTarget.projectionMatrix.toArray(!0);f.uniforms.alpha.value=a.worldAlpha;f.syncUniforms();a.dirty?
(a.dirty=!1,c.bindBuffer(c.ARRAY_BUFFER,a._vertexBuffer),c.bufferData(c.ARRAY_BUFFER,a.vertices,c.STATIC_DRAW),c.vertexAttribPointer(f.attributes.aVertexPosition,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,a._uvBuffer),c.bufferData(c.ARRAY_BUFFER,a.uvs,c.STATIC_DRAW),c.vertexAttribPointer(f.attributes.aTextureCoord,2,c.FLOAT,!1,0,0),c.activeTexture(c.TEXTURE0),d._glTextures[c.id]?c.bindTexture(c.TEXTURE_2D,d._glTextures[c.id]):this.renderer.updateTexture(d),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a._indexBuffer),
c.bufferData(c.ELEMENT_ARRAY_BUFFER,a.indices,c.STATIC_DRAW)):(c.bindBuffer(c.ARRAY_BUFFER,a._vertexBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,a.vertices),c.vertexAttribPointer(f.attributes.aVertexPosition,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,a._uvBuffer),c.vertexAttribPointer(f.attributes.aTextureCoord,2,c.FLOAT,!1,0,0),c.activeTexture(c.TEXTURE0),d._glTextures[c.id]?c.bindTexture(c.TEXTURE_2D,d._glTextures[c.id]):this.renderer.updateTexture(d),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a._indexBuffer),
c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,a.indices));c.drawElements(g,a.indices.length,c.UNSIGNED_SHORT,0)};a.prototype._initWebGL=function(a){var b=this.renderer.gl;a._vertexBuffer=b.createBuffer();a._indexBuffer=b.createBuffer();a._uvBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,a._vertexBuffer);b.bufferData(b.ARRAY_BUFFER,a.vertices,b.DYNAMIC_DRAW);b.bindBuffer(b.ARRAY_BUFFER,a._uvBuffer);b.bufferData(b.ARRAY_BUFFER,a.uvs,b.STATIC_DRAW);a.colors&&(a._colorBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,
a._colorBuffer),b.bufferData(b.ARRAY_BUFFER,a.colors,b.STATIC_DRAW));b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a._indexBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.indices,b.STATIC_DRAW)};a.prototype.flush=function(){};a.prototype.start=function(){this.currentShader=null};a.prototype.destroy=function(){g.ObjectRenderer.prototype.destroy.call(this)}},{"../../core":23,"../Mesh":118}],123:[function(b,c,f){function a(a){g.Shader.call(this,a,"precision lowp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat3 translationMatrix;\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}",
"precision lowp float;\nvarying vec2 vTextureCoord;\nuniform float alpha;\nuniform sampler2D uSampler;\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * alpha ;\n}",{alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aTextureCoord:0})}var g=b("../../core");a.prototype=Object.create(g.Shader.prototype);a.prototype.constructor=a;c.exports=a;g.ShaderManager.registerPlugin("meshShader",
a)},{"../../core":23}],124:[function(b,c,f){Math.sign||(Math.sign=function(a){a=+a;return 0===a||isNaN(a)?a:0<a?1:-1})},{}],125:[function(b,c,f){Object.assign||(Object.assign=b("object-assign"))},{"object-assign":11}],126:[function(b,c,f){b("./Object.assign");b("./requestAnimationFrame");b("./Math.sign")},{"./Math.sign":124,"./Object.assign":125,"./requestAnimationFrame":127}],127:[function(b,c,f){(function(a){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()});if(!a.performance||
!a.performance.now){var b=Date.now();a.performance||(a.performance={});a.performance.now=function(){return Date.now()-b}}for(var c=Date.now(),d=["ms","moz","webkit","o"],f=0;f<d.length&&!a.requestAnimationFrame;++f)a.requestAnimationFrame=a[d[f]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[d[f]+"CancelAnimationFrame"]||a[d[f]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(a){if("function"!==typeof a)throw new TypeError(a+"is not a function");var b=Date.now(),
d=16+c-b;0>d&&(d=0);c=b;return setTimeout(function(){c=Date.now();a(performance.now())},d)});a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)})}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],128:[function(b,c,f){(function(a){(function(){function b(a){var c=!1;return function(){if(c)throw Error("Callback was already called.");c=!0;a.apply(f,arguments)}}var e={},f,h;f=this;null!=f&&(h=f.async);e.noConflict=
function(){f.async=h;return e};var m=Object.prototype.toString,n=Array.isArray||function(a){return"[object Array]"===m.call(a)},q=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},w=function(a,b){if(a.map)return a.map(b);var c=[];q(a,function(a,d,e){c.push(b(a,d,e))});return c},p=function(a,b,c){if(a.reduce)return a.reduce(b,c);q(a,function(a,d,e){c=b(c,a,d,e)});return c},v=function(a){if(Object.keys)return Object.keys(a);var b=[],c;for(c in a)a.hasOwnProperty(c)&&
b.push(c);return b};"undefined"!==typeof a&&a.nextTick?(e.nextTick=a.nextTick,e.setImmediate="undefined"!==typeof setImmediate?function(a){setImmediate(a)}:e.nextTick):(e.nextTick="function"===typeof setImmediate?function(a){setImmediate(a)}:function(a){setTimeout(a,0)},e.setImmediate=e.nextTick);e.each=function(a,c,d){function e(b){b?(d(b),d=function(){}):(f+=1,f>=a.length&&d())}d=d||function(){};if(!a.length)return d();var f=0;q(a,function(a){c(a,b(e))})};e.forEach=e.each;e.eachSeries=function(a,
b,c){c=c||function(){};if(!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c():e())})};e()};e.forEachSeries=e.eachSeries;e.eachLimit=function(a,b,c,d){r(b).apply(null,[a,c,d])};e.forEachLimit=e.eachLimit;var r=function(a){return function(b,c,d){d=d||function(){};if(!b.length||0>=a)return d();var e=0,f=0,g=0;(function H(){if(e>=b.length)return d();for(;g<a&&f<b.length;)f+=1,g+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,--g,e>=b.length?
d():H())})})()}},u=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[e.each].concat(b))}},t=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[r(a)].concat(c))}},D=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[e.eachSeries].concat(b))}},G=function(a,b,c,d){b=w(b,function(a,b){return{index:b,value:a}});if(d){var e=[];a(b,function(a,b){c(a.value,function(c,d){e[a.index]=
d;b(c)})},function(a){d(a,e)})}else a(b,function(a,b){c(a.value,function(a){b(a)})})};e.map=u(G);e.mapSeries=D(G);e.mapLimit=function(a,b,c,d){return t(b,G)(a,c,d)};e.reduce=function(a,b,c,d){e.eachSeries(a,function(a,d){c(b,a,function(a,c){b=c;d(a)})},function(a){d(a,b)})};e.inject=e.reduce;e.foldl=e.reduce;e.reduceRight=function(a,b,c,d){a=w(a,function(a){return a}).reverse();e.reduce(a,b,c,d)};e.foldr=e.reduceRight;var A=function(a,b,c,d){var e=[];b=w(b,function(a,b){return{index:b,value:a}});
a(b,function(a,b){c(a.value,function(c){c&&e.push(a);b()})},function(a){d(w(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};e.filter=u(A);e.filterSeries=D(A);e.select=e.filter;e.selectSeries=e.filterSeries;A=function(a,b,c,d){var e=[];b=w(b,function(a,b){return{index:b,value:a}});a(b,function(a,b){c(a.value,function(c){c||e.push(a);b()})},function(a){d(w(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};e.reject=u(A);e.rejectSeries=D(A);
A=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(a){d()})};e.detect=u(A);e.detectSeries=D(A);e.some=function(a,b,c){e.each(a,function(a,d){b(a,function(a){a&&(c(!0),c=function(){});d()})},function(a){c(!1)})};e.any=e.some;e.every=function(a,b,c){e.each(a,function(a,d){b(a,function(a){a||(c(!1),c=function(){});d()})},function(a){c(!0)})};e.all=e.every;e.sortBy=function(a,b,c){e.map(a,function(a,c){b(a,function(b,d){b?c(b):c(null,{value:a,criteria:d})})},
function(a,b){if(a)return c(a);c(null,w(b.sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),function(a){return a.value}))})};e.auto=function(a,b){b=b||function(){};var c=v(a),d=c.length;if(!d)return b();var f={},g=[],h=function(){d--;q(g.slice(0),function(a){a()})};g.unshift(function(){if(!d){var a=b;b=function(){};a(null,f)}});q(c,function(c){var d=n(a[c])?a[c]:[a[c]],k=function(a){var d=Array.prototype.slice.call(arguments,1);1>=d.length&&(d=d[0]);if(a){var g={};q(v(f),function(a){g[a]=
f[a]});g[c]=d;b(a,g);b=function(){}}else f[c]=d,e.setImmediate(h)},m=d.slice(0,Math.abs(d.length-1))||[],w=function(){return p(m,function(a,b){return a&&f.hasOwnProperty(b)},!0)&&!f.hasOwnProperty(c)};if(w())d[d.length-1](k,f);else{var r=function(){if(w()){a:for(var a=r,b=0;b<g.length;b+=1)if(g[b]===a){g.splice(b,1);break a}d[d.length-1](k,f)}};g.unshift(r)}})};e.retry=function(a,b,c){var d=[];"function"===typeof a&&(c=b,b=a,a=5);a=parseInt(a,10)||5;var f=function(f,g){for(var h=function(a,b){return function(c){a(function(a,
d){c(!a||b,{err:a,result:d})},g)}};a;)d.push(h(b,!--a));e.series(d,function(a,b){b=b[b.length-1];(f||c)(b.err,b.result)})};return c?f():f};e.waterfall=function(a,b){b=b||function(){};if(!n(a))return b(Error("First argument to waterfall must be an array of functions"));if(!a.length)return b();var c=function(a){return function(d){if(d)b.apply(null,arguments),b=function(){};else{var f=Array.prototype.slice.call(arguments,1),g=a.next();g?f.push(c(g)):f.push(b);e.setImmediate(function(){a.apply(null,f)})}}};
c(e.iterator(a))()};var z=function(a,b,c){c=c||function(){};if(n(b))a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);1>=c.length&&(c=c[0]);b.call(null,a,c)})},c);else{var d={};a.each(v(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);1>=e.length&&(e=e[0]);d[a]=e;c(b)})},function(a){c(a,d)})}};e.parallel=function(a,b){z({map:e.map,each:e.each},a,b)};e.parallelLimit=function(a,b,c){z({map:t(b,G),each:r(b)},a,c)};e.series=function(a,
b){b=b||function(){};if(n(a))e.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);1>=c.length&&(c=c[0]);b.call(null,a,c)})},b);else{var c={};e.eachSeries(v(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);1>=e.length&&(e=e[0]);c[b]=e;d(a)})},function(a){b(a,c)})}};e.iterator=function(a){var b=function(c){var d=function(){a.length&&a[c].apply(null,arguments);return d.next()};d.next=function(){return c<a.length-1?b(c+1):null};return d};
return b(0)};e.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};A=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]);b(a)})},function(a){d(a,e)})};e.concat=u(A);e.concatSeries=D(A);e.whilst=function(a,b,c){a()?b(function(d){if(d)return c(d);e.whilst(a,b,c)}):c()};e.doWhilst=function(a,b,c){a(function(d){if(d)return c(d);var f=Array.prototype.slice.call(arguments,1);
b.apply(null,f)?e.doWhilst(a,b,c):c()})};e.until=function(a,b,c){a()?c():b(function(d){if(d)return c(d);e.until(a,b,c)})};e.doUntil=function(a,b,c){a(function(d){if(d)return c(d);var f=Array.prototype.slice.call(arguments,1);b.apply(null,f)?c():e.doUntil(a,b,c)})};e.queue=function(a,c){function d(a,b,c,f){a.started||(a.started=!0);n(b)||(b=[b]);if(0==b.length)return e.setImmediate(function(){a.drain&&a.drain()});q(b,function(b){b={data:b,callback:"function"===typeof f?f:null};c?a.tasks.unshift(b):
a.tasks.push(b);a.saturated&&a.tasks.length===a.concurrency&&a.saturated();e.setImmediate(a.process)})}void 0===c&&(c=1);var f=0,h={tasks:[],concurrency:c,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(a,b){d(h,a,!1,b)},kill:function(){h.drain=null;h.tasks=[]},unshift:function(a,b){d(h,a,!0,b)},process:function(){if(!h.paused&&f<h.concurrency&&h.tasks.length){var c=h.tasks.shift();h.empty&&0===h.tasks.length&&h.empty();f+=1;var d=b(function(){--f;c.callback&&c.callback.apply(c,
arguments);h.drain&&0===h.tasks.length+f&&h.drain();h.process()});a(c.data,d)}},length:function(){return h.tasks.length},running:function(){return f},idle:function(){return 0===h.tasks.length+f},pause:function(){!0!==h.paused&&(h.paused=!0,h.process())},resume:function(){!1!==h.paused&&(h.paused=!1,h.process())}};return h};e.priorityQueue=function(a,b){function c(a,b){return a.priority-b.priority}function d(a,b,c){for(var e=-1,f=a.length-1;e<f;){var g=e+(f-e+1>>>1);0<=c(b,a[g])?e=g:f=g-1}return e}
function f(a,b,g,h){a.started||(a.started=!0);n(b)||(b=[b]);if(0==b.length)return e.setImmediate(function(){a.drain&&a.drain()});q(b,function(b){b={data:b,priority:g,callback:"function"===typeof h?h:null};a.tasks.splice(d(a.tasks,b,c)+1,0,b);a.saturated&&a.tasks.length===a.concurrency&&a.saturated();e.setImmediate(a.process)})}var g=e.queue(a,b);g.push=function(a,b,c){f(g,a,b,c)};delete g.unshift;return g};e.cargo=function(a,b){var c=!1,d=[],f={tasks:d,payload:b,saturated:null,empty:null,drain:null,
drained:!0,push:function(a,c){n(a)||(a=[a]);q(a,function(a){d.push({data:a,callback:"function"===typeof c?c:null});f.drained=!1;f.saturated&&d.length===b&&f.saturated()});e.setImmediate(f.process)},process:function B(){if(!c)if(0===d.length)f.drain&&!f.drained&&f.drain(),f.drained=!0;else{var e="number"===typeof b?d.splice(0,b):d.splice(0,d.length),g=w(e,function(a){return a.data});f.empty&&f.empty();c=!0;a(g,function(){c=!1;var a=arguments;q(e,function(b){b.callback&&b.callback.apply(null,a)});B()})}},
length:function(){return d.length},running:function(){return c}};return f};A=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);"undefined"!==typeof console&&(b?console.error&&console.error(b):console[a]&&q(c,function(b){console[a](b)}))}]))}};e.log=A("log");e.dir=A("dir");e.memoize=function(a,b){var c={},d={};b=b||function(a){return a};var f=function(){var f=Array.prototype.slice.call(arguments),
g=f.pop(),h=b.apply(null,f);h in c?e.nextTick(function(){g.apply(null,c[h])}):h in d?d[h].push(g):(d[h]=[g],a.apply(null,f.concat([function(){c[h]=arguments;var a=d[h];delete d[h];for(var b=0,e=a.length;b<e;b++)a[b].apply(null,arguments)}])))};f.memo=c;f.unmemoized=a;return f};e.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}};e.times=function(a,b,c){for(var d=[],f=0;f<a;f++)d.push(f);return e.map(d,b,c)};e.timesSeries=function(a,b,c){for(var d=[],f=0;f<a;f++)d.push(f);
return e.mapSeries(d,b,c)};e.seq=function(){var a=arguments;return function(){var b=this,c=Array.prototype.slice.call(arguments),d=c.pop();e.reduce(a,c,function(a,c,d){c.apply(b,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,c){d.apply(b,[a].concat(c))})}};e.compose=function(){return e.seq.apply(null,Array.prototype.reverse.call(arguments))};A=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,
function(a,b){a.apply(c,d.concat([b]))},e)};if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return c.apply(this,d)}return c};e.applyEach=u(A);e.applyEachSeries=D(A);e.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d;}a(c)}c()};"undefined"!==typeof c&&c.exports?c.exports=e:f.async=e})()}).call(this,b("_process"))},{_process:3}],129:[function(b,c,f){function a(a,b,c){this.fn=a;this.context=b;this.once=c||!1}function g(){}var e="function"!==typeof Object.create?
"~":!1;g.prototype._events=void 0;g.prototype.listeners=function(a,b){var c=e?e+a:a,d=this._events&&this._events[c];if(b)return!!d;if(!d)return[];if(this._events[c].fn)return[this._events[c].fn];for(var d=0,f=this._events[c].length,g=Array(f);d<f;d++)g[d]=this._events[c][d].fn;return g};g.prototype.emit=function(a,b,c,d,f,g){var p=e?e+a:a;if(!this._events||!this._events[p])return!1;var p=this._events[p],v=arguments.length,r,u;if("function"===typeof p.fn){p.once&&this.removeListener(a,p.fn,void 0,
!0);switch(v){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,b),!0;case 3:return p.fn.call(p.context,b,c),!0;case 4:return p.fn.call(p.context,b,c,d),!0;case 5:return p.fn.call(p.context,b,c,d,f),!0;case 6:return p.fn.call(p.context,b,c,d,f,g),!0}u=1;for(r=Array(v-1);u<v;u++)r[u-1]=arguments[u];p.fn.apply(p.context,r)}else{var t=p.length,D;for(u=0;u<t;u++)switch(p[u].once&&this.removeListener(a,p[u].fn,void 0,!0),v){case 1:p[u].fn.call(p[u].context);break;case 2:p[u].fn.call(p[u].context,
b);break;case 3:p[u].fn.call(p[u].context,b,c);break;default:if(!r)for(D=1,r=Array(v-1);D<v;D++)r[D-1]=arguments[D];p[u].fn.apply(p[u].context,r)}}return!0};g.prototype.on=function(b,c,d){c=new a(c,d||this);b=e?e+b:b;this._events||(this._events=e?{}:Object.create(null));this._events[b]?this._events[b].fn?this._events[b]=[this._events[b],c]:this._events[b].push(c):this._events[b]=c;return this};g.prototype.once=function(b,c,d){c=new a(c,d||this,!0);b=e?e+b:b;this._events||(this._events=e?{}:Object.create(null));
this._events[b]?this._events[b].fn?this._events[b]=[this._events[b],c]:this._events[b].push(c):this._events[b]=c;return this};g.prototype.removeListener=function(a,b,c,d){a=e?e+a:a;if(!this._events||!this._events[a])return this;var f=this._events[a],g=[];if(b)if(f.fn)(f.fn!==b||d&&!f.once||c&&f.context!==c)&&g.push(f);else for(var p=0,v=f.length;p<v;p++)(f[p].fn!==b||d&&!f[p].once||c&&f[p].context!==c)&&g.push(f[p]);g.length?this._events[a]=1===g.length?g[0]:g:delete this._events[a];return this};
g.prototype.removeAllListeners=function(a){if(!this._events)return this;a?delete this._events[e?e+a:a]:this._events=e?{}:Object.create(null);return this};g.prototype.off=g.prototype.removeListener;g.prototype.addListener=g.prototype.on;g.prototype.setMaxListeners=function(){return this};g.prefixed=e;c.exports=g},{}],130:[function(b,c,f){function a(a,b){h.call(this);b=b||10;this.baseUrl=a||"";this.progress=0;this.loading=!1;this._progressChunk=0;this._beforeMiddleware=[];this._afterMiddleware=[];this._boundLoadResource=
this._loadResource.bind(this);this._boundOnLoad=this._onLoad.bind(this);this._buffer=[];this._numToLoad=0;this._queue=g.queue(this._boundLoadResource,b);this.resources={}}var g=b("async"),e=b("url"),k=b("./Resource"),h=b("eventemitter3");a.prototype=Object.create(h.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.add=a.prototype.enqueue=function(a,b,c,d){if(Array.isArray(a)){for(b=0;b<a.length;++b)this.add(a[b]);return this}"object"===typeof a&&(d=b||a.callback||a.onComplete,c=a,b=a.url,
a=a.name||a.key||a.url);"string"!==typeof b&&(d=c,c=b,b=a);if("string"!==typeof b)throw Error("No url passed to add resource to loader.");"function"===typeof c&&(d=c,c=null);if(this.resources[a])throw Error('Resource with name "'+a+'" already exists.');b=this._handleBaseUrl(b);this.resources[a]=new k(a,b,c);if("function"===typeof d)this.resources[a].once("afterMiddleware",d);this._numToLoad++;this._queue.started?(this._queue.push(this.resources[a]),this._progressChunk=(100-this.progress)/(this._queue.length()+
this._queue.running())):(this._buffer.push(this.resources[a]),this._progressChunk=100/this._buffer.length);return this};a.prototype._handleBaseUrl=function(a){var b=e.parse(a);return b.protocol||0===b.pathname.indexOf("//")?a:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==a.charAt(0)?this.baseUrl+"/"+a:this.baseUrl+a};a.prototype.before=a.prototype.pre=function(a){this._beforeMiddleware.push(a);return this};a.prototype.after=a.prototype.use=function(a){this._afterMiddleware.push(a);
return this};a.prototype.reset=function(){this.progress=0;this.loading=!1;this._progressChunk=0;this._numToLoad=this._buffer.length=0;this._queue.kill();this._queue.started=!1;this.resources={}};a.prototype.load=function(a){if("function"===typeof a)this.once("complete",a);if(this._queue.started)return this;this.emit("start",this);for(a=0;a<this._buffer.length;++a)this._queue.push(this._buffer[a]);this._buffer.length=0;return this};a.prototype._loadResource=function(a,b){var c=this;a._dequeue=b;this._runMiddleware(a,
this._beforeMiddleware,function(){a.load(c._boundOnLoad)})};a.prototype._onComplete=function(){this.emit("complete",this,this.resources)};a.prototype._onLoad=function(a){this.progress+=this._progressChunk;this.emit("progress",this,a);this._runMiddleware(a,this._afterMiddleware,function(){a.emit("afterMiddleware",a);this._numToLoad--;0===this._numToLoad&&(this.progress=100,this._onComplete());a.error?this.emit("error",a.error,this,a):this.emit("load",this,a)});a._dequeue()};a.prototype._runMiddleware=
function(a,b,c){var d=this;g.eachSeries(b,function(b,c){b.call(d,a,c)},c.bind(this,a))};a.LOAD_TYPE=k.LOAD_TYPE;a.XHR_READY_STATE=k.XHR_READY_STATE;a.XHR_RESPONSE_TYPE=k.XHR_RESPONSE_TYPE},{"./Resource":131,async:128,eventemitter3:129,url:8}],131:[function(b,c,f){function a(a,b,c){k.call(this);c=c||{};if("string"!==typeof a||"string"!==typeof b)throw Error("Both name and url are required for constructing a resource.");this.name=a;this.url=b;this.isDataUrl=0===this.url.indexOf("data:");this.data=null;
this.crossOrigin=!0===c.crossOrigin?"anonymous":c.crossOrigin;this.loadType=c.loadType||this._determineLoadType();this.xhrType=c.xhrType;this.metadata=c.metadata||{};this.xhr=this.error=null;this.isVideo=this.isAudio=this.isImage=this.isXml=this.isJson=!1;this._dequeue=null;this._boundComplete=this.complete.bind(this);this._boundOnError=this._onError.bind(this);this._boundOnProgress=this._onProgress.bind(this);this._boundXhrOnError=this._xhrOnError.bind(this);this._boundXhrOnAbort=this._xhrOnAbort.bind(this);
this._boundXhrOnLoad=this._xhrOnLoad.bind(this);this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this)}function g(a){return a.toString().replace("object ","")}function e(a,b,c){b&&0===b.indexOf(".")&&(b=b.substring(1));b&&(a[b]=c)}var k=b("eventemitter3"),h=b("url"),m=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),n=null;a.prototype=Object.create(k.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.complete=function(){this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",
this._boundOnError),this.data.removeEventListener("load",this._boundComplete),this.data.removeEventListener("progress",this._boundOnProgress),this.data.removeEventListener("canplaythrough",this._boundComplete));this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError),this.xhr.removeEventListener("abort",this._boundXhrOnAbort),this.xhr.removeEventListener("progress",this._boundOnProgress),this.xhr.removeEventListener("load",this._boundXhrOnLoad)):(this.xhr.onerror=
null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null));this.emit("complete",this)};a.prototype.load=function(b){this.emit("start",this);if(b)this.once("complete",b);if(!1===this.crossOrigin||"string"!==typeof this.crossOrigin)this.crossOrigin=this._determineCrossOrigin(this.url);switch(this.loadType){case a.LOAD_TYPE.IMAGE:this._loadImage();break;case a.LOAD_TYPE.AUDIO:this._loadElement("audio");break;case a.LOAD_TYPE.VIDEO:this._loadElement("video");break;default:m&&this.crossOrigin?
this._loadXdr():this._loadXhr()}};a.prototype._loadImage=function(){this.data=new Image;this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin);this.data.src=this.url;this.isImage=!0;this.data.addEventListener("error",this._boundOnError,!1);this.data.addEventListener("load",this._boundComplete,!1);this.data.addEventListener("progress",this._boundOnProgress,!1)};a.prototype._loadElement=function(a){this.data="audio"===a&&"undefined"!==typeof Audio?new Audio:document.createElement(a);if(null===this.data)this.error=
Error("Unsupported element "+a),this.complete();else{if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var b=0;b<this.url.length;++b)this.data.appendChild(this._createSource(a,this.url[b]));else this.data.appendChild(this._createSource(a,this.url));this["is"+a[0].toUpperCase()+a.substring(1)]=!0;this.data.addEventListener("error",this._boundOnError,!1);this.data.addEventListener("load",this._boundComplete,!1);this.data.addEventListener("progress",
this._boundOnProgress,!1);this.data.addEventListener("canplaythrough",this._boundComplete,!1);this.data.load()}};a.prototype._loadXhr=function(){"string"!==typeof this.xhrType&&(this.xhrType=this._determineXhrType());var b=this.xhr=new XMLHttpRequest;b.open("GET",this.url,!0);b.responseType=this.xhrType===a.XHR_RESPONSE_TYPE.JSON||this.xhrType===a.XHR_RESPONSE_TYPE.DOCUMENT?a.XHR_RESPONSE_TYPE.TEXT:this.xhrType;b.addEventListener("error",this._boundXhrOnError,!1);b.addEventListener("abort",this._boundXhrOnAbort,
!1);b.addEventListener("progress",this._boundOnProgress,!1);b.addEventListener("load",this._boundXhrOnLoad,!1);b.send()};a.prototype._loadXdr=function(){"string"!==typeof this.xhrType&&(this.xhrType=this._determineXhrType());var a=this.xhr=new XDomainRequest;a.timeout=5E3;a.onerror=this._boundXhrOnError;a.ontimeout=this._boundXdrOnTimeout;a.onprogress=this._boundOnProgress;a.onload=this._boundXhrOnLoad;a.open("GET",this.url,!0);setTimeout(function(){a.send()},0)};a.prototype._createSource=function(a,
b,c){c||(c=a+"/"+b.substr(b.lastIndexOf(".")+1));a=document.createElement("source");a.src=b;a.type=c;return a};a.prototype._onError=function(a){this.error=Error("Failed to load element using "+a.target.nodeName);this.complete()};a.prototype._onProgress=function(a){a&&a.lengthComputable&&this.emit("progress",this,a.loaded/a.total)};a.prototype._xhrOnError=function(){this.error=Error(g(this.xhr)+" Request failed. Status: "+this.xhr.status+', text: "'+this.xhr.statusText+'"');this.complete()};a.prototype._xhrOnAbort=
function(){this.error=Error(g(this.xhr)+" Request was aborted by the user.");this.complete()};a.prototype._xdrOnTimeout=function(){this.error=Error(g(this.xhr)+" Request timed out.");this.complete()};a.prototype._xhrOnLoad=function(){var b=this.xhr,c=void 0!==b.status?b.status:200;if(200===c||204===c||0===c&&0<b.responseText.length)if(this.xhrType===a.XHR_RESPONSE_TYPE.TEXT)this.data=b.responseText;else if(this.xhrType===a.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(b.responseText),this.isJson=
!0}catch(d){this.error=Error("Error trying to parse loaded json:",d)}else if(this.xhrType===a.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser)this.data=(new DOMParser).parseFromString(b.responseText,"text/xml");else{var e=document.createElement("div");e.innerHTML=b.responseText;this.data=e}this.isXml=!0}catch(d){this.error=Error("Error trying to parse loaded xml:",d)}else this.data=b.response||b.responseText;else this.error=Error("["+b.status+"]"+b.statusText+":"+b.responseURL);this.complete()};
a.prototype._determineCrossOrigin=function(a,b){if(0===a.indexOf("data:"))return"";b=b||window.location;n||(n=document.createElement("a"));n.href=a;a=h.parse(n.href);var c=!a.port&&""===b.port||a.port===b.port;return a.hostname===b.hostname&&c&&a.protocol===b.protocol?"":"anonymous"};a.prototype._determineXhrType=function(){return a._xhrTypeMap[this._getExtension()]||a.XHR_RESPONSE_TYPE.TEXT};a.prototype._determineLoadType=function(){return a._loadTypeMap[this._getExtension()]||a.LOAD_TYPE.XHR};a.prototype._getExtension=
function(){var a=this.url;if(this.isDataUrl)var b=a.indexOf("/"),a=a.substring(b+1,a.indexOf(";",b));else b=a.indexOf("?"),-1!==b&&(a=a.substring(0,b)),a=a.substring(a.lastIndexOf(".")+1);return a};a.prototype._getMimeFromXhrType=function(b){switch(b){case a.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case a.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case a.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case a.XHR_RESPONSE_TYPE.JSON:return"application/json";default:return"text/plain"}};
a.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4};a.XHR_READY_STATE={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4};a.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"};a._loadTypeMap={gif:a.LOAD_TYPE.IMAGE,png:a.LOAD_TYPE.IMAGE,bmp:a.LOAD_TYPE.IMAGE,jpg:a.LOAD_TYPE.IMAGE,jpeg:a.LOAD_TYPE.IMAGE,tif:a.LOAD_TYPE.IMAGE,tiff:a.LOAD_TYPE.IMAGE,webp:a.LOAD_TYPE.IMAGE,tga:a.LOAD_TYPE.IMAGE};a._xhrTypeMap={xhtml:a.XHR_RESPONSE_TYPE.DOCUMENT,html:a.XHR_RESPONSE_TYPE.DOCUMENT,
htm:a.XHR_RESPONSE_TYPE.DOCUMENT,xml:a.XHR_RESPONSE_TYPE.DOCUMENT,tmx:a.XHR_RESPONSE_TYPE.DOCUMENT,tsx:a.XHR_RESPONSE_TYPE.DOCUMENT,svg:a.XHR_RESPONSE_TYPE.DOCUMENT,gif:a.XHR_RESPONSE_TYPE.BLOB,png:a.XHR_RESPONSE_TYPE.BLOB,bmp:a.XHR_RESPONSE_TYPE.BLOB,jpg:a.XHR_RESPONSE_TYPE.BLOB,jpeg:a.XHR_RESPONSE_TYPE.BLOB,tif:a.XHR_RESPONSE_TYPE.BLOB,tiff:a.XHR_RESPONSE_TYPE.BLOB,webp:a.XHR_RESPONSE_TYPE.BLOB,tga:a.XHR_RESPONSE_TYPE.BLOB,json:a.XHR_RESPONSE_TYPE.JSON,text:a.XHR_RESPONSE_TYPE.TEXT,txt:a.XHR_RESPONSE_TYPE.TEXT};
a.setExtensionLoadType=function(b,c){e(a._loadTypeMap,b,c)};a.setExtensionXhrType=function(b,c){e(a._xhrTypeMap,b,c)}},{eventemitter3:129,url:8}],132:[function(b,c,f){c.exports={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeBinary:function(a){for(var b="",c,d=Array(4),f=0,m;f<a.length;){c=Array(3);for(m=0;m<c.length;m++)c[m]=f<a.length?a.charCodeAt(f++)&255:0;d[0]=c[0]>>2;d[1]=(c[0]&3)<<4|c[1]>>4;d[2]=(c[1]&15)<<2|c[2]>>6;d[3]=c[2]&63;c=f-(a.length-1);switch(c){case 2:d[3]=
64;d[2]=64;break;case 1:d[3]=64}for(m=0;m<d.length;m++)b+=this._keyStr.charAt(d[m])}return b}}},{}],133:[function(b,c,f){c.exports=b("./Loader");c.exports.Resource=b("./Resource");c.exports.middleware={caching:{memory:b("./middlewares/caching/memory")},parsing:{blob:b("./middlewares/parsing/blob")}}},{"./Loader":130,"./Resource":131,"./middlewares/caching/memory":134,"./middlewares/parsing/blob":135}],134:[function(b,c,f){var a={};c.exports=function(){return function(b,c){if(a[b.url])b.data=a[b.url],
b.complete();else b.once("complete",function(){a[this.url]=this.data});c()}}},{}],135:[function(b,c,f){var a=b("../../Resource"),g=b("../../b64");window.URL=window.URL||window.webkitURL;c.exports=function(){return function(b,c){if(!b.data)return c();if(b.xhr&&b.xhrType===a.XHR_RESPONSE_TYPE.BLOB)if(!window.Blob||"string"===typeof b.data){var d=b.xhr.getResponseHeader("content-type");d&&0===d.indexOf("image")&&(b.data=new Image,b.data.src="data:"+d+";base64,"+g.encodeBinary(b.xhr.responseText),b.isImage=
!0,b.data.onload=function(){b.data.onload=null;c()})}else{if(0===b.data.type.indexOf("image")){var f=URL.createObjectURL(b.data);b.blob=b.data;b.data=new Image;b.data.src=f;b.isImage=!0;b.data.onload=function(){URL.revokeObjectURL(f);b.data.onload=null;c()}}}else c()}}},{"../../Resource":131,"../../b64":132}]},{},[108])(108)});PIXI.TransparencyHitArea=function(c){this.sprite=c};PIXI.TransparencyHitArea.create=function(c,b){var d;d=b?new PIXI.WebGLTransparencyHitArea(c):new PIXI.CanvasTransparencyHitArea(c);d.init();return d};PIXI.TransparencyHitArea.prototype.init=function(){};
PIXI.TransparencyHitArea.prototype.contains=function(c,b){if(0===Math.abs(this.sprite.width)||0===Math.abs(this.sprite.height))return!1;var d=this.sprite.texture.frame.width,f=this.sprite.texture.frame.height;c+=this.sprite.anchor.x*d;b+=this.sprite.anchor.y*f;return 0<=c&&c<=d&&0<=b&&b<=f?!this.isTextureTransparentAt(Math.round(c+this.sprite.texture.frame.x),Math.round(b+this.sprite.texture.frame.y)):!1};PIXI.TransparencyHitArea.prototype.getTexture=function(){return this.sprite.texture};
PIXI.CanvasTransparencyHitArea=function(c){PIXI.TransparencyHitArea.call(this,c);this.textureWidth=this.textureData=null};PIXI.CanvasTransparencyHitArea.prototype=Object.create(PIXI.TransparencyHitArea.prototype);PIXI.CanvasTransparencyHitArea.constructor=PIXI.CanvasTransparencyHitArea;PIXI.CanvasTransparencyHitArea.prototype.clone=function(){return new PIXI.CanvasTransparencyHitArea(this.sprite)};
PIXI.CanvasTransparencyHitArea.prototype.init=function(){PIXI.TransparencyHitArea.prototype.init.call(this);null===PIXI.CanvasTransparencyHitArea.cachedRenderer&&(PIXI.CanvasTransparencyHitArea.cachedRenderer=new PIXI.CanvasRenderer(1,1));this.initTextureData()};
PIXI.CanvasTransparencyHitArea.prototype.initTextureData=function(){if(!this.textureData){var c=this.getTexture(),b=c.baseTexture.source;this.textureWidth=b.width;b=b.src;void 0===PIXI.CanvasTransparencyHitArea.TextureData[b]&&(c=this.createTextureData(c),PIXI.CanvasTransparencyHitArea.TextureData[b]=c);this.textureData=PIXI.CanvasTransparencyHitArea.TextureData[b]}};
PIXI.CanvasTransparencyHitArea.prototype.createTextureData=function(c){c=c.baseTexture.source;var b=PIXI.CanvasTransparencyHitArea.cachedRenderer,d=b.view;d.width=c.width;d.height=c.height;b=b.view.getContext("2d");b.clearRect(0,0,c.width,c.height);b.drawImage(c,0,0);return b.getImageData(0,0,c.width,c.height).data};
PIXI.CanvasTransparencyHitArea.prototype.isTextureTransparentAt=function(c,b){if(!this.textureData)throw Error("CanvasTransparencyHitArea#init() not called.");return 1>this.textureData[4*(c+b*this.textureWidth)+3]};PIXI.CanvasTransparencyHitArea.TextureData=[];PIXI.CanvasTransparencyHitArea.cachedRenderer=null;PIXI.WebGLTransparencyHitArea=function(c){PIXI.TransparencyHitArea.call(this,c);this.textureWidth=this.textureData=null};PIXI.WebGLTransparencyHitArea.prototype=Object.create(PIXI.TransparencyHitArea.prototype);
PIXI.WebGLTransparencyHitArea.constructor=PIXI.WebGLTransparencyHitArea;PIXI.WebGLTransparencyHitArea.prototype.clone=function(){return new PIXI.WebGLTransparencyHitArea(this.sprite)};PIXI.WebGLTransparencyHitArea.prototype.init=function(){PIXI.TransparencyHitArea.prototype.init.call(this);null===PIXI.WebGLTransparencyHitArea.cachedRenderer&&(PIXI.WebGLTransparencyHitArea.cachedRenderer=new PIXI.WebGLRenderer(1,1));this.initTextureData()};
PIXI.WebGLTransparencyHitArea.prototype.initTextureData=function(){if(!this.textureData){var c=this.getTexture(),b=c.baseTexture.source;this.textureWidth=b.width;b=b.src;void 0===PIXI.WebGLTransparencyHitArea.TextureData[b]&&(c=this.createTextureData(c),PIXI.WebGLTransparencyHitArea.TextureData[b]=c);this.textureData=PIXI.WebGLTransparencyHitArea.TextureData[b]}};
PIXI.WebGLTransparencyHitArea.prototype.createTextureData=function(c){var b=c.baseTexture.source,d=PIXI.WebGLTransparencyHitArea.cachedRenderer.view;d.width=b.width;d.height=b.height;var d=PIXI.WebGLTransparencyHitArea.cachedRenderer.gl,f=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,f);void 0===c.baseTexture._glTextures[d.id]&&PIXI.WebGLTransparencyHitArea.cachedRenderer.updateTexture(c.baseTexture);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c.baseTexture._glTextures[d.id],
0);c=new Uint8Array(b.width*b.height*4);try{d.readPixels(0,0,b.width,b.height,d.RGBA,d.UNSIGNED_BYTE,c)}catch(a){console.log(error)}d.bindFramebuffer(d.FRAMEBUFFER,null);return c};PIXI.WebGLTransparencyHitArea.prototype.isTextureTransparentAt=function(c,b){if(!this.textureData)throw Error("WebGLTransparencyHitArea#init() not called.");return 255>this.textureData[4*(c+b*this.textureWidth)+3]};PIXI.WebGLTransparencyHitArea.TextureData=[];PIXI.WebGLTransparencyHitArea.cachedRenderer=null;function getCurvePoints(c,b,d,f){function a(a,b,c,e){for(var f=2,g;f<c;f+=2){var k=a[f],n=a[f+1],p=a[f+2],q=a[f+3],r=(p-a[f-2])*e,v=(q-a[f-1])*e,u=(a[f+4]-k)*e,w=(a[f+5]-n)*e,K=0,O,F,E,P;for(g=0;g<d;g++)O=b[K++],F=b[K++],E=b[K++],P=b[K++],m[h++]=O*k+F*p+E*r+P*u,m[h++]=O*n+F*q+E*v+P*w}}b="number"===typeof b?b:.5;d="number"===typeof d?d:25;var g,e=1,k=c.length,h=0,m=new Float32Array((k-2)*d+2+(f?2*d:0)),n=new Float32Array(4*(d+2)),q=4;g=c.slice(0);f?(g.unshift(c[k-1]),g.unshift(c[k-2]),g.push(c[0],
c[1])):(g.unshift(c[1]),g.unshift(c[0]),g.push(c[k-2],c[k-1]));for(n[0]=1;e<d;e++){var w=e/d,p=w*w,v=p*w,r=2*v,u=3*p;n[q++]=r-u+1;n[q++]=u-r;n[q++]=v-2*p+w;n[q++]=v-p}n[++q]=1;a(g,n,k,b);f&&(g=[],g.push(c[k-4],c[k-3],c[k-2],c[k-1],c[0],c[1],c[2],c[3]),a(g,n,4,b));k=f?0:c.length-2;m[h++]=c[k++];m[h]=c[k];return m}"undefined"!==typeof exports&&(exports.getCurvePoints=getCurvePoints);var servers=$("#socket_io_servers").attr("data-socket_io_servers").split(","),is_video_replay=!1;-1!=location.pathname.indexOf("planner3")&&(is_video_replay=!0);var image_host;function is_safari(){return navigator.vendor&&-1<navigator.vendor.indexOf("Apple")}var static_host=$("#static_host").attr("data-static_host");image_host=is_safari()?"http://"+location.host+"/icons/":static_host+"/icons/";var asset_host=static_host+"/",game=$("meta[name=game]").attr("content"),loader=PIXI.loader,assets=[];
"wows"==game?(assets.push(image_host+"rotate.png"),assets.push(image_host+"bb.png",image_host+"cv.png",image_host+"ca.png",image_host+"dd.png"),assets.push(image_host+"circle.png",image_host+"recticle.png",image_host+"dot.png",image_host+"note.png",image_host+"cursor.png",image_host+"grid.png")):"blitz"==game?(assets.push(image_host+"rotate.png"),assets.push(image_host+"light.png",image_host+"medium.png",image_host+"heavy.png",image_host+"td.png",image_host+"arty.png"),assets.push(image_host+"circle.png",
image_host+"recticle.png",image_host+"dot.png",image_host+"note.png",image_host+"cursor.png",image_host+"grid.png")):"aw"==game?(assets.push(image_host+"rotate.png"),loader.add("aw_assets.png",asset_host+"aw_assets.png"),loader.add("aw_assets.json",asset_host+"aw_assets.json")):"lol"==game?(assets.push(image_host+"rotate.png"),assets.push(image_host+"circle.png",image_host+"recticle.png",image_host+"dot.png",image_host+"note.png",image_host+"cursor.png",image_host+"grid.png")):"hots"==game?(assets.push(image_host+
"rotate.png"),loader.add("hots_assets.png",asset_host+"hots_assets.png"),loader.add("hots_assets.json",asset_host+"hots_assets.json")):(assets.push(image_host+"rotate.png"),loader.add("wot_assets.png",asset_host+"wot_assets.png"),loader.add("wot_assets.json",asset_host+"wot_assets.json"));for(var i in assets)loader.add(assets[i],assets[i]);loader.load(setup_assets);var texture_atlas;
function setup_assets(){texture_atlas={};for(var c in loader.resources)if("json"==c.slice(-4))for(var b in loader.resources[c].data.tiles)texture_atlas[b]=loader.resources[c].data.tiles[b]}var room=location.search.split("room=")[1].split("&")[0],nowebgl=-1!=location.search.indexOf("nowebgl");function hashstring(c){var b=0;for(i=0;i<c.length;i++)b+=c.charCodeAt(i);return b}var server=servers[hashstring(room)%servers.length];console.log("connecting to server: ",server);
function parse_domain(c){c=c.split(".");2<c.length&&(c=c.slice(1));return"."+c.join(".")}var socket;
try{socket=Modernizr.websockets?io.connect(server,{reconnectionDelay:100,reconnectionDelayMax:500,"reconnection limit":1E3,"max reconnection attempts":Infinity,query:"connect_sid="+$("#sid").attr("data-sid")+"&host="+parse_domain(location.hostname)}):io.connect(server,{transports:["polling"],reconnectionDelay:100,reconnectionDelayMax:500,"reconnection limit":1E3,"max reconnection attempts":Infinity,query:"connect_sid="+$("#sid").attr("data-sid")+"&host="+parse_domain(location.hostname)})}catch(c){console.log(c)}
var valid_chars="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function newUid(){for(var c="",b=0;14>b;b++)c+=valid_chars.charAt(Math.floor(Math.random()*valid_chars.length));return c}function is_chrome(){return-1<navigator.userAgent.toLowerCase().indexOf("chrome")}function is_firefox(){return-1<navigator.userAgent.toLowerCase().indexOf("firefox")}
function is_ie(){return-1<navigator.userAgent.toLowerCase().indexOf("msie")||-1<navigator.userAgent.toLowerCase().indexOf("trident")}function is_edge(){return-1<navigator.userAgent.toLowerCase().indexOf("edge")}var last=function(c){return c[c.length-1]};function random_darkish_color(){var c=Math.round(127*Math.random()).toString(16),b=Math.round(127*Math.random()).toString(16),d=Math.round(127*Math.random()).toString(16);return"#"+c+b+d}
function random_color(){var c=Math.round(256*Math.random()).toString(16),b=Math.round(256*Math.random()).toString(16),d=Math.round(256*Math.random()).toString(16);return"#"+("00"+c.toString(16)).slice(-2)+("00"+b.toString(16)).slice(-2)+("00"+d.toString(16)).slice(-2)}var ARROW_LOOKBACK=4,MOUSE_DRAW_SMOOTHING=.5,LEFT_BAR_MIN_WIDTH=340,RIGHT_BAR_MIN_WIDTH=302,SINGLE_SIDE_BAR_MIN_WIDTH;SINGLE_SIDE_BAR_MIN_WIDTH="blitz"==game?350:630;
var MIN_POLYGON_END_DISTANCE=.01,MIN_POLYGON_END_DISTANCE_TOUCH=.025,MIN_TRACK_MOVE_DISTANCE_SQ=1E-4,ICON_SCALE=.00125,NOTE_SCALE=.03,THICKNESS_SCALE=1,FONT_SCALE=.002,TEXT_QUALITY=8,ARROW_SCALE=.008,ARROW_SCALE2=1.7,TEND_SCALE=.008,TEND_SCALE2=1.5,MAGIC_NUMBER=25,EPSILON=1E-9,ROTATE_ARROW_SCALE=.05,ROTATE_ARROW_MARGIN=.02,TEXT_BOX_QUALITY=4,VIDEO_EXTENSIONS=["mp4","webgl","avi"],VIDEO_SYNC_DELAY=1E4,MOUSE_IDLE_HIDE_TIME=5E3,MAX_CANVAS_SIZE=4096,chat_color=random_darkish_color(),room_data,active_slide=
0,active_context="ping_context",active_menu="ping_context",userlist={},selected_icon,selected_icon_no_color=!1,label_position="pos_bottom",icon_extra_scale=1,icon_color=16711680,draw_color=16711680,ping_color=16711680,track_color=16711680,line_color=16711680,curve_color=16711680,text_color=16777215,background_text_color=0,rectangle_outline_color=16711680,rectangle_fill_color=16711680,circle_outline_color=16711680,circle_fill_color=16711680,polygon_outline_color=16711680,polygon_fill_color=16711680,
area_outline_color=16711680,area_fill_color=16711680,background,draw_thickness,curve_thickness,line_thickness,icon_size,ping_size,track_size,draw_end_size,line_end_size,curve_end_size,rectangle_outline_thickness,rectangle_outline_transparancy,rectangle_fill_transparancy,circle_outline_thickness,circle_outline_transparancy,circle_fill_transparancy,polygon_outline_thickness,polygon_outline_transparancy,polygon_fill_transparancy,area_outline_thickness,area_outline_transparancy,area_fill_transparancy,
my_user,undo_list=[],redo_list=[],is_room_locked,tactic_name="",graphics,new_drawing,left_click_origin,selected_entities=[],previously_selected_entities=[],label_font_size=30,last_ping_time,trackers={},my_tracker,last_track_position,tracker_width=.05,tracker_height=.05,my_user_id,clipboard=[],slide_name,assets_loaded=!1,select_alpha=.6,resources_loading=0,circle_draw_style="edge",drag_delay_running=!1,current_text_element,last_mouse_location,ping_texture,hovering_over,just_activated,select_box,rotate_arrow0,
rotate_arrow1,rotate_arrow2,rotate_arrow3,select_box_dirty=!1,select_center,objectContainer,fast_container,background_sprite,renderer,size,size_x,size_y,useWebGL,last_pan_loc,panning,last_move_func,last_end_func,draw_canvas,temp_draw_canvas,draw_context,temp_draw_context,grid_layer,zoom_level=1,control_camera=!1,offset=0,sync_start_time,progress=0,progress_update=Date.now(),video_layer,manual_pause=!1,sync_seek=!1,sync_event,clock_sync_event,last_video_sync=null,timeline,timeline_entities={},video_ready=
!1,video_paused=!0,initiated_play=!1,im_syncing=!1,idleMouseTimer,playback_rate=1,base_playback_rate=1,mouse_down_interrupted;document.body.onmouseup=function(){mouse_down_interrupted=!0};var shifted;
$(document).on("keyup keydown",function(c){can_edit()&&(shifted=c.shiftKey,"input"!=document.activeElement.localName&&("keydown"==c.type?c.ctrlKey?90==c.keyCode?undo():89==c.keyCode?redo():65==c.keyCode?(select_all(),c.preventDefault()):83==c.keyCode?my_user.logged_in&&tactic_name&&""!=tactic_name&&socket&&socket.emit("store",room,tactic_name):67==c.keyCode?copy():88==c.keyCode?cut():86==c.keyCode&&paste():32==c.keyCode&&video_layer&&can_edit()&&(toggle_play(),c.preventDefault()):"keyup"==c.type&&
(46==c.keyCode?clear_selected():16==c.keyCode&&"line_context"==active_context&&new_drawing&&on_line_end(c))))});function cut(){copy();clear_selected()}function copy(){clipboard=[];for(var c in selected_entities){var b=selected_entities[c].container;selected_entities[c].container=null;clipboard.push(JSON.parse(JSON.stringify(selected_entities[c])));selected_entities[c].container=b}}
function paste(){if(0!=clipboard.length){deselect_all();var c=renderer.plugins.interaction.eventData.data.global,b=from_x_local(c.x),c=from_y_local(c.y);if(1<Math.abs(b)||1<Math.abs(c))b=c=0;var d=1,f=1,a;for(a in clipboard)d=Math.min(d,clipboard[a].y),f=Math.min(f,clipboard[a].x);var g=[];for(a in clipboard){var e=JSON.parse(JSON.stringify(clipboard[a]));e.uid=newUid();e.x=b+(e.x-f);e.y=c+(e.y-d);g.push(e);create_entity(e);snap_and_emit_entity(e);selected_entities.push(e);render_scene()}select_entities();
undo_list.push(clone_action(["add",g]))}}function zoom(c,b,d){c=1+c*(b?1:-1);b=renderer.plugins.interaction.eventData.data.global;objectContainer.scale.x*=c;objectContainer.scale.y*=c;objectContainer.x-=x_abs(from_x_local(b.x)*(c-1)*objectContainer.scale.x);objectContainer.y-=y_abs(from_y_local(b.y)*(c-1)*objectContainer.scale.y);correct();zoom_level=size_y/(background_sprite.height*objectContainer.scale.y)}
function emit_pan_zoom(){socket.emit("pan_zoom",room,zoom_level,from_x_local_vect(objectContainer.x),from_y_local_vect(objectContainer.y))}function pan_zoom(c,b,d){c=zoom_level/c-1;zoom(Math.abs(c),0<c);objectContainer.x=to_x_local_vect(b);objectContainer.y=to_y_local_vect(d);correct()}
function correct(){objectContainer.x=Math.min(0,objectContainer.x);objectContainer.y=Math.min(0,objectContainer.y);background_sprite.width*objectContainer.scale.x+objectContainer.x<draw_canvas.width&&(objectContainer.x=Math.min(0,draw_canvas.width-background_sprite.width*objectContainer.scale.x),0==objectContainer.x&&(objectContainer.scale.x=draw_canvas.width/background_sprite.width));background_sprite.height*objectContainer.scale.y+objectContainer.y<draw_canvas.height&&(objectContainer.y=Math.min(0,
draw_canvas.height-background_sprite.height*objectContainer.scale.y),0==objectContainer.y&&(objectContainer.scale.y=draw_canvas.height/background_sprite.height));objectContainer.scale.y!=objectContainer.scale.x&&(objectContainer.scale.x=Math.max(objectContainer.scale.x,objectContainer.scale.y),objectContainer.scale.y=Math.max(objectContainer.scale.x,objectContainer.scale.y));if(room_data)for(var c in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities[c]&&"note"==room_data.slides[active_slide].entities[c].type&&
align_note_text(room_data.slides[active_slide].entities[c]);my_tracker&&on_track_move();render_scene()}var pan_state={};function on_pan(c){limit_rate(15,pan_state,function(){var b=renderer.plugins.interaction.eventData.data.global,c=b.x-last_pan_loc[0],f=b.y-last_pan_loc[1];last_pan_loc=[b.x,b.y];objectContainer.x+=c;objectContainer.y+=f;correct()})}
function resize_renderer(c,b){if(video_layer){var d=c*(1-(0<video_layer[0].videoWidth?video_layer[0].videoWidth/video_layer[0].videoHeight:16/9)/(c/b))/2;$("#edit_window").css("left",""+d+"px");c-=2*d;video_layer.width(c);video_layer.height(b)}else $("#edit_window").css("left","0px");d=size_y;size_x=c;size_y=b;draw_canvas.width=c;draw_canvas.height=b;temp_draw_canvas.width=c;temp_draw_canvas.height=b;objectContainer.scale.x*=size_y/d;objectContainer.scale.y*=size_y/d;grid_layer.width=background_sprite.width;
grid_layer.height=background_sprite.height;$("#edit_window").css("width",""+c+"px");$("#edit_window").css("height",""+b+"px");renderer.resize(c,b);zoom(0,!0)}
window.onresize=function(){if(-1!=window.location.pathname.indexOf("planner3"))resize_renderer($(window).width(),$(window).height());else{var c=1;background_sprite.texture&&(c=background_sprite.texture.width/background_sprite.texture.height);var b;b=$("#single_side_bar").length?SINGLE_SIDE_BAR_MIN_WIDTH:LEFT_BAR_MIN_WIDTH+RIGHT_BAR_MIN_WIDTH;if(b<window.innerWidth/2){var d;$("#left_side_bar").length&&($("#left_side_bar").detach().prependTo($("body")),$("#map_select_box").prependTo($("#map_select_section")),
$("#home_button").prependTo($("#left_navbar")));d=window.innerHeight-5;var f=d*c;f+b+MAGIC_NUMBER>window.innerWidth&&(f=window.innerWidth-b-MAGIC_NUMBER,d=f/c)}else $("#left_side_bar").length&&($("#left_side_bar").detach().appendTo($("body")),$("#map_select_box").prependTo($(".left_column")),$("#home_button").prependTo($("#right_navbar")),b=RIGHT_BAR_MIN_WIDTH),f=window.innerWidth-b,d=f/c,f<RIGHT_BAR_MIN_WIDTH&&(f=window.innerWidth,d=f/c),d>window.innerHeight&&(d=window.innerHeight,f=d*c);resize_renderer(f,
d);render_scene()}};function x_rel(c){return c/background_sprite.width}function x_abs(c){return c*background_sprite.width}function y_rel(c){return c/background_sprite.height}function y_abs(c){return c*background_sprite.height}function to_x_local(c){return objectContainer.x+c*background_sprite.width*objectContainer.scale.x}function to_x_local_vect(c){return c*background_sprite.width*objectContainer.scale.x}
function from_x_local(c){return(c-objectContainer.x)/objectContainer.scale.x/background_sprite.width}function from_x_local_vect(c){return c/objectContainer.scale.x/background_sprite.width}function to_y_local(c){return objectContainer.y+c*background_sprite.height*objectContainer.scale.y}function to_y_local_vect(c){return c*background_sprite.height*objectContainer.scale.y}function from_y_local(c){return(c-objectContainer.y)/objectContainer.scale.y/background_sprite.height}
function from_y_local_vect(c){return c/objectContainer.scale.y/background_sprite.height}function mouse_x_abs(c){return c}function mouse_y_abs(c){return c}function mouse_x_rel(c){return c/(background_sprite.width/background_sprite.scale.x)}function mouse_y_rel(c){return c/(background_sprite.height/background_sprite.scale.y)}function is_video(c){return""!=get_video_type(c)}
function get_video_type(c){for(var b=c.split(".").pop(),d=0;d<VIDEO_EXTENSIONS.length;d++)if(b.startsWith(VIDEO_EXTENSIONS[d]))return"video/"+VIDEO_EXTENSIONS[d];return-1!=c.toUpperCase().indexOf("YOUTUBE")?"video/youtube":-1!=c.toUpperCase().indexOf("VIMEO")?"video/vimeo":""}
function reset_background(){pan_zoom(1,0,0);video_ready=!1;video_media&&video_media.setCurrentTime(0);video_player&&(video_player.pause(),video_player.remove());$("#video_player")&&$("#video_player").remove();video_layer=null;$("#left_detect").unbind("mouseenter");$("#right_detect").unbind("mouseenter");$("#left_side_bar").unbind("mouseleave");$("#right_side_bar").unbind("mouseleave");$("#left_side_bar").show();$("#right_side_bar").show();clearTimeout(idleMouseTimer)}var video_player,video_media;
function init_video_controls(){$("#left_detect").mouseenter(function(){$("#left_side_bar").show()});$("#right_detect").mouseenter(function(){$("#right_side_bar").show()});$("#left_side_bar").mouseleave(function(){$("#left_side_bar").hide()});$("#right_side_bar").mouseleave(function(){$("#right_side_bar").hide()});$("#left_side_bar").hide();$("#right_side_bar").hide()}
function start_syncing(){clearInterval(sync_event);im_syncing=!0;for(var c=0;5>c;c++)setTimeout(function(){var b=video_progress();socket.emit("sync_video",room,b,get_server_time())},2E3*c);sync_event=setInterval(function(){var b=video_progress();socket.emit("sync_video",room,b,get_server_time())},1E4)}
function play_video_controls(){$(".mejs-controls").mouseenter(function(){$(".mejs-controls").css("opacity",1)});$(".mejs-controls").mouseleave(function(){$(".mejs-controls").css("opacity",0)});$(".mejs-controls").css("opacity",0);can_edit()?$(".mejs-controls").show():$(".mejs-controls").hide()}function pause_video_controls(){$(".mejs-controls").unbind("mouseenter");$(".mejs-controls").unbind("mouseleave");$(".mejs-controls").css("opacity",1)}
function toggle_play(){if(background.is_video)if(video_paused){var c=video_progress();socket.emit("play_video",room,c,base_playback_rate);initiated_play=!0;play_video_controls();start_syncing()}else manual_pause=!0,video_player.pause(),pause_video_controls()}var ignore_jump=!1;
function init_video_triggers(){video_media.addEventListener("pause",function(c){manual_pause&&(clearInterval(sync_event),im_syncing=!1,video_paused=!0,socket.emit("pause_video",room,video_progress()),manual_pause=!1)});video_media.addEventListener("play",function(c){initiated_play?(start_syncing(),initiated_play=!1):stop_syncing();video_paused&&(video_player.pause(),video_media.currentTime=last_video_sync?last_video_sync[0]:0,video_player.pause())});video_media.addEventListener("ended",function(c){im_syncing&&
socket.emit("pause_video",room,0)});video_media.addEventListener("timeupdate",function(c){progress=video_media.currentTime;progress_update=Date.now()});$(".mejs-playpause-button").unbind("click");$(".mejs-playpause-button").click(function(c){toggle_play();c.preventDefault();return!1});$(".mejs-time-rail").on("mousedown",function(){wait_for_seek(function(){socket.emit("seek_video",room,video_progress(),get_server_time());video_paused||start_syncing();rebuild_timeline()})})}
function wait_for_seek(c){var b=Date.now(),d=video_progress(),f=setInterval(function(){video_progress();.05<Math.abs(video_progress()-(d+(Date.now()-b)/1E3))&&(c(),clearInterval(f));1E4<Date.now()-b&&clearInterval(f)},5)}
function set_background(c,b){if(""!=c.path)if(c.is_video){reset_background();background=c;history[background.uid]=background;add_custom_map(background.path);$("#wotbase_map_select_container").hide();$("#map_select_container").show();var d=new PIXI.Graphics;d.beginFill(16777215,0);d.moveTo(0,0);d.lineTo(renderer.width,0);d.lineTo(renderer.width,renderer.height);d.lineTo(0,renderer.height);d.lineTo(0,0);d.endFill();background_sprite.texture=d.generateTexture();$("#map_size").text("");background_sprite.width=
renderer.view.width/objectContainer.scale.x;background_sprite.height=renderer.view.height/objectContainer.scale.y;var f=get_video_type(c.path);video_layer=$("<video />",{id:"video_player",autoplay:!1,controls:!0});$("<source />",{type:f,src:c.path}).appendTo(video_layer);video_layer.appendTo($("#video_div"));video_layer.mediaelementplayer({videoHeight:"100%",loop:!1,autoPlay:!1,enableAutosize:!0,alwaysShowControls:!0,speeds:"0.25 0.50 1.00 1.25 1.50 2.00".split(" "),defaultSpeed:"1.00",speedChar:"x",
features:"playpause speed progress current duration tracks volume".split(" "),success:function(a,c,d){video_media=a;video_paused=!room_data.playing;video_player=d;"video/youtube"==f&&video_media.pluginApi.pauseVideo();init_video_controls();$(".mejs-controls").css("z-index",9);$(".mejs-controls").css("position","fixed");$(".mejs-controls").css("left","0px");$(".mejs-controls").css("bottom","0px");$(".mejs-controls").css("height","3%");init_video_triggers();timeline=new FastPriorityQueue;video_ready=
!0;room_data.playing?room_data.last_sync?handle_play(room_data.last_sync[0],Date.now()):handle_play(0,Date.now()):room_data.last_sync&&(video_media.setCurrentTime(room_data.last_sync[0]),video_player.pause());"youtube"==video_media.pluginType&&(a=video_media.pluginType,video_player.options.speeds=video_media.pluginApi.getAvailablePlaybackRates().map(function(a){return a.toFixed(2)}),video_player.options.defaultSpeed="1.00",video_media.pluginType="native",video_player.buildspeed(d,d.controls,d.layers,
d.media),$(".mejs-playpause-button").after($(".mejs-speed-button")),video_media.pluginType=a);playback_rate=base_playback_rate=1;$(".mejs-speed-button").find(".mejs-speed-selector").on("click",'input[type="radio"]',function(){var a=parseFloat($(this).attr("value"));socket.emit("change_rate",room,a);set_playback_rate(a,a);start_syncing()});var g=!1;$(renderer.view).css("cursor","none");$(renderer.view).mousemove(function(a){g||($(renderer.view).css("cursor","default"),clearTimeout(idleMouseTimer),
idleMouseTimer=setTimeout(function(){$(renderer.view).css("cursor","none");g=!0;setTimeout(function(){g=!1},200)},MOUSE_IDLE_HIDE_TIME))});socket.emit("request_sync",room);window.onresize();render_scene();b&&b(!0)}})}else{resources_loading++;var a=PIXI.Texture.fromImage(c.path),g=function(){reset_background();background=c;history[background.uid]=background;background_sprite.texture=a;room_data.slides[active_slide].entities[c.uid]=c;resources_loading--;0<$("#map_select option[value='"+background.path+
"']").length?($("#map_select").val(background.path).change(),$("#use_wotbase").prop("checked",!1),$("#map_select_container").show(),$("#wotbase_map_select_container").hide()):0<$("#map_select_wotbase option[value='"+background.path+"']").length?($("#map_select_wotbase").val(background.path).change(),$("#use_wotbase").prop("checked",!0),$("#map_select_container").hide(),$("#wotbase_map_select_container").show()):(add_custom_map(background.path),$("#wotbase_map_select_container").hide(),$("#map_select_container").show());
background.size_x&&background.size_y&&0<background.size_x&&0<background.size_y?$("#map_size").text("("+background.size_x+" x "+background.size_y+")"):$("#map_size").text("");window.onresize();background_sprite.width=renderer.view.width/objectContainer.scale.x;background_sprite.height=renderer.view.height/objectContainer.scale.y;zoom_level=size_y/(background_sprite.height*objectContainer.scale.y);render_scene();b&&b(!0)};a.baseTexture.hasLoaded?g():(a.baseTexture.on("loaded",function(){g()}),a.baseTexture.on("error",
function(a){alert("Image exists, but the host does not allow embedding. Try uploading your map to a service such as http://imgur.com.");resources_loading--;b&&b(!1)}))}else reset_background(),background=c,history[background.uid]=background,$("#map_select").val(background.path).change(),$("#use_wotbase").prop("checked",!1),$("#map_select_container").show(),$("#wotbase_map_select_container").hide(),d=new PIXI.Graphics,d.beginFill(16777215,1),d.moveTo(0,0),d.lineTo(renderer.width,0),d.lineTo(renderer.width,
renderer.height),d.lineTo(0,renderer.height),d.lineTo(0,0),d.endFill(),background_sprite.texture=d.generateTexture(),$("#map_size").text(""),background_sprite.width=renderer.view.width/objectContainer.scale.x,background_sprite.height=renderer.view.height/objectContainer.scale.y,window.onresize(),render_scene(),b&&b(!0)}var context_before_drag,move_selected,drag_timeout,last_drag_position,last_drag_update,dragged_entity;
function on_drag_start(c){this==select_box&&(limit_rate(15,select_box_move_state,function(){}),select_box.mousemove=void 0,select_box.mouseover=void 0,select_box.mouseout=void 0);drag_delay_running=!0;drag_timeout&&clearTimeout(drag_timeout);_this=this;var b=c.data.getLocalPosition(background_sprite);last_mouse_location=[mouse_x_rel(b.x),mouse_y_rel(b.y)];mouse_down_interrupted=!1;b=0;if("ping_context"!=active_context||_this.entity&&"note"==_this.entity.type){if("remove_context"==active_context||
"eraser_context"==active_context){_this.entity&&(deselect_all(),remove(_this.entity.uid),undo_list.push(clone_action(["remove",[_this.entity]])),socket.emit("remove",room,_this.entity.uid,active_slide),"eraser_context"==active_context&&on_left_click(c));_this==select_box&&clear_selected();c.stopPropagation();return}if("select_context"!=active_context&&"icon_context"!=active_context&&"text_context"!=active_context&&"background_text_context"!=active_context&&"note_context"!=active_context&&"ping_context"!=
active_context&&"track_context"!=active_context)return;"drag_context"!=active_context&&(context_before_drag=active_context);active_context="drag_context";c.stopPropagation()}else b=300;drag_timeout=setTimeout(function(){if(mouse_down_interrupted)drag_delay_running=!1,deselect_all();else{var b=renderer.plugins.interaction.eventData.data.global;last_drag_update=Date.now();last_drag_position=[from_x_local(b.x),from_y_local(b.y)];objectContainer.buttonMode=!0;dragged_entity=_this;if(is_room_locked&&!my_user.role)_this.entity&&
"note"==_this.entity.type&&(_this.mouseup=toggle_note,_this.touchend=toggle_note,_this.mouseupoutside=toggle_note,_this.touchendoutside=toggle_note);else{"drag_context"!=active_context&&(context_before_drag=active_context);active_context="drag_context";_this.mouseup=on_drag_end;_this.touchend=on_drag_end;_this.mouseupoutside=on_drag_end;_this.touchendoutside=on_drag_end;_this.mousemove=on_drag_move;_this.touchmove=on_drag_move;$("html,body").css("cursor","pointer");move_selected=!1;if(_this.entity)for(var c in selected_entities){if(selected_entities[c].uid==
_this.entity.uid){move_selected=!0;break}}else move_selected=!0;move_selected||deselect_all();for(c in selected_entities)selected_entities[c].origin_x=selected_entities[c].x,selected_entities[c].origin_y=selected_entities[c].y,objectContainer.removeChild(selected_entities[c].container),objectContainer.addChild(selected_entities[c].container);_this.entity&&(_this.entity.origin_x=_this.entity.x,_this.entity.origin_y=_this.entity.y);drag_delay_running=!1;select_box&&(objectContainer.removeChild(select_box),
objectContainer.addChild(select_box));render_scene()}}},b)}function toggle_note(c){this.is_open=this.is_open?!1:!0;align_note_text(this.entity)}function move_entity(c,b,d){c.container&&(b=c.container.x+x_abs(b),d=c.container.y+y_abs(d),drag_entity(c,c.x+x_rel(b-c.container.x),c.y+y_rel(d-c.container.y)))}
function limit_rate(c,b,d){clearTimeout(b.timeout);b.last_trigger||(b.last_trigger=Date.now());Date.now()-b.last_trigger>c?(d(),b.last_trigger=Date.now()):b.timeout=setTimeout(function(){d();b.last_trigger=Date.now()},c+5)}var drag_state={};
function on_drag_move(c){_this=this;limit_rate(15,drag_state,function(){var b=c.data.getLocalPosition(background_sprite),b=[mouse_x_rel(b.x),mouse_y_rel(b.y)],d=b[0]-last_mouse_location[0],f=b[1]-last_mouse_location[1];if(move_selected)for(var a in selected_entities)move_entity(selected_entities[a],d,f);else move_entity(_this.entity,d,f);select_box&&(select_box.x+=x_abs(d),select_box.y+=y_abs(f));select_box&&(objectContainer.removeChild(select_box),objectContainer.addChild(select_box));last_mouse_location=
b;render_scene()})}
function on_drag_end(c){limit_rate(15,drag_state,function(){});if(this.entity&&Math.abs(this.entity.origin_x-this.entity.x)<EPSILON&&Math.abs(this.entity.origin_y-this.entity.y)<EPSILON)"remove_context"==context_before_drag?(remove(this.entity.uid),undo_list.push(clone_action(["remove",[this.entity]])),socket.emit("remove",room,this.entity.uid,active_slide)):"note"==this.entity.type&&(toggle_note.call(this,c),deselect_all());else{c=["drag",[]];if(0<selected_entities.length)for(var b in selected_entities){var d=[selected_entities[b].origin_x,
selected_entities[b].origin_y];c[1].push([d,selected_entities[b].uid]);delete selected_entities[b].origin_x;delete selected_entities[b].origin_y;socket.emit("drag",room,selected_entities[b].uid,active_slide,selected_entities[b].x,selected_entities[b].y)}else d=[this.entity.origin_x,this.entity.origin_y],c[1].push([d,this.entity.uid]),delete this.entity.origin_x,delete this.entity.origin_y,socket.emit("drag",room,this.entity.uid,active_slide,this.entity.x,this.entity.y);undo_list.push(clone_action(c))}cancel_drag();
render_scene()}
function remove(c,b){var d=room_data.slides[active_slide].entities[c];if(d&&d.container&&(dragged_entity&&dragged_entity.entity&&dragged_entity.entity.uid==c&&cancel_drag(!0),"note"==d.type&&d.container.menu.remove(),objectContainer.removeChild(d.container),delete d.container,"icon"==d.type))try{var f=$('button[id*="'+room_data.slides[active_slide].entities[c].tank+'"]').find("span");f[0].innerHTML=parseInt(f[0].innerHTML)-1;f=$("#icon_context").find("span").first();f.text((parseInt(f.text())-1).toString())}catch(a){}for(d=
selected_entities.length;d--;)if(selected_entities[d].uid==c){selected_entities.splice(d,1);"drag_context"==active_context&&move_selected&&cancel_drag(!0);break}b||delete room_data.slides[active_slide].entities[c];select_box_dirty=!0;render_scene()}function move_tracker(c,b,d){var f=.1*b,a=.1*d,g=10,e=setInterval(function(){trackers[c]&&(trackers[c].x+=f,trackers[c].y+=a,trackers[c].container.x+=x_abs(f),trackers[c].container.y+=y_abs(a),render_scene());g--;0==g&&clearInterval(e)},15)}
var scene_dirty=!1;function render_scene(){scene_dirty=!0}function get_offset(){return offset}function get_server_time(){return Date.now()+offset}function get_local_time(c){return c-offset}var ping_texture_atlas={};
function ping(c,b,d,f){var a=new PIXI.Sprite(ping_texture);a.tint=d;a.anchor.set(.5);a.height=y_abs(.01)*(f/10)*zoom_level;a.width=y_abs(.01)*(f/10)*zoom_level;a.x=x_abs(c);a.y=y_abs(b);objectContainer.addChild(a);render_scene();var g=25,e=a.height/5,k=setInterval(function(){a.height+=e;a.width+=e;a.alpha-=.02;render_scene();g--;0>=g&&(clearInterval(k),objectContainer.removeChild(a),render_scene())},20)}
function setup_mouse_events(c,b){objectContainer.mouseup=b;objectContainer.touchend=b;objectContainer.mouseupoutside=b;objectContainer.touchendoutside=b;objectContainer.mousemove=c;objectContainer.touchmove=c}
function align_note_text(c){if(c.container)if(c.container.is_open){var b=renderer.view.getBoundingClientRect(),d=b.left+to_x_local(c.x)+c.container.width*objectContainer.scale.x,b=b.top+to_y_local(c.y);c.container.menu.attr("style","top:"+b+"px; left:"+d+"px; display:block; z-index:20")}else c.container.menu.css("visibility","hidden")}
var drawArrow=function(c,b,d,f,a,g,e,k,h){var m=Math.atan2(a-d,f-b);g=Math.abs(h/Math.cos(k));e=m+Math.PI+k;h=f+Math.cos(e)*g;e=a+Math.sin(e)*g;k=m+Math.PI-k;f+=Math.cos(k)*g;a+=Math.sin(k)*g;c.beginPath();c.moveTo(h,e);c.lineTo(b,d);c.lineTo(f,a);c.quadraticCurveTo((h+b+f)/3,(e+d+a)/3,h,e);c.stroke();c.fill()};function hexToRGBA(c,b){var d=parseInt(c.slice(1,3),16),f=parseInt(c.slice(3,5),16),a=parseInt(c.slice(5,7),16);return"rgba("+d+", "+f+", "+a+", "+b+")"}
function init_canvas(c,b,d,f,a,g,e){d="#"+("00000"+(d|0).toString(16)).substr(-6);c.lineWidth=size_y/1E3*b*THICKNESS_SCALE;c.strokeStyle=d;c.fillStyle=d;c.shadowBlur=c.lineWidth/2;c.shadowColor="#000000";"setLineDash"in c&&("dashed"==f?(c.setLineDash([10,10]),c.lineJoin=c.lineCap="round"):"dotted"==f?(c.setLineDash([b,b]),c.lineJoin=c.lineCap="butt"):c.lineJoin=c.lineCap="round");"undefined"!==typeof a&&(g="#"+("00000"+(g|0).toString(16)).substr(-6),b=hexToRGBA(g,a),c.fillStyle=b,("00000"+(g|0).toString(16)).substr(-6),
d=hexToRGBA(d,e),c.strokeStyle=d)}function init_canvases(c,b,d,f,a,g){start_drawing();init_canvas(draw_context,c,b,d,f,a,g);init_canvas(temp_draw_context,c,b,d,f,a,g);draw_context.beginPath();temp_draw_context.beginPath()}function can_edit(){return!is_room_locked||my_user.role}function t2o(c){return 1-c/100}var last_draw_time,last_point;
function on_left_click(c){"drag_context"==active_context&&cancel_drag(!0);var b=c.data.getLocalPosition(background_sprite);if(can_edit()){try{document.activeElement.blur()}catch(d){}"drag_context"!=active_context&&("ping_context"!=active_context&&deselect_all(),"draw_context"==active_context?(setup_mouse_events(on_draw_move,on_draw_end),point_buffer=[],new_drawing={uid:newUid(),type:"drawing",x:mouse_x_rel(b.x),y:mouse_y_rel(b.y),scale:[1,1],color:draw_color,alpha:1,thickness:parseFloat(draw_thickness)*
zoom_level,end:$("#draw_end_type").find(".active").attr("data-end"),style:$("#draw_type").find(".active").attr("data-style"),path:[[0,0]],end_size:draw_end_size*zoom_level,draw_zoom_level:zoom_level},init_canvases(parseFloat(draw_thickness),new_drawing.color,new_drawing.style),draw_context.moveTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),last_draw_time=Date.now(),last_point=[to_x_local(mouse_x_rel(b.x)),to_y_local(mouse_y_rel(b.y))]):"ruler_context"==active_context?(setup_mouse_events(on_ruler_move,
on_ruler_end),init_canvases(.1,16777215,"full"),left_click_origin=[mouse_x_rel(b.x),mouse_y_rel(b.y)]):"line_context"==active_context?new_drawing||(setup_mouse_events(on_line_move,on_line_end),new_drawing={uid:newUid(),type:"line",x:mouse_x_rel(b.x),y:mouse_y_rel(b.y),scale:[1,1],color:line_color,alpha:1,thickness:parseFloat(line_thickness)*zoom_level,path:[[0,0]],end:$("#line_end_type").find(".active").attr("data-end"),style:$("#line_type").find(".active").attr("data-style"),end_size:line_end_size*
zoom_level,draw_zoom_level:zoom_level},init_canvases(parseFloat(line_thickness),new_drawing.color,new_drawing.style),draw_context.moveTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),just_activated=!0):"polygon_context"==active_context?new_drawing||(setup_mouse_events(on_line_move,on_polygon_end),new_drawing={uid:newUid(),type:"polygon",x:mouse_x_rel(b.x),y:mouse_y_rel(b.y),scale:[1,1],outline_thickness:polygon_outline_thickness*zoom_level,outline_color:polygon_outline_color,outline_opacity:t2o(polygon_outline_transparancy),
fill_color:polygon_fill_color,fill_opacity:t2o(polygon_fill_transparancy),alpha:1,path:[[0,0]],style:$("#polygon_type").find(".active").attr("data-style"),draw_zoom_level:zoom_level},init_canvases(polygon_outline_thickness,new_drawing.outline_color,new_drawing.style,new_drawing.fill_opacity,new_drawing.fill_color,new_drawing.outline_opacity),draw_context.moveTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),c="touchstart"==c.type?MIN_POLYGON_END_DISTANCE_TOUCH:MIN_POLYGON_END_DISTANCE,graphics=
new PIXI.Graphics,graphics.lineStyle(new_drawing.outline_thickness*THICKNESS_SCALE,new_drawing.outline_color,new_drawing.outline_opacity),graphics.moveTo(x_abs(mouse_x_rel(b.x)),y_abs(mouse_y_rel(b.y))),graphics.drawShape(new PIXI.Circle(x_abs(mouse_x_rel(b.x)),y_abs(mouse_y_rel(b.y)),size_y*c*zoom_level)),objectContainer.addChild(graphics),just_activated=!0,render_scene()):"curve_context"==active_context?new_drawing||(new_drawing={uid:newUid(),type:"curve",x:mouse_x_rel(b.x),y:mouse_y_rel(b.y),scale:[1,
1],color:curve_color,alpha:1,thickness:parseFloat(curve_thickness)*zoom_level,path:[[0,0]],end:$("#curve_end_type").find(".active").attr("data-end"),style:$("#curve_type").find(".active").attr("data-style"),end_size:curve_end_size*zoom_level,draw_zoom_level:zoom_level},point_buffer=[to_x_local(mouse_x_rel(b.x)),to_y_local(mouse_y_rel(b.y))],init_canvases(parseFloat(curve_thickness),new_drawing.color,new_drawing.style),draw_context.moveTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),setup_mouse_events(on_curve_move,
on_curve_end),just_activated=!0):"area_context"==active_context?new_drawing||(new_drawing={uid:newUid(),type:"area",x:mouse_x_rel(b.x),y:mouse_y_rel(b.y),scale:[1,1],outline_thickness:parseFloat(area_outline_thickness)*zoom_level,outline_color:area_outline_color,outline_opacity:t2o(area_outline_transparancy),fill_color:area_fill_color,fill_opacity:t2o(area_fill_transparancy),alpha:1,path:[[0,0]],style:$("#area_type").find(".active").attr("data-style"),draw_zoom_level:zoom_level},point_buffer=[to_x_local(mouse_x_rel(b.x)),
to_y_local(mouse_y_rel(b.y))],init_canvases(parseFloat(area_outline_thickness),new_drawing.outline_color,new_drawing.style,new_drawing.fill_opacity,new_drawing.fill_color,new_drawing.outline_opacity),draw_context.moveTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),c="touchstart"==c.type?MIN_POLYGON_END_DISTANCE_TOUCH:MIN_POLYGON_END_DISTANCE,graphics=new PIXI.Graphics,graphics.lineStyle(new_drawing.outline_thickness*THICKNESS_SCALE,new_drawing.outline_color,new_drawing.outline_opacity),graphics.moveTo(x_abs(mouse_x_rel(b.x)),
y_abs(mouse_y_rel(b.y))),graphics.drawShape(new PIXI.Circle(x_abs(mouse_x_rel(b.x)),y_abs(mouse_y_rel(b.y)),size_y*c*zoom_level)),objectContainer.addChild(graphics),setup_mouse_events(on_curve_move,on_area_end),just_activated=!0,render_scene()):"icon_context"==active_context?setup_mouse_events(void 0,on_icon_end):"eraser_context"==active_context?(hovering_over=void 0,setup_mouse_events(on_eraser_move,on_eraser_end)):"ping_context"==active_context?(drag_delay_running||deselect_all(),last_ping_time=
new Date,setup_mouse_events(on_ping_move,on_ping_end)):"select_context"==active_context?(setup_mouse_events(on_select_move,on_select_end),init_canvases(2,12303291,"dotted",.25,12303291,1),left_click_origin=[mouse_x_rel(b.x),mouse_y_rel(b.y)],deselect_all()):"text_context"==active_context?setup_mouse_events(void 0,on_text_end):"background_text_context"==active_context?setup_mouse_events(void 0,on_background_text_end):"rectangle_context"==active_context?new_drawing||(setup_mouse_events(on_rectangle_move,
on_rectangle_end),left_click_origin=[mouse_x_rel(b.x),mouse_y_rel(b.y)],init_canvases(rectangle_outline_thickness,rectangle_outline_color,$("#rectangle_type").find(".active").attr("data-style"),t2o(rectangle_fill_transparancy),rectangle_fill_color,t2o(rectangle_outline_transparancy)),just_activated=new_drawing=!0):"circle_context"==active_context?new_drawing||(setup_mouse_events(on_circle_move,on_circle_end),left_click_origin=[mouse_x_rel(b.x),mouse_y_rel(b.y)],init_canvases(circle_outline_thickness,
circle_outline_color,$("#circle_type").find(".active").attr("data-style"),t2o(circle_fill_transparancy),circle_fill_color,t2o(circle_outline_transparancy)),circle_draw_style=$("#circle_draw_style").find(".active").attr("data-draw_style"),just_activated=new_drawing=!0):"track_context"==active_context?my_tracker?stop_tracking():(start_tracking(b),on_track_move(c)):"note_context"==active_context&&setup_mouse_events(void 0,on_note_end))}else setup_mouse_events(on_ruler_move,on_ruler_end),init_canvases(.1,
16777215,"full"),left_click_origin=[mouse_x_rel(b.x),mouse_y_rel(b.y)]}var eraser_state={};function on_eraser_move(c){limit_rate(15,eraser_state,function(){hovering_over&&room_data.slides[active_slide].entities[hovering_over.uid]&&(remove(hovering_over.uid),undo_list.push(clone_action(["remove",[hovering_over]])),socket.emit("remove",room,hovering_over.uid,active_slide))})}function on_eraser_end(c){setup_mouse_events(void 0,void 0)}
function stop_tracking(){limit_rate(15,track_state,function(){});setup_mouse_events(void 0,void 0);socket.emit("stop_track",room,my_tracker.uid);objectContainer.removeChild(my_tracker.container);my_tracker=void 0;render_scene()}
function start_tracking(c){setup_mouse_events(on_track_move);var b=$("#track_shape .active").attr("data-cursor"),d;d="dot"==b||"cursor"==b?.025:.05;my_tracker={uid:newUid(),shape:b,size:track_size/10*d,color:track_color,x:mouse_x_rel(c.x),y:mouse_y_rel(c.y),owner:my_user.id};last_track_position=[my_tracker.x,my_tracker.y];socket.emit("track",room,my_tracker);create_tracker(my_tracker)}
function on_note_end(c){setup_mouse_events(void 0,void 0);var b=c.data.getLocalPosition(background_sprite);c=mouse_x_rel(b.x);b=mouse_y_rel(b.y);c={uid:newUid(),type:"note",x:c,y:b,scale:[1,1],color:text_color,alpha:1,text:"",font_size:font_size,font:"Arial",height:zoom_level};undo_list.push(clone_action(["add",[c]]));create_note(c);c.container.is_open=!0;align_note_text(c);snap_and_emit_entity(c)}
function create_note(c){var b;texture_atlas["note.png"]&&!is_safari()?(b=texture_atlas["note.png"],b=new PIXI.Texture(loader.resources[b.sprite].texture,new PIXI.Rectangle(b.x,b.y,b.width,b.height))):b=PIXI.Texture.fromImage(image_host+"note.png");b=new PIXI.Sprite(b);var d=b.width/b.height;b.height=x_abs(NOTE_SCALE)*c.height;b.width=b.height*d;b.x=x_abs(c.x);b.y=y_abs(c.y);c.container=b;c.container.entity=c;c.container.is_open=!1;c.container.menu=$('<div class="popover fade right in" role="tooltip"><h3 style="display: none;" class="popover-title"></h3><div class="popover-content"><textarea style="height:400px; width:300px;" id="note_box"></textarea><br /><span id="notification_area" style="float: left;" hidden>Saved</span><div style="float:right; padding:3px;"></div></div></div>');
$("#note_box",c.container.menu).val(c.text);is_room_locked&&!my_user.role&&($("textarea",c.container.menu).prop("readonly",!0),$("button",c.container.menu).hide());$("body").append(c.container.menu);$("#note_box",c.container.menu).on("blur",function(){can_edit()&&(c.text=$("#note_box",c.container.menu).val(),$("#notification_area",c.container.menu).show(),$("#notification_area",c.container.menu).fadeOut("slow"),snap_and_emit_entity(c))});align_note_text(c);make_draggable(c.container);objectContainer.addChild(c.container);
render_scene();b.texture.on("update",function(){render_scene()});room_data.slides[active_slide].entities[c.uid]=c}
function create_tracker(c){var b;texture_atlas[c.shape+".png"]&&!is_safari()?(b=texture_atlas[c.shape+".png"],b=new PIXI.Texture(loader.resources[b.sprite].texture,new PIXI.Rectangle(b.x,b.y,b.width,b.height))):b=PIXI.Texture.fromImage(image_host+c.shape+".png");c.container=new PIXI.Sprite(b);c.container.tint=c.color;"cursor"!=c.shape&&c.container.anchor.set(.5);c.container.x=x_abs(c.x);c.container.y=y_abs(c.y);b=c.container.width/c.container.height;c.container.height=y_abs(c.size);c.container.width=
c.container.height*b;trackers[c.uid]=c;objectContainer.addChild(trackers[c.uid].container);render_scene()}function remove_tracker(c){objectContainer.removeChild(trackers[c].container);render_scene();delete trackers[c]}var last_track_update=Date.now(),count,track_timeout,track_state={};
function on_track_move(c){limit_rate(15,track_state,function(){clearTimeout(track_timeout);var b=renderer.plugins.interaction.eventData.data.global,c=from_x_local(b.x),b=from_y_local(b.y);my_tracker.x=c;my_tracker.y=b;my_tracker.container.x=x_abs(c);my_tracker.container.y=y_abs(b);c=(last_track_position[0]-my_tracker.x)*(last_track_position[0]-my_tracker.x)+(last_track_position[1]-my_tracker.y)*(last_track_position[1]-my_tracker.y);render_scene();b=Date.now()-last_track_update;c>MIN_TRACK_MOVE_DISTANCE_SQ||
50<b?(last_track_update=Date.now(),0<Math.abs(my_tracker.x-last_track_position[0]+my_tracker.y-last_track_position[1])&&(socket.emit("track_move",room,my_tracker.uid,my_tracker.x-last_track_position[0],my_tracker.y-last_track_position[1]),last_track_position=[my_tracker.x,my_tracker.y])):track_timeout=setTimeout(function(){my_tracker&&(last_track_update=Date.now(),socket.emit("track_move",room,my_tracker.uid,my_tracker.x-last_track_position[0],my_tracker.y-last_track_position[1]),last_track_position=
[my_tracker.x,my_tracker.y],render_scene())},55)})}
function on_area_end(c){var b=renderer.plugins.interaction.eventData.data.global,d=b.x,f=b.y,a=Math.pow(new_drawing.x-from_x_local(d),2)+Math.pow(new_drawing.y-from_y_local(f),2),g="touchend"==c.type||"touchendoutside"==c.type?MIN_POLYGON_END_DISTANCE_TOUCH:MIN_POLYGON_END_DISTANCE;if(just_activated&&(just_activated=!1,a<EPSILON))return;a<g*g*zoom_level?(temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height),c=smooth_draw(temp_draw_context,point_buffer,!0),temp_draw_context.fill(),
draw_end(temp_draw_context,new_drawing,c[0],c[1]),canvas2container(temp_draw_context,temp_draw_canvas,new_drawing)&&(emit_entity(new_drawing),undo_list.push(clone_action(["add",[new_drawing]]))),objectContainer.removeChild(graphics),render_scene(),stop_drawing(),setup_mouse_events(void 0,void 0),new_drawing=null):(point_buffer.push(b.x,b.y),new_drawing.path.push([from_x_local(d)-new_drawing.x,from_y_local(f)-new_drawing.y]),on_curve_move(c))}var curve_state={},point_buffer=[];
function on_curve_move(c){limit_rate(20,curve_state,function(){var b=renderer.plugins.interaction.eventData.data.global,c=b.x,f=b.y;temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);point_buffer.push(c,f);var a=smooth_draw(temp_draw_context,point_buffer);point_buffer.pop();point_buffer.pop();new_drawing.path.push([from_x_local(b.x)-new_drawing.x,from_y_local(b.y)-new_drawing.y]);draw_end(temp_draw_context,new_drawing,a[0],a[1]);new_drawing.path.pop();last_point=[c,f]})}
function on_curve_end(c){var b=renderer.plugins.interaction.eventData.data.global,d=b.x,f=b.y,a=Math.pow(from_x_local(d)-new_drawing.x-new_drawing.path[new_drawing.path.length-1][0],2)+Math.pow(from_y_local(f)-new_drawing.y-new_drawing.path[new_drawing.path.length-1][1],2);if(just_activated&&(just_activated=!1,a<EPSILON))return;var g="touchend"==c.type||"touchendoutside"==c.type||"touchstart"==c.type||"touchstartoutside"==c.type?MIN_POLYGON_END_DISTANCE_TOUCH:MIN_POLYGON_END_DISTANCE;a<g*g*zoom_level?
(temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height),c=smooth_draw(temp_draw_context,point_buffer),draw_end(temp_draw_context,new_drawing,c[0],c[1]),canvas2container(temp_draw_context,temp_draw_canvas,new_drawing)&&(emit_entity(new_drawing),undo_list.push(clone_action(["add",[new_drawing]]))),objectContainer.removeChild(graphics),render_scene(),stop_drawing(),setup_mouse_events(void 0,void 0),new_drawing=null):(point_buffer.push(b.x,b.y),new_drawing.path.push([from_x_local(d)-
new_drawing.x,from_y_local(f)-new_drawing.y]),objectContainer.removeChild(graphics),graphics=new PIXI.Graphics,graphics.lineStyle(new_drawing.thickness*THICKNESS_SCALE,new_drawing.color,1),graphics.moveTo(x_abs(from_x_local(b.x)),y_abs(from_y_local(b.y))),graphics.drawShape(new PIXI.Circle(x_abs(from_x_local(b.x)),y_abs(from_y_local(b.y)),size_y*g*zoom_level)),objectContainer.addChild(graphics),render_scene(),on_curve_move(c))}
function on_polygon_end(c){try{var b=c.data.getLocalPosition(background_sprite),d=mouse_x_rel(b.x),f=mouse_y_rel(b.y),d=d-new_drawing.x,f=f-new_drawing.y}catch(e){}b=d*d+f*f;c="touchend"==c.type||"touchendoutside"==c.type?MIN_POLYGON_END_DISTANCE_TOUCH:MIN_POLYGON_END_DISTANCE;var a;a=1==new_drawing.path.length?[to_x_local(new_drawing.x),to_y_local(new_drawing.y)]:[to_x_local(new_drawing.path[new_drawing.path.length-2][0]+new_drawing.x),to_y_local(new_drawing.path[new_drawing.path.length-2][1]+new_drawing.y)];
var g=[to_x_local(d+new_drawing.x),to_y_local(f+new_drawing.y)];if(just_activated&&(a=Math.pow(a[0]-g[0],2)+Math.pow(a[1]-g[1],2),just_activated=!1,.01>a))return;b<c*c*zoom_level?(new_drawing.path.push([0,0]),draw_context.lineTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),draw_context.stroke(),draw_context.fill(),canvas2container(draw_context,draw_canvas,new_drawing)&&(emit_entity(new_drawing),undo_list.push(clone_action(["add",[new_drawing]]))),objectContainer.removeChild(graphics),render_scene(),
setup_mouse_events(void 0,void 0),stop_drawing(),new_drawing=null):(0!=new_drawing.path.length&&d==last(new_drawing.path)[0]&&f==last(new_drawing.path)[1]||new_drawing.path.push([d,f]),draw_context.lineTo(g[0],g[1]),draw_context.stroke())}function draw_shape(c,b,d,f,a,g){var e=new PIXI.Graphics;e.lineStyle(c*THICKNESS_SCALE,d,b);e.beginFill(a,f);e.drawShape(g);e.endFill();e.boundsPadding=1;return new PIXI.Sprite(e.generateTexture(renderer))}var ruler_state={};
function on_ruler_move(c){limit_rate(15,ruler_state,function(){var b=c.data.getLocalPosition(background_sprite),d=background.size_x?background.size_x:0,f=background.size_y?background.size_y:0;temp_draw_context.lineWidth=size_x/1E3*2;temp_draw_context.strokeStyle="#FFFFFF";temp_draw_context.fillStyle="#FFFFFF";var a=to_x_local(left_click_origin[0]),g=to_y_local(left_click_origin[1]),e=to_x_local(mouse_x_rel(b.x)),k=to_y_local(mouse_y_rel(b.y)),h=Math.sqrt(Math.pow(a-e,2)+Math.pow(g-k,2));temp_draw_context.clearRect(0,
0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.beginPath();temp_draw_context.moveTo(e,k);temp_draw_context.lineTo(a,g);temp_draw_context.moveTo(a+h,g);temp_draw_context.arc(a,g,h,0,2*Math.PI);temp_draw_context.stroke();a=(a+to_x_local(mouse_x_rel(b.x)))/2;g=(g+to_y_local(mouse_y_rel(b.y)))/2;temp_draw_context.font="22px Arial";b=Math.sqrt(Math.pow(d*(left_click_origin[0]-mouse_x_rel(b.x)),2)+Math.pow(f*(left_click_origin[1]-mouse_y_rel(b.y)),2));temp_draw_context.lineWidth=to_x_local(.5)/
1E3;temp_draw_context.strokeStyle="#000000";temp_draw_context.fillStyle="#FFFFFF";d="";d="lol"==game?d+(Math.round(10*b)/10+"u"):"wows"==game?d+(Math.round(.01*b)/10+"km"):d+(Math.round(10*b)/10+"m");temp_draw_context.fillText(d,a,g)})}function on_ruler_end(c){setup_mouse_events(void 0,void 0);limit_rate(15,ruler_state,function(){temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height)})}var circle_state={};
function on_circle_move(c){limit_rate(15,circle_state,function(){var b=renderer.plugins.interaction.eventData.data.global,c=from_x_local(b.x),f=from_y_local(b.y),a,g,e;"edge"==circle_draw_style?(a=(left_click_origin[0]+c)/2,g=(left_click_origin[1]+f)/2,e=Math.sqrt(Math.pow(to_x_local(left_click_origin[0])-to_x_local(c),2)+Math.pow(to_y_local(left_click_origin[1])-to_y_local(f),2)),e/=2):"radius"==circle_draw_style&&(a=left_click_origin[0],g=left_click_origin[1],e=Math.sqrt(Math.pow(to_x_local(left_click_origin[0])-
to_x_local(c),2)+Math.pow(to_y_local(left_click_origin[1])-to_y_local(f),2)));temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.beginPath();temp_draw_context.arc(to_x_local(a),to_y_local(g),e,0,2*Math.PI);temp_draw_context.fill();temp_draw_context.stroke();"radius"==circle_draw_style&&background.size_x&&0<background.size_x&&background.size_y&&0<background.size_y&&(temp_draw_context.save(),temp_draw_context.lineWidth=size_x/1E3*2,temp_draw_context.strokeStyle=
"#FFFFFF",temp_draw_context.fillStyle="#FFFFFF",temp_draw_context.shadowBlur=0,temp_draw_context.beginPath(),temp_draw_context.moveTo(to_x_local(a),to_y_local(g)),temp_draw_context.lineTo(to_x_local(c),to_y_local(f)),temp_draw_context.stroke(),e=to_x_local((a+c)/2),b=to_y_local((g+f)/2),temp_draw_context.font="22px Arial",c=Math.sqrt(Math.pow(background.size_x*(a-c),2)+Math.pow(background.size_y*(g-f),2)),temp_draw_context.lineWidth=to_x_local(.5)/1E3,temp_draw_context.strokeStyle="#000000",temp_draw_context.fillStyle=
"#FFFFFF",a="",a="lol"==game?a+(Math.round(10*c)/10+"u"):"wows"==game?a+(Math.round(.01*c)/10+"km"):a+(Math.round(10*c)/10+"m"),temp_draw_context.fillText(a,e,b),temp_draw_context.stroke(),temp_draw_context.restore())})}
function on_circle_end(c){limit_rate(15,circle_state,function(){});var b=renderer.plugins.interaction.eventData.data.global;c=from_x_local(b.x);var d=from_y_local(b.y),f,a,g;"edge"==circle_draw_style?(f=(left_click_origin[0]+c)/2,a=(left_click_origin[1]+d)/2,g=Math.sqrt(Math.pow(to_x_local(left_click_origin[0])-to_x_local(c),2)+Math.pow(to_y_local(left_click_origin[1])-to_y_local(d),2)),g/=2):"radius"==circle_draw_style&&(f=left_click_origin[0],a=left_click_origin[1],g=Math.sqrt(Math.pow(to_x_local(left_click_origin[0])-
to_x_local(c),2)+Math.pow(to_y_local(left_click_origin[1])-to_y_local(d),2)));temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.beginPath();temp_draw_context.arc(to_x_local(f),to_y_local(a),g,0,2*Math.PI);temp_draw_context.fill();temp_draw_context.stroke();g={uid:newUid(),type:"circle",x:f,y:a,radius:from_y_local_vect(g),outline_thickness:circle_outline_thickness*zoom_level,outline_color:circle_outline_color,outline_opacity:t2o(circle_outline_transparancy),
fill_opacity:t2o(circle_fill_transparancy),fill_color:circle_fill_color,alpha:1,style:$("#circle_type").find(".active").attr("data-style"),draw_zoom_level:zoom_level};new_drawing=void 0;if("radius"==circle_draw_style&&background.size_x&&0<background.size_x&&background.size_y&&0<background.size_y){g.draw_radius=[c,d];temp_draw_context.save();temp_draw_context.lineWidth=size_x/1E3*2;temp_draw_context.strokeStyle="#FFFFFF";temp_draw_context.fillStyle="#FFFFFF";temp_draw_context.shadowBlur=0;temp_draw_context.beginPath();
temp_draw_context.moveTo(to_x_local(f),to_y_local(a));temp_draw_context.lineTo(to_x_local(c),to_y_local(d));temp_draw_context.stroke();var b=to_x_local((f+c)/2),e=to_y_local((a+d)/2);temp_draw_context.font="22px Arial";f=Math.sqrt(Math.pow(background.size_x*(f-c),2)+Math.pow(background.size_y*(a-d),2));temp_draw_context.lineWidth=to_x_local(.5)/1E3;temp_draw_context.strokeStyle="#000000";temp_draw_context.fillStyle="#FFFFFF";a="";a="lol"==game?a+(Math.round(10*f)/10+"u"):"wows"==game?a+(Math.round(.01*
f)/10+"km"):a+(Math.round(10*f)/10+"m");temp_draw_context.fillText(a,b,e);temp_draw_context.stroke();temp_draw_context.restore()}canvas2container(temp_draw_context,temp_draw_canvas,g)&&(emit_entity(g),undo_list.push(clone_action(["add",[g]])));stop_drawing();setup_mouse_events(void 0,void 0)}var rectangle_state={};
function on_rectangle_move(c){limit_rate(15,rectangle_state,function(){var b=c.data.getLocalPosition(background_sprite),d=Math.min(left_click_origin[0],mouse_x_rel(b.x)),f=Math.min(left_click_origin[1],mouse_y_rel(b.y)),a=Math.max(left_click_origin[0],mouse_x_rel(b.x)),b=Math.max(left_click_origin[1],mouse_y_rel(b.y));temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.fillRect(to_x_local(d),to_y_local(f),to_x_local(a)-to_x_local(d),to_y_local(b)-to_y_local(f));
temp_draw_context.strokeRect(to_x_local(d),to_y_local(f),to_x_local(a)-to_x_local(d),to_y_local(b)-to_y_local(f))})}
function on_rectangle_end(c){limit_rate(15,rectangle_state,function(){});var b=c.data.getLocalPosition(background_sprite);c=Math.min(left_click_origin[0],mouse_x_rel(b.x));var d=Math.min(left_click_origin[1],mouse_y_rel(b.y)),f=Math.max(left_click_origin[0],mouse_x_rel(b.x)),b=Math.max(left_click_origin[1],mouse_y_rel(b.y));if(just_activated){var a=Math.pow(to_x_local(c-f),2)+Math.pow(to_y_local(d-b),2);just_activated=!1;if(.01>a)return}new_drawing=void 0;temp_draw_context.clearRect(0,0,temp_draw_canvas.width,
temp_draw_canvas.height);temp_draw_context.fillRect(to_x_local(c),to_y_local(d),to_x_local(f)-to_x_local(c),to_y_local(b)-to_y_local(d));temp_draw_context.strokeRect(to_x_local(c),to_y_local(d),to_x_local(f)-to_x_local(c),to_y_local(b)-to_y_local(d));c={uid:newUid(),type:"rectangle",x:c,y:d,width:f-c,height:b-d,outline_thickness:rectangle_outline_thickness*zoom_level,outline_color:rectangle_outline_color,outline_opacity:t2o(rectangle_outline_transparancy),fill_opacity:t2o(rectangle_fill_transparancy),
fill_color:rectangle_fill_color,alpha:1,style:$("#rectangle_type").find(".active").attr("data-style"),draw_zoom_level:zoom_level};canvas2container(temp_draw_context,temp_draw_canvas,c)&&(emit_entity(c),undo_list.push(clone_action(["add",[c]])));stop_drawing();setup_mouse_events(void 0,void 0)}var ping_state={};
function on_ping_move(c){limit_rate(60,drag_state,function(){var b=renderer.plugins.interaction.eventData.data.global,c=from_x_local(b.x),b=from_y_local(b.y);ping(c,b,ping_color,ping_size);socket.emit("ping_marker",room,c,b,ping_color,ping_size)})}
function on_ping_end(c){limit_rate(15,drag_state,function(){});var b=renderer.plugins.interaction.eventData.data.global;c=from_x_local(b.x);b=from_y_local(b.y);ping(c,b,ping_color,ping_size);socket.emit("ping_marker",room,c,b,ping_color,ping_size);setup_mouse_events(void 0,void 0)}var select_state={};
function on_select_move(c){limit_rate(15,select_state,function(){var b=c.data.getLocalPosition(background_sprite),d=Math.min(left_click_origin[0],mouse_x_rel(b.x)),f=Math.min(left_click_origin[1],mouse_y_rel(b.y)),a=Math.max(left_click_origin[0],mouse_x_rel(b.x)),b=Math.max(left_click_origin[1],mouse_y_rel(b.y));temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.fillRect(to_x_local(d),to_y_local(f),to_x_local(a)-to_x_local(d),to_y_local(b)-to_y_local(f));
temp_draw_context.strokeRect(to_x_local(d),to_y_local(f),to_x_local(a)-to_x_local(d),to_y_local(b)-to_y_local(f))})}
function on_select_end(c){limit_rate(15,select_state,function(){temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height)});setup_mouse_events(void 0,void 0);var b=c.data.getLocalPosition(background_sprite);c=Math.min(x_abs(mouse_x_rel(b.x)),x_abs(left_click_origin[0]));var d=Math.min(y_abs(mouse_y_rel(b.y)),y_abs(left_click_origin[1])),f=Math.max(x_abs(mouse_x_rel(b.x)),x_abs(left_click_origin[0])),b=Math.max(y_abs(mouse_y_rel(b.y)),y_abs(left_click_origin[1])),a;for(a in room_data.slides[active_slide].entities)if(room_data.slides[active_slide].entities.hasOwnProperty(a)&&
room_data.slides[active_slide].entities[a].container){var g=room_data.slides[active_slide].entities[a].container.getBounds();g.width/=objectContainer.scale.x;g.height/=objectContainer.scale.y;g.x=(-objectContainer.x+g.x)/objectContainer.scale.x;g.y=(-objectContainer.y+g.y)/objectContainer.scale.y;var e=g.y,k=g.x+g.width,h=g.y+g.height;g.x>c&&e>d&&k<f&&h<b&&selected_entities.push(room_data.slides[active_slide].entities[a])}select_entities();undo_list.push(clone_action(["select",selected_entities,previously_selected_entities]));
render_scene()}function measure_text(c){return[x_rel(c.container.width),x_rel(c.container.height)]}
function select_box_mousemove(c,b,d,f,a,g,e){limit_rate(15,select_box_move_state,function(){var c=renderer.plugins.interaction.eventData.data.global;c.x=x_abs(from_x_local(c.x));c.y=y_abs(from_y_local(c.y));var h=Math.abs((c.x-b)/f),m=Math.abs((c.y-d)/a),n;for(n in selected_entities){var q=selected_entities[n];g||(q.container.scale.x=h*q.container.start_scale[0],q.container.x=(q.container.x_orig-b)*h+b);e||(q.container.scale.y=m*q.container.start_scale[1],q.container.y=(q.container.y_orig-d)*m+d)}g||
(select_box.width=Math.abs(b-c.x),select_box.left_x=Math.min(b,c.x),select_box.x=select_box.left_x+select_box.width/2);e||(select_box.height=Math.abs(d-c.y),select_box.upper_y=Math.min(d,c.y),select_box.y=select_box.upper_y+select_box.height/2);render_scene()});c.stopPropagation()}
function select_box_mouseup(c,b,d,f,a,g,e){limit_rate(15,select_box_move_state,function(){});var k=renderer.plugins.interaction.eventData.data.global;k.x=x_abs(from_x_local(k.x));k.y=y_abs(from_y_local(k.y));f=Math.abs((k.x-b)/f);a=Math.abs((k.y-d)/a);var h=["drag",[]],m;for(m in selected_entities){var n=selected_entities[m],q=[1,1];n.scale&&(q=[n.scale[0],n.scale[1]]);h[1].push([[n.x,n.y,[q[0],q[1]]],n.uid]);var w=n.x,p=n.y;g||(w=x_rel((n.container.x_orig-b)*f+b-n.container.x_orig)+n.x,q[0]=f*n.container.start_scale[0]/
n.container.orig_scale[0]);e||(p=y_rel((n.container.y_orig-d)*a+d-n.container.y_orig)+n.y,q[1]=a*n.container.start_scale[1]/n.container.orig_scale[1]);n.container.x=n.container.x_orig;n.container.y=n.container.y_orig;drag_entity(n,w,p,q);socket.emit("drag",room,n.uid,active_slide,w,p,q)}undo_list.push(clone_action(h));select_box.mousedown=void 0;select_box.mousemove=on_selectbox_move;select_box.mouseup=void 0;select_box.mouseupoutside=void 0;objectContainer.mouseup=void 0;objectContainer.mouseupoutside=
void 0;g||(select_box.width=Math.abs(b-k.x),select_box.left_x=Math.min(b,k.x),select_box.x=select_box.left_x+select_box.width/2);e||(select_box.height=Math.abs(d-k.y),select_box.upper_y=Math.min(d,k.y),select_box.y=select_box.upper_y+select_box.height/2);render_scene();c.stopPropagation()}
function prepare_resize(c,b,d,f,a,g,e){for(var k in selected_entities){var h=selected_entities[k];h.container.x_orig=h.container.x;h.container.y_orig=h.container.y;h.container.start_scale=[h.container.scale.x,h.container.scale.y]}objectContainer.removeChild(rotate_arrow0);objectContainer.removeChild(rotate_arrow1);objectContainer.removeChild(rotate_arrow2);objectContainer.removeChild(rotate_arrow3);objectContainer.mousedown=on_left_click;select_box.mouseup=function(c){select_box_mouseup(c,b,d,f,a,
g,e)};select_box.mouseupoutside=select_box.mouseup;objectContainer.mouseup=select_box.mouseup;objectContainer.mouseupoutside=select_box.mouseup;select_box.mousemove=function(c){select_box_mousemove(c,b,d,f,a,g,e)};c.stopPropagation()}var select_box_move_state={};
function on_selectbox_move(c){limit_rate(15,select_box_move_state,function(){var b=renderer.plugins.interaction.eventData.data.global;b.x=x_abs(from_x_local(b.x));b.y=y_abs(from_y_local(b.y));b.x-=select_box.left_x;b.y-=select_box.upper_y;b.x/=select_box.width;b.y/=select_box.height;var d=y_abs(ROTATE_ARROW_MARGIN)*zoom_level,f=d/select_box.width,d=d/select_box.height,a=select_box.left_x,g=select_box.upper_y,e=a+select_box.width,k=g+select_box.height;b.x<0-f||b.x>1+f||b.y<0-d||b.y>1+d?(on_select_out(c),
c&&c.stopPropagation()):(f=Math.min(f,.25),d=Math.min(d,.25),b.x<f?(b.y<d?($("html,body").css("cursor","nw-resize"),objectContainer.mousedown=function(a){prepare_resize(a,e,k,select_box.width,select_box.height,!1,!1)}):b.y>1-d?($("html,body").css("cursor","sw-resize"),objectContainer.mousedown=function(a){prepare_resize(a,e,g,select_box.width,select_box.height,!1,!1)}):($("html,body").css("cursor","w-resize"),objectContainer.mousedown=function(a){prepare_resize(a,e,0,select_box.width,select_box.height,
!1,!0)}),select_box.mousedown=objectContainer.mousedown):b.x>1-f?(b.y<d?($("html,body").css("cursor","ne-resize"),objectContainer.mousedown=function(b){prepare_resize(b,a,k,select_box.width,select_box.height,!1,!1)}):b.y>1-d?($("html,body").css("cursor","se-resize"),objectContainer.mousedown=function(b){prepare_resize(b,a,g,select_box.width,select_box.height,!1,!1)}):($("html,body").css("cursor","e-resize"),objectContainer.mousedown=function(b){prepare_resize(b,a,0,select_box.width,select_box.height,
!1,!0)}),select_box.mousedown=objectContainer.mousedown):b.y<d?($("html,body").css("cursor","n-resize"),objectContainer.mousedown=function(a){prepare_resize(a,0,k,select_box.width,select_box.height,!0,!1)},select_box.mousedown=objectContainer.mousedown):b.y>1-d?($("html,body").css("cursor","s-resize"),objectContainer.mousedown=function(a){prepare_resize(a,0,g,select_box.width,select_box.height,!0,!1)},select_box.mousedown=objectContainer.mousedown):($("html,body").css("cursor","move"),select_box.mousedown=
on_drag_start,objectContainer.mousedown=on_left_click))});c&&c.stopPropagation()}function on_select_over(c){select_box.mousemove=on_selectbox_move;select_box.mouseout=on_select_out}function on_select_out(c){limit_rate(15,select_box_move_state,function(){});$("html,body").css("cursor","initial");select_box.mousemove=void 0;select_box.mousedown=void 0;objectContainer.mousedown=on_left_click;select_box.mouseout=void 0}function make_resizable(c){c.interactive=!0;c.mouseover=on_select_over}
function redraw_select_box(){if(select_box)if(select_box.rotation=0,0<selected_entities.length){var c=99999,b=-99999,d=99999,f=-99999,a;for(a in selected_entities){var g=selected_entities[a].container,e,k,h;k=-g.rotation;e=Math.abs(g.width*Math.cos(k))+Math.abs(g.height*Math.sin(k));k=Math.abs(g.width*Math.sin(k))+Math.abs(g.height*Math.cos(k));h=g.x-g.anchor.x*e;g=g.y-g.anchor.y*k;c=Math.min(h,c);d=Math.min(g,d);b=Math.max(h+e,b);f=Math.max(g+k,f)}select_center=[x_rel(c+(b-c)/2),y_rel(d+(f-d)/2)];
select_box.left_x=c;select_box.upper_y=d;select_box.width=b-c;select_box.height=f-d;select_box.x=c+select_box.width/2;select_box.y=d+select_box.height/2;rotate_arrow0.x=c+select_box.width+rotate_arrow0.width/2+y_abs(ROTATE_ARROW_MARGIN)*zoom_level;rotate_arrow0.y=d+select_box.height/2;rotate_arrow1.x=c+select_box.width/2;rotate_arrow1.y=d-rotate_arrow1.width/2-y_abs(ROTATE_ARROW_MARGIN)*zoom_level;rotate_arrow2.x=c-rotate_arrow2.width/2-y_abs(ROTATE_ARROW_MARGIN)*zoom_level;rotate_arrow2.y=d+select_box.height/
2;rotate_arrow3.x=c+select_box.width/2;rotate_arrow3.y=d+rotate_arrow3.width/2+select_box.height+y_abs(ROTATE_ARROW_MARGIN)*zoom_level;objectContainer.removeChild(rotate_arrow0);objectContainer.removeChild(rotate_arrow1);objectContainer.removeChild(rotate_arrow2);objectContainer.removeChild(rotate_arrow3);objectContainer.addChild(rotate_arrow0);objectContainer.addChild(rotate_arrow1);objectContainer.addChild(rotate_arrow2);objectContainer.addChild(rotate_arrow3);objectContainer.removeChild(select_box);
objectContainer.addChild(select_box)}else remove_select_box();select_box_dirty=!1}
function start_rotate_selection(c,b){limit_rate(15,drag_state,function(){});setup_mouse_events(rotate_selection.bind(void 0,this,c),stop_rotate_selection.bind(void 0,this,c));var d=b.data.getLocalPosition(background_sprite);objectContainer.buttonMode=!0;last_mouse_location=[mouse_x_rel(d.x),mouse_y_rel(d.y)];for(var f in selected_entities)d=room_data.slides[active_slide].entities[selected_entities[f].uid].container,d.x_orig=d.x,d.y_orig=d.y,d.rotation_orig=d.rotation;objectContainer.removeChild(rotate_arrow0);
objectContainer.removeChild(rotate_arrow1);objectContainer.removeChild(rotate_arrow2);objectContainer.removeChild(rotate_arrow3);objectContainer.addChild(this);b.stopPropagation()}
function rotate_selection(c,b,d){limit_rate(15,drag_state,function(){var f=d.data.getLocalPosition(background_sprite),f=[mouse_x_rel(f.x),mouse_y_rel(f.y)],a=f[1]-last_mouse_location[1];c.x+=x_abs(f[0]-last_mouse_location[0]);c.y+=y_abs(a);b=Math.atan2(-(f[1]-select_center[1]),f[0]-select_center[0])-b;var a=Math.sin(-b),g=Math.cos(-b),e;for(e in selected_entities){var k=room_data.slides[active_slide].entities[selected_entities[e].uid].container;k.x=k.x_orig;k.y=k.y_orig;k.x-=x_abs(select_center[0]);
k.y-=y_abs(select_center[1]);var h=k.x;k.x=k.x*g-k.y*a;k.y=h*a+k.y*g;k.x+=x_abs(select_center[0]);k.y+=y_abs(select_center[1]);k.rotation=k.rotation_orig-b}select_box.rotation=-b;last_mouse_location=f;render_scene()})}
function stop_rotate_selection(c,b,d){limit_rate(15,drag_state,function(){});objectContainer.buttonMode=!1;setup_mouse_events(void 0,void 0);d=d.data.getLocalPosition(background_sprite);d=[mouse_x_rel(d.x),mouse_y_rel(d.y)];var f=d[1]-last_mouse_location[1];c.x+=x_abs(d[0]-last_mouse_location[0]);c.y+=y_abs(f);b=Math.atan2(-(d[1]-select_center[1]),d[0]-select_center[0])-b;c=Math.sin(-b);d=Math.cos(-b);var f=["drag",[]],a;for(a in selected_entities){var g=room_data.slides[active_slide].entities[selected_entities[a].uid],
e=g.container,e=room_data.slides[active_slide].entities[selected_entities[a].uid].container;e.x=e.x_orig;e.y=e.y_orig;e.x-=x_abs(select_center[0]);e.y-=y_abs(select_center[1]);var k=e.x;e.x=e.x*d-e.y*c;e.y=k*c+e.y*d;e.x+=x_abs(select_center[0]);e.y+=y_abs(select_center[1]);k=[1,1];g.scale&&(k=[g.scale[0],g.scale[1]]);var h=0;g.rotation&&(h=g.rotation);f[1].push([[g.x,g.y,[k[0],k[1]],h],g.uid]);k=e.x-e.x_orig;h=e.y-e.y_orig;e.x=e.x_orig;e.y=e.y_orig;g.rotation||(g.rotation=0);e=(g.rotation+b)%(2*Math.PI);
socket.emit("drag",room,g.uid,active_slide,x_rel(x_abs(g.x)+k),y_rel(y_abs(g.y)+h),g.scale,e);drag_entity(g,x_rel(x_abs(g.x)+k),y_rel(y_abs(g.y)+h),g.scale,e)}undo_list.push(clone_action(f));select_box_dirty=!0;render_scene()}
function select_entities(){remove_select_box();var c=99999,b=-99999,d=99999,f=-99999,a;for(a in selected_entities){var g=room_data.slides[active_slide].entities[selected_entities[a].uid].container,e,k,h;k=-g.rotation;e=Math.abs(g.width*Math.cos(k))+Math.abs(g.height*Math.sin(k));k=Math.abs(g.width*Math.sin(k))+Math.abs(g.height*Math.cos(k));h=g.x-g.anchor.x*e;g=g.y-g.anchor.y*k;c=Math.min(x_rel(h),c);d=Math.min(y_rel(g),d);b=Math.max(x_rel(h)+x_rel(e),b);f=Math.max(y_rel(g)+y_rel(k),f);room_data.slides[active_slide].entities[selected_entities[a].uid].container.alpha=
select_alpha}if(0<selected_entities.length){select_center=[c+(b-c)/2,d+(f-d)/2];a=new PIXI.Rectangle(0,0,x_abs(b-c),y_abs(f-d),5);select_box=draw_select_box(a);select_box.anchor.x=.5;select_box.anchor.y=.5;a=x_abs(c);e=y_abs(d);select_box.left_x=a;select_box.upper_y=e;select_box.x=a+x_abs(b-c)/2;select_box.y=e+y_abs(f-d)/2;make_resizable(select_box);var m=new PIXI.Texture.fromImage(image_host+"rotate.png"),c=m.width/m.height,n=y_abs(ROTATE_ARROW_SCALE)*zoom_level,q=n*c,c=function(a,b,c){var d=new PIXI.Sprite(m);
d.anchor.x=.5;d.anchor.y=.5;d.width=q;d.height=n;d.interactive=!0;d.buttonMode=!0;d.draggable=!0;d.mousedown=start_rotate_selection.bind(d,c);d.rotation=-c;d.x=a;d.y=b;objectContainer.addChild(d);return d};rotate_arrow0=c(a+select_box.width+q/2+y_abs(ROTATE_ARROW_MARGIN)*zoom_level,e+select_box.height/2,0);rotate_arrow1=c(a+select_box.width/2,e-q/2-y_abs(ROTATE_ARROW_MARGIN)*zoom_level,Math.PI/2);rotate_arrow2=c(a-q/2-y_abs(ROTATE_ARROW_MARGIN)*zoom_level,e+select_box.height/2,Math.PI);rotate_arrow3=
c(a+select_box.width/2,e+q/2+select_box.height+y_abs(ROTATE_ARROW_MARGIN)*zoom_level,-Math.PI/2);objectContainer.addChild(select_box)}render_scene()}function draw_select_box(c){var b=new PIXI.Graphics;b.lineStyle(1*zoom_level,16777215,.2);b.beginFill(16777215,.2);b.drawShape(c);b.endFill();return new PIXI.Sprite(b.generateTexture(renderer))}
function select_all(){previously_selected_entities=selected_entities;selected_entities=[];for(var c in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities.hasOwnProperty(c)&&room_data.slides[active_slide].entities[c].container&&selected_entities.push(room_data.slides[active_slide].entities[c]);select_entities();undo_list.push(clone_action(["select",selected_entities,previously_selected_entities]))}
function remove_select_box(){limit_rate(15,select_box_move_state,function(){});select_box&&(select_box.mousedown=void 0,select_box.mousemove=void 0,select_box.mouseup=void 0,select_box.mouseout=void 0,select_box.mouseover=void 0,select_box.mouseupoutside=void 0,objectContainer.mousedown=on_left_click,objectContainer.removeChild(select_box),objectContainer.removeChild(rotate_arrow0),objectContainer.removeChild(rotate_arrow1),objectContainer.removeChild(rotate_arrow2),objectContainer.removeChild(rotate_arrow3),
select_box=void 0,render_scene());$("html,body").css("cursor","initial")}function deselect_all(){remove_select_box();previously_selected_entities=selected_entities;for(var c in selected_entities)selected_entities[c].container.filters=void 0,selected_entities[c].container.alpha=selected_entities[c].alpha;selected_entities=[]}var INTERPOLATION_RESOLUTION=25,INTERPOLATION_TENSION=.5,INTERPOLATION_LOOKBACK=10;
function smooth_draw(c,b,d){b=getCurvePoints(b,INTERPOLATION_TENSION,INTERPOLATION_RESOLUTION,d);c.beginPath();c.moveTo(b[0],b[1]);for(d=2;d<b.length;d+=2)c.lineTo(b[d],b[d+1]);c.stroke();return[[b[b.length-4],b[b.length-3]],[b[b.length-2],b[b.length-1]]]}
function smooth_draw_incremental(c,b,d,f){var a=getCurvePoints(d,INTERPOLATION_TENSION,INTERPOLATION_RESOLUTION),g=INTERPOLATION_LOOKBACK*INTERPOLATION_RESOLUTION;d.length<2*INTERPOLATION_LOOKBACK&&(g=0);d.length==3*INTERPOLATION_LOOKBACK&&(g=2*INTERPOLATION_LOOKBACK*INTERPOLATION_RESOLUTION);b.moveTo(a[g],a[g+1]);b.beginPath();for(g+=2;g<a.length;g+=2)b.lineTo(a[g],a[g+1]);b.stroke();if(d.length==2*INTERPOLATION_LOOKBACK||d.length==3*INTERPOLATION_LOOKBACK||f){g=INTERPOLATION_LOOKBACK*INTERPOLATION_RESOLUTION;
b=f?a.length:a.length-(INTERPOLATION_LOOKBACK-2)*INTERPOLATION_RESOLUTION;d.length==2*INTERPOLATION_LOOKBACK&&(g=2,c.beginPath(),c.moveTo(a[0],a[1]));for(c.clearRect(0,0,c.canvas.width,c.canvas.height);g<b;g+=2)c.lineTo(a[g],a[g+1]);c.stroke();d.length==3*INTERPOLATION_LOOKBACK&&d.splice(0,INTERPOLATION_LOOKBACK)}}var draw_state={},point_buffer=[];
function on_draw_move(c){limit_rate(20,draw_state,function(){var b=renderer.plugins.interaction.eventData.data.global,c=last_point[0]*MOUSE_DRAW_SMOOTHING+(1-MOUSE_DRAW_SMOOTHING)*b.x,f=last_point[1]*MOUSE_DRAW_SMOOTHING+(1-MOUSE_DRAW_SMOOTHING)*b.y;new_drawing.path.push([from_x_local(c)-new_drawing.x,from_y_local(f)-new_drawing.y]);temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);point_buffer.push(c,f,b.x,b.y);smooth_draw_incremental(draw_context,temp_draw_context,
point_buffer);point_buffer.pop();point_buffer.pop();new_drawing.path.push([from_x_local(b.x)-new_drawing.x,from_y_local(b.y)-new_drawing.y]);draw_end_path(temp_draw_context,new_drawing);new_drawing.path.pop();last_point=[c,f]})}
function on_draw_end(c){limit_rate(20,draw_state,function(){});c=renderer.plugins.interaction.eventData.data.global;point_buffer.push(last_point[0],last_point[1],c.x,c.y);smooth_draw_incremental(draw_context,temp_draw_context,point_buffer,!0);new_drawing.path.push([from_x_local(c.x)-new_drawing.x,from_y_local(c.y)-new_drawing.y]);draw_context.beginPath();draw_end_path(draw_context,new_drawing);canvas2container(draw_context,draw_canvas,new_drawing)&&(emit_entity(new_drawing),undo_list.push(clone_action(["add",
[new_drawing]])));temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);draw_context.clearRect(0,0,draw_canvas.width,draw_canvas.height);draw_context.beginPath();temp_draw_context.beginPath();setup_mouse_events(void 0,void 0);new_drawing=null}
function autocrop_canvas(c){var b=c.getContext("2d"),d=c.width,f=c.height,a=[],g=[],e=b.getImageData(0,0,c.width,c.height),k,h;for(k=0;k<f;k++)for(c=0;c<d;c++)h=4*(k*d+c),0<e.data[h+3]&&(a.push(c),g.push(k));a.sort(function(a,b){return a-b});g.sort(function(a,b){return a-b});f=a.length-1;c=a[0];k=g[0];d=a[f]-a[0]+1;f=g[f]-g[0]+1;a=document.createElement("canvas");a.width=d;a.height=f;g=a.getContext("2d");if(isNaN(c)||isNaN(k)||isNaN(d)||isNaN(f))return null;b=b.getImageData(c,k,d,f);g.putImageData(b,
0,0);a.x=c;a.y=k;return a}function createSprite(c,b){if(b=autocrop_canvas(b)){var d=PIXI.Texture.fromCanvas(b),d=new PIXI.Sprite(d);d.x=x_abs(from_x_local(b.x));d.y=y_abs(from_y_local(b.y));return d}return null}function drawRotatedImage(c,b,d){c.save();c.translate(b.width/2,b.height/2);c.rotate(d);c.translate(-(b.width/2),-(b.height/2));c.drawImage(b,0,0);c.restore()}
function draw_end_path(c,b){if(b.path.length>=ARROW_LOOKBACK){var d=Math.max(0,b.path.length-ARROW_LOOKBACK),d=[to_x_local(b.x+b.path[d][0]),to_y_local(b.y+b.path[d][1])],f=[to_x_local(b.x+b.path[b.path.length-1][0]),to_y_local(b.y+b.path[b.path.length-1][1])];draw_end(c,b,d,f)}}
function draw_end(c,b,d,f,a){a=void 0===a?1/zoom_level:a;var g=ARROW_SCALE*b.thickness*background_sprite.height*objectContainer.scale.y;b.end_size&&(g=size_y/1E3*b.end_size*a);c.stroke();c.beginPath();"arrow"==b.end?draw_arrow(c,d,f,g):"T"==b.end&&draw_T(c,d,f,g)}function draw_arrow(c,b,d,f){var a=d[0]-b[0];b=d[1]-b[1];l=Math.sqrt(Math.pow(a,2)+Math.pow(b,2));a/=l;b/=l;drawArrow(c,d[0],d[1],d[0]+a,d[1]+b,3,1,Math.PI/8,f*ARROW_SCALE2)}
function draw_T(c,b,d,f){f*=TEND_SCALE2;var a=d[0]-b[0];b=d[1]-b[1];l=Math.sqrt(Math.pow(a,2)+Math.pow(b,2));a/=l;b/=l;b=-b;c.stroke();var g=c.getLineDash();c.setLineDash([]);c.beginPath();c.moveTo(d[0]-f*b,d[1]-f*a);c.lineTo(d[0]+f*b,d[1]+f*a);c.stroke();c.setLineDash(g)}function canvas2sprite(c,b){var d=createSprite(c,b);return d?(d.height/=objectContainer.scale.x,d.width/=objectContainer.scale.y,d):!1}
function canvas2container(c,b,d){return(c=createSprite(c,b))?(d.container=c,c.height/=objectContainer.scale.x,c.width/=objectContainer.scale.y,objectContainer.addChild(c),c.texture.baseTexture.source.src=d.uid,c.hitArea=new PIXI.TransparencyHitArea.create(c,!1),make_draggable(c),c.entity=d,room_data.slides[active_slide].entities[d.uid]=d,render_scene(),!0):!1}
function init_shape_canvas(c,b,d){init_canvas(c,b.outline_thickness*(void 0===d?1:d),b.outline_color,b.style,b.fill_opacity,b.fill_color,b.outline_opacity)}
function create_rectangle2(c){var b=document.createElement("canvas"),d=b.getContext("2d"),f=background_sprite.width,a=background_sprite.height,g=1;c.draw_zoom_level&&(g=1/c.draw_zoom_level);b.width=f*c.width*g+50;b.height=a*c.height*g+50;init_shape_canvas(d,c,g);d.fillRect(25,25,f*c.width*g,a*c.height*g);d.strokeRect(25,25,f*c.width*g,a*c.height*g);canvas2container2(d,b,c);objectContainer.addChild(c.container);c.container.x=x_abs(c.x)-25/g;c.container.y=y_abs(c.y)-25/g;c.container.width/=g;c.container.height/=
g;render_scene()}
function create_circle2(c){var b=document.createElement("canvas"),d=b.getContext("2d"),f=background_sprite.height,a=1;c.draw_zoom_level&&(a=1/c.draw_zoom_level);b.width=2*f*c.radius*a+50;b.height=2*f*c.radius*a+50;init_shape_canvas(d,c,a);to_x_local_vect(c.radius);d.beginPath();d.arc(f*c.radius*a+25,f*c.radius*a+25,f*c.radius*a,0,2*Math.PI);d.fill();d.stroke();if(c.draw_radius){d.save();d.lineWidth=size_x/1E3*2;d.strokeStyle="#FFFFFF";d.fillStyle="#FFFFFF";d.beginPath();d.moveTo(f*c.radius*a+25,f*
c.radius*a+25);d.lineTo(f*a*(c.radius+c.draw_radius[0]-c.x)+25,f*a*(c.radius+c.draw_radius[1]-c.y)+25);d.stroke();var g=f*a*(c.radius+(c.draw_radius[0]-c.x)/2)+25,e=f*a*(c.radius+(c.draw_radius[1]-c.y)/2)+25;d.font="22px Arial";var k=Math.sqrt(Math.pow(background.size_x*(c.x-c.draw_radius[0]),2)+Math.pow(background.size_y*(c.y-c.draw_radius[1]),2));d.lineWidth=to_x_local(.5)/1E3;d.strokeStyle="#000000";d.fillStyle="#FFFFFF";var h="",h="lol"==game?h+(Math.round(10*k)/10+"u"):"wows"==game?h+(Math.round(.01*
k)/10+"km"):h+(Math.round(10*k)/10+"m");d.fillText(h,g,e);d.restore()}canvas2container2(d,b,c);objectContainer.addChild(c.container);c.container.x=x_abs(c.x)-f*c.radius-25/a;c.container.y=y_abs(c.y)-f*c.radius-25/a;c.container.width/=a;c.container.height/=a;render_scene()}
function canvas2container2(c,b,d){c=PIXI.Texture.fromCanvas(b);c=new PIXI.Sprite(c);d.container=c;c.texture.baseTexture.source.src=d.uid;c.hitArea=new PIXI.TransparencyHitArea.create(c,!1);make_draggable(c);c.entity=d;room_data.slides[active_slide].entities[d.uid]=d;return!0}
function draw_entity(c,b){("00000"+(c.color|0).toString(16)).substr(-6);var d=document.createElement("canvas"),f=d.getContext("2d"),a=[],g=background_sprite.width,e=background_sprite.height,k=1;c.draw_zoom_level&&(k/=c.draw_zoom_level);if(0<c.path.length){for(var h=9999,m=9999,n=-9999,q=-9999,w=0;w<c.path.length;w++){var p=c.path[w][0],v=c.path[w][1],h=Math.min(h,p),m=Math.min(m,v),n=Math.max(n,p),q=Math.max(q,v);a.push(g*p*k,e*v*k)}p=50;c.end_size&&(p=c.end_size*k*3);d.width=g*(n-h)*k+p;d.height=
e*(q-m)*k+p;g=-h*g*k+p/2;e=-m*e*k+p/2;for(w=0;w<a.length;w+=2)a[w]+=g,a[w+1]+=e;b(f,a,k);canvas2container2(f,d,c);c.container.height/=k;c.container.width/=k;c.container.x=x_abs(c.x)+x_abs(h)-p/2/k;c.container.y=y_abs(c.y)+y_abs(m)-p/2/k;objectContainer.addChild(c.container);render_scene()}}
function create_drawing2(c){draw_entity(c,function(b,d,f){init_canvas(b,c.thickness*f,c.color,c.style);var a=smooth_draw(b,d);if(c.end){if(c.path.length>=ARROW_LOOKBACK){var g=Math.max(0,c.path.length-ARROW_LOOKBACK);a[0]=[d[2*g],d[2*g+1]]}draw_end(b,c,a[0],a[1],f)}})}function create_curve2(c){draw_entity(c,function(b,d,f){init_canvas(b,c.thickness*f,c.color,c.style);d=smooth_draw(b,d,!1);c.end&&draw_end(b,c,d[0],d[1],f)})}
function create_area2(c){c.path[c.path.length-1]==[0,0]&&c.path.pop();draw_entity(c,function(b,d,f){init_shape_canvas(b,c,f);smooth_draw(b,d,!0);b.fill()})}function create_line2(c){draw_entity(c,function(b,d,f){init_canvas(b,c.thickness*f,c.color,c.style);b.moveTo(d[0],d[1]);for(var a=2;a<d.length;a+=2)b.lineTo(d[a],d[a+1]);b.stroke();draw_end(b,c,1==c.path.length?[x_diff,y_diff]:[d[d.length-4],d[d.length-3]],[d[d.length-2],d[d.length-1]],f)})}
function create_polygon2(c){draw_entity(c,function(b,d,f){init_shape_canvas(b,c,f);b.moveTo(d[0],d[1]);for(var a=2;a<d.length;a+=2)b.lineTo(d[a],d[a+1]);b.lineTo(d[0],d[1]);b.stroke();b.fill();draw_end(b,c,1==c.path.length?[x_diff,y_diff]:[d[d.length-4],d[d.length-3]],[d[d.length-2],d[d.length-1]],f)})}
function start_drawing(){draw_context.clearRect(0,0,draw_canvas.width,draw_canvas.height);temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);"setLineDash"in temp_draw_context&&temp_draw_context.setLineDash([]);"setLineDash"in draw_context&&draw_context.setLineDash([]);$(temp_draw_canvas).show();$(draw_canvas).show()}function stop_drawing(){$(temp_draw_canvas).hide();$(draw_canvas).hide()}
function snap_and_emit_entity(c){move_entity(c,0,0);emit_entity(c);render_scene()}function update_timeline(c){if(c.start_time){for(var b=c.start_time;timeline_entities[b];)b+=EPSILON;timeline.add(b);timeline_entities[b]=c;for(b=c.end_time;timeline_entities[b];)b+=EPSILON;timeline.add(b);timeline_entities[b]=c}}
function rebuild_timeline(c){timeline=new FastPriorityQueue;timeline_entities={};for(var b in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities.hasOwnProperty(b)&&room_data.slides[active_slide].entities[b].container&&(update_timeline(room_data.slides[active_slide].entities[b]),remove(b,!0))}
function progress_timeline(){if(!timeline.isEmpty())for(var c=video_progress(),b=timeline.peek();c>=b;){b=timeline_entities[b];video_progress()>=b.end_time?b.container&&remove(b.uid,!0):b.start_time<=c&&(b.container||create_entity(b));timeline.poll();if(timeline.isEmpty())break;b=timeline.peek()}}
function emit_entity(c){var b=c.container;background.is_video&&(c.start_time=video_progress(),c.end_time=video_progress()+delay,update_timeline(c));c.container=void 0;socket.emit("create_entity",room,c,active_slide);room_data.slides[active_slide].z_top++;c.z_index=room_data.slides[active_slide].z_top;c.container=b;center_anchor(c.container);c.container.mouseover=function(){hovering_over=c}}
function on_icon_end(c){setup_mouse_events(void 0,void 0);var b=c.data.getLocalPosition(background_sprite);c=icon_color;selected_icon_no_color&&(c=16777215);var d=icon_size*icon_extra_scale*ICON_SCALE,d=d*zoom_level,f=mouse_x_rel(b.x)-d/2,b=mouse_y_rel(b.y)-d/2;c={uid:newUid(),type:"icon",tank:selected_icon,x:f,y:b,size:d,color:c,alpha:1,label:$("#icon_label").val(),label_font_size:label_font_size*zoom_level,label_color:"#ffffff",label_font:"Arial",label_pos:label_position,label_background:$("#label_background").get(0).checked};
c.label_background&&(c.label_color="#000000");undo_list.push(clone_action(["add",[c]]));create_icon(c,snap_and_emit_entity)}
function on_text_end(c){var b=$("#text_tool_text").val();setup_mouse_events(void 0,void 0);if(""!=b){var d=c.data.getLocalPosition(background_sprite);c=mouse_x_rel(d.x);d=mouse_y_rel(d.y);b={uid:newUid(),type:"text",x:c,y:d,scale:[1,1],color:text_color,alpha:1,text:b,font_size:font_size*zoom_level,font:"Arial"};undo_list.push(clone_action(["add",[b]]));current_text_element=b;create_text2(b);snap_and_emit_entity(b)}}
function on_background_text_end(c){setup_mouse_events(void 0,void 0);var b=c.data.getLocalPosition(background_sprite);c=mouse_x_rel(b.x);b=mouse_y_rel(b.y);c={uid:newUid(),type:"background_text",x:c,y:b,scale:[1,1],color:background_text_color,alpha:1,text:$("#text_tool_background_text").val(),font_size:background_font_size*zoom_level,font:"Arial"};undo_list.push(clone_action(["add",[c]]));create_background_text2(c);snap_and_emit_entity(c)}var line_state={};
function on_line_move(c){limit_rate(15,line_state,function(){var b=c.data.getLocalPosition(background_sprite),d;d=0==new_drawing.path.length?[to_x_local(new_drawing.x),to_y_local(new_drawing.y)]:[to_x_local(new_drawing.path[new_drawing.path.length-1][0]+new_drawing.x),to_y_local(new_drawing.path[new_drawing.path.length-1][1]+new_drawing.y)];b=[to_x_local(mouse_x_rel(b.x)),to_y_local(mouse_y_rel(b.y))];temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.beginPath();
temp_draw_context.moveTo(d[0],d[1]);temp_draw_context.lineTo(b[0],b[1]);temp_draw_context.stroke();draw_end(temp_draw_context,new_drawing,d,b)})}
function on_line_end(c){limit_rate(15,line_state,function(){});try{var b=c.data.getLocalPosition(background_sprite),d=mouse_x_rel(b.x),f=mouse_y_rel(b.y),d=d-new_drawing.x,f=f-new_drawing.y;0!=new_drawing.path.length&&d==last(new_drawing.path)[0]&&f==last(new_drawing.path)[1]||new_drawing.path.push([d,f])}catch(a){}c=1==new_drawing.path.length?[to_x_local(new_drawing.x),to_y_local(new_drawing.y)]:[to_x_local(new_drawing.path[new_drawing.path.length-2][0]+new_drawing.x),to_y_local(new_drawing.path[new_drawing.path.length-
2][1]+new_drawing.y)];b=[to_x_local(last(new_drawing.path)[0]+new_drawing.x),to_y_local(last(new_drawing.path)[1]+new_drawing.y)];if(just_activated&&(d=Math.pow(c[0]-b[0],2)+Math.pow(c[1]-b[1],2),just_activated=!1,.01>d))return;draw_context.lineTo(b[0],b[1]);draw_context.stroke();shifted||(draw_end(draw_context,new_drawing,c,b),canvas2container(draw_context,draw_canvas,new_drawing)&&(emit_entity(new_drawing),undo_list.push(clone_action(["add",[new_drawing]]))),setup_mouse_events(void 0,void 0),stop_drawing(),
new_drawing=null)}
function create_text2(c){("00000"+(line.color|0).toString(16)).substr(-6);var b=document.createElement("canvas"),d=objectContainer.scale.y,f=b.getContext("2d"),a=TEXT_QUALITY;f.font=""+2*(c.font_size+1)*d*a+"px "+c.font;for(var g=f.measureText(c.text);g.width>MAX_CANVAS_SIZE;)a/=2,f.font=""+2*(c.font_size+1)*d*a+"px "+c.font,g=f.measureText(c.text);b.width=g.width;b.height=c.font_size*d*a*3;g="#"+("00000"+(c.color|0).toString(16)).substr(-6);f.fillStyle=g;f.shadowColor="black";f.shadowOffsetX=1;f.shadowOffsetY=
1;f.shadowBlur=7;f.font=""+2*c.font_size*d*a+"px "+c.font;f.fillText(c.text,0,b.height/2);if(b=createSprite(f,b))c.container=b,b.height/=objectContainer.scale.x*a,b.width/=objectContainer.scale.y*a,b.x=x_abs(c.x),b.y=y_abs(c.y),objectContainer.addChild(b),b.texture.baseTexture.source.src=c.uid,make_draggable(b),b.entity=c,room_data.slides[active_slide].entities[c.uid]=c,render_scene()}
function create_background_text2(c){("00000"+(line.color|0).toString(16)).substr(-6);var b=document.createElement("canvas"),d=objectContainer.scale.y,f=b.getContext("2d"),a=TEXT_QUALITY;f.font=""+2*(c.font_size+1)*d*a+"px "+c.font;for(var g=f.measureText(c.text);g.width>MAX_CANVAS_SIZE;)a/=2,f.font=""+2*(c.font_size+1)*d*a+"px "+c.font,g=f.measureText(c.text);b.width=g.width;b.height=c.font_size*d*a*3;g="#"+("00000"+(c.color|0).toString(16)).substr(-6);f.fillStyle=g;f.shadowColor="black";f.shadowOffsetX=
1;f.shadowOffsetY=1;f.shadowBlur=7;f.font=""+2*c.font_size*d*a+"px "+c.font;f.fillText(c.text,0,b.height/2);if(b=createSprite(f,b))b.height/=objectContainer.scale.x*a,b.width/=objectContainer.scale.y*a,b.x=0,b.y=0,a=new PIXI.Rectangle(0,0,TEXT_BOX_QUALITY*(b.width+b.height/2),TEXT_BOX_QUALITY*(b.height+b.height/2)),a=draw_shape(b.height/8*TEXT_BOX_QUALITY,1,0,1,16777215,a),a.x=x_abs(c.x),a.y=y_abs(c.y),a.width/=TEXT_BOX_QUALITY,a.height/=TEXT_BOX_QUALITY,b.width*=TEXT_BOX_QUALITY,b.height*=TEXT_BOX_QUALITY,
b.x=-b.width/2+b.height/16,b.y=-b.height/2+b.height/16,a.addChild(b),c.container=a,objectContainer.addChild(a),b.texture.baseTexture.source.src=c.uid,make_draggable(a),a.entity=c,room_data.slides[active_slide].entities[c.uid]=c,render_scene()}function nearestPow2(c){return Math.pow(2,Math.round(Math.log(c)/Math.log(2)))}
function create_icon_cont(c,b){var d=new PIXI.Sprite(b);d.tint=c.color;var f=d.width/d.height;c.container=d;c.container.x=x_abs(c.x);c.container.y=y_abs(c.y);d.height=x_abs(c.size);d.width=d.height*f;if(c.label&&""!=c.label){("00000"+(c.label_color|0).toString(16)).substr(-6);var f=document.createElement("canvas"),a=1/d.scale.y;f.width=1.8*c.label.length*c.label_font_size*a*1.5*TEXT_QUALITY;f.height=1.8*c.label_font_size*a*2*TEXT_QUALITY+30;var g=f.getContext("2d");g.font=""+Math.round(1.8*c.label_font_size*
a*TEXT_QUALITY)+"px "+c.label_font;g.fillStyle=c.label_color;c.label_background||(g.shadowColor="black");g.shadowOffsetX=1;g.shadowOffsetY=1;g.shadowBlur=7;g.fillText(c.label,0,f.height/1.5);f=createSprite(g,f);f.scale.x/=TEXT_QUALITY;f.scale.y/=TEXT_QUALITY;f.x=0;f.y=0;c.label_background&&(a=f,f=new PIXI.Rectangle(0,0,TEXT_BOX_QUALITY*(a.width+a.height/1.5),TEXT_BOX_QUALITY*(a.height+a.height/1.5)),f=draw_shape(a.height/8*TEXT_BOX_QUALITY,1,0,1,16777215,f),f.addChild(a),f.width/=TEXT_BOX_QUALITY,
f.height/=TEXT_BOX_QUALITY,a.width*=TEXT_BOX_QUALITY,a.height*=TEXT_BOX_QUALITY,a.x+=a.height/3+a.height/16+1,a.y+=a.height/3+a.height/16+1);(a=c.label_pos)||(a="pos_bottom");g=d.width/d.scale.x;d=d.height/d.scale.y;"pos_bottom"==a?(f.x-=f.width/2,f.y+=d/2):"pos_top"==a?(f.x-=f.width/2,f.y-=f.height+d/2):"pos_left"==a?(f.x-=f.width+g/2,f.y-=f.height/2):"pos_right"==a?(f.x+=g/2,f.y-=f.height/2):"pos_top_left"==a?(f.x-=f.width+g/2,f.y-=d/2+f.height/2):"pos_top_right"==a?(f.x+=g/2,f.y-=d/2+f.height/
2):"pos_bottom_left"==a?f.x-=f.width+g/2:"pos_bottom_right"==a&&(f.x+=g/2);c.container.addChild(f)}c.container.entity=c;c.container.alpha=c.alpha;make_draggable(c.container);objectContainer.addChild(c.container);render_scene();room_data.slides[active_slide].entities[c.uid]=c}
function create_icon(c,b){try{var d=$('button[id*="'+c.tank+'"]').find("span");d[0].innerHTML=parseInt(d[0].innerHTML)+1;d=$("#icon_counter");d.text((parseInt(d.text())+1).toString())}catch(e){}var d=c.tank,f=c.tank.slice(-3);"png"!=f&&"jpg"!=f&&(d+=".png");var a;texture_atlas[d]&&!is_safari()?(d=texture_atlas[d],a=new PIXI.Texture(loader.resources[d.sprite].texture,new PIXI.Rectangle(d.x,d.y,d.width,d.height))):a=PIXI.Texture.fromImage(image_host+d);resources_loading++;var g=function(){create_icon_cont(c,
a);b&&b(c);resources_loading--};if(a.baseTexture.hasLoaded)g();else a.baseTexture.on("loaded",function(){g()})}function make_draggable(c){c.interactive=!0;c.buttonMode=!0;c.draggable=!0;c.mousedown=on_drag_start;c.touchstart=on_drag_start;c.orig_scale=[c.scale.x,c.scale.y]}function make_undraggable(c){c.interactive=!1;c.buttonMode=!1;c.draggable=!1;delete c.mousedown;delete c.touchstart}
function center_anchor(c){var b=.5-c.anchor.x,d=.5-c.anchor.y;c.anchor.x=.5;c.anchor.y=.5;c.x+=b*c.width;c.y+=d*c.height}
function create_entity(c){room_data.slides[active_slide].entities[c.uid]&&remove(c.uid);"background"==c.type?set_background(c):"icon"==c.type?create_icon(c):"drawing"==c.type?create_drawing2(c):"curve"==c.type?create_curve2(c):"line"==c.type?create_line2(c):"text"==c.type?create_text2(c):"background_text"==c.type?create_background_text2(c):"note"==c.type?create_note(c):"rectangle"==c.type?create_rectangle2(c):"circle"==c.type?create_circle2(c):"polygon"==c.type?create_polygon2(c):"area"==c.type&&
create_area2(c);c.container&&(c.scale&&(c.container.scale.x=c.container.scale.x*c.container.orig_scale[0]*c.scale[0],c.container.scale.y=c.container.scale.y*c.container.orig_scale[1]*c.scale[1]),c.container.anchor&&center_anchor(c.container),c.rotation&&(c.container.rotation=-c.rotation),"background"!=c.type&&(c.container.mouseover=function(){hovering_over=c}),background.is_video&&update_timeline(c))}
function update_username(c){""!=c&&c!=my_user.name&&(my_user.name=c,socket.emit("update_user",room,my_user));c=$("#"+my_user.id).find("input");c.attr("placeholder",my_user.name);c.val("")}
function add_user(c){my_user_id==c.id&&(my_user=c);if(c.id in userlist){var b=$("#"+c.id);c.id==my_user_id?b.find("input").attr("placeholder",c.name):b.text(c.name)}else c.id==my_user_id?(b="<div class='btn' style='text-align:left;' id='"+c.id+"'><input maxlength='30' type='text' placeholder='"+escapeHtml(c.name)+"'></div>",$("#userlist").prepend(b),b=$("#userlist").find("input"),b.on("blur",function(){update_username(this.value)}),b.onkeypress=function(b){b||(b=window.event);keyCode=b.keyCode||b.which;
"13"==keyCode&&update_username(this.value)}):(b="<button class='btn' style='text-align:left;' data-toggle='tooltip' title='Click to toggle this user&#39;s permission.' id='"+c.id+"'>"+escapeHtml(c.name)+"</button>",$("#userlist").append(b));userlist[c.id]=c;c.role?"owner"==c.role?$("#"+c.id).css("background-color","lime"):"driver"==c.role&&$("#"+c.id).css("background-color","yellow"):$("#"+c.id).css("background-color","#EEEEEE");c.id==my_user_id&&update_my_user();$("#user_count").text(Object.keys(userlist).length.toString())}
function update_my_user(){my_user.logged_in?($("#store_tactic_popover").show(),tactic_name&&""!=tactic_name&&$("#save").show()):($("#store_tactic_popover").hide(),$("#save").hide());update_lock()}
function update_lock(){var c=$("#lock div");is_room_locked?c.removeClass("icon-unlock").addClass("icon-lock"):c.removeClass("icon-lock").addClass("icon-unlock");if(is_room_locked&&!my_user.role){$(".mejs-controls").hide();$(".left_column").hide();$("#slide_interactive").hide();$("#slide_static").show();$("#slide_table1").hide();$("#can_not_edit").show();$("#map_select_box").hide();for(var b in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities[b]&&"note"==room_data.slides[active_slide].entities[b].type&&
room_data.slides[active_slide].entities[b].container&&($("textarea",room_data.slides[active_slide].entities[b].container.menu).prop("readonly",!0),$("button",room_data.slides[active_slide].entities[b].container.menu).hide());my_tracker&&stop_tracking();"ping_context"==active_context&&(objectContainer.mousemove=void 0)}else for(b in $(".mejs-controls").show(),$(".left_column").show(),$("#slide_interactive").show(),$("#slide_static").hide(),$("#slide_table1").show(),$("#can_not_edit").hide(),$("#map_select_box").show(),
room_data.slides[active_slide].entities)room_data.slides[active_slide].entities[b]&&"note"==room_data.slides[active_slide].entities[b].type&&room_data.slides[active_slide].entities[b].container&&($("textarea",room_data.slides[active_slide].entities[b].container.menu).prop("readonly",!1),$("button",room_data.slides[active_slide].entities[b].container.menu).show());"owner"!=my_user.role&&is_room_locked?($("#store_tactic_popover").hide(),$("#save").hide(),$("#export_tab_button").hide()):(my_user.logged_in?
($("#store_tactic_popover").show(),tactic_name&&""!=tactic_name&&$("#save").show()):($("#store_tactic_popover").hide(),$("#save").hide()),$("#export_tab_button").show());"owner"==my_user.role?($("#lock").show(),$("#nuke_room").show(),$("#lock_camera").show()):($("#lock").hide(),$("#nuke_room").hide(),$("#lock_camera").hide())}function remove_user(c){$("#"+c).remove();delete userlist[c];$("#user_count").text(Object.keys(userlist).length.toString())}
function escapeHtml(c){return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function chat(c,b){c=escapeHtml(c);c=c.split(":");$("#chat_box").append('<div class="chatmsg"><b style="color:'+b+';">'+c[0]+"</b>: "+c.slice(1).join(":")+"<br/></div>");$("#chat_box").scrollTop($("#chat_box")[0].scrollHeight)}
function initialize_color_picker(c,b){Modernizr.inputtypes.color?$("#"+c+" ~ input").show():$("#"+c+" ~ input").hide();var d=$('select[id="'+c+'"]').val();window[b]=parseInt("0x"+d.substring(1));$("#"+c+" ~ input").attr("value",d);$("#"+c+" ~ input").val(d);$("#"+c+" ~ input").on("change",function(){var d=$(this).val();window[b]=parseInt("0x"+d.substring(1));$("#"+c+'~ span span[data-selected=""]').removeAttr("data-selected")});$('select[id="'+c+'"]').simplecolorpicker().on("change",function(){var d=
$('select[id="'+c+'"]').val();window[b]=parseInt("0x"+d.substring(1));$("#"+c+" ~ input").first().val(d);"track_color"==b&&(my_tracker&&stop_tracking(),start_tracking({x:2E3,y:2E3}))})}
function initialize_slider(c,b,d){var f=$("#"+c);$("#"+b).val(f.attr("value"));window[d]=parseFloat(f.attr("value"));f.on("change",function(a){$("#"+b).val(this.value);window[d]=parseFloat(this.value)});f.on("input",function(a){$("#"+b).val(this.value);window[d]=parseFloat(this.value)});$("#"+b).change(function(){var a=parseFloat(this.value);isNaN(a)?this.value=window[d]:(window[d]=a,f.slider("setValue",window[d]))})}
function clear(c){var b=[],d;for(d in room_data.slides[active_slide].entities)if(room_data.slides[active_slide].entities.hasOwnProperty(d)&&(room_data.slides[active_slide].entities[d].type==c||!c)&&"background"!=room_data.slides[active_slide].entities[d].type){var f=room_data.slides[active_slide].entities[d];remove(d);b.push(f);socket.emit("remove",room,d,active_slide)}undo_list.push(clone_action(["remove",b]))}
function clone_action(c){if(c[1].length){temp_containers=[];for(var b=0;b<c[1].length;b++)temp_containers.push(c[1][b].container),c[1][b].container=null}var d=JSON.stringify(c);if(c[1].length)for(b=0;b<c[1].length;b++)c[1][b].container=temp_containers[b];return JSON.parse(d)}
function undo(){var c=undo_list.pop();if(c)if("add"==c[0]){for(var b in c[1])c[1][b].uid&&(remove(c[1][b].uid),delete c[1][b].container,socket.emit("remove",room,c[1][b].uid,active_slide));redo_list.push(clone_action(c))}else if("drag"==c[0]){for(b in c[1]){var d=c[1][b][0][0],f=c[1][b][0][1],a=c[1][b][0][2],g=c[1][b][0][3],e=c[1][b][1];room_data.slides[active_slide].entities[e]&&(c[1][b][0][0]=room_data.slides[active_slide].entities[e].x,c[1][b][0][1]=room_data.slides[active_slide].entities[e].y,
c[1][b][0][2]=room_data.slides[active_slide].entities[e].scale?[room_data.slides[active_slide].entities[e].scale[0],room_data.slides[active_slide].entities[e].scale[1]]:[1,1],"undefined"!==typeof room_data.slides[active_slide].entities[e].rotation&&(c[1][b][0][3]=room_data.slides[active_slide].entities[e].rotation),drag_entity(room_data.slides[active_slide].entities[e],d,f,a,g),socket.emit("drag",room,e,active_slide,d,f,a,g))}redo_list.push(clone_action(c))}else if("remove"==c[0]){for(b in c[1])d=
c[1][b],delete d.container,socket.emit("create_entity",room,d,active_slide),create_entity(d);redo_list.push(clone_action(c))}else if("select"==c[0]){f=[];for(b in c[2])d=c[2][b],room_data.slides[active_slide].entities.hasOwnProperty(d.uid)&&f.push(d);deselect_all();selected_entities=f;select_entities();redo_list.push(clone_action(c))}render_scene()}
function redo(){var c=redo_list.pop();if(c){if("add"==c[0]){for(var b in c[1])c[1][b].uid&&(socket.emit("create_entity",room,c[1][b],active_slide),create_entity(c[1][b]));undo_list.push(clone_action(c))}else if("drag"==c[0]){for(b in c[1]){var d=c[1][b][0][0],f=c[1][b][0][1],a=c[1][b][0][2],g=c[1][b][0][3],e=c[1][b][1];room_data.slides[active_slide].entities[e]&&(c[1][b][0][0]=room_data.slides[active_slide].entities[e].x,c[1][b][0][1]=room_data.slides[active_slide].entities[e].y,c[1][b][0][2]=room_data.slides[active_slide].entities[e].scale?
[room_data.slides[active_slide].entities[e].scale[0],room_data.slides[active_slide].entities[e].scale[1]]:[1,1],"undefined"!==typeof room_data.slides[active_slide].entities[e].rotation&&(c[1][b][0][3]=room_data.slides[active_slide].entities[e].rotation),drag_entity(room_data.slides[active_slide].entities[e],d,f,a,g),socket.emit("drag",room,e,active_slide,d,f,a,g))}undo_list.push(clone_action(c))}else if("remove"==c[0]){for(b in c[1])d=c[1][b],room_data.slides[active_slide].entities.hasOwnProperty(d.uid)&&
(remove(d.uid),delete d.container,socket.emit("remove",room,d.uid,active_slide));undo_list.push(clone_action(c))}else if("select"==c[0]){f=[];for(b in c[1])d=c[1][b],room_data.slides[active_slide].entities.hasOwnProperty(d.uid)&&f.push(d);deselect_all();selected_entities=f;select_entities();undo_list.push(clone_action(c))}render_scene()}}
function clear_selected(){remove_select_box();var c=selected_entities.slice(0),b=[],d;for(d in c){var f=c[d];remove(c[d].uid);b.push(f);socket.emit("remove",room,f.uid,active_slide)}deselect_all();selected_entities=[];undo_list.push(clone_action(["remove",b]));"drag_context"==active_context&&cancel_drag(!0)}
function drag_entity(c,b,d,f,a){if(c.container){c.container.x+=x_abs(b-c.x);c.container.y+=y_abs(d-c.y);c.x=b;c.y=d;c.scale=f;"undefined"!==typeof a&&null!=a&&(c.rotation=a,c.container.rotation=-a);"note"==c.type&&align_note_text(c);c.container&&(objectContainer.removeChild(c.container),objectContainer.addChild(c.container),f&&(c.container.scale.x=c.container.orig_scale[0]*f[0],c.container.scale.y=c.container.orig_scale[1]*f[1]));select_box_dirty=!1;for(var g in selected_entities)selected_entities[g].uid==
c.uid&&(select_box_dirty=!0);render_scene()}}function find_first_slide(){var c=Math.pow(2,52),b=0,d;for(d in room_data.slides){var f=room_data.slides[d].order;f<c&&(c=f,b=d)}return b}function find_previous_slide(c){var b=-9007199254740990,d=0,f;for(f in room_data.slides){var a=room_data.slides[f].order;a<c&&a>b&&(b=a,d=f)}return d}function find_next_slide(c){var b=9007199254740991,d=0,f;for(f in room_data.slides){var a=room_data.slides[f].order;a>c&&a<b&&(b=a,d=f)}return d}
function hash(c){for(var b=0,d=0;d<c.length;d++)b+=c.charCodeAt(d);return b}function resolve_order_conflicts(c){for(var b in room_data.slides)if(room_data.slides[b].order==c.order){if(hash(c.uid)<hash(b)){b=find_previous_slide(c.order);var d=0;0!=b&&(d=room_data.slides[b].order);c.order=Math.floor((c.order-d)/2)}else b=find_next_slide(c.order),d=c.order+4294967296,0!=b&&(d=room_data.slides[b].order),c.order=Math.floor((d-c.order)/2);resolve_order_conflicts(c);break}}
function update_slide_buttons(){var c=find_previous_slide(room_data.slides[active_slide].order),b=find_next_slide(room_data.slides[active_slide].order);0==c?document.getElementById("prev_slide").disabled=!0:document.getElementById("prev_slide").disabled=!1;0==b?document.getElementById("next_slide").disabled=!0:document.getElementById("next_slide").disabled=!1;1==Object.keys(room_data.slides).length?document.getElementById("remove_slide").disabled=!0:document.getElementById("remove_slide").disabled=
!1;grid_layer.visible=room_data.slides[active_slide].show_grid?!0:!1;c=escapeHtml(room_data.slides[active_slide].name);$("#slide_name_field").val(c);$("#slide_name_field2").val(c);var b=find_first_slide(),d=$("#slide_table");d.empty();do c=escapeHtml(room_data.slides[b].name),b==active_slide?d.append("<tr id='"+b+"' style='background-color:#ADD8E6'><td><a id='"+b+"'>"+c+"</a></td></tr>"):d.append("<tr id='"+b+"'><td><a id='"+b+"'>"+c+"</a></td></tr>"),b=find_next_slide(room_data.slides[b].order);
while(0!=b);var f=$("#slide_container").scrollTop();setTimeout(function(){$("#slide_container").scrollTop(f)},0)}
function transition(c){var b=[],d=[],f=[],a;for(a in room_data.slides[active_slide].entities)room_data.slides[c].entities[a]?f.push(a):b.push(a);for(a in room_data.slides[c].entities)room_data.slides[active_slide].entities.hasOwnProperty(a)||d.push(a);for(var g in b)a=b[g],remove(a,!0);var e;for(g in f)a=f[g],"background"==room_data.slides[c].entities[a].type?e=a:(remove(a,!0),d.push(a));active_slide=c;update_slide_buttons();var k=function(){try{d.sort(function(a,b){return room_data.slides[c].entities[a].z_index-
room_data.slides[c].entities[b].z_index})}catch(a){}for(var b in d)create_entity(room_data.slides[c].entities[d[b]])};e?set_background(room_data.slides[c].entities[e],function(){k();render_scene()}):(k(),render_scene())}
function cancel_drag(c){clearTimeout(drag_timeout);objectContainer.buttonMode=!1;$("html,body").css("cursor","initial");context_before_drag&&(active_context=context_before_drag);context_before_drag=null;if(dragged_entity){dragged_entity.mouseup=void 0;dragged_entity.touchend=void 0;dragged_entity.mouseupoutside=void 0;dragged_entity.touchendoutside=void 0;dragged_entity.mousemove=void 0;dragged_entity.touchmove=void 0;if(c)if(move_selected&&0<selected_entities.length)for(var b in selected_entities)drag_entity(selected_entities[b],
selected_entities[b].origin_x,selected_entities[b].origin_y);else drag_entity(dragged_entity.entity,dragged_entity.entity.origin_x,dragged_entity.entity.origin_y);dragged_entity==select_box&&(make_resizable(select_box),on_select_over.bind(select_box)(),on_selectbox_move.bind(select_box)())}dragged_entity=null;move_selected=!1}
function change_slide(c){if(active_slide!=c){"drag_context"==active_context&&cancel_drag(!0);undo_list=[];redo_list=[];deselect_all();transition(c);c=$("#contexts").find(".active");var b=c.attr("id")+"_context";$(this).attr("data-context")&&(b=c.attr("data-context")+"_context");active_context=b}}
function create_new_slide(c){var b={};b.show_grid=room_data.slides[c].show_grid;b.z_top=room_data.slides[c].z_top;b.uid=newUid();var d=room_data.slides[c].name,f=d.split(" ");isNaN(parseFloat(f[f.length-1]))?d+=" 1":(f[f.length-1]=""+(parseFloat(f[f.length-1])+1),d=f.join(" "));b.name=d;b.entities={};for(var a in room_data.slides[c].entities)f=room_data.slides[c].entities[a].container,delete room_data.slides[c].entities[a].container,b.entities[a]=JSON.parse(JSON.stringify(room_data.slides[c].entities[a])),
room_data.slides[c].entities[a].container=f;f=find_next_slide(room_data.slides[c].order);0==f?a=room_data.slides[c].order+4294967296:(a=room_data.slides[c].order+Math.floor((room_data.slides[f].order-room_data.slides[c].order)/2),d==room_data.slides[f].name&&(b.name=room_data.slides[c].name+" - 1"));b.order=a;return b}
function remove_slide(c){if(1<Object.keys(room_data.slides).length){if(c==active_slide){var b=room_data.slides[c].order,d=find_previous_slide(b);0==d&&(d=find_next_slide(b));change_slide(d);active_slide=d}delete room_data.slides[c]}update_slide_buttons()}function rename_slide(c,b){room_data.slides[c].name=b;update_slide_buttons()}function add_slide(c){resolve_order_conflicts(c);room_data.slides[c.uid]=c;update_slide_buttons()}
function initialize_map_select(c){var b=c.find("option").sort(function(b,c){return b.innerHTML<c.innerHTML?-1:b.innerHTML>c.innerHTML?1:0});c.empty().append(b);c.val("");c.change(function(){var b=c.val().trim();background&&background.path==b||try_select_map(c,b)})}function activity_animation(c){var b=$("#userlist #"+c);b.hasClass("sheen")||(b.addClass("sheen"),setTimeout(function(){b.removeClass("sheen")},1E3))}
function try_select_map(c,b,d){c=background?background.uid:newUid();var f=0,a=0,g=$('option[value="'+b+'"]').attr("data-size");g&&(a=g.split("x"),f=parseFloat(a[0]),a=parseFloat(a[1]));d=d?!0:!1;b.split(".").pop().startsWith();var e={uid:c,type:"background",path:b,size_x:f,size_y:a,custom:d};is_video(b)&&(e.is_video=!0);set_background(e,function(a){a&&(socket.emit("create_entity",room,e,active_slide),background.is_video&&(handle_pause(0),socket.emit("pause_video",room,0)))})}
function add_custom_map(c){var b=$("#map_select"),d=$('#map_select option[value="'+c+'"]');0==d.length&&(d=last(c.split("/")),d=$('<option value="'+c+'">'+d+"</option>"),b.append(d));b.val(c)}function cleanup(){deselect_all();undo_list=[];redo_list=[];if(active_slide)for(var c in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities.hasOwnProperty(c)&&remove(c);room_data={}}
function stop_syncing(){im_syncing=!1;clearInterval(sync_event);sync_event=setInterval(function(){im_syncing=!1;video_paused?clearInterval(sync_event):2E4<Date.now()-get_local_time(last_video_sync[1])&&start_syncing()},1E4+5E3*Math.random())}function handle_play(c,b){video_paused=!1;last_video_sync=[c,b];var d=Date.now()-get_local_time(b);video_media.setCurrentTime(c);0>=d?video_player.play():setTimeout(function(){video_player.play()},d);video_player.play();stop_syncing();play_video_controls()}
function handle_pause(c,b){video_paused=!0;clearInterval(sync_event);im_syncing=!1;video_media.setCurrentTime(c);video_player.pause();pause_video_controls()}function sync_video(c,b){var d=Date.now()-get_local_time(b),d=c+d*base_playback_rate/1E3,d=video_progress()-d;console.log("lag: ",d);.1<Math.abs(d)/base_playback_rate?hard_sync_video(c,b):"youtube"!=video_media.pluginType&&set_playback_rate(base_playback_rate,base_playback_rate+d/VIDEO_SYNC_DELAY)}
function video_progress(){return video_paused?video_media.currentTime:progress+(Date.now()-progress_update)*playback_rate/1E3}var sync_in_progress=!1,press_play_delay=0;
function hard_sync_video(c,b){if(!sync_in_progress){sync_in_progress=!0;var d=Date.now()-get_local_time(b),d=c+d*base_playback_rate/1E3,f=video_progress()-d;0>f||3<f?(video_media.setCurrentTime(d+1),sync_in_progress=!1):(video_progress(),video_player.pause(),setTimeout(function(){sync_in_progress=!1;if(!video_paused){video_player.play();var a=Date.now(),b=function(c){press_play_delay=Date.now()-a;video_media.removeEventListener("play",b)};video_media.addEventListener("play",b)}},Math.max(0,1E3*f/
base_playback_rate-press_play_delay)))}}function handle_sync(c,b,d){video_paused?im_syncing=!1:(d!=my_user.id&&stop_syncing(),last_video_sync=[c,b],sync_video(c,b))}
function set_playback_rate(c,b){base_playback_rate=c;playback_rate=b;var d=c.toFixed(2);$(".mejs-speed-button").find("button").html(d+"x");$(".mejs-speed-button").find(".mejs-speed-selected").removeClass("mejs-speed-selected");$(".mejs-speed-button").find('input[value="'+d+'"]').next().addClass("mejs-speed-selected");"youtube"==video_media.pluginType?video_media.pluginApi.setPlaybackRate(b):video_media.playbackRate=b}
$(document).ready(function(){function c(){video_ready&&progress_timeline();scene_dirty&&(select_box_dirty&&redraw_select_box(),renderer.render(objectContainer),scene_dirty=!1);requestAnimationFrame(c)}initialize_map_select($("#map_select"));initialize_map_select($("#map_select_wotbase"));size_y=size_x=size=Math.min(window.innerHeight,window.innerWidth)-30;renderer=Modernizr.webgl&&!nowebgl?PIXI.autoDetectRenderer(size,size,{transparent:!0}):new PIXI.CanvasRenderer(size,size,{transparent:!0});renderer.autoResize=
!0;useWebGL=renderer instanceof PIXI.WebGLRenderer;$(renderer.view).attr("style","position:absolute; z-index: 2; padding:0; margin:0; border:0;");$(".edit_window").append(renderer.view);renderer.view.addEventListener("wheel",function(b){zoom(.1,0>b.deltaY,b);control_camera&&emit_pan_zoom();b.preventDefault()});background_sprite=new PIXI.Sprite;objectContainer=new PIXI.Container;fast_container=new PIXI.ParticleContainer(1E4,{scale:!0,position:!0,rotation:!1,uvs:!1,alpha:!1});grid_layer="aw"==game?
new PIXI.Sprite.fromImage(image_host+"aw_grid.png"):new PIXI.Sprite.fromImage(image_host+"grid.png");grid_layer.height=renderer.height;grid_layer.width=renderer.width;objectContainer.addChild(background_sprite);objectContainer.addChild(grid_layer);objectContainer.addChild(fast_container);objectContainer.interactive=!0;objectContainer.mousedown=on_left_click;objectContainer.touchstart=on_left_click;$(renderer.view).mousedown(function(b){if(3===b.which||2===b.which)last_pan_loc=[renderer.plugins.interaction.eventData.data.global.x,
renderer.plugins.interaction.eventData.data.global.y],setup_mouse_events(on_pan),b.preventDefault()});renderer.view.addEventListener("contextmenu",function(b){setup_mouse_events(void 0);control_camera&&emit_pan_zoom();b.preventDefault()});$(renderer.view).mouseup(function(b){if(3===b.which||2===b.which)setup_mouse_events(void 0),control_camera&&emit_pan_zoom(),b.preventDefault()});draw_canvas=document.createElement("canvas");$(draw_canvas).attr("style","padding:0px; margin:0px; border:0; position:absolute; z-index:3; pointer-events:none");
draw_canvas.width=renderer.view.width;draw_canvas.height=renderer.view.height;draw_context=draw_canvas.getContext("2d");temp_draw_canvas=document.createElement("canvas");$(temp_draw_canvas).attr("style","padding:0px; margin:0px; border:0; position:absolute; z-index:4; pointer-events:none");temp_draw_canvas.width=renderer.view.width;temp_draw_canvas.height=renderer.view.height;temp_draw_context=temp_draw_canvas.getContext("2d");$(renderer.view).parent().append(temp_draw_canvas);$(renderer.view).parent().append(draw_canvas);
$(temp_draw_canvas).hide();$(draw_canvas).hide();c();loader.once("complete",function(){var b=document.querySelectorAll("input[type=range][list]");Array.prototype.slice.call(b).forEach(function(b){if("list"in b&&"min"in b&&"max"in b&&"step"in b){var c=document.createElement("datalist"),a=parseFloat(b.getAttribute("min")),g=parseFloat(b.getAttribute("step")),e=parseFloat(b.getAttribute("max"));c.id=b.getAttribute("list");if(20>Math.abs(e-a)/g){for(;a<e+g;a+=g)c.innerHTML+="<option value="+a.toFixed(2)+
"></option>";b.parentNode.insertBefore(c,b.nextSibling)}}});texture_atlas["circle.png"]&&!is_safari()?(b=texture_atlas["circle.png"],ping_texture=new PIXI.Texture(loader.resources[b.sprite].texture,new PIXI.Rectangle(b.x,b.y,b.width,b.height))):ping_texture=PIXI.Texture.fromImage(image_host+"circle.png");$("#slide_table1 tbody").sortable({helper:function(b,c){c.children().each(function(){$(this).width($(this).width())});return c},update:function(b,c){var a;c.item[0].previousElementSibling?(a=room_data.slides[c.item[0].previousElementSibling.id].order,
c.item[0].nextElementSibling?(a+=room_data.slides[c.item[0].nextElementSibling.id].order,a/=2):a+=4294967296):a=room_data.slides[find_first_slide()].order-4294967296;room_data.slides[c.item[0].id].order=a;socket.emit("change_slide_order",room,c.item[0].id,a);update_slide_buttons()}}).disableSelection();$("#modal_cancel").click(function(b){$("#myModal").modal("hide")});$("#link_send").click(function(b){b=$("#send_link").val();var c=b.indexOf("room=");-1==c?alert("No room id found in link."):(tactic_uid=
b.slice(c+5).split("&")[0],b=servers[hashstring(tactic_uid)%servers.length],c=active_slide,$("#this_slide_only").get(0).checked||(c=void 0),$.post("http://"+b+"/add_to_room",{target:tactic_uid,source:room,session_id:$("#sid").attr("data-sid"),host:parse_domain(location.hostname),stored:"false",slide:c}).done(function(a){"Success"!=a&&alert(a)}));$("#myModal").modal("hide")});$("#use_wotbase").click(function(){$(this).is(":checked")?($("#map_select_container").hide(),$("#wotbase_map_select_container").show()):
($("#map_select_container").show(),$("#wotbase_map_select_container").hide())});$("#send_to_link").click(function(b){socket.emit("save_room",room);$("#myModal").modal("show");$("#myModal").on("shown.bs.modal",function(){$("#send_link").focus()})});$("#custom_map").click(function(b){socket.emit("save_room",room);$("#map_modal").modal("show");$("#map_modal").on("shown.bs.modal",function(){$("#send_link").focus()})});$("#map_modal_cancel").click(function(b){$("#map_modal").modal("hide")});$("#set_map").click(function(b){(b=
$("#map_url").val().trim())&&""!=b&&try_select_map($("#map_select"),b,!0);$("#map_modal").modal("hide")});$("#contexts ~ div").each(function(){$(this).hide()});$("#ping_context").show();$("#store_tactic_popover").hide();$("#save").hide();$("#ping").addClass("active");$("#"+label_position).addClass("active");b=$("#icon_context").find("button:first");b.addClass("selected");selected_icon_no_color="true"==b.attr("data-no_color")?!0:!1;selected_icon=b.attr("id");icon_extra_scale=b.attr("data-scale")?parseFloat(b.attr("data-scale")):
1;slide_name=$("#slide_interactive").attr("slide_name");$(".nav-pills > li > a").click(function(){$(".nav-pills > li.active").removeClass("active");$(this).parent().addClass("active")});initialize_color_picker("curve_colorpicker","curve_color");initialize_color_picker("icon_colorpicker","icon_color");initialize_color_picker("draw_colorpicker","draw_color");initialize_color_picker("ping_colorpicker","ping_color");initialize_color_picker("track_colorpicker","track_color");initialize_color_picker("line_colorpicker",
"line_color");initialize_color_picker("text_colorpicker","text_color");initialize_color_picker("background_text_colorpicker","background_text_color");initialize_color_picker("rectangle_outline_colorpicker","rectangle_outline_color");initialize_color_picker("rectangle_fill_colorpicker","rectangle_fill_color");initialize_color_picker("circle_outline_colorpicker","circle_outline_color");initialize_color_picker("circle_fill_colorpicker","circle_fill_color");initialize_color_picker("polygon_outline_colorpicker",
"polygon_outline_color");initialize_color_picker("polygon_fill_colorpicker","polygon_fill_color");initialize_color_picker("area_outline_colorpicker","area_outline_color");initialize_color_picker("area_fill_colorpicker","area_fill_color");initialize_slider("rectangle_outline_thickness","rectangle_outline_thickness_text","rectangle_outline_thickness");rectangle_outline_thickness=parseFloat($("#rectangle_outline_thickness").val());initialize_slider("rectangle_outline_transparancy","rectangle_outline_transparancy_text",
"rectangle_outline_transparancy");initialize_slider("rectangle_fill_transparancy","rectangle_fill_transparancy_text","rectangle_fill_transparancy");initialize_slider("circle_outline_thickness","circle_outline_thickness_text","circle_outline_thickness");initialize_slider("circle_outline_transparancy","circle_outline_transparancy_text","circle_outline_transparancy");initialize_slider("circle_fill_transparancy","circle_fill_transparancy_text","circle_fill_transparancy");initialize_slider("polygon_outline_thickness",
"polygon_outline_thickness_text","polygon_outline_thickness");initialize_slider("polygon_outline_transparancy","polygon_outline_transparancy_text","polygon_outline_transparancy");initialize_slider("polygon_fill_transparancy","polygon_fill_transparancy_text","polygon_fill_transparancy");initialize_slider("area_outline_thickness","area_outline_thickness_text","area_outline_thickness");initialize_slider("area_outline_transparancy","area_outline_transparancy_text","area_outline_transparancy");initialize_slider("area_fill_transparancy",
"area_fill_transparancy_text","area_fill_transparancy");initialize_slider("line_thickness","line_thickness_text","line_thickness");initialize_slider("draw_thickness","draw_thickness_text","draw_thickness");initialize_slider("curve_thickness","curve_thickness_text","curve_thickness");initialize_slider("font_size","font_size_text","font_size");initialize_slider("background_font_size","background_font_size_text","background_font_size");initialize_slider("label_font_size","label_font_size_text","label_font_size");
initialize_slider("icon_size","icon_size_text","icon_size");initialize_slider("ping_size","ping_size_text","ping_size");initialize_slider("track_size","track_size_text","track_size");initialize_slider("draw_end_size","draw_end_size_text","draw_end_size");initialize_slider("line_end_size","line_end_size_text","line_end_size");initialize_slider("curve_end_size","curve_end_size_text","curve_end_size");$("#delay")&&initialize_slider("delay","delay_text","delay");$("html").click(function(b){"tactic_name"!=
b.target.id&&$('[data-toggle="popover"]').popover("hide")});$('[data-toggle="popover"]').popover({container:"body",trigger:"manual",html:"true",template:'<div class="popover popover-medium" style="width: 300px;"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"></div></div></div>',content:function(){return $("#popover-content")}}).click(function(b){$(this).popover("toggle");document.getElementById("tactic_name").setAttribute("value",tactic_name);
$(this);$(document).on("click","#store_tactic",function(b){var a=$(document).find("#tactic_name")[0].value,a=escapeHtml(a);""==a?alert("Empty name, tactic not stored"):(tactic_name=a,document.title="Tactic - "+tactic_name,socket.emit("store",room,a),$("#save").show(),alert("Tactic stored as: "+a),b.stopPropagation())});b.stopPropagation()});$("#slide_table").on("click","tr",function(){var b=$(this).attr("id");active_slide!=b&&(socket.emit("change_slide",room,b),change_slide(b))});$("#prev_slide").click(function(){var b=
find_previous_slide(room_data.slides[active_slide].order);0!=b&&(socket.emit("change_slide",room,b),change_slide(b))});$("#next_slide").click(function(){var b=find_next_slide(room_data.slides[active_slide].order);0!=b&&(socket.emit("change_slide",room,b),change_slide(b))});$("#new_slide").click(function(){var b=create_new_slide(active_slide);socket.emit("new_slide",room,b);add_slide(b);change_slide(b.uid)});$("#remove_slide").click(function(){1<Object.keys(room_data.slides).length&&(socket.emit("remove_slide",
room,active_slide),remove_slide(active_slide))});$("#save").click(function(){tactic_name&&""!=tactic_name&&socket.emit("store",room,tactic_name)});$("#slide_name_field").focusout(function(){rename_slide(active_slide,$(this).val());socket.emit("rename_slide",room,active_slide,$(this).val())});$("#slide_name_field").keyup(function(b){13==b.keyCode&&(rename_slide(active_slide,$(this).val()),socket.emit("rename_slide",room,active_slide,$(this).val()))});$("#link").click(function(){document.queryCommandSupported("copy");
var b=document.createElement("textarea"),c="http://"+location.host+location.pathname+"?room="+room;b.value=c;document.body.appendChild(b);window.prompt("Copy to clipboard and share with friends:",c);document.body.removeChild(b)});$("#chat_input").keyup(function(b){13==b.keyCode&&(b=my_user.name+": "+$("#chat_input").val()+"\n",socket.emit("chat",room,b,chat_color),chat(b,chat_color),$("#chat_input").val(""))});$("#export").click(function(){var b=new PIXI.CanvasRenderer(size_x,size_y,{backgroundColor:12303291});
b.render(objectContainer);$.getScript("http://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2014-11-29/FileSaver.min.js",function(){$.getScript("http://cdnjs.cloudflare.com/ajax/libs/javascript-canvas-to-blob/3.3.0/js/canvas-to-blob.min.js",function(){b.view.toBlob(function(b){tactic_name&&""!=tactic_name?saveAs(b,tactic_name+".jpg"):saveAs(b,"map.jpg")})})})});$("#backup").click(function(){$.getScript("https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js",function(){var b=active_slide,c=
new JSZip,a=new PIXI.CanvasRenderer(size_x,size_y,{backgroundColor:12303291}),g=find_first_slide(),e=1,k=function(g){change_slide(g);var m=setInterval(function(){if(0==resources_loading){a.render(objectContainer);var n=a.view.toDataURL("image/jpeg",.9),n=n.replace("data:image/jpeg;base64,","");c.file(e.toString()+"-"+room_data.slides[g].name+".jpg",n,{base64:!0});e++;next_slide_uid=find_next_slide(room_data.slides[g].order);if(0!=next_slide_uid)clearInterval(m),k(next_slide_uid);else{clearInterval(m);
a.destroy();var n={},q;for(q in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities.hasOwnProperty(q)&&room_data.slides[active_slide].entities[q].container&&(n[q]=room_data.slides[active_slide].entities[q].container,delete room_data.slides[active_slide].entities[q].container);c.file("tactic.json",JSON.stringify(room_data,null,2));for(q in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities.hasOwnProperty(q)&&n[q]&&(room_data.slides[active_slide].entities[q].container=
n[q]);$.getScript("http://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2014-11-29/FileSaver.min.js",function(){var a=c.generate({type:"blob"});tactic_name&&""!=tactic_name?saveAs(a,tactic_name+".zip"):saveAs(a,"backup.zip")});change_slide(b);render_scene()}}},50)};k(g)})});$(".icon_group").each(function(){var b=this.id;$("#"+b).click(function(){var c=$("#"+b+"_list").text().split("\n"),c=c.map(function(a){return encodeURIComponent(a.trim())}),c=c.filter(function(a){return""==a?!1:!0}),a=$("#"+b+"_list").attr("data-path"),
g=parseFloat($("#"+b+"_list").attr("data-scale")),e=parseFloat($("#"+b+"_list").attr("data-height")),k=$("#"+b+"_list").attr("data-no_color"),h=$("#"+b+"_list").attr("data-style");if(!$.trim($("#"+b+"_menu").html()))if(h)for(var m in c)$("#"+b+"_menu").append('<button data-toggle="tooltip" title="'+c[m]+'" class="tank_select" data-scale="'+g+'" data-no_color="'+k+'" id="'+a+"/"+c[m]+'"><div class="'+a+" "+a+"-"+c[m].slice(0,-4)+' inline"></div></button>');else for(m in c)$("#"+b+"_menu").append("<img height="+
e+' class="tank_select" data-scale="'+g+'" data-no_color="'+k+'" id="'+a+"/"+c[m]+'" data-toggle="tooltip" title="'+c[m]+'" src='+image_host+a+"/"+c[m]+"></img>")})});$("[id^=icon][id$=context]").each(function(){$(this).find("a:first").trigger("click")});$("#lock").click(function(){is_room_locked=$(this).find("div").hasClass("icon-lock")?!1:!0;update_lock();socket.emit("lock_room",room,is_room_locked)});$("#lock_camera").click(function(){var b=$(this).find("div");b.hasClass("icon-lock_camera")?(b.removeClass("icon-lock_camera").addClass("icon-unlock_camera"),
emit_pan_zoom(),control_camera=!0):(b.removeClass("icon-unlock_camera").addClass("icon-lock_camera"),control_camera=!1)});$("#grid").click(function(){grid_layer.visible=!grid_layer.visible;room_data.slides[active_slide].show_grid=grid_layer.visible;can_edit()&&socket.emit("show_grid",room,active_slide,grid_layer.visible);render_scene()});$("#contexts").on("click","button",function(b){stop_drawing();setup_mouse_events(void 0,void 0);new_drawing=null;graphics&&objectContainer.removeChild(graphics);
new_drawing&&(new_drawing=void 0);current_text_element=void 0;if("undo"==$(this).attr("id"))undo();else if("redo"==$(this).attr("id"))redo();else if("cut"==$(this).attr("id"))cut();else if("copy"==$(this).attr("id"))copy();else if("paste"==$(this).attr("id"))paste();else if("clear_all_main"==$(this).attr("id"))clear();else{shifted&&objectContainer.mouseup&&(shifted=!1,objectContainer.mouseup(renderer.plugins.interaction.eventData),shifted=!0);$("#contexts").find("button").removeClass("active");$(this).addClass("active");
b=$(this).attr("id")+"_context";var c=$(this).attr("id")+"_context";"sc2"==game&&"icon"==c.substring(0,4)&&$("#icon_options").detach().appendTo($("#"+c));$(this).attr("data-context")&&(b=$(this).attr("data-context")+"_context");my_tracker&&stop_tracking();"track_context"==b&&start_tracking({x:2E3,y:2E3});active_menu!=c&&("remove_context"!=b&&(deselect_all(),render_scene()),$("#"+active_menu).hide(),$("#"+c).show(),active_menu=c,active_context=b)}});$("#label_pos").on("click","button",function(b){$("#label_pos").find("button").removeClass("active");
$(this).addClass("active");label_position=this.id});$('#rectangle_type button[data-style="full"]').addClass("active");$("#rectangle_type").on("click","button",function(b){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#circle_type button[data-style="full"]').addClass("active");$("#circle_type").on("click","button",function(b){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#circle_draw_style button[data-draw_style="edge"]').addClass("active");$("#circle_draw_style").on("click",
"button",function(b){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#polygon_type button[data-style="full"]').addClass("active");$("#polygon_type").on("click","button",function(b){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#area_type button[data-style="full"]').addClass("active");$("#area_type").on("click","button",function(b){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#line_type button[data-style="full"]').addClass("active");
$("#line_type").on("click","button",function(b){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#line_end_type button[data-end="arrow"]').addClass("active");$("#line_end_type").on("click","button",function(b){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#curve_type button[data-style="full"]').addClass("active");$("#curve_type").on("click","button",function(b){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#curve_end_type button[data-end="arrow"]').addClass("active");
$("#curve_end_type").on("click","button",function(b){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#track_shape button[data-cursor="cursor"]').addClass("active");$("#track_shape").on("click","button",function(b){$(this).addClass("active");$(this).siblings().removeClass("active");my_tracker&&stop_tracking();start_tracking({x:2E3,y:2E3})});$('#draw_type button[data-style="full"]').addClass("active");$("#draw_type").on("click","button",function(b){$(this).addClass("active");
$(this).siblings().removeClass("active")});$('#draw_end_type button[data-end="arrow"]').addClass("active");$("#draw_end_type").on("click","button",function(b){$(this).addClass("active");$(this).siblings().removeClass("active")});$("#userlist").on("click","button",function(){var b=$(this).attr("id");if(b!=my_user.id&&"owner"==my_user.role)return userlist[b].role?"driver"==userlist[b].role?(userlist[b].role="owner",$(this).css("background-color","lime")):"owner"==userlist[b].role&&(delete userlist[b].role,
$(this).css("background-color","")):(userlist[b].role="driver",$(this).css("background-color","yellow")),socket.emit("update_user",room,userlist[b]),!1});$("#clear_all").click(function(){clear()});$("#clear_draw").click(function(){clear("drawing")});$("#clear_icons").click(function(){clear("icon")});$("#clear_lines").click(function(){clear("line")});$("#clear_text").click(function(){clear("text")});$("#clear_curve").click(function(){clear("curve")});$("#clear_rectangle").click(function(){clear("rectangle")});
$("#clear_circle").click(function(){clear("circle")});$("#clear_polygon").click(function(){clear("polygon")});$("#clear_area").click(function(){clear("area")});$("#clear_selected").click(function(){clear_selected()});$("#clear_note").click(function(){clear("note")});$("#nuke_room").click(function(){1==confirm("Warning: all unsaved data will be lost")&&socket.emit("nuke_room",room,game)});$("body").on("click",".tank_select",function(){$(".tank_select.selected").removeClass("selected");$(this).addClass("selected");
selected_icon=$(this).attr("id");selected_icon_no_color="true"==$(this).attr("data-no_color")?!0:!1;icon_extra_scale=$(this).attr("data-scale")?parseFloat($(this).attr("data-scale")):1});assets_loaded=!0;socket.on("connect",function(){console.log("Connecting/Reconnecting");socket.emit("join_room",room,game)});socket.connected&&socket.emit("join_room",room,game)});socket.on("room_data",function(b,c,f){cleanup();room_data=b;video_paused=b.video_paused;active_slide=room_data.active_slide;is_room_locked=
room_data.locked;my_user_id=c;(tactic_name=f)&&""!=tactic_name&&(document.title="Tactic - "+tactic_name);for(var a in room_data.userlist)add_user(room_data.userlist[a]);var g=[],e,k;for(k in room_data.slides[active_slide].entities)"background"==room_data.slides[active_slide].entities[k].type?e=room_data.slides[active_slide].entities[k]:g.push(room_data.slides[active_slide].entities[k]);try{g.sort(function(a,b){return a.z_index-b.z_index})}catch(m){}var h=function(){room_data.pan_zoom&&pan_zoom(room_data.pan_zoom[0],
room_data.pan_zoom[1],room_data.pan_zoom[2])};e?set_background(e,function(){if(background.is_video)rebuild_timeline(),room_data.playback_rate&&set_playback_rate(room_data.playback_rate,room_data.playback_rate);else for(var a in g)create_entity(g[a]);h()}):h();for(k in room_data.trackers)create_tracker(room_data.trackers[k]);delete room_data.trackers;update_slide_buttons();update_my_user();my_tracker&&(stop_tracking(),start_tracking({x:2E3,y:2E3}));is_video_replay&&(sync_start_time=Date.now(),socket.emit("sync_clock"),
clearInterval(clock_sync_event),clock_sync_event=setInterval(function(){sync_start_time=Date.now();socket.emit("sync_clock")},2E4));render_scene()});socket.on("create_entity",function(b,c,f){c!=active_slide?room_data.slides[c].entities[b.uid]=b:create_entity(b);activity_animation(f)});socket.on("drag",function(b,c,f,a,g,e,k){c!=active_slide?room_data.slides[c].entities[b]&&(room_data.slides[c].entities[b].x=f,room_data.slides[c].entities[b].y=a,g&&(room_data.slides[c].entities[b].scale=g),e&&(room_data.slides[c].entities[b].rotation=
e)):room_data.slides[c].entities[b]&&drag_entity(room_data.slides[active_slide].entities[b],f,a,g,e);activity_animation(k)});socket.on("ping_marker",function(b,c,f,a,g){ping(b,c,f,a);activity_animation(g)});socket.on("chat",function(b,c){chat(b,c)});socket.on("identify",function(b){my_user?(my_user.logged_in=b.logged_in,my_user.name=b.name):my_user=b;update_my_user()});socket.on("remove",function(b,c,f){c!=active_slide?delete room_data.slides[c].entities[b]:remove(b);activity_animation(f)});socket.on("add_user",
function(b){add_user(b)});socket.on("remove_user",function(b){remove_user(b)});socket.on("lock_room",function(b,c){is_room_locked=b;update_lock();activity_animation(c)});socket.on("change_slide",function(b){b!=active_slide&&change_slide(b)});socket.on("new_slide",function(b,c){add_slide(b);activity_animation(c)});socket.on("remove_slide",function(b,c){1>=Object.keys(room_data.slides)?socket.emit("join_room",room,game):(remove_slide(b),activity_animation(c))});socket.on("rename_slide",function(b,c,
f){rename_slide(b,c);activity_animation(f)});socket.on("change_slide_order",function(b,c,f){room_data.slides[b].order=c;update_slide_buttons();activity_animation(f)});socket.on("track",function(b,c){trackers[b.uid]&&remove_tracker(uid);create_tracker(b);activity_animation(c)});socket.on("track_move",function(b,c,f){move_tracker(b,c,f)});socket.on("stop_track",function(b){remove_tracker(b)});socket.on("show_grid",function(b,c,f){room_data.slides[b].show_grid=c;b==active_slide&&(grid_layer.visible=
c,render_scene());activity_animation(f)});socket.on("pan_zoom",function(b,c,f,a){activity_animation(b,c,f);pan_zoom(b,c,f)});socket.on("force_reconnect",function(){location.reload()});socket.on("play_video",function(b,c,f,a){activity_animation(a);set_playback_rate(f,f);handle_play(b,c)});socket.on("pause_video",function(b,c){handle_pause(b);activity_animation(c)});socket.on("sync_video",function(b,c,f){handle_sync(b,c,f)});socket.on("request_sync",function(){if(im_syncing)for(var b=0;5>=b;b++)setTimeout(function(){var b=
video_progress();socket.emit("sync_video",room,b,get_server_time())},2E3*b)});socket.on("sync_clock",function(b){var c=Date.now();offset=b+(c-sync_start_time)/2-c});socket.on("seek_video",function(b,c,f){video_media.setCurrentTime(b);video_paused?video_player.pause():(handle_sync(b,c,f),wait_for_seek(function(){rebuild_timeline()}))});socket.on("change_rate",function(b){set_playback_rate(b,b)})});

//# sourceMappingURL=combined.js.map